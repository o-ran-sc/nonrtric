[{"id":"981e056f.00e92","type":"dgstart","name":"DGSTART","outputs":1,"x":144,"y":93,"z":"58a990e2.9c1408","wires":[["cd88fdf4.d26cb8"]]},{"id":"cd88fdf4.d26cb8","type":"service-logic","name":"GENERIC-RESOURCE-API 1.1.0-SNAPSHOT-111701","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":240.23807907104492,"y":153.95239067077637,"z":"58a990e2.9c1408","wires":[["deb4f99a.917d9"]]},{"id":"deb4f99a.917d9","type":"method","name":"tunnelxconn-topology-operation-activate","xml":"<method rpc='tunnelxconn-topology-operation-activate' mode='sync'>\n","comments":"","outputs":1,"x":286.15485763549805,"y":189.19044589996338,"z":"58a990e2.9c1408","wires":[["1b3faaa6.b124c5"]]},{"id":"1b3faaa6.b124c5","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":194.47619247436523,"y":332.5237879753113,"z":"58a990e2.9c1408","wires":[["1307f869.2b6cd8","809972ef.32aa68","abd5e0c.9a04a2","3a16a190.19236e","7c15294.f6d20d8","a59e6cd5.d18278","4659a1a.641356","5581c8c3.58ae58","a8fc0526.9f7d6","a061c39.68b194","e19d9646.79311","a072200f.8e7178"]]},{"id":"809972ef.32aa68","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":461.0001106262207,"y":1002.2145080566406,"z":"58a990e2.9c1408","wires":[]},{"id":"1307f869.2b6cd8","type":"set","name":"set output to api handler","xml":"<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='tunnelxconn-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $tunnelxconn-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n","comments":"","x":489.75402450561523,"y":966.3370542526245,"z":"58a990e2.9c1408","wires":[]},{"id":"a061c39.68b194","type":"set","name":"set allotted-resource-oper-status","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='Active' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$tunnelxconn-topology-operation-input.request-information.request-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n","comments":"","x":500.7542190551758,"y":713.0514001846313,"z":"58a990e2.9c1408","wires":[]},{"id":"3a16a190.19236e","type":"set","name":"set tmp.ar.self-link","xml":"<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:tunnelxconn-allotted-resources/tunnelxconn-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/tunnelxconn-topology/'` \" />\n\n","comments":"","x":453.73805236816406,"y":324.33332443237305,"z":"58a990e2.9c1408","wires":[]},{"id":"abd5e0c.9a04a2","type":"set","name":"set tmp.ar.allotted-resource-id,etc","xml":"<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n<parameter name='tmp.ar.parent-service-instance-id' value='`$tunnelxconn-topology-operation-input.allotted-resource-information.parent-service-instance-id`' />\n<parameter name='tmp.ar.brg-vnf-id' value='`$tunnelxconn-topology-operation-input.allotted-resource-data.tunnelxconn-topology.tunnelxconn-assignments.tunnelxconn-vnf-id`' />\n\n\n","comments":"","x":500.997314453125,"y":290.59259033203125,"z":"58a990e2.9c1408","wires":[]},{"id":"7c15294.f6d20d8","type":"execute","name":"execute Properties","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":459.993408203125,"y":360.23152351379395,"z":"58a990e2.9c1408","wires":[[]]},{"id":"4659a1a.641356","type":"execute","name":"execute RestApiCallNode - Get AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":525.5187530517578,"y":503.4594917297363,"z":"58a990e2.9c1408","wires":[["d5420c75.e1a068","8c63e091.1c25a"]]},{"id":"a59e6cd5.d18278","type":"execute","name":"generate allotted-resource url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.tx-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n","comments":"","outputs":1,"x":488.0648422241211,"y":420.0172281265259,"z":"58a990e2.9c1408","wires":[[]]},{"id":"d5420c75.e1a068","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":782.8148918151855,"y":502.26725220680237,"z":"58a990e2.9c1408","wires":[["35fdf191.06bf8e"]]},{"id":"5581c8c3.58ae58","type":"execute","name":"execute RestApiCallNode - PUT AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.tx.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":533.5293121337891,"y":856.4341316223145,"z":"58a990e2.9c1408","wires":[["777acde7.9ef674","20c6b40.7c54d4c","933655b0.cd72e8"]]},{"id":"777acde7.9ef674","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":803.837329864502,"y":909.432332418859,"z":"58a990e2.9c1408","wires":[["b19ae1f0.49793"]]},{"id":"20c6b40.7c54d4c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":794.8373794555664,"y":877.9323581680655,"z":"58a990e2.9c1408","wires":[["b19ae1f0.49793"]]},{"id":"933655b0.cd72e8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":798.5874176025391,"y":848.2894630432129,"z":"58a990e2.9c1408","wires":[["5ddd3ee.6ad194"]]},{"id":"b19ae1f0.49793","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for tunnelxconn-allotted-resource\" />\n","comments":"","x":964.5874176025391,"y":878.6823820099235,"z":"58a990e2.9c1408","wires":[]},{"id":"35fdf191.06bf8e","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":963.8148460388184,"y":502.7672016620636,"z":"58a990e2.9c1408","wires":[["7b5dcd10.39bc8c","e690203.d87676"]]},{"id":"7b5dcd10.39bc8c","type":"switchNode","name":"switch tx length","xml":"<switch test='`$mdsal-ar.tunnelxconn-allotted-resource_length`'>\n","comments":"","outputs":1,"x":1209.6720924377441,"y":537.052964925766,"z":"58a990e2.9c1408","wires":[["6c133fab.55436"]]},{"id":"6c133fab.55436","type":"other","name":"outcome 1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":1400.6720962524414,"y":537.0529625415802,"z":"58a990e2.9c1408","wires":[["29b0d828.00bad"]]},{"id":"77bfd621.2d5df8","type":"set","name":"set tx-ar from get","xml":"<set>\n<parameter name='tx-ar.' value='$mdsal-ar.tunnelxconn-allotted-resource[0].' />\n","comments":"","x":1800.5292320251465,"y":537.6243867874146,"z":"58a990e2.9c1408","wires":[]},{"id":"29b0d828.00bad","type":"block","name":"block: atomic","xml":"<block atomic='true'>\n","atomic":"false","comments":"","outputs":1,"x":1571.5290794372559,"y":537.6244316101074,"z":"58a990e2.9c1408","wires":[["77bfd621.2d5df8","c0f2542e.da588","9bfcca3f.570378"]]},{"id":"c0f2542e.da588","type":"set","name":"set oper-status","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$tx-ar.allotted-resource-data.allotted-resource-operation-information.request-information.request-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$tx-ar.allotted-resource-status.rpc-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$tx-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.svc-request-id`' />\n\n","comments":"","x":1798.5294761657715,"y":605.0529508590698,"z":"58a990e2.9c1408","wires":[]},{"id":"81df98f1.37d4d","type":"comment","name":"GET tunnelxconn-allotted-resource from mdsal","info":"","comments":"","x":550.8148155212402,"y":466.7671926021576,"z":"58a990e2.9c1408","wires":[]},{"id":"9bfcca3f.570378","type":"switchNode","name":"switch order-status","xml":"<switch test='`$tx-ar.allotted-resource-data.allotted-resource-oper-status.order-status`'>\n","comments":"","outputs":1,"x":1808.52925491333,"y":570.6243848800659,"z":"58a990e2.9c1408","wires":[["a1591402.ef402","263fbca1.ee9e44"]]},{"id":"a1591402.ef402","type":"outcome","name":"outcome Created","xml":"<outcome value='Created'>\n","comments":"","outputs":1,"x":2020.1292114257812,"y":531.6243848800659,"z":"58a990e2.9c1408","wires":[["dcaba266.f2c058"]]},{"id":"263fbca1.ee9e44","type":"outcome","name":"outcome Other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2045.8435859680176,"y":567.052975654602,"z":"58a990e2.9c1408","wires":[["dcaba266.f2c058"]]},{"id":"868474a4.fe42d","type":"comment","name":"Set allotted-resource-identifiers","info":"","comments":"","x":506.33863830566406,"y":557.3386459350586,"z":"58a990e2.9c1408","wires":[]},{"id":"e690203.d87676","type":"set","name":"save backup copy of mdsal-ar for rollback","xml":"<set>\n<parameter name='bk-tx-ar' value='$mdsal-ar.' />\n","comments":"","x":1289.3864250183105,"y":502.76729369163513,"z":"58a990e2.9c1408","wires":[]},{"id":"15b321eb.5032de","type":"comment","name":"Create urls for restapi","info":"","comments":"","x":458.95764923095703,"y":389.6243553161621,"z":"58a990e2.9c1408","wires":[]},{"id":"5ddd3ee.6ad194","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":940.2433853149414,"y":844.481632232666,"z":"58a990e2.9c1408","wires":[[]]},{"id":"dc646785.b390d","type":"comment","name":"TO DO: vnf/put parent","info":"","comments":"","x":464.2433776855469,"y":745.1481952667236,"z":"58a990e2.9c1408","wires":[]},{"id":"a8fc0526.9f7d6","type":"execute","name":"execute getTime","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n","comments":"","outputs":1,"x":448.24338150024414,"y":674.4815549850464,"z":"58a990e2.9c1408","wires":[[]]},{"id":"8c63e091.1c25a","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":782.5766868591309,"y":538.4814250469208,"z":"58a990e2.9c1408","wires":[["55d3815f.d40af8"]]},{"id":"55d3815f.d40af8","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":962.5766372680664,"y":539.1479756832123,"z":"58a990e2.9c1408","wires":[[]]},{"id":"e19d9646.79311","type":"set","name":"set id","xml":"<set>\n<parameter name='tx-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='tx-ar.allotted-resource-status.action' value=\"`$tunnelxconn-topology-operation-input.request-information.request-action` \" />\n<parameter name='tx-ar.allotted-resource-status.rpc-name' value=\"tunnelxconn-topology-operation\" />\n<parameter name='tx-ar.allotted-resource-status.rpc-action' value=\"`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$tunnelxconn-topology-operation-input.request-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$tunnelxconn-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$tunnelxconn-topology-operation-input.service-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.tunnelxconn-request-input.' value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.` \" />","comments":"","x":431.24342346191406,"y":594.1481666564941,"z":"58a990e2.9c1408","wires":[]},{"id":"dcaba266.f2c058","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2234.5997276306152,"y":533.0000190734863,"z":"58a990e2.9c1408","wires":[[]]},{"id":"a072200f.8e7178","type":"update","name":"update AAI allotted-resource","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $tunnelxconn-topology-operation-input.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $tunnelxconn-topology-operation-input.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $tunnelxconn-topology-operation-input.allotted-resource-information.parent-service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n\t<parameter name=\"operational-status\" value=\"in-service-path\" />\n\n\n<!--\n\n<set>\n$tunnelxconn-topology-operation-input.service-information.global-customer-id\n$tunnelxconn-topology-operation-input.service-information.subscription-service-type\n\n\t\tkey=\"customer.global-customer-id = $service-data.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $service-data.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $service-data.service-information.service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n\t\t\t\n\t\t\t$tunnelxconn-topology-operation-input.allotted-resource-information.parent-service-instance-id\n\t\t\t\n-->","comments":"","outputs":1,"x":491.85716247558594,"y":778.2380628585815,"z":"58a990e2.9c1408","wires":[["d29c55c2.14d6","287d76d.31b2f0a"]]},{"id":"d29c55c2.14d6","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":747.6190567016602,"y":761.1905598640442,"z":"58a990e2.9c1408","wires":[["2918b200.d40266"]]},{"id":"2918b200.d40266","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n","comments":"","x":914.142936706543,"y":772.8096308708191,"z":"58a990e2.9c1408","wires":[]},{"id":"287d76d.31b2f0a","type":"failure","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":754.7143440246582,"y":793.9525275230408,"z":"58a990e2.9c1408","wires":[["2918b200.d40266"]]},{"id":"be5072e4.33f558","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":236,"y":785,"z":"58a990e2.9c1408","wires":[]}]
