[{"id":"77e7c41f.d39b2c","type":"dgstart","name":"DGSTART","outputs":1,"x":129,"y":77,"z":"2b82a97f.11e4ee","wires":[["eb62acdc.bba158"]]},{"id":"eb62acdc.bba158","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":225.23807907104492,"y":137.95239067077637,"z":"2b82a97f.11e4ee","wires":[["6dbf8ba8.4b789c"]]},{"id":"6dbf8ba8.4b789c","type":"method","name":"tunnelxconn-topology-operation-deactivate","xml":"<method rpc='tunnelxconn-topology-operation-deactivate' mode='sync'>\n","comments":"","outputs":1,"x":271.15485763549805,"y":173.19044589996338,"z":"2b82a97f.11e4ee","wires":[["12e90cec.9889bb"]]},{"id":"12e90cec.9889bb","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":179.47619247436523,"y":316.5237879753113,"z":"2b82a97f.11e4ee","wires":[["bfde80e.cd9818","a9f3bbe1.8e6458","2ebe5fb6.6deef","a139db86.7c9fb","50a44a6b.6f304c","f5391cda.7ebb38","7dc1b11b.7bf04","4e75d792.04ff58","5fcf2002.dc2648","6bad160a.61f6c8","63f6549a.034eec","17f54773.35cae9"]]},{"id":"a9f3bbe1.8e6458","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":446.0001106262207,"y":986.2145080566406,"z":"2b82a97f.11e4ee","wires":[]},{"id":"bfde80e.cd9818","type":"set","name":"set output to api handler","xml":"<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='tunnelxconn-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $tunnelxconn-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n","comments":"","x":474.7540283203125,"y":949.3370361328125,"z":"2b82a97f.11e4ee","wires":[]},{"id":"6bad160a.61f6c8","type":"set","name":"set allotted-resource-oper-status","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='PendingDelete' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$tunnelxconn-topology-operation-input.request-information.request-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n","comments":"","x":485.7542419433594,"y":697.0514221191406,"z":"2b82a97f.11e4ee","wires":[]},{"id":"a139db86.7c9fb","type":"set","name":"set tmp.ar.self-link","xml":"<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:tunnelxconn-allotted-resources/tunnelxconn-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/tunnelxconn-topology/'` \" />\n\n","comments":"","x":441.73806381225586,"y":290.33332538604736,"z":"2b82a97f.11e4ee","wires":[]},{"id":"2ebe5fb6.6deef","type":"set","name":"set tmp.ar.allotted-resource-id,etc","xml":"<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n<parameter name='tmp.ar.parent-service-instance-id' value='`$tunnelxconn-topology-operation-input.allotted-resource-information.parent-service-instance-id`' />\n\n\n","comments":"","x":488.9973258972168,"y":256.59259128570557,"z":"2b82a97f.11e4ee","wires":[]},{"id":"50a44a6b.6f304c","type":"execute","name":"execute Properties","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":447.9934196472168,"y":326.23152446746826,"z":"2b82a97f.11e4ee","wires":[[]]},{"id":"7dc1b11b.7bf04","type":"execute","name":"execute RestApiCallNode - Get AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":510.5187530517578,"y":487.4594917297363,"z":"2b82a97f.11e4ee","wires":[["a6b8e311.5d4ba","ed37dff8.8e4478"]]},{"id":"f5391cda.7ebb38","type":"execute","name":"generate allotted-resource url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.tx-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n","comments":"","outputs":1,"x":476.0648536682129,"y":386.0172290802002,"z":"2b82a97f.11e4ee","wires":[[]]},{"id":"a6b8e311.5d4ba","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":767.8148918151855,"y":486.26725220680237,"z":"2b82a97f.11e4ee","wires":[["78a50574.e49954"]]},{"id":"4e75d792.04ff58","type":"execute","name":"execute RestApiCallNode - PUT AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.tx.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":518.5293121337891,"y":840.4341316223145,"z":"2b82a97f.11e4ee","wires":[["2ed02149.4dd00e","a6a159ad.147bc","820e27ec.2ca21"]]},{"id":"2ed02149.4dd00e","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":788.837329864502,"y":893.432332418859,"z":"2b82a97f.11e4ee","wires":[["275cb7a4.5d6a28"]]},{"id":"a6a159ad.147bc","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":779.8373794555664,"y":861.9323581680655,"z":"2b82a97f.11e4ee","wires":[["275cb7a4.5d6a28"]]},{"id":"820e27ec.2ca21","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":783.5874176025391,"y":832.2894630432129,"z":"2b82a97f.11e4ee","wires":[["e3974867.1ad8f8"]]},{"id":"275cb7a4.5d6a28","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for tunnelxconn-allotted-resource\" />\n","comments":"","x":949.5874176025391,"y":862.6823820099235,"z":"2b82a97f.11e4ee","wires":[]},{"id":"78a50574.e49954","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":948.8148460388184,"y":486.7672016620636,"z":"2b82a97f.11e4ee","wires":[["495c50c0.877d7","15865c28.4b50bc"]]},{"id":"495c50c0.877d7","type":"switchNode","name":"switch tx length","xml":"<switch test='`$mdsal-ar.tunnelxconn-allotted-resource_length`'>\n","comments":"","outputs":1,"x":1194.6720924377441,"y":521.052964925766,"z":"2b82a97f.11e4ee","wires":[["17c51ecf.7cd569"]]},{"id":"17c51ecf.7cd569","type":"other","name":"outcome 1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":1385.6720962524414,"y":521.0529625415802,"z":"2b82a97f.11e4ee","wires":[["68fb786b.6c9068"]]},{"id":"f91188db.7ca6","type":"set","name":"set tx-ar from get","xml":"<set>\n<parameter name='tx-ar.' value='$mdsal-ar.tunnelxconn-allotted-resource[0].' />\n","comments":"","x":1785.5292320251465,"y":521.6243867874146,"z":"2b82a97f.11e4ee","wires":[]},{"id":"68fb786b.6c9068","type":"block","name":"block: atomic","xml":"<block atomic='true'>\n","atomic":"false","comments":"","outputs":1,"x":1556.5290794372559,"y":521.6244316101074,"z":"2b82a97f.11e4ee","wires":[["f91188db.7ca6","24a63c38.36bad4","ed06370.898bd48"]]},{"id":"24a63c38.36bad4","type":"set","name":"set oper-status","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$tx-ar.allotted-resource-data.allotted-resource-operation-information.request-information.request-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$tx-ar.allotted-resource-status.rpc-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$tx-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.svc-request-id`' />\n\n","comments":"","x":1783.5294761657715,"y":589.0529508590698,"z":"2b82a97f.11e4ee","wires":[]},{"id":"480b8187.423d28","type":"comment","name":"GET tunnelxconn-allotted-resource from mdsal","info":"","comments":"","x":535.8148155212402,"y":450.7671926021576,"z":"2b82a97f.11e4ee","wires":[]},{"id":"ed06370.898bd48","type":"switchNode","name":"switch order-status","xml":"<switch test='`$tx-ar.allotted-resource-data.allotted-resource-oper-status.order-status`'>\n","comments":"","outputs":1,"x":1793.52925491333,"y":554.6243848800659,"z":"2b82a97f.11e4ee","wires":[["8b637658.dc76d","523ac249.9cee14"]]},{"id":"8b637658.dc76d","type":"outcome","name":"outcome Created","xml":"<outcome value='Created'>\n","comments":"","outputs":1,"x":2005.1292114257812,"y":515.6243848800659,"z":"2b82a97f.11e4ee","wires":[["ae90d88c.f247e"]]},{"id":"523ac249.9cee14","type":"outcome","name":"outcome Other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2030.8435859680176,"y":551.052975654602,"z":"2b82a97f.11e4ee","wires":[["ae90d88c.f247e"]]},{"id":"8ab3497c.81651","type":"comment","name":"Set allotted-resource-identifiers","info":"","comments":"","x":491.33863830566406,"y":541.3386459350586,"z":"2b82a97f.11e4ee","wires":[]},{"id":"15865c28.4b50bc","type":"set","name":"save backup copy of mdsal-ar for rollback","xml":"<set>\n<parameter name='bk-tx-ar' value='$mdsal-ar.' />\n","comments":"","x":1274.3864250183105,"y":486.76729369163513,"z":"2b82a97f.11e4ee","wires":[]},{"id":"667a59da.7e3228","type":"comment","name":"Create urls for restapi","info":"","comments":"","x":446.9576606750488,"y":355.6243562698364,"z":"2b82a97f.11e4ee","wires":[]},{"id":"e3974867.1ad8f8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":925.2433853149414,"y":828.481632232666,"z":"2b82a97f.11e4ee","wires":[[]]},{"id":"877979d2.d0cc48","type":"comment","name":"TO DO: vnf/put parent","info":"","comments":"","x":453.52909088134766,"y":733.9101696014404,"z":"2b82a97f.11e4ee","wires":[]},{"id":"5fcf2002.dc2648","type":"execute","name":"execute getTime","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n","comments":"","outputs":1,"x":433.24338150024414,"y":658.4815549850464,"z":"2b82a97f.11e4ee","wires":[[]]},{"id":"ed37dff8.8e4478","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":767.5766868591309,"y":522.4814250469208,"z":"2b82a97f.11e4ee","wires":[["4ddae737.3112d"]]},{"id":"4ddae737.3112d","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":947.5766372680664,"y":523.1479756832123,"z":"2b82a97f.11e4ee","wires":[[]]},{"id":"63f6549a.034eec","type":"set","name":"set id","xml":"<set>\n<parameter name='tx-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='tx-ar.allotted-resource-status.action' value=\"`$tunnelxconn-topology-operation-input.request-information.request-action` \" />\n<parameter name='tx-ar.allotted-resource-status.rpc-name' value=\"tunnelxconn-topology-operation\" />\n<parameter name='tx-ar.allotted-resource-status.rpc-action' value=\"`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$tunnelxconn-topology-operation-input.request-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$tunnelxconn-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$tunnelxconn-topology-operation-input.service-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.tunnelxconn-request-input.' value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.` \" />","comments":"","x":416.24342346191406,"y":578.1481666564941,"z":"2b82a97f.11e4ee","wires":[]},{"id":"ae90d88c.f247e","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2219.5997276306152,"y":517.0000190734863,"z":"2b82a97f.11e4ee","wires":[[]]},{"id":"17f54773.35cae9","type":"update","name":"update AAI allotted-resource","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $service-data.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $service-data.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $service-data.service-information.service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n\t<parameter name=\"operational-status\" value=\"out-of-service-path\" />\n","comments":"","outputs":1,"x":480.42857360839844,"y":775.571418762207,"z":"2b82a97f.11e4ee","wires":[["5bc14f2f.834cb","dcde8ae.d8a6c78"]]},{"id":"5bc14f2f.834cb","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":736.1904830932617,"y":758.5239224433899,"z":"2b82a97f.11e4ee","wires":[["11d358d.8f25ba7"]]},{"id":"11d358d.8f25ba7","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n","comments":"","x":902.7143630981445,"y":770.1429934501648,"z":"2b82a97f.11e4ee","wires":[]},{"id":"dcde8ae.d8a6c78","type":"failure","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":743.2857704162598,"y":791.2858901023865,"z":"2b82a97f.11e4ee","wires":[["11d358d.8f25ba7"]]}]
