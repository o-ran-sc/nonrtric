[
  {
    "id": "41a7b6d3.f9b528",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 104.03125,
    "y": 62.99999749660492,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "f309be9c.cefce"
      ]
    ]
  },
  {
    "id": "f309be9c.cefce",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API ${project.version}",
    "module": "GENERIC-RESOURCE-API",
    "version": "${project.version}",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
    "outputs": 1,
    "x": 287.03125381469727,
    "y": 137.00001561641693,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "63686a7b.f7aa94"
      ]
    ]
  },
  {
    "id": "63686a7b.f7aa94",
    "type": "method",
    "name": "sdwan-attachment-topology-operation-create",
    "xml": "<method rpc='sdwan-attachment-topology-operation-create' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 275.0313720703125,
    "y": 224.99999845027924,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "445b402d.36165"
      ]
    ]
  },
  {
    "id": "445b402d.36165",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 195.03130340576172,
    "y": 974.0002464056015,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "57abe88c.4f1e28",
        "da2ee563.ca49c8",
        "d7db7598.ec6a58",
        "b1a31713.a74f68",
        "bb52c8b.9210938",
        "e248322d.07f73",
        "e3ed6a01.033e28",
        "49207aa3.305be4",
        "e7fc7beb.0c2218",
        "fff0be1d.b2bcf",
        "6737ccd9.1b9484",
        "3d98ece2.536f54",
        "279d04d9.311b7c",
        "bd2101b.463ff",
        "a593e64c.edffe8",
        "ad258829.1a9fb8",
        "d28d77a4.947808",
        "b3ca8b3e.e57468",
        "4f85eb.0fdeca14",
        "4b8ef133.24669",
        "3a0fc26c.48c2fe",
        "13f594ad.41064b",
        "571ae355.45c2fc",
        "936a519f.07274"
      ]
    ]
  },
  {
    "id": "f44d3a22.e968a8",
    "type": "comment",
    "name": "Set allotted resource id if not sent by SO",
    "info": "",
    "comments": "",
    "x": 679.1080017089844,
    "y": 134.43391740322113,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "57abe88c.4f1e28",
    "type": "switchNode",
    "name": "switch allotted-resource-id",
    "xml": "<switch test='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-id`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 625.0312805175781,
    "y": 189.9999908208847,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "4ebc9e25.f0a41",
        "c5e852a7.8a1b7"
      ]
    ]
  },
  {
    "id": "4ebc9e25.f0a41",
    "type": "outcome",
    "name": "NULL",
    "xml": "<outcome value=''>",
    "comments": "",
    "outputs": 1,
    "x": 823.0313682556152,
    "y": 159.9999793767929,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "80de8467.db5608"
      ]
    ]
  },
  {
    "id": "c5e852a7.8a1b7",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 822.0312767028809,
    "y": 196.9999898672104,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "f37c96f7.6c5a88"
      ]
    ]
  },
  {
    "id": "f37c96f7.6c5a88",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-id",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n",
    "comments": "",
    "x": 1020.0312652587891,
    "y": 194.00000894069672,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "da2ee563.ca49c8",
    "type": "set",
    "name": "set tmp.ar.self-link",
    "xml": "<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:connection-attachment-allotted-resources/connection-attachment-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/connection-attachment-topology/'` \" />\n\n",
    "comments": "",
    "x": 593.0312042236328,
    "y": 411.00009763240814,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "d7db7598.ec6a58",
    "type": "execute",
    "name": "execute Properties",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n",
    "comments": "",
    "outputs": 1,
    "x": 593.2931213378906,
    "y": 492.666778922081,
    "z": "588621bb.e9fef",
    "wires": [
      []
    ]
  },
  {
    "id": "b1a31713.a74f68",
    "type": "execute",
    "name": "generate allotted-resource tmp.ar-url",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.connection-attachment-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 646.2931823730469,
    "y": 579.6666969060898,
    "z": "588621bb.e9fef",
    "wires": [
      []
    ]
  },
  {
    "id": "80de8467.db5608",
    "type": "execute",
    "name": "execute tmp.ar.allotted-resource-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"tmp.ar.allotted-resource-id\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1038.0313453674316,
    "y": 160.9999850988388,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "827e9a97.124e48"
      ]
    ]
  },
  {
    "id": "827e9a97.124e48",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1256.0313873291016,
    "y": 160.99994885921478,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "153037d4.5daa68"
      ]
    ]
  },
  {
    "id": "153037d4.5daa68",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value=\"An error occured while generation allotted resource ID\" />\n",
    "comments": "",
    "x": 1422.0313415527344,
    "y": 160.99996316432953,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "8fcb37f5.98d048",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1152.0314807891846,
    "y": 651.7778695821762,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "91db96ee.5f5ab8"
      ]
    ]
  },
  {
    "id": "bc59ed7b.1de9c",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error: Existing connection attachment allotted resource\" />\n    \n",
    "comments": "",
    "x": 1885.5498600006104,
    "y": 652.8439410924911,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "b0f210fa.eabdf",
    "type": "comment",
    "name": "Check for non existence of allotted resource",
    "info": "",
    "comments": "",
    "x": 1008.0314025878906,
    "y": 585.7779363393784,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "a2101ce1.011fb",
    "type": "for",
    "name": "for cidx..service-data.consumed-allotted-resources.consumed-allotted-resource[]",
    "xml": "<for index='cidx' start='0' end='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1528.6979484558105,
    "y": 796.0000487565994,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "f78e26b6.71e388"
      ]
    ]
  },
  {
    "id": "e248322d.07f73",
    "type": "switchNode",
    "name": "switch service-data.consumed-allotted-resources_length",
    "xml": "<switch test='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 710.6972732543945,
    "y": 772.7140811681747,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "30dfa22f.78a2de",
        "3fbb9163.26209e"
      ]
    ]
  },
  {
    "id": "30dfa22f.78a2de",
    "type": "other",
    "name": "outcome Null",
    "xml": "<outcome value=''>\n",
    "comments": "",
    "outputs": 1,
    "x": 1014.8401718139648,
    "y": 741.5715183019638,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "a8a680b4.767d6"
      ]
    ]
  },
  {
    "id": "3fbb9163.26209e",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 991.8402214050293,
    "y": 802.5714734792709,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "c3b51f9c.33bcc"
      ]
    ]
  },
  {
    "id": "c3b51f9c.33bcc",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1151.9673118591309,
    "y": 800.6974500417709,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "a2101ce1.011fb",
        "e3a80e4a.14e7d",
        "6c9a2abd.a627f4"
      ]
    ]
  },
  {
    "id": "a8a680b4.767d6",
    "type": "set",
    "name": "set cidx",
    "xml": "<set>\n<parameter name='tmp.cidx' value=\"`0`\" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value=\"1\" />\n\n\n",
    "comments": "",
    "x": 1164.6971549987793,
    "y": 739.2855685949326,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "e3ed6a01.033e28",
    "type": "set",
    "name": "set consumed allotted resources",
    "xml": "<set>\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-type' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-pointer' value=\"`$tmp.ar.self-link` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value='`$tmp.cidx + 1`' />\n\n",
    "comments": "",
    "x": 639.5545654296875,
    "y": 876.2856458425522,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "e3a80e4a.14e7d",
    "type": "switchNode",
    "name": "switch tmp.found-cidx",
    "xml": "<switch test='`$tmp.found-cidx`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1341.0823593139648,
    "y": 832.7089728116989,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "cbb92020.3ddcd"
      ]
    ]
  },
  {
    "id": "cbb92020.3ddcd",
    "type": "outcomeTrue",
    "name": "false",
    "xml": "<outcome value='false'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1531.0823135375977,
    "y": 832.708909869194,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "808efd55.65f55"
      ]
    ]
  },
  {
    "id": "808efd55.65f55",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1697.0823135375977,
    "y": 832.708909869194,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "6d2d79a2.093ad8"
      ]
    ]
  },
  {
    "id": "f78e26b6.71e388",
    "type": "switchNode",
    "name": "switch allotted-resource-id",
    "xml": "<switch test=\"`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].allotted-resource-id == $tmp.ar.allotted-resource-id`\">\n\n",
    "comments": "",
    "outputs": 1,
    "x": 1945.8095779418945,
    "y": 793.0000756978989,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "b1c9d43a.bd2f08"
      ]
    ]
  },
  {
    "id": "b1c9d43a.bd2f08",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2127.619152069092,
    "y": 793.4645227193832,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "1288ae5b.1e1ce2"
      ]
    ]
  },
  {
    "id": "6d2d79a2.093ad8",
    "type": "set",
    "name": "set tmp.cidx",
    "xml": "<set>\n<parameter name='tmp.cidx' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' />\n",
    "comments": "",
    "x": 1858.955696105957,
    "y": 832.2206109762192,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "8e24c24b.d6fc2",
    "type": "comment",
    "name": "Add to consumed service consumed-allotted-resources in mdsal",
    "info": "Prepare data and add to service-data",
    "comments": "",
    "x": 731.698486328125,
    "y": 703.0000451803207,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "2cffaf1f.4fc49",
    "type": "comment",
    "name": "This set resource will be added to MDSAL by provider code",
    "info": "Below we add to service-data.consumed-allotted-resource at last index",
    "comments": "",
    "x": 719.0314025878906,
    "y": 841.7781375646591,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "571ae355.45c2fc",
    "type": "update",
    "name": "save AAI allotted-resource",
    "xml": "<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $connection-attachment-topology-operation-input.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $connection-attachment-topology-operation-input.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $connection-attachment-topology-operation-input.service-information.service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n    <parameter name=\"id\" value=\"`$tmp.ar.allotted-resource-id`\" />\n\t<parameter name=\"role\" value=\"`$prop.connection-attachment.role`\" />\t\n    <parameter name=\"vpn-name\" value=\"`$prop.connection-attachment.sdwanVpnName`\" />\n\t<parameter name=\"selflink\" value=\"`$tmp.ar.self-link`\" />\n\t<parameter name=\"model-invariant-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-invariant-uuid`\" />\n\t<parameter name=\"model-version-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-uuid`\" />\n\t<parameter name=\"operational-status\" value=\"Created\" />\n",
    "comments": "",
    "outputs": 1,
    "x": 629.7221069335938,
    "y": 1801.531901717186,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "bad0c727.d486c8",
        "6744df38.44f3c"
      ]
    ]
  },
  {
    "id": "bad0c727.d486c8",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 824.4840431213379,
    "y": 1792.4845031499863,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "be610d32.68478"
      ]
    ]
  },
  {
    "id": "be610d32.68478",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n",
    "comments": "",
    "x": 991.0079231262207,
    "y": 1804.1035741567612,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "6744df38.44f3c",
    "type": "failure",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 831.5793304443359,
    "y": 1825.2464708089828,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "be610d32.68478"
      ]
    ]
  },
  {
    "id": "7ddcb0e1.3b36d",
    "type": "comment",
    "name": "Save Resource to AAI",
    "info": "",
    "comments": "",
    "x": 663.5317840576172,
    "y": 1769.8338731527328,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "42977fdb.9150a",
    "type": "comment",
    "name": "Set allotted resource type if not sent by SO",
    "info": "",
    "comments": "",
    "x": 665.03125,
    "y": 242.99999845027924,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "bb52c8b.9210938",
    "type": "switchNode",
    "name": "switch allotted-resource-type",
    "xml": "<switch test='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 626.9545593261719,
    "y": 283.5660547018051,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "ebcdd7cc.5ddb28",
        "5e1b4704.ff03b8"
      ]
    ]
  },
  {
    "id": "ebcdd7cc.5ddb28",
    "type": "outcome",
    "name": "NULL",
    "xml": "<outcome value=''>",
    "comments": "",
    "outputs": 1,
    "x": 829.9547119140625,
    "y": 268.56605756282806,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "e292f924.218148"
      ]
    ]
  },
  {
    "id": "5e1b4704.ff03b8",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 822.9545402526855,
    "y": 308.5660775899887,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "bc4b0c6b.6b5dc"
      ]
    ]
  },
  {
    "id": "bc4b0c6b.6b5dc",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-type",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-type' value='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type`' />\n",
    "comments": "",
    "x": 1054.9545249938965,
    "y": 308.5660823583603,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "e49aa8f1.f12588",
    "type": "comment",
    "name": "For storage in AAI connection-attachment-topology",
    "info": "",
    "comments": "",
    "x": 690.0312118530273,
    "y": 377.99999845027924,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "c0fccf31.3b1b7",
    "type": "comment",
    "name": "Obtain different URL, template location etc",
    "info": "For saving resource information to MDSAL & for AAI",
    "comments": "",
    "x": 665.0311965942383,
    "y": 459.888907790184,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "100bd889.c313d7",
    "type": "comment",
    "name": "Used for Put AR by id to MDSAL",
    "info": "",
    "comments": "",
    "x": 631.0312805175781,
    "y": 548.8889249563217,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "18c10c65.2f90b4",
    "type": "comment",
    "name": "Obtain the last index in services",
    "info": "ServiceData is added by Provider code",
    "comments": "",
    "x": 632.4757232666016,
    "y": 734.8888696432114,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "4f85eb.0fdeca14",
    "type": "set",
    "name": "set output to api handler",
    "xml": "<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='connection-attachment-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $connection-attachment-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n",
    "comments": "",
    "x": 615.2993927001953,
    "y": 1708.359200835228,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "4b8ef133.24669",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 583.7125244140625,
    "y": 1957.974946975708,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "e292f924.218148",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-type",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-type' value=\"SDWANAttachmentInstance\" />\n",
    "comments": "",
    "x": 1069.0313987731934,
    "y": 268.9999841451645,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "b3ca8b3e.e57468",
    "type": "execute",
    "name": "execute RestApiCallNode - PUT AR by id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.sdwan-attachment.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 666.0315246582031,
    "y": 1642.000130057335,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "891b6f50.0b8ca",
        "17f28b89.81c5a4",
        "6238cca6.7c6784"
      ]
    ]
  },
  {
    "id": "891b6f50.0b8ca",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 915.6728782653809,
    "y": 1680.3314603567123,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "c7ada304.940bb"
      ]
    ]
  },
  {
    "id": "17f28b89.81c5a4",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 906.6729278564453,
    "y": 1648.8314861059189,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "c7ada304.940bb"
      ]
    ]
  },
  {
    "id": "6238cca6.7c6784",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 910.422966003418,
    "y": 1619.1885909810662,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "9d842474.1d5df8"
      ]
    ]
  },
  {
    "id": "c7ada304.940bb",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource\" />\n",
    "comments": "",
    "x": 1076.422966003418,
    "y": 1649.5815099477768,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "9d842474.1d5df8",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1052.0789337158203,
    "y": 1615.3807601705194,
    "z": "588621bb.e9fef",
    "wires": [
      []
    ]
  },
  {
    "id": "6737ccd9.1b9484",
    "type": "execute",
    "name": "execute RestApiCallNode - Update parent provided service AR",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.parentsvc.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.parent-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"parent\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 731.0312042236328,
    "y": 1158.000163435936,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "ce9d67c0.fef428",
        "32ea0966.e31a46",
        "8052d936.8da758"
      ]
    ]
  },
  {
    "id": "ce9d67c0.fef428",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1039.3392639160156,
    "y": 1189.998439192772,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "cecd64fe.528bd8"
      ]
    ]
  },
  {
    "id": "32ea0966.e31a46",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1030.33931350708,
    "y": 1158.4984649419785,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "cecd64fe.528bd8"
      ]
    ]
  },
  {
    "id": "8052d936.8da758",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1034.0893516540527,
    "y": 1128.8555698171258,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "c4a631eb.caa38"
      ]
    ]
  },
  {
    "id": "cecd64fe.528bd8",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource\" />\n",
    "comments": "",
    "x": 1200.0893516540527,
    "y": 1159.2484887838364,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "c4a631eb.caa38",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1175.745319366455,
    "y": 1125.047739006579,
    "z": "588621bb.e9fef",
    "wires": [
      []
    ]
  },
  {
    "id": "9c5665b2.ee98f8",
    "type": "comment",
    "name": "Put the parent allotted resource in mdsal",
    "info": "",
    "comments": "",
    "x": 660.0311508178711,
    "y": 1120.000069975853,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "279d04d9.311b7c",
    "type": "set",
    "name": "set connection-attachment-ar-identifiers",
    "xml": "<set>\n<parameter name='connection-attachment-ar-identifiers.consuming-service-instance-id' value=\"`$connection-attachment-topology-operation-input.service-information.service-instance-id` \" />\n<parameter name='connection-attachment-ar-identifiers.parent-service-instance-id' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n<parameter name='connection-attachment-ar-identifiers.allotted-resource-type' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='connection-attachment-ar-identifiers.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n\n",
    "comments": "",
    "x": 656.3883361816406,
    "y": 1322.5716890096664,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "3d98ece2.536f54",
    "type": "set",
    "name": "set ar-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='connection-attachment-ar.allotted-resource-status.action' value=\"`$connection-attachment-topology-operation-input.request-information.request-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-name' value=\"connection-attachment-topology-operation\" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-action' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$connection-attachment-topology-operation-input.request-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$connection-attachment-topology-operation-input.service-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.' value=\"`$connection-attachment-topology-operation-input.connection-attachment-request-input.` \" />",
    "comments": "",
    "x": 576.2451629638672,
    "y": 1290.38119161129,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "bd2101b.463ff",
    "type": "set",
    "name": "set identifiers in overall structure",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.connection-attachment-topology.allotted-resource-identifiers.' \nvalue=\"`$connection-attachment-ar-identifiers.`\" />\n\n\n",
    "comments": "",
    "x": 635.1981353759766,
    "y": 1356.6668742895126,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "a593e64c.edffe8",
    "type": "execute",
    "name": "execute getTime",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 587.5309753417969,
    "y": 1430.000401854515,
    "z": "588621bb.e9fef",
    "wires": [
      []
    ]
  },
  {
    "id": "ad258829.1a9fb8",
    "type": "set",
    "name": "set allotted-resource-oper-status",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='Created' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$connection-attachment-topology-operation-input.request-information.request-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n",
    "comments": "",
    "x": 638.5180130004883,
    "y": 1485.9516347646713,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "d28d77a4.947808",
    "type": "set",
    "name": "set model-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.connection-attachment-topology.onap-model-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.` \" />",
    "comments": "",
    "x": 583.0866317749023,
    "y": 1391.5557597875595,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "23859bfe.f043f4",
    "type": "comment",
    "name": "Prepare data for allotted-resource addition to MDSAL",
    "info": "This will add to allotted-resource which is present inside service.",
    "comments": "",
    "x": 700.4201202392578,
    "y": 1256.5556062459946,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "fff0be1d.b2bcf",
    "type": "execute",
    "name": "generate parent-ar url - replace allotted-resource-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.parent-ar-url`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 695.5312652587891,
    "y": 1084.0000089406967,
    "z": "588621bb.e9fef",
    "wires": [
      []
    ]
  },
  {
    "id": "e7fc7beb.0c2218",
    "type": "execute",
    "name": "generate parent-ar url - replace service-instance-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.parent-provided-resource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.parent-service-instance-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 691.5311889648438,
    "y": 1041.000145316124,
    "z": "588621bb.e9fef",
    "wires": [
      []
    ]
  },
  {
    "id": "80cf2b3b.3e92b8",
    "type": "comment",
    "name": "Prepare Parent AR URL",
    "info": "Preparation to set provided-allotted-resource in parent service instance",
    "comments": "",
    "x": 609.5316467285156,
    "y": 970.0000985860825,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "49207aa3.305be4",
    "type": "set",
    "name": "set tmp.ar.parent-service-instance-id",
    "xml": "<set>\n<parameter name='tmp.ar.parent-service-instance-id' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n\n",
    "comments": "",
    "x": 648.5314407348633,
    "y": 1003.5000380277634,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "1288ae5b.1e1ce2",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource as cosumed allotted resource already exists.\" />\n",
    "comments": "",
    "x": 2205.7882232666016,
    "y": 841.6458276510239,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "6c9a2abd.a627f4",
    "type": "set",
    "name": "set tmp.found-cidx",
    "xml": "<set>\n<parameter name='tmp.found-cidx' value=\"`false`\" />\n\n\n",
    "comments": "",
    "x": 1331.6773948669434,
    "y": 753.3125706911087,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "57452405.e26b5c",
    "type": "comment",
    "name": "Add to parent services provided-allotted-resources in mdsal",
    "info": "",
    "comments": "",
    "x": 720.2327575683594,
    "y": 937.9792550802231,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "6013a8b1.8cfec8",
    "type": "comment",
    "name": "Add to allotted-resources in mdsal",
    "info": "",
    "comments": "",
    "x": 640.9999465942383,
    "y": 1223.9689353704453,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "91db96ee.5f5ab8",
    "type": "block",
    "name": "block: atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1314.031301498413,
    "y": 651.2777589559555,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "d36cd8c7.bbc8c8"
      ]
    ]
  },
  {
    "id": "d36cd8c7.bbc8c8",
    "type": "switchNode",
    "name": "switch cr length",
    "xml": "<switch test='`$mdsal-ar.connection-attachment-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1501.8886814117432,
    "y": 651.8968943357468,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "c670c701.c3ff18"
      ]
    ]
  },
  {
    "id": "c670c701.c3ff18",
    "type": "other",
    "name": "outcome 1",
    "xml": "<outcome value='1'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1701.2218036651611,
    "y": 651.8969730138779,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "bc59ed7b.1de9c"
      ]
    ]
  },
  {
    "id": "3a0fc26c.48c2fe",
    "type": "execute",
    "name": "execute RestApiCallNode - get-resource connection-attachment-allotted-resource",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 786.0313034057617,
    "y": 646.0000346899033,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "8fcb37f5.98d048",
        "230adea5.52af62"
      ]
    ]
  },
  {
    "id": "230adea5.52af62",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1154.0313339233398,
    "y": 616.0000327825546,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "f02fcbfc.47bf28"
      ]
    ]
  },
  {
    "id": "f02fcbfc.47bf28",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1306.0313339233398,
    "y": 615.0000327825546,
    "z": "588621bb.e9fef",
    "wires": [
      []
    ]
  },
  {
    "id": "13f594ad.41064b",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 592.0351715087891,
    "y": 1561.2500013113022,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "c4d3876.e194578",
        "a56d9e1e.69cb5"
      ]
    ]
  },
  {
    "id": "c4d3876.e194578",
    "type": "for",
    "name": "for each sdwan-get-request-input-param",
    "xml": "<for index='i' start='0' end='`$connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 927.0353698730469,
    "y": 1507.2501235604286,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "c009da24.7d2598"
      ]
    ]
  },
  {
    "id": "654cbf55.2b8ad",
    "type": "comment",
    "name": "Required for filling template values",
    "info": "This is done because connection-attachment is generic resource and doesn't have specific parameters",
    "comments": "",
    "x": 949.4798736572266,
    "y": 1541.0832842588425,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "eaf3595.bafe4a8",
    "type": "comment",
    "name": "Remove VNFC prefix",
    "info": "",
    "comments": "",
    "x": 1010.035213470459,
    "y": 1463.6944593191147,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "c009da24.7d2598",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1174.0352172851562,
    "y": 1508.6943687200546,
    "z": "588621bb.e9fef",
    "wires": [
      [
        "447c6486.c17b2c",
        "fb95c554.72d748"
      ]
    ]
  },
  {
    "id": "6b76a58c.b29a1c",
    "type": "comment",
    "name": "Take the parameter names by removing prefix",
    "info": "",
    "comments": "",
    "x": 1442.0350646972656,
    "y": 1424.250366806984,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "447c6486.c17b2c",
    "type": "execute",
    "name": "execute split parameterName",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param[$i].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1393.0697326660156,
    "y": 1459.229462981224,
    "z": "588621bb.e9fef",
    "wires": [
      []
    ]
  },
  {
    "id": "fb95c554.72d748",
    "type": "set",
    "name": "set parameterName",
    "xml": "<set>\n<parameter name=\"`connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param[$i].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
    "comments": "",
    "x": 1381.5142059326172,
    "y": 1563.2294334173203,
    "z": "588621bb.e9fef",
    "wires": []
  },
  {
    "id": "a56d9e1e.69cb5",
    "type": "call",
    "name": "call GENERIC-RESOURCE-API:sdwan-get-saved-ar-param",
    "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-saved-ar-param' mode='sync' >\n",
    "comments": "",
    "outputs": 1,
    "x": 968.0352172851562,
    "y": 1581.2500633001328,
    "z": "588621bb.e9fef",
    "wires": [
      []
    ]
  },
  {
    "id": "936a519f.07274",
    "type": "save",
    "name": "save allotted relationship in AAI",
    "xml": "<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" resource=\"service-instance:relationship-list\" \n\t\tkey=\"customer.global-customer-id = $connection-attachment-topology-operation-input.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $connection-attachment-topology-operation-input.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id\" \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"allotted-resource\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/business/customers/customer/' + $connection-attachment-topology-operation-input.service-information.global-customer-id + '/service-subscriptions/service-subscription/' + $connection-attachment-topology-operation-input.service-information.subscription-service-type + '/service-instances/service-instance/' + $connection-attachment-topology-operation-input.service-information.service-instance-id + '/allotted-resources/allotted-resource/' + $tmp.ar.allotted-resource-id`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"allotted-resource.id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$tmp.ar.allotted-resource-id`\" />\n\n\n\n",
    "comments": "",
    "outputs": 1,
    "x": 641.0312767028809,
    "y": 1884.531162261963,
    "z": "588621bb.e9fef",
    "wires": [
      []
    ]
  }
]
