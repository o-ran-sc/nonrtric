[{"id":"1f770d1b.dc38c3","type":"dgstart","name":"DGSTART","outputs":1,"x":95,"y":76.81381225585938,"z":"760a1398.0b459c","wires":[["4fe79f76.5849e"]]},{"id":"371652dd.4cae3e","type":"method","name":"eipam-allocate-network-role-subnet","xml":"<method rpc='eipam-allocate-network-role-subnet' mode='sync'>\n","comments":"","outputs":1,"x":648.8667907714844,"y":79.68048095703125,"z":"760a1398.0b459c","wires":[["9ffb5e9d.17238"]]},{"id":"4fe79f76.5849e","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":323.95001220703125,"y":80.13049697875977,"z":"760a1398.0b459c","wires":[["371652dd.4cae3e"]]},{"id":"a4900b2a.5dcad8","type":"comment","name":"ChangeLog","info":"1.0.0: Release 1702 - EIPAM only allows allocating one address plan request at a time\n1.0.1: Release 1702 - introduced new input, eipam-ip-block.allocate-version to call EIPAM allocateSubnet individually\n                    - change toplevel block to Atomic, so if subet already exists, then it returns as failure\n                    - Update error msg\n1.0.2: Release 1702 - Remove check for existing subnet so can be called to create multiple subnet with same CLII_ZONE & NETWORK_ROLE, as \n\t\t\t\t\t\tin the autogrowth scenario\n1.0.3: Release 1702 - Req update to change level 1 & 2 key-name & key-values\n\t\t\t\t\t- update status to ACTIVE for level subnet\n\t\t\t\t\t- update service-type from $network-topology-operation-input.service-information.subscription-service-type to $tmp.service-type\n\t\t\t\t\t(cannot use the input field as not always populated in NTO-assign)\n\t\t\t\t\t- check for error when querying for entry in EIPAM_IP_POOLS before inserting to EIPAM_IP_SUBNETS\n1.0.4: Release 1707 - Add eipam-ip-block.subnet-size-override for level 2\n\n5/10 - 1707 - updated pool key-names for AIC_AIM_LANDING_NETWORK_V4\n6/20 - 1710 - change any underscores _  to colon : for all level 1 and level 2 Pool KeyNames\n6/21 - 1710 - Task 403314 - QIP Parent pool consolidation\n\t\t\t- New V6 plans - \n\t\t\t\tAIC_ATM_UNPROTECTED_V6\n\t\t\t\tAIC_ATM_PROTECTED_V6\n\t\t\t\tAIC_AIM_LANDING_V6\n3/8/18 - 1806 - 506678 -Level 1 keyName CLLI:CLOUD_REGION changed to LOCATION_CLLI8:CLOUD_REGION_ID\n","comments":"","x":150.68618774414062,"y":112,"z":"760a1398.0b459c","wires":[]},{"id":"9ffb5e9d.17238","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":117.68618774414062,"y":209.87387084960938,"z":"760a1398.0b459c","wires":[["d16b37cf.489f58","83ecc269.b0307","161f8d7c.8e3a03"]]},{"id":"d16b37cf.489f58","type":"set","name":"set: data initialization","xml":"<set>\n\t<parameter name=\"tmp.eipam-error\" value=\"false\" />\n\t<parameter name=\"eipam-ip-block.ip-prefix\" value='' />\n\t<parameter name=\"eipam-ip-block.mask\" value='' />\n\t<parameter name=\"pfx.eipam-pool-row\" value='' />\n\t<parameter name=\"tmp.level1-key-name\" value=\"LOCATION_CLLI8:CLOUD_REGION_ID\" />\n\t<parameter name=\"tmp.level2-key-name\" value=\"NETWORK_ROLE:NETWORK_ID\" />","comments":"","x":332.1201171875,"y":208.81381225585938,"z":"760a1398.0b459c","wires":[]},{"id":"80fa339c.99e08","type":"set","name":"set EIPAM plan info for Level 2 pool for allocateSubnet","xml":"<set>\n\t<parameter name=\"eipam-ip-block.plan-name\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n\t<parameter name=\"eipam-ip-block.activate-subnet-flag\" value=\"N\"/>\t\n\t<parameter name=\"eipam-ip-block.leaf-level-indicator\" value=\"Y\"/>\n\n\t<!-- Number of Pool Levels -->\n\t<parameter name=\"eipam-ip-block.pools_length\" value=\"2\"/>\n\n\t<!-- Level 1 -->\n\t<parameter name=\"eipam-ip-block.pools[0].key-name\" value=\"`$tmp.level1-key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[0].key-value\" value=\"`$tmp.level1-key-value`\"/>\n\n\t<!-- Level 2 -->\n\t<parameter name=\"eipam-ip-block.pools[1].key-name\" value=\"`$tmp.level2-key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[1].key-value\" value=\"`$tmp.level2-key-value`\"/>","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2098.9706802368164,"y":505.6710214614868,"z":"760a1398.0b459c","wires":[]},{"id":"83ecc269.b0307","type":"switchNode","name":"switch: eipam-ip-block.allocate-version","xml":"<switch test=\"`$eipam-ip-block.allocate-version`\">","comments":"Need to know which ipv version to get the plan name from the network-model.","outputs":1,"x":337,"y":551.8138084411621,"z":"760a1398.0b459c","wires":[["b722808e.ca0b5","e6300956.825bd8","6137dc86.9b29e4"]]},{"id":"b722808e.ca0b5","type":"other","name":"ipv4","xml":"<outcome value='ipv4'>","comments":"","outputs":1,"x":577.000114440918,"y":411.8138122558594,"z":"760a1398.0b459c","wires":[["916a463e.4fa4a8"]]},{"id":"916a463e.4fa4a8","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":731.000057220459,"y":410.81381607055664,"z":"760a1398.0b459c","wires":[["60c65685.a18c18"]]},{"id":"e6300956.825bd8","type":"other","name":"Null","xml":"<outcome value=''>","comments":"","outputs":1,"x":519.0000610351562,"y":1213.0541076660156,"z":"760a1398.0b459c","wires":[["501b79a.71a9088"]]},{"id":"4102ac63.9c8424","type":"set","name":"set EIPAM plan info for Level 1 pool for allocateSubnet","xml":"<set>\n\t<parameter name=\"eipam-ip-block.plan-name\" value=\"`$network-model.eipam-v6-address-plan`\"/>\n\t<parameter name=\"eipam-ip-block.activate-subnet-flag\" value=\"Y\"/>\t\n\t<parameter name=\"eipam-ip-block.leaf-level-indicator\" value=\"N\"/>\n\t<!-- Number of Pool Levels -->\n\t<parameter name=\"eipam-ip-block.pools_length\" value=\"1\"/>\n\n\t<!-- Level 1 -->\n\t<parameter name=\"eipam-ip-block.pools[0].key-name\" value=\"`$tmp.level1-key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[0].key-value\" value=\"`$tmp.level1-key-value`\"/>","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2104.736862182617,"y":1018.8138976097107,"z":"760a1398.0b459c","wires":[]},{"id":"66fa4ddd.45c444","type":"set","name":"set EIPAM plan info for Level 2 pool for allocateSubnet","xml":"<set>\n\t<parameter name=\"eipam-ip-block.plan-name\" value=\"`$network-model.eipam-v6-address-plan`\"/>\n\t<parameter name=\"eipam-ip-block.activate-subnet-flag\" value=\"N\"/>\t\n\t<parameter name=\"eipam-ip-block.leaf-level-indicator\" value=\"Y\"/>\n\t\n\t<!-- Number of Pool Levels -->\n\t<parameter name=\"eipam-ip-block.pools_length\" value=\"2\"/>\n\n\t<!-- Level 1 -->\n\t<parameter name=\"eipam-ip-block.pools[0].key-name\" value=\"`$tmp.level1-key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[0].key-value\" value=\"`$tmp.level1-key-value`\"/>\n\n\t<!-- Level 2 -->\n\t<parameter name=\"eipam-ip-block.pools[1].key-name\" value=\"`$tmp.level2-key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[1].key-value\" value=\"`$tmp.level2-key-value`\"/>","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2155.564437866211,"y":1464.0996627807617,"z":"760a1398.0b459c","wires":[]},{"id":"b74d2d62.394db","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":733.8799324035645,"y":1097.8138160705566,"z":"760a1398.0b459c","wires":[["532f3ab4.c4c164"]]},{"id":"fcde54df.af4438","type":"get-resource","name":"get-resource V4 - validate if level 2 subnet does not exists","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_SUBNETS s, EIPAM_IP_SUBNET_KEYS k WHERE s.plan_name = $network-model.eipam-v4-address-plan and s.network_id = $tmp.network-id and s.entity_id = k.entity_id and k.level = 2 and k.key_value = $network-model.network-role ;\"\n        pfx='tmp.eipam-subnet-row'>\n\n","comments":"","outputs":1,"x":2223.999969482422,"y":469.0000305175781,"z":"760a1398.0b459c","wires":[["4830173a.71fe08","80511b7b.e4aab8","a8e746dd.af1b88"]]},{"id":"27347235.930fee","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Query to DB table EIPAM_IP_SUBNET_KEYS and EIPAM_IP_SUBNETS failed.\" />\n\t","comments":"","x":2644.9998626708984,"y":422.0000305175781,"z":"760a1398.0b459c","wires":[]},{"id":"4830173a.71fe08","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2496.999954223633,"y":460.0000305175781,"z":"760a1398.0b459c","wires":[["f92c4af8.d67a58"]]},{"id":"60c65685.a18c18","type":"switchNode","name":"switch: eipam-ip-block.level","xml":"<switch test=\"`$eipam-ip-block.level`\">","comments":"","outputs":1,"x":954.0810928344727,"y":410.99999618530273,"z":"760a1398.0b459c","wires":[["16307416.fc962c","28a54d14.e1ee52","53b183dc.53d50c"]]},{"id":"16307416.fc962c","type":"other","name":"2","xml":"<outcome value='2'>","comments":"","outputs":1,"x":1101.0812072753906,"y":523,"z":"760a1398.0b459c","wires":[["cbaffe8a.989f7"]]},{"id":"28a54d14.e1ee52","type":"other","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1077.0812072753906,"y":653.0000305175781,"z":"760a1398.0b459c","wires":[["64d28328.b405ac"]]},{"id":"64d28328.b405ac","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Please set the eipam-ip-block.level for appropriate EIPAM request.\" />\n\t","comments":"","x":1237.0811767578125,"y":653.0000610351562,"z":"760a1398.0b459c","wires":[]},{"id":"80511b7b.e4aab8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2495.8617401123047,"y":424.0000305175781,"z":"760a1398.0b459c","wires":[["27347235.930fee"]]},{"id":"a8e746dd.af1b88","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2499.861770629883,"y":496.0000305175781,"z":"760a1398.0b459c","wires":[[]]},{"id":"2f5a2150.3d3a2e","type":"get-resource","name":"get-resource V4 - validate if level 1 subnet does not exists","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_SUBNETS s, EIPAM_IP_SUBNET_KEYS k WHERE s.plan_name = $network-model.eipam-v4-address-plan and s.entity_id = k.entity_id and k.level = 1 and k.key_value = $tmp.level1-key-value ; \"\n        pfx='tmp.eipam-subnet-row'>\n\n","comments":"","outputs":1,"x":2017.4113311767578,"y":67.99999237060547,"z":"760a1398.0b459c","wires":[["fb8aca5.9b7ac38","dec2b328.82d96","8020e208.b0ffd"]]},{"id":"a9dc4db4.779bd","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Query to DB table EIPAM_IP_SUBNET_KEYS and EIPAM_IP_SUBNETS failed.\" />\n\t","comments":"","x":2438.4113159179688,"y":20,"z":"760a1398.0b459c","wires":[]},{"id":"fb8aca5.9b7ac38","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2290.411407470703,"y":58,"z":"760a1398.0b459c","wires":[["64b05dad.2cad44"]]},{"id":"53b183dc.53d50c","type":"other","name":"1","xml":"<outcome value='1'>","comments":"","outputs":1,"x":1094.4925231933594,"y":216,"z":"760a1398.0b459c","wires":[["bcf2b6d6.6d0b38"]]},{"id":"dec2b328.82d96","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2289.273193359375,"y":22,"z":"760a1398.0b459c","wires":[["a9dc4db4.779bd"]]},{"id":"8020e208.b0ffd","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2293.273223876953,"y":94,"z":"760a1398.0b459c","wires":[[]]},{"id":"edf0f161.9ce66","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n\t<parameter name=\"error-code\" value=\"201\" />\n","comments":"","x":2644.1500549316406,"y":88,"z":"760a1398.0b459c","wires":[]},{"id":"3c25c29c.06ed2e","type":"get-resource","name":"get-resource V6 - validate if level 2 subnet does not exists","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_SUBNETS s, EIPAM_IP_SUBNET_KEYS k WHERE s.plan_name = $network-model.eipam-v6-address-plan and s.network_id = $tmp.network-id and s.entity_id = k.entity_id and k.level = 2 and k.key_value = $network-model.network-role ;\"\n        pfx='tmp.eipam-subnet-row'>\n\n","comments":"","outputs":1,"x":1375.636459350586,"y":1386.1141357421875,"z":"760a1398.0b459c","wires":[["8f6400a2.8a791","3fb1139f.29660c","1fae9c1f.e65ea4"]]},{"id":"9d4fc360.e622c","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Query to DB table EIPAM_IP_SUBNET_KEYS and EIPAM_IP_SUBNETS failed.\" />\n\t","comments":"","x":1796.636245727539,"y":1337.1141357421875,"z":"760a1398.0b459c","wires":[]},{"id":"8f6400a2.8a791","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1648.6364440917969,"y":1375.1141357421875,"z":"760a1398.0b459c","wires":[["23a2d3f.911312c"]]},{"id":"532f3ab4.c4c164","type":"switchNode","name":"switch: eipam-ip-block.level","xml":"<switch test=\"`$eipam-ip-block.level`\">","comments":"","outputs":1,"x":940.7175750732422,"y":1094.2569961547852,"z":"760a1398.0b459c","wires":[["e530ea7.cfbe818","77735382.0d846c","c7dea1ce.8f647"]]},{"id":"e530ea7.cfbe818","type":"other","name":"2","xml":"<outcome value='2'>","comments":"","outputs":1,"x":1105.7174987792969,"y":1460.1141357421875,"z":"760a1398.0b459c","wires":[["8f612ba5.2244a8"]]},{"id":"77735382.0d846c","type":"other","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1102.7174987792969,"y":1505.1141357421875,"z":"760a1398.0b459c","wires":[["e6dd0cef.4bdc"]]},{"id":"e6dd0cef.4bdc","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Please set the eipam-ip-block.level for appropriate EIPAM request.\" />\n\t","comments":"","x":1262.7173767089844,"y":1505.1141357421875,"z":"760a1398.0b459c","wires":[]},{"id":"3fb1139f.29660c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1647.4982299804688,"y":1339.1141357421875,"z":"760a1398.0b459c","wires":[["9d4fc360.e622c"]]},{"id":"1fae9c1f.e65ea4","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":1651.4982604980469,"y":1411.1141357421875,"z":"760a1398.0b459c","wires":[[]]},{"id":"c2c1d17f.8dbac","type":"get-resource","name":"get-resource V6 - validate if level 1 subnet does not exists","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_SUBNETS s, EIPAM_IP_SUBNET_KEYS k WHERE s.plan_name = $network-model.eipam-v6-address-plan and s.entity_id = k.entity_id and k.level = 1 and k.key_value = $tmp.level1-key-value ;\"\n        pfx='tmp.eipam-subnet-row'>\n\n","comments":"","outputs":1,"x":1957.0480270385742,"y":843.1141834259033,"z":"760a1398.0b459c","wires":[["6f57f784.e5c6e8","ceb7fd70.ab91a","a2b917cc.476cc8"]]},{"id":"f97e66aa.720a58","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Query to DB table EIPAM_IP_SUBNET_KEYS and EIPAM_IP_SUBNETS failed.\" />\n\t","comments":"","x":2378.0480308532715,"y":794.1142139434814,"z":"760a1398.0b459c","wires":[]},{"id":"6f57f784.e5c6e8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2230.048122406006,"y":832.1142139434814,"z":"760a1398.0b459c","wires":[["8133637b.48a57"]]},{"id":"c7dea1ce.8f647","type":"other","name":"1","xml":"<outcome value='1'>","comments":"","outputs":1,"x":1104.1290168762207,"y":988.1141662597656,"z":"760a1398.0b459c","wires":[["c531ead0.40b148"]]},{"id":"ceb7fd70.ab91a","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2228.9099082946777,"y":796.1142139434814,"z":"760a1398.0b459c","wires":[["f97e66aa.720a58"]]},{"id":"a2b917cc.476cc8","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2232.909938812256,"y":868.1142139434814,"z":"760a1398.0b459c","wires":[[]]},{"id":"9ad7bb73.7983e8","type":"set","name":"set EIPAM plan info for Level 1 pool for allocateSubnet","xml":"<set>\n\t<parameter name=\"eipam-ip-block.plan-name\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n\t<parameter name=\"eipam-ip-block.activate-subnet-flag\" value=\"Y\"/>\t\n\t<parameter name=\"eipam-ip-block.leaf-level-indicator\" value=\"N\"/>\n\t<!-- Number of Pool Levels -->\n\t<parameter name=\"eipam-ip-block.pools_length\" value=\"1\"/>\n\n\t<!-- Level 1 -->\n\t<parameter name=\"eipam-ip-block.pools[0].key-name\" value=\"`$tmp.level1-key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[0].key-value\" value=\"`$tmp.level1-key-value`\"/>","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2091.534698486328,"y":180.81381225585938,"z":"760a1398.0b459c","wires":[]},{"id":"eaace9a5.c1ece8","type":"save","name":"insert EIPAM_IP_SUBNETS for level 1 V4","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNETS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             service_type = $tmp.service-type ,\n             ip_address = $eipam-ip-block.ip-prefix ,\n             prefix_length = $eipam-ip-block.mask ,\n             plan_name = $network-model.eipam-v4-address-plan ,\n             status = 'ACTIVE' ,\n             pool_id = $pfx.eipam-pool-row.pool-id ,\n             address_family = $network-model.ipv4-ip-version ,\n             network_id = $tmp.network-id ; \"\n    force='true'\n        pfx='pfx.eipam-v4subnet-row'>\n","comments":"","outputs":1,"x":2061.540802001953,"y":325.96417236328125,"z":"760a1398.0b459c","wires":[["925aeb70.b22f68","dc8d75b0.09c688"]]},{"id":"bcf2b6d6.6d0b38","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1299.4894104003906,"y":213.96395874023438,"z":"760a1398.0b459c","wires":[["9ad7bb73.7983e8","bc706818.a810c8","eaace9a5.c1ece8","e63ec037.80fba","d6be9577.8252d8","feae1b24.761d88"]]},{"id":"bc706818.a810c8","type":"execute","name":"execute EIPAM allocateSubnet","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"allocateSubnet\">\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","outputs":1,"x":2022.0812072753906,"y":225.81381225585938,"z":"760a1398.0b459c","wires":[["d7ad882b.fcda68"]]},{"id":"d7ad882b.fcda68","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2232.0812377929688,"y":227.2041778564453,"z":"760a1398.0b459c","wires":[["fa28aaa2.b5a438"]]},{"id":"fa28aaa2.b5a438","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while allocating V4 subnet in EIPAM.\" />\n\t","comments":"","x":2396.081268310547,"y":230.20420837402344,"z":"760a1398.0b459c","wires":[]},{"id":"cbaffe8a.989f7","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1281.5705871582031,"y":524.8138122558594,"z":"760a1398.0b459c","wires":[["80fa339c.99e08","573b6d96.29c894","c01b033c.34cdf","8e8d9559.92e268","5198aecb.d2a32","f0aa1ff6.5d249","106f1e90.287d31","f63c99d8.3b6cb8","d21cbd92.6a426"]]},{"id":"573b6d96.29c894","type":"execute","name":"execute EIPAM allocateSubnet","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"allocateSubnet\">\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","outputs":1,"x":2026.6126403808594,"y":571.8138122558594,"z":"760a1398.0b459c","wires":[["6599c8ae.5ffcd8"]]},{"id":"6599c8ae.5ffcd8","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2236.6126708984375,"y":573.2041778564453,"z":"760a1398.0b459c","wires":[["3d657ed.846f382"]]},{"id":"3d657ed.846f382","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while allocating V4 subnet in EIPAM.\" />\n\t","comments":"","x":2400.6127014160156,"y":576.2042083740234,"z":"760a1398.0b459c","wires":[]},{"id":"c01b033c.34cdf","type":"save","name":"insert EIPAM_IP_SUBNETS for level 2 V4","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNETS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             service_type = $tmp.service-type ,\n             ip_address = $eipam-ip-block.ip-prefix ,\n             prefix_length = $eipam-ip-block.mask ,\n             plan_name = $network-model.eipam-v4-address-plan ,\n             status = 'ALLOCATED' ,\n             pool_id = $pfx.eipam-pool-row.pool-id ,\n             address_family = $network-model.ipv4-ip-version ,\n             network_id = $tmp.network-id ; \"\n    force='true'\n        pfx='pfx.eipam-subnet-row'>\n","comments":"","outputs":1,"x":2061.612518310547,"y":679.8138732910156,"z":"760a1398.0b459c","wires":[["575acf6f.3712c","2cab8ca3.72baa4"]]},{"id":"8e8d9559.92e268","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for level 1 V4","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $tmp.level1-key-name ,\n             key_value = $tmp.level1-key-value ,\n             level = 1 ; \"\n    force='true'\n        pfx='pfx.eipam-v4subnet-key-row'>\n","comments":"","outputs":1,"x":2076.612335205078,"y":721.8138160705566,"z":"760a1398.0b459c","wires":[["2cab8ca3.72baa4","c5bcb39.d3b4b5"]]},{"id":"5198aecb.d2a32","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for level 2 V4","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $tmp.level2-key-name ,\n             key_value = $tmp.level2-key-value ,\n             level = 2 ; \"\n    force='true'\n        pfx='pfx.eipam-v4subnet-key-row'>\n","comments":"","outputs":1,"x":2075.6124572753906,"y":767.8138465881348,"z":"760a1398.0b459c","wires":[["2cab8ca3.72baa4","c5bcb39.d3b4b5"]]},{"id":"e63ec037.80fba","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for level 1 V4","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $tmp.level1-key-name ,\n             key_value = $tmp.level1-key-value ,\n             level = 1 ; \"\n    force='true'\n        pfx='pfx.eipam-v4subnet-key-row'>\n","comments":"","outputs":1,"x":2079.816864013672,"y":362.9639587402344,"z":"760a1398.0b459c","wires":[["dc8d75b0.09c688","fd392a07.eb9c58"]]},{"id":"d6be9577.8252d8","type":"get-resource","name":"get-resource V4 - get pool_id","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_POOLS WHERE plan_name = $network-model.eipam-v4-address-plan and level = 1 and key_value = $tmp.level1-key-value ; \"\n        pfx='pfx.eipam-pool-row'>\n\n","comments":"","outputs":1,"x":2021.1892395019531,"y":274.81380462646484,"z":"760a1398.0b459c","wires":[["38251174.1c869e","4e8d064f.fd5d48"]]},{"id":"f0aa1ff6.5d249","type":"get-resource","name":"get-resource V4 - get pool_id","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_POOLS WHERE plan_name = $network-model.eipam-v4-address-plan and level = 2 and parent_pool = $tmp.level1-key-value AND key_value = $tmp.level2-key-value ; \"\n        pfx='pfx.eipam-pool-row'>\n\n","comments":"","outputs":1,"x":2018.1889953613281,"y":623.8138732910156,"z":"760a1398.0b459c","wires":[["5fa054bd.16e17c","2207199e.08aea6"]]},{"id":"96160911.77add8","type":"save","name":"insert EIPAM_IP_SUBNETS for level 1 V6","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNETS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             service_type = $tmp.service-type ,\n             ip_address = $eipam-ip-block.ip-prefix ,\n             prefix_length = $eipam-ip-block.mask ,\n             plan_name = $network-model.eipam-v6-address-plan ,\n             status = 'ACTIVE' ,\n             pool_id = $pfx.eipam-pool-row.pool-id ,\n             address_family = $network-model.ipv6-ip-version ,\n             network_id = $tmp.network-id ; \"\n    force='true'\n        pfx='pfx.eipam-v6subnet-row'>\n","comments":"","outputs":1,"x":2074.3451232910156,"y":1168.4146118164062,"z":"760a1398.0b459c","wires":[["33c44b3e.966ef4","a40e05cb.6396d8"]]},{"id":"727b36ab.492098","type":"execute","name":"execute EIPAM allocateSubnet","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"allocateSubnet\">\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","outputs":1,"x":2034.8855895996094,"y":1070.2642517089844,"z":"760a1398.0b459c","wires":[["e68681fb.1b313"]]},{"id":"e68681fb.1b313","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2244.8856201171875,"y":1071.6546173095703,"z":"760a1398.0b459c","wires":[["a1bad217.c4e66"]]},{"id":"a1bad217.c4e66","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while allocating V4 subnet in EIPAM.\" />\n\t","comments":"","x":2408.8856506347656,"y":1074.6546478271484,"z":"760a1398.0b459c","wires":[]},{"id":"411b72f1.d14bac","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for level 1 V6","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $tmp.level1-key-name ,\n             key_value = $tmp.level1-key-value ,\n             level = 1 ; \"\n    force='true'\n        pfx='pfx.eipam-v6subnet-key-row'>\n","comments":"","outputs":1,"x":2092.6212463378906,"y":1207.4143981933594,"z":"760a1398.0b459c","wires":[["3fa0173.be07be8","a40e05cb.6396d8"]]},{"id":"6506c176.93235","type":"get-resource","name":"get-resource V6 - get pool_id","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_POOLS WHERE plan_name = $network-model.eipam-v6-address-plan and level = 1 and key_value = $tmp.level1-key-value ; \"\n        pfx='pfx.eipam-pool-row'>\n\n","comments":"","outputs":1,"x":2033.9935607910156,"y":1116.2642822265625,"z":"760a1398.0b459c","wires":[["6e0864fa.a05b5c","81c3a0cf.8f46b"]]},{"id":"7be2c1b5.c1c77","type":"execute","name":"execute EIPAM allocateSubnet","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"allocateSubnet\">\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","outputs":1,"x":2089.2672424316406,"y":1542.7146453857422,"z":"760a1398.0b459c","wires":[["e3471665.468d88"]]},{"id":"e3471665.468d88","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2299.2672729492188,"y":1544.1050109863281,"z":"760a1398.0b459c","wires":[["94516d8.b36509"]]},{"id":"94516d8.b36509","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while allocating V4 subnet in EIPAM.\" />\n\t","comments":"","x":2463.2672424316406,"y":1547.10498046875,"z":"760a1398.0b459c","wires":[]},{"id":"e84f11af.afca5","type":"save","name":"insert EIPAM_IP_SUBNETS for level 2 V6","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNETS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             service_type = $tmp.service-type ,\n             ip_address = $eipam-ip-block.ip-prefix ,\n             prefix_length = $eipam-ip-block.mask ,\n             plan_name = $network-model.eipam-v6-address-plan ,\n             status = 'ALLOCATED' ,\n             pool_id = $pfx.eipam-pool-row.pool-id ,\n             address_family = $network-model.ipv6-ip-version ,\n             network_id = $tmp.network-id ; \"\n    force='true'\n        pfx='pfx.eipam-v6subnet-row'>\n","comments":"","outputs":1,"x":2121.267120361328,"y":1650.7147216796875,"z":"760a1398.0b459c","wires":[["7ca10271.cf98dc","da5c64a7.63de18"]]},{"id":"c715c9e8.59d0d8","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for level 1 V6","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $tmp.level1-key-name ,\n             key_value = $tmp.level1-key-value ,\n             level = 1 ; \"\n    force='true'\n        pfx='pfx.eipam-v6subnet-key-row'>\n","comments":"","outputs":1,"x":2139.2669372558594,"y":1692.7146492004395,"z":"760a1398.0b459c","wires":[["da5c64a7.63de18","91780b62.d91198"]]},{"id":"f9f33233.1ebf2","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for level 2 V6","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $tmp.level2-key-name ,\n             key_value = $tmp.level2-key-value ,\n             level = 2 ; \"\n    force='true'\n        pfx='pfx.eipam-v6subnet-key-row'>\n","comments":"","outputs":1,"x":2138.267059326172,"y":1738.7146797180176,"z":"760a1398.0b459c","wires":[["da5c64a7.63de18","91780b62.d91198"]]},{"id":"e1eb7292.1ec3b","type":"get-resource","name":"get-resource V6 - get pool_id","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_POOLS WHERE plan_name = $network-model.eipam-v6-address-plan and level = 2 and parent_pool = $tmp.level1-key-value AND key_value = $tmp.level2-key-value ; \"\n        pfx='pfx.eipam-pool-row'>\n\n","comments":"","outputs":1,"x":2085.8436584472656,"y":1596.7147216796875,"z":"760a1398.0b459c","wires":[["a3433e81.f0097","15a4041c.4a70fc"]]},{"id":"c531ead0.40b148","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1272.9460144042969,"y":985.2643127441406,"z":"760a1398.0b459c","wires":[["4102ac63.9c8424","727b36ab.492098","6506c176.93235","96160911.77add8","411b72f1.d14bac","8955333.6563dd"]]},{"id":"8f612ba5.2244a8","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1262.6607360839844,"y":1458.7147216796875,"z":"760a1398.0b459c","wires":[["66fa4ddd.45c444","7be2c1b5.c1c77","e1eb7292.1ec3b","e84f11af.afca5","c715c9e8.59d0d8","f9f33233.1ebf2","61ea6fc5.05eee","483c255.04784dc"]]},{"id":"6137dc86.9b29e4","type":"other","name":"ipv6","xml":"<outcome value='ipv6'>","comments":"","outputs":1,"x":549.7717437744141,"y":1095.9640197753906,"z":"760a1398.0b459c","wires":[["b74d2d62.394db"]]},{"id":"161f8d7c.8e3a03","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n\t<parameter name=\"error-code\" value=\"200\" />\n","comments":"","x":267,"y":684.1141662597656,"z":"760a1398.0b459c","wires":[]},{"id":"9bd357cd.62d6b8","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"V4 Level 2 Subnet already exists.\" />\n\t","comments":"","x":2865.2161560058594,"y":511.8138427734375,"z":"760a1398.0b459c","wires":[]},{"id":"fe30cef2.bc586","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"V6 Level 1 Subnet already exists.\" />\n\t","comments":"","x":2239.216094970703,"y":966.2643127441406,"z":"760a1398.0b459c","wires":[]},{"id":"547e3e18.82a3d","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"V6 Level 2 Subnet already exists.\" />\n\t","comments":"","x":2019.2162780761719,"y":1413.7147216796875,"z":"760a1398.0b459c","wires":[]},{"id":"501b79a.71a9088","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Please set the eipam-ip-block.allocate-version for appropriate EIPAM request.\" />\n\t","comments":"","x":686.1141052246094,"y":1213.5645751953125,"z":"760a1398.0b459c","wires":[]},{"id":"a0b5b6d4.69bf88","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n\t<parameter name=\"error-code\" value=\"201\" />\n","comments":"","x":2581.159355163574,"y":864.4145069122314,"z":"760a1398.0b459c","wires":[]},{"id":"703386c3.364c18","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n<parameter name=\"field6\" value=\"Level 1 subnet already exists, SKIP.\"/>\n<parameter name=\"field7\" value=\"`$tmp.eipam-pool-row.pool-id`\"/>\n","comments":"","outputs":1,"x":2619.9159240722656,"y":48.813812255859375,"z":"760a1398.0b459c","wires":[[]]},{"id":"ebaf4e36.bd4bf","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n<parameter name=\"field6\" value=\"Level 1 subnet already exists, SKIP.\"/>\n<parameter name=\"field7\" value=\"`$tmp.eipam-pool-row.pool-id`\"/>\n","comments":"","outputs":1,"x":2560.366630554199,"y":833.2642993927002,"z":"760a1398.0b459c","wires":[[]]},{"id":"64b05dad.2cad44","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2441.3663482666016,"y":53.813812255859375,"z":"760a1398.0b459c","wires":[["703386c3.364c18","edf0f161.9ce66"]]},{"id":"f92c4af8.d67a58","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2648.3662719726562,"y":457.96398544311523,"z":"760a1398.0b459c","wires":[["e1ad168c.14d068","9bd357cd.62d6b8"]]},{"id":"a30c2417.c0dfe8","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$eipam-ip-block.plans[$eipam-ip-block.plans_length].plan-name`\"/>\n<parameter name=\"field5\" value=\"`$eipam-ip-block.plans[$eipam-ip-block.plans_length].requests[0].pools[0].key-name`\"/>\n<parameter name=\"field6\" value=\"`$eipam-ip-block.plans[$eipam-ip-block.plans_length].requests[0].pools[0].key-value`\"/>\n<parameter name=\"field7\" value=\"`$eipam-ip-block.plans[$eipam-ip-block.plans_length].requests[0].pools[1].key-name`\"/>\n<parameter name=\"field8\" value=\"`$eipam-ip-block.plans[$eipam-ip-block.plans_length].requests[0].pools[1].key-value`\"/>\n","comments":"","outputs":1,"x":2487.366241455078,"y":487.8138084411621,"z":"760a1398.0b459c","wires":[[]]},{"id":"e1ad168c.14d068","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n<parameter name=\"field6\" value=\"Level 2 subnet already exists, SKIP.\"/>\n\n<!-- Level 2 -->\n\t<parameter name=\"field7\" value=\"NETWORK_ROLE_NETWORK_ID\"/>\n\t<parameter name=\"field8\" value=\"`$tmp.level2-key-value`\"/>\n","comments":"","outputs":1,"x":2844.3663024902344,"y":478.8138427734375,"z":"760a1398.0b459c","wires":[[]]},{"id":"8133637b.48a57","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2376.745048522949,"y":834.2643604278564,"z":"760a1398.0b459c","wires":[["ebaf4e36.bd4bf","a0b5b6d4.69bf88"]]},{"id":"23a2d3f.911312c","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1803.744888305664,"y":1372.7147216796875,"z":"760a1398.0b459c","wires":[["46d3087c.7d3818","547e3e18.82a3d"]]},{"id":"46d3087c.7d3818","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n<parameter name=\"field6\" value=\"Level 2 subnet already exists, SKIP.\"/>\n\n<!-- Level 2 -->\n\t<parameter name=\"field7\" value=\"NETWORK_ROLE_NETWORK_ID\"/>\n\t<parameter name=\"field8\" value=\"`$tmp.level2-key-value`\"/>\n","comments":"","outputs":1,"x":2005.7447814941406,"y":1374.8648681640625,"z":"760a1398.0b459c","wires":[[]]},{"id":"7e6a6282.f8c56c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNETS table.' />\n","comments":"","x":2587.8376426696777,"y":321.96395111083984,"z":"760a1398.0b459c","wires":[]},{"id":"925aeb70.b22f68","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2372.8377990722656,"y":320.8138084411621,"z":"760a1398.0b459c","wires":[["7e6a6282.f8c56c"]]},{"id":"dc8d75b0.09c688","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2368.9305725097656,"y":416.96395111083984,"z":"760a1398.0b459c","wires":[[]]},{"id":"575acf6f.3712c","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2395.6458168029785,"y":695.8138465881348,"z":"760a1398.0b459c","wires":[["681c821a.b300ac"]]},{"id":"2cab8ca3.72baa4","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2397.738800048828,"y":730.9640159606934,"z":"760a1398.0b459c","wires":[[]]},{"id":"33c44b3e.966ef4","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2402.6458168029785,"y":1162.4144325256348,"z":"760a1398.0b459c","wires":[["a8bdda72.805118"]]},{"id":"a40e05cb.6396d8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2414.738800048828,"y":1252.5645751953125,"z":"760a1398.0b459c","wires":[[]]},{"id":"7ca10271.cf98dc","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2469.645538330078,"y":1664.8648681640625,"z":"760a1398.0b459c","wires":[["235ca03c.04ad8"]]},{"id":"da5c64a7.63de18","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2476.738800048828,"y":1759.0150146484375,"z":"760a1398.0b459c","wires":[[]]},{"id":"d669beda.87f5c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNET_KEYS table.' />\n","comments":"","x":2587.9515686035156,"y":366.8138122558594,"z":"760a1398.0b459c","wires":[]},{"id":"fd392a07.eb9c58","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2373.9520568847656,"y":367.6636657714844,"z":"760a1398.0b459c","wires":[["d669beda.87f5c"]]},{"id":"2b912804.7b9c68","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNET_KEYS table.' />\n","comments":"","x":2570.951446533203,"y":766.9640159606934,"z":"760a1398.0b459c","wires":[]},{"id":"c5bcb39.d3b4b5","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2395.951934814453,"y":766.8138694763184,"z":"760a1398.0b459c","wires":[["2b912804.7b9c68"]]},{"id":"681c821a.b300ac","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNETS table.' />\n","comments":"","x":2563.9518127441406,"y":696.9639892578125,"z":"760a1398.0b459c","wires":[]},{"id":"56dea9f1.3ef0a8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNET_KEYS table.' />\n","comments":"","x":2565.951690673828,"y":1203.4144287109375,"z":"760a1398.0b459c","wires":[]},{"id":"a8bdda72.805118","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNETS table.' />\n","comments":"","x":2564.952178955078,"y":1161.4144020080566,"z":"760a1398.0b459c","wires":[]},{"id":"3fa0173.be07be8","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2403.951690673828,"y":1203.4144287109375,"z":"760a1398.0b459c","wires":[["56dea9f1.3ef0a8"]]},{"id":"489d7861.d07ae8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNET_KEYS table.' />\n","comments":"","x":2633.257598876953,"y":1713.0150146484375,"z":"760a1398.0b459c","wires":[]},{"id":"235ca03c.04ad8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNETS table.' />\n","comments":"","x":2627.258087158203,"y":1663.0150146484375,"z":"760a1398.0b459c","wires":[]},{"id":"91780b62.d91198","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2471.257598876953,"y":1713.0150146484375,"z":"760a1398.0b459c","wires":[["489d7861.d07ae8"]]},{"id":"8955333.6563dd","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n<parameter name=\"field6\" value=\"`$tmp.eipam-pool-row.pool-id`\"/>\n<parameter name=\"field7\" value=\"Level 1 subnet saved to DB.\"/>","comments":"","outputs":1,"x":1979.9219055175781,"y":1249.7147216796875,"z":"760a1398.0b459c","wires":[[]]},{"id":"61ea6fc5.05eee","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n\n<!-- Level 2 -->\n\t<parameter name=\"field6\" value=\"NETWORK_ROLE_NETWORK_ID\"/>\n\t<parameter name=\"field7\" value=\"`$tmp.level2-key-value`\"/>\n<parameter name=\"field8\" value=\"Level 2 subnet saved to DB.\"/>","comments":"","outputs":1,"x":2036.9519348144531,"y":1802.3153076171875,"z":"760a1398.0b459c","wires":[[]]},{"id":"106f1e90.287d31","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n\n<!-- Level 2 -->\n\t<parameter name=\"field6\" value=\"NETWORK_ROLE_NETWORK_ID\"/>\n\t<parameter name=\"field7\" value=\"`$tmp.level2-key-value`\"/>\n<parameter name=\"field8\" value=\"Level 2 subnet saved to DB.\"/>","comments":"","outputs":1,"x":1956.9519348144531,"y":804.4144287109375,"z":"760a1398.0b459c","wires":[[]]},{"id":"feae1b24.761d88","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n<parameter name=\"field6\" value=\"`$tmp.eipam-pool-row.pool-id`\"/>\n<parameter name=\"field7\" value=\"Level 1 subnet saved to DB.\"/>","comments":"","outputs":1,"x":1463.9519348144531,"y":299.9639587402344,"z":"760a1398.0b459c","wires":[[]]},{"id":"38251174.1c869e","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2224.1861877441406,"y":261.39998626708984,"z":"760a1398.0b459c","wires":[["4b3725b3.fcda9c"]]},{"id":"4b3725b3.fcda9c","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while looking for entry in EIPAM_IP_POOLS for V4 subnet in EIPAM.\" />\n\t","comments":"","x":2429.1861877441406,"y":275.40001678466797,"z":"760a1398.0b459c","wires":[]},{"id":"4e8d064f.fd5d48","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2238.1861877441406,"y":296.39998626708984,"z":"760a1398.0b459c","wires":[["4b3725b3.fcda9c"]]},{"id":"5fa054bd.16e17c","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2216.2911376953125,"y":618.595832824707,"z":"760a1398.0b459c","wires":[["2ed2ba3f.1c7966"]]},{"id":"2ed2ba3f.1c7966","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while looking for entry in EIPAM_IP_POOLS for V4 subnet in EIPAM.\" />\n\t","comments":"","x":2421.2911376953125,"y":632.5958633422852,"z":"760a1398.0b459c","wires":[]},{"id":"2207199e.08aea6","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2230.2911376953125,"y":653.595832824707,"z":"760a1398.0b459c","wires":[["2ed2ba3f.1c7966"]]},{"id":"6e0864fa.a05b5c","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2241.5860900878906,"y":1103.4000244140625,"z":"760a1398.0b459c","wires":[["998553a0.5a009"]]},{"id":"998553a0.5a009","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while looking for entry in EIPAM_IP_POOLS for V6 subnet in EIPAM.\" />\n\t","comments":"","x":2446.5860900878906,"y":1117.4000549316406,"z":"760a1398.0b459c","wires":[]},{"id":"81c3a0cf.8f46b","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2255.5860900878906,"y":1138.4000244140625,"z":"760a1398.0b459c","wires":[["998553a0.5a009"]]},{"id":"a3433e81.f0097","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2297.5860900878906,"y":1581.4000244140625,"z":"760a1398.0b459c","wires":[["adf0891f.d1fa18"]]},{"id":"adf0891f.d1fa18","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while looking for entry in EIPAM_IP_POOLS for V6 subnet in EIPAM.\" />\n\t","comments":"","x":2502.585968017578,"y":1595.4000244140625,"z":"760a1398.0b459c","wires":[]},{"id":"15a4041c.4a70fc","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2311.5860900878906,"y":1616.4000244140625,"z":"760a1398.0b459c","wires":[["adf0891f.d1fa18"]]},{"id":"2b47b090.d7ef9","type":"switchNode","name":"switch: network-model.eipam-v4-address-plan","xml":"<switch test=\"`$network-model.eipam-v4-address-plan`\">","comments":"","outputs":1,"x":1009.5454330444336,"y":169.84091186523438,"z":"760a1398.0b459c","wires":[["67f46aa1.6bc964"]]},{"id":"67f46aa1.6bc964","type":"other","name":"AIC_AIM_LANDING_NETWORK_V4","xml":"<outcome value=\"AIC_AIM_LANDING_NETWORK_V4\">","comments":"","outputs":1,"x":1348.5454177856445,"y":163.84090614318848,"z":"760a1398.0b459c","wires":[["9f05ca3.3178d38"]]},{"id":"9f05ca3.3178d38","type":"set","name":"set key-names","xml":"<set>\n\t<parameter name=\"tmp.level1-key-name\" value=\"CLLI:CLOUD_REGION\" />\n\t<parameter name=\"tmp.level2-key-name\" value=\"NETWORK_ROLE:NETWORK_ID\" />\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":1654.636215209961,"y":158.7499942779541,"z":"760a1398.0b459c","wires":[]},{"id":"2b7ed529.3d43ba","type":"switchNode","name":"switch: network-model.eipam-v6-address-plan","xml":"<switch test=\"`$network-model.eipam-v6-address-plan`\">","comments":"","outputs":1,"x":1000.2366485595703,"y":928.3332672119141,"z":"760a1398.0b459c","wires":[["16cfe3e2.cecd8c","3a6dfd.d01f8204","dee875e0.658cb8","2b8d9210.774eee"]]},{"id":"16cfe3e2.cecd8c","type":"other","name":"AIC_AIM_LANDING_NETWORK_V6","xml":"<outcome value=\"AIC_AIM_LANDING_NETWORK_V6\">","comments":"","outputs":1,"x":1339.2366333007812,"y":922.3332614898682,"z":"760a1398.0b459c","wires":[["30735986.fcf186"]]},{"id":"30735986.fcf186","type":"set","name":"set key-names","xml":"<set>\n\t<parameter name=\"tmp.level1-key-name\" value=\"CLLI:CLOUD_REGION\" />\n\t<parameter name=\"tmp.level2-key-name\" value=\"NETWORK_ROLE:NETWORK_ID\" />\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":1645.3274307250977,"y":917.2423496246338,"z":"760a1398.0b459c","wires":[]},{"id":"2b8d9210.774eee","type":"other","name":"AIC_DATA_PLANE_UNPROTECTED_V6","xml":"<outcome value=\"AIC_DATA_PLANE_UNPROTECTED_V6\">","comments":"","outputs":1,"x":1363.2366485595703,"y":808.333309173584,"z":"760a1398.0b459c","wires":[["30735986.fcf186"]]},{"id":"3a6dfd.d01f8204","type":"other","name":"AIC_DATA_PLANE_PROTECTED_V6","xml":"<outcome value=\"AIC_DATA_PLANE_PROTECTED_V6\">","comments":"","outputs":1,"x":1349.9033432006836,"y":884.3333358764648,"z":"760a1398.0b459c","wires":[["30735986.fcf186"]]},{"id":"dee875e0.658cb8","type":"other","name":"AIC_DATA_PLANE_PRIVATE_V6","xml":"<outcome value=\"AIC_DATA_PLANE_PRIVATE_V6\">","comments":"","outputs":1,"x":1338.2367095947266,"y":848.333288192749,"z":"760a1398.0b459c","wires":[["30735986.fcf186"]]},{"id":"f63c99d8.3b6cb8","type":"switchNode","name":"switch: eipam-ip-block.subnet-size-override","xml":"<switch test=\"`$eipam-ip-block.subnet-size-override`\">","comments":"","outputs":1,"x":2060.428695678711,"y":541.428544998169,"z":"760a1398.0b459c","wires":[["a441450b.f19e08"]]},{"id":"17506802.cbb568","type":"set","name":"set subnet override if not set","xml":"<set>\n\t<parameter name=\"eipam-ip-block.subnet-size-override\" value=\"`$network-model.ipv4-cidr-mask`\" />\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2793.2856979370117,"y":570.0001010894775,"z":"760a1398.0b459c","wires":[]},{"id":"a441450b.f19e08","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":2331.8575019836426,"y":540.0000820159912,"z":"760a1398.0b459c","wires":[["801f369b.171c48"]]},{"id":"517daf80.d2a12","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level2-key-value`\"/>\n<parameter name=\"field6\" value=\"Level 2 subnet override not set, default to network model value.\"/>\n\n","comments":"","outputs":1,"x":2723.28564453125,"y":538.4285888671875,"z":"760a1398.0b459c","wires":[[]]},{"id":"801f369b.171c48","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2539.6640625,"y":538.4286499023438,"z":"760a1398.0b459c","wires":[["517daf80.d2a12","17506802.cbb568"]]},{"id":"483c255.04784dc","type":"switchNode","name":"switch: eipam-ip-block.subnet-size-override","xml":"<switch test=\"`$eipam-ip-block.subnet-size-override`\">","comments":"","outputs":1,"x":2114.428466796875,"y":1497.142822265625,"z":"760a1398.0b459c","wires":[["f307ed5.20b8b1"]]},{"id":"f307ed5.20b8b1","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":2385.8572731018066,"y":1495.7143592834473,"z":"760a1398.0b459c","wires":[["43b37e56.eccae"]]},{"id":"43b37e56.eccae","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2593.663833618164,"y":1494.1429271697998,"z":"760a1398.0b459c","wires":[["40d15cb5.994364","28a43c12.6d6e74"]]},{"id":"28a43c12.6d6e74","type":"set","name":"set subnet override if not set","xml":"<set>\n\t<parameter name=\"eipam-ip-block.subnet-size-override\" value=\"`$network-model.ipv6-cidr-mask`\" />\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2845.0695419311523,"y":1523.9004917144775,"z":"760a1398.0b459c","wires":[]},{"id":"40d15cb5.994364","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v6-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level2-key-value`\"/>\n<parameter name=\"field6\" value=\"Level 2 subnet override not set, default to network model value.\"/>\n\n","comments":"","outputs":1,"x":2775.0694885253906,"y":1492.3289794921875,"z":"760a1398.0b459c","wires":[[]]},{"id":"d21cbd92.6a426","type":"set","name":"unset subnet override ","xml":"<set>\n\t<parameter name=\"eipam-ip-block.subnet-size-override\" value='' />\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":1703.7500228881836,"y":777.5000114440918,"z":"760a1398.0b459c","wires":[]}]