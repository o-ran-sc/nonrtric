[{"id":"8f9fef7.6f3a81","type":"dgstart","name":"DGSTART","outputs":1,"x":96.66665649414062,"y":22.39760112762451,"z":"59d9d15d.d6cec","wires":[["ce1c5240.2f13a"]]},{"id":"ce1c5240.2f13a","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":362.75952911376953,"y":20,"z":"59d9d15d.d6cec","wires":[["6f9cb61b.ee5138"]]},{"id":"71899083.1fb68","type":"comment","name":"ChangeLog","info":"4/16 - initial version","comments":"","x":85.49564361572266,"y":70.15521693229675,"z":"59d9d15d.d6cec","wires":[]},{"id":"6f9cb61b.ee5138","type":"method","name":"eipam-allocate-generic-subnet","xml":"<method rpc='eipam-allocate-generic-subnet' mode='sync'>\n","comments":"","outputs":1,"x":154.21531677246094,"y":111.08245182037354,"z":"59d9d15d.d6cec","wires":[["b5922f7f.64557"]]},{"id":"ab6de05c.4e171","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-generic-subnet\"/>\n<parameter name=\"field4\" value=\"`$eipam-ip-block.plan-name`\"/>\n<parameter name=\"field5\" value=\"`$eipam-ip-block.pools[$l4-idx].key-name`\"/>\n<parameter name=\"field6\" value=\"`$eipam-ip-block.pools[$l4-idx].key-value`\"/>\n\n","comments":"","outputs":1,"x":2243.14102935791,"y":646.7808322906494,"z":"59d9d15d.d6cec","wires":[[]]},{"id":"4bb70423.bcb5ec","type":"set","name":"set EIPAM key info at each Level","xml":"<set>\n\t<parameter name=\"eipam-ip-block.pools[$l4-idx].key-name\" value=\"`$v4FQPN-output.pools[$l4-idx].key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[$l4-idx].key-value\" value=\"`$v4FQPN-output.pools[$l4-idx].key-value`\"/>\n\t","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2317.9530506134033,"y":602.326545715332,"z":"59d9d15d.d6cec","wires":[]},{"id":"b5922f7f.64557","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":106.35284423828125,"y":161.4576597213745,"z":"59d9d15d.d6cec","wires":[["8d759ec.66d776","e3ade912.f66688","ea9b121a.c4eaf","3b70b322.db11fc","2b4e4aec.1de226"]]},{"id":"a8830696.011d28","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":730.9524345397949,"y":421.8863134384155,"z":"59d9d15d.d6cec","wires":[["ac71dacb.26a0d8"]]},{"id":"8d759ec.66d776","type":"set","name":"set: data initialization","xml":"<set>\n\t<parameter name=\"tmp.eipam-error\" value=\"false\" />\n\t<parameter name=\"tmp.allocate-v4-subnet-flag\" value=\"N\" />\n\t<parameter name=\"tmp.allocate-v6-subnet-flag\" value=\"N\" />\n\t<parameter name='eipam-ip-block.plans_length' value='0' />\n\t<parameter name=\"eipam-pool.v4.pre-existing\" value=\"N\"/>\n\t<parameter name=\"eipam-pool.v6.pre-existing\" value=\"N\"/>\n\t<parameter name=\"tmp.leaf-level\" value=\"N\" />","comments":"","x":363.6958465576172,"y":170.4885025024414,"z":"59d9d15d.d6cec","wires":[]},{"id":"84f45d73.77544","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":773.4203872680664,"y":996.2534217834473,"z":"59d9d15d.d6cec","wires":[["93951379.be7a2"]]},{"id":"ac71dacb.26a0d8","type":"switchNode","name":"test: eipam-ip-block.level","xml":"<switch test=\"`$l-idx`\">","comments":"","outputs":1,"x":938.7808876037598,"y":420.50491523742676,"z":"59d9d15d.d6cec","wires":[["182eb74a.ac9469","b87b3061.052b2","226aca7f.3fbb76"]]},{"id":"182eb74a.ac9469","type":"other","name":"level 1","xml":"<outcome value='1'>","comments":"","outputs":1,"x":1123.0390396118164,"y":418.826434135437,"z":"59d9d15d.d6cec","wires":[["6063e155.3da64"]]},{"id":"b87b3061.052b2","type":"other","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1125.610450744629,"y":520.6835517883301,"z":"59d9d15d.d6cec","wires":[["9138f223.f2316"]]},{"id":"9138f223.f2316","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Please set the eipam-ip-block.level for appropriate EIPAM request.\" />\n\t","comments":"","x":1252.8603477478027,"y":519.6835770606995,"z":"59d9d15d.d6cec","wires":[]},{"id":"e3ade912.f66688","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n\t<parameter name=\"error-code\" value=\"200\" />\n","comments":"","x":265.42652130126953,"y":1794.3280906677246,"z":"59d9d15d.d6cec","wires":[]},{"id":"226aca7f.3fbb76","type":"other","name":"Other","xml":"<outcome value='Other'>","comments":"","outputs":1,"x":1120.2782707214355,"y":562.5764150619507,"z":"59d9d15d.d6cec","wires":[["1e9c1897.d2f767"]]},{"id":"f006120d.73e05","type":"comment","name":"Required INPUTS","info":"Pre-requisites: \n\tThe levels are called in sequence starting at level 1,2,...\n\tso that the previous levels are created already.\n\tWorking with current plan: eipam-ip-block.plans[$eipam-ip-block.plans_length]\n\tAssumes generate-FQPN was already called, need its output for key_values\n\t\nOptional INPUTS:\n\ttmp.qip-pool - for level 1 if needed\n\ttmp.activate-subnet-flag - set to Y to have EIPAM activate it, else N(Default to Y)\tapplies to every level\n\ttmp.network-instance-group-id\n\t\nrequired INPUTS:\n\n\tnetwork-model - for Tosca model\n\ttmp.skip-first-level - set to Y if already created in EIPAM\n\teipam-ip-block.level - the level for createPool/allocateSubnet\n\ttmp.network-id\n\nSet the necessary values as inputs for the key_values \nfor 1 to current level as needed for EIPAM operations:\n\nv4FQPN-output.pools[].key-name\nv4FQPN-output.pools[].key-value\nv6FQPN-output.pools[].key-name\nv6FQPN-output.pools[].key-value\n\n(ie - Calling DG should set v[4|6]FQPN-output = generate-FQPN-output)\n\n\n","comments":"","x":650.9523773193359,"y":82.57617473602295,"z":"59d9d15d.d6cec","wires":[]},{"id":"98c2cc84.9a912","type":"for","name":"for l4-idx: eipam-ip-block.level","xml":"<for index=\"l4-idx\" start=\"0\" end=\"`$eipam-ip-block.level`\">","comments":"","outputs":1,"x":1905.4169006347656,"y":617.7549533843994,"z":"59d9d15d.d6cec","wires":[["c39675d.1ac9888"]]},{"id":"c39675d.1ac9888","type":"block","name":"block","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2096.865390777588,"y":615.0247287750244,"z":"59d9d15d.d6cec","wires":[["4bb70423.bcb5ec","ab6de05c.4e171"]]},{"id":"e4105395.c1905","type":"switchNode","name":"switch: tmp.skip-first-level","xml":"<switch test=\"`$tmp.skip-first-level`\">","comments":"","outputs":1,"x":1430.2384338378906,"y":417.2192659378052,"z":"59d9d15d.d6cec","wires":[["33bb99d8.2114a6","d82636a5.9a0d38","2f749836.e94048"]]},{"id":"33bb99d8.2114a6","type":"other","name":"NULL","xml":"<outcome value=\"\">","comments":"","outputs":1,"x":1586.5241775512695,"y":447.1835422515869,"z":"59d9d15d.d6cec","wires":[["1e9c1897.d2f767"]]},{"id":"1e9c1897.d2f767","type":"block","name":"block","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1707.0242767333984,"y":558.2550249099731,"z":"59d9d15d.d6cec","wires":[["98c2cc84.9a912","fcf076c0.ae1d78","6ffc366b.bfe838","4e03d290.769fac","e16fb56c.0e3e48","fe526422.16f6a8","e34e99ee.7a2268"]]},{"id":"d82636a5.9a0d38","type":"other","name":"N","xml":"<outcome value='N'>","comments":"","outputs":1,"x":1543.5956573486328,"y":483.6948595046997,"z":"59d9d15d.d6cec","wires":[["1e9c1897.d2f767"]]},{"id":"ea9b121a.c4eaf","type":"switchNode","name":"test: tmp.activate-subnet-flag","xml":"<switch test=\"`$tmp.activate-subnet-flag`\">","comments":"","outputs":1,"x":394.7023696899414,"y":217.57617282867432,"z":"59d9d15d.d6cec","wires":[["7ab0cb5c.25fd34","15d3a211.21541e","ab74cc21.2afd2"]]},{"id":"15d3a211.21541e","type":"other","name":"NULL","xml":"<outcome value=\"\">","comments":"","outputs":1,"x":607.9524383544922,"y":186.8262062072754,"z":"59d9d15d.d6cec","wires":[["39a65e43.d68482"]]},{"id":"7ab0cb5c.25fd34","type":"other","name":"Y","xml":"<outcome value='Y'>","comments":"","outputs":1,"x":603.2025012969971,"y":232.82617664337158,"z":"59d9d15d.d6cec","wires":[[]]},{"id":"39a65e43.d68482","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":759.7024307250977,"y":185.57617664337158,"z":"59d9d15d.d6cec","wires":[["4912f99e.65f368"]]},{"id":"ab74cc21.2afd2","type":"other","name":"N","xml":"<outcome value='N'>","comments":"","outputs":1,"x":607.7024307250977,"y":268.51611042022705,"z":"59d9d15d.d6cec","wires":[[]]},{"id":"4912f99e.65f368","type":"set","name":"set tmp.activate-subnet-flag to Y","xml":"<set>\n\t<parameter name=\"tmp.activate-subnet-flag\" value=\"Y\"/>\t\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":984.7023696899414,"y":187.57617282867432,"z":"59d9d15d.d6cec","wires":[]},{"id":"6063e155.3da64","type":"block","name":"block","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1251.3097915649414,"y":419.3621482849121,"z":"59d9d15d.d6cec","wires":[["e4105395.c1905"]]},{"id":"94e6e10b.06072","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-generic-subnet\"/>\n<parameter name=\"field4\" value=\"`$eipam-ip-block.plan-name`\"/>\n<parameter name=\"field5\" value=\"`$eipam-ip-block.pools[$l6-idx].key-name`\"/>\n<parameter name=\"field6\" value=\"`$eipam-ip-block.pools[$l6-idx].key-value`\"/>\n<parameter name=\"field7\" value=\"`$l6-idx`\"/>\n","comments":"","outputs":1,"x":2275.1337394714355,"y":1212.0604271888733,"z":"59d9d15d.d6cec","wires":[[]]},{"id":"93951379.be7a2","type":"switchNode","name":"test: eipam-ip-block.level","xml":"<switch test=\"`$l-idx`\">","comments":"","outputs":1,"x":973.9880905151367,"y":995.764778137207,"z":"59d9d15d.d6cec","wires":[["5fca83a8.bf0a3c","f6dd58ad.545418","cac33639.67c088"]]},{"id":"5fca83a8.bf0a3c","type":"other","name":"level 1","xml":"<outcome value='1'>","comments":"","outputs":1,"x":1162.8097305297852,"y":998.55042552948,"z":"59d9d15d.d6cec","wires":[["da3ad60b.40a538"]]},{"id":"f6dd58ad.545418","type":"other","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1165.3811416625977,"y":1100.407543182373,"z":"59d9d15d.d6cec","wires":[["7316123e.6ee9cc"]]},{"id":"7316123e.6ee9cc","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Please set the eipam-ip-block.level for appropriate EIPAM request.\" />\n\t","comments":"","x":1292.6310386657715,"y":1099.4075684547424,"z":"59d9d15d.d6cec","wires":[]},{"id":"cac33639.67c088","type":"other","name":"Other","xml":"<outcome value='Other'>","comments":"","outputs":1,"x":1160.0489616394043,"y":1142.3004064559937,"z":"59d9d15d.d6cec","wires":[["88faa638.e54cf8"]]},{"id":"3ab54f41.6592e","type":"for","name":"for l6-idx: eipam-ip-block.level","xml":"<for index=\"l6-idx\" start=\"0\" end=\"`$eipam-ip-block.level`\">","comments":"","outputs":1,"x":1945.1875915527344,"y":1197.4789447784424,"z":"59d9d15d.d6cec","wires":[["24cb1d26.b5d7b2"]]},{"id":"24cb1d26.b5d7b2","type":"block","name":"block","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2136.6360816955566,"y":1194.7487201690674,"z":"59d9d15d.d6cec","wires":[["94e6e10b.06072","8f172824.4d3c88"]]},{"id":"60b72913.4f8168","type":"switchNode","name":"switch: tmp.skip-first-level","xml":"<switch test=\"`$tmp.skip-first-level`\">","comments":"","outputs":1,"x":1473.759262084961,"y":998.1932592391968,"z":"59d9d15d.d6cec","wires":[["5bb9354.1ebb0cc","680e224e.86676c","9bcfb57.ef89248"]]},{"id":"5bb9354.1ebb0cc","type":"other","name":"NULL","xml":"<outcome value=\"\">","comments":"","outputs":1,"x":1645.7593574523926,"y":1032.443271636963,"z":"59d9d15d.d6cec","wires":[["88faa638.e54cf8"]]},{"id":"88faa638.e54cf8","type":"block","name":"block","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1746.7949676513672,"y":1137.979016304016,"z":"59d9d15d.d6cec","wires":[["3ab54f41.6592e","83776b7d.3e2ea8","947c46b.dfcfcb8","fbd44536.a250d8","5f9cddac.d2bb54","7f1fcd55.6f8b64","be19d35a.f6ee9"]]},{"id":"680e224e.86676c","type":"other","name":"N","xml":"<outcome value='N'>","comments":"","outputs":1,"x":1644.6163864135742,"y":1068.9544792175293,"z":"59d9d15d.d6cec","wires":[["88faa638.e54cf8"]]},{"id":"da3ad60b.40a538","type":"block","name":"block","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1291.0804824829102,"y":999.0861396789551,"z":"59d9d15d.d6cec","wires":[["60b72913.4f8168"]]},{"id":"9bcfb57.ef89248","type":"other","name":"Y","xml":"<outcome value='Y'>","comments":"","outputs":1,"x":1654.0454273223877,"y":991.3004283905029,"z":"59d9d15d.d6cec","wires":[[]]},{"id":"2f749836.e94048","type":"other","name":"Y","xml":"<outcome value='Y'>","comments":"","outputs":1,"x":1621.4884185791016,"y":413.2906684875488,"z":"59d9d15d.d6cec","wires":[[]]},{"id":"fcf076c0.ae1d78","type":"set","name":"set EIPAM pool info for allocateSubnet","xml":"<set>\n\t<parameter name=\"eipam-ip-block.plan-name\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n\t<parameter name=\"eipam-ip-block.activate-subnet-flag\" value=\"`$tmp.activate-subnet-flag`\"/>\t\n\t<parameter name=\"eipam-ip-block.leaf-level-indicator\" value=\"`$tmp.leaf-level`\"/>\n\t<parameter name=\"tmp.allocate-v4-subnet-flag\" value=\"Y\" />\n\t<!-- Number of Pool Levels -->\n\t<parameter name=\"eipam-ip-block.pools_length\" value=\"`$eipam-ip-block.level`\"/>\n\n\t","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":1940.5363006591797,"y":558.7622022628784,"z":"59d9d15d.d6cec","wires":[]},{"id":"f14ae6f0.6b0b68","type":"other","name":"true","xml":"<outcome value='true'>","comments":"","outputs":1,"x":515.7143135070801,"y":330.0000066757202,"z":"59d9d15d.d6cec","wires":[["bcbca98c.14d5c8"]]},{"id":"bcbca98c.14d5c8","type":"block","name":"block","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":634.5162162780762,"y":329.81357192993164,"z":"59d9d15d.d6cec","wires":[["9ebcbfc6.15186"]]},{"id":"3b70b322.db11fc","type":"switchNode","name":"switch: leaf level","xml":"<switch test=\"`$eipam-ip-block.level == $eipam-ip-block.getPlanTopologyResponse.TopologyDetails_length`\">","comments":"","outputs":1,"x":361.1305847167969,"y":329.23771476745605,"z":"59d9d15d.d6cec","wires":[["f14ae6f0.6b0b68"]]},{"id":"9ebcbfc6.15186","type":"set","name":"set tmp.leaf-level to Y","xml":"<set>\n\t<parameter name=\"tmp.leaf-level\" value=\"Y\" />","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":842.8571166992188,"y":331.4285583496094,"z":"59d9d15d.d6cec","wires":[]},{"id":"83776b7d.3e2ea8","type":"set","name":"set EIPAM pool info for allocateSubnet","xml":"<set>\n\t<parameter name=\"eipam-ip-block.plan-name\" value=\"`$network-model.eipam-v6-address-plan`\"/>\n\t<parameter name=\"eipam-ip-block.activate-subnet-flag\" value=\"`$tmp.activate-subnet-flag`\"/>\t\n\t<parameter name=\"eipam-ip-block.leaf-level-indicator\" value=\"`$tmp.leaf-level`\"/>\n\t<parameter name=\"tmp.allocate-v6-subnet-flag\" value=\"Y\" />\n\t<!-- Number of Pool Levels -->\n\t<parameter name=\"eipam-ip-block.pools_length\" value=\"`$eipam-ip-block.level`\"/>\n\n\t","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":1976.083251953125,"y":1136.2498779296875,"z":"59d9d15d.d6cec","wires":[]},{"id":"8f172824.4d3c88","type":"set","name":"set EIPAM pool info at each Level","xml":"<set>\n\t<parameter name=\"eipam-ip-block.pools[$l6-idx].key-name\" value=\"`$v6FQPN-output.pools[$l6-idx].key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[$l6-idx].key-value\" value=\"`$v6FQPN-output.pools[$l6-idx].key-value`\"/>\n\t","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2356.083251953125,"y":1177.9166259765625,"z":"59d9d15d.d6cec","wires":[]},{"id":"2b4e4aec.1de226","type":"switchNode","name":"switch: eipam-ip-block.allocate-version","xml":"<switch test=\"`$eipam-ip-block.allocate-version`\">","comments":"Need to know which ipv version to get the plan name from the network-model.","outputs":1,"x":348.7499769181013,"y":482.49998474121094,"z":"59d9d15d.d6cec","wires":[["5f026f8d.26562","821f7cdd.9300d","8bb1e0b.4dd582"]]},{"id":"5f026f8d.26562","type":"other","name":"ipv4","xml":"<outcome value='ipv4'>","comments":"","outputs":1,"x":586.2500761002302,"y":422.499981880188,"z":"59d9d15d.d6cec","wires":[["a8830696.011d28"]]},{"id":"821f7cdd.9300d","type":"other","name":"Null","xml":"<outcome value=''>","comments":"","outputs":1,"x":550.7500991821289,"y":1327.4904613494873,"z":"59d9d15d.d6cec","wires":[["849eba01.737b78"]]},{"id":"8bb1e0b.4dd582","type":"other","name":"ipv6","xml":"<outcome value='ipv6'>","comments":"","outputs":1,"x":599.0217552185059,"y":1000.4002666473389,"z":"59d9d15d.d6cec","wires":[["84f45d73.77544"]]},{"id":"849eba01.737b78","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Please set the eipam-ip-block.allocate-version for appropriate EIPAM request.\" />\n\t","comments":"","x":693.4999771118164,"y":1327.9168949127197,"z":"59d9d15d.d6cec","wires":[]},{"id":"26f3b34b.bf5e3c","type":"set","name":"set EIPAM plan info for allocateSubnet","xml":"<set>\n\t<parameter name=\"eipam-ip-block.plan-name\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n\t<parameter name=\"eipam-ip-block.activate-subnet-flag\" value=\"Y\"/>\t\n\t<parameter name=\"eipam-ip-block.leaf-level-indicator\" value=\"`$tmp.leaf-level`\"/>\n\t<!-- Number of Pool Levels -->\n\t<parameter name=\"eipam-ip-block.pools_length\" value=\"1\"/>\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2453.3332328796387,"y":480.8333168029785,"z":"59d9d15d.d6cec","wires":[]},{"id":"739a41cf.6ce14","type":"save","name":"insert EIPAM_IP_SUBNETS for V4","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNETS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             service_type = $tmp.service-type ,\n             ip_address = $eipam-ip-block.ip-prefix ,\n             prefix_length = $eipam-ip-block.mask ,\n             plan_name = $network-model.eipam-v4-address-plan ,\n             status = 'ACTIVE' ,\n             pool_id = $pfx.eipam-pool-row.pool-id ,\n             address_family = $network-model.ipv4-ip-version ,\n             network_id = $tmp.network-id ,\n             network_instance_group_id = $tmp.network-instance-group-id ; \"\n    force='true'\n        pfx='pfx.eipam-v4subnet-row'>\n","comments":"","outputs":1,"x":2255.7193641662598,"y":806.822883605957,"z":"59d9d15d.d6cec","wires":[["bb00f828.48b688"]]},{"id":"6ffc366b.bfe838","type":"execute","name":"execute EIPAM allocateSubnet","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"allocateSubnet\">\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","outputs":1,"x":1908.4819793701172,"y":685.3392143249512,"z":"59d9d15d.d6cec","wires":[["97506f50.4a93"]]},{"id":"97506f50.4a93","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2118.4820098876953,"y":686.7295799255371,"z":"59d9d15d.d6cec","wires":[["ce167d53.ecb57"]]},{"id":"ce167d53.ecb57","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while allocating V4 subnet in EIPAM.\" />\n\t","comments":"","x":2282.4820404052734,"y":689.7296104431152,"z":"59d9d15d.d6cec","wires":[]},{"id":"e16fb56c.0e3e48","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for V4","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $key-name ,\n             key_value = $key-value ,\n             level = $eipam-ip-block.level ; \"\n    force='true'\n        pfx='pfx.eipam-v4subnet-key-row'>\n","comments":"","outputs":1,"x":1937.3288345336914,"y":912.4893751144409,"z":"59d9d15d.d6cec","wires":[["54bc5756.107198","7f276b3.f6f6794"]]},{"id":"4e03d290.769fac","type":"get-resource","name":"get-resource V4 - get pool_id","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_POOLS WHERE plan_name = $network-model.eipam-v4-address-plan and level = $eipam-ip-block.level and key_value = $tmp.key-value ; \"\n        pfx='pfx.eipam-pool-row'>\n\n","comments":"","outputs":1,"x":1907.5899505615234,"y":731.3392448425293,"z":"59d9d15d.d6cec","wires":[["26bb8cfc.df8fb4","ef851ee3.4729d"]]},{"id":"bb00f828.48b688","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2491.7979621887207,"y":804.1560049057007,"z":"59d9d15d.d6cec","wires":[["8a79d874.143b98"]]},{"id":"7f276b3.f6f6794","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2259.446388244629,"y":957.639552116394,"z":"59d9d15d.d6cec","wires":[[]]},{"id":"5a318a10.b7f824","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNET_KEYS table.' />\n","comments":"","x":2410.659278869629,"y":908.489405632019,"z":"59d9d15d.d6cec","wires":[]},{"id":"8a79d874.143b98","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNETS table.' />\n","comments":"","x":2654.1043243408203,"y":803.1559743881226,"z":"59d9d15d.d6cec","wires":[]},{"id":"54bc5756.107198","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2248.659278869629,"y":908.489405632019,"z":"59d9d15d.d6cec","wires":[["5a318a10.b7f824"]]},{"id":"fe526422.16f6a8","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-generic-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$key-value`\"/>\n<parameter name=\"field6\" value=\"`$tmp.eipam-pool-row.pool-id`\"/>\n<parameter name=\"field7\" value=\"`$tmp.network_instance_group_id`\"/>\n<parameter name=\"field8\" value=\"`$eipam-ip-block.level`\"/>\n<parameter name=\"field9\" value=\"`$network-model.network-role`\"/>\n<parameter name=\"field10\" value=\"`$tmp.network-id`\"/>\n<parameter name=\"field11\" value=\"subnet saved to DB.\"/>","comments":"","outputs":1,"x":1824.629493713379,"y":954.789698600769,"z":"59d9d15d.d6cec","wires":[[]]},{"id":"26bb8cfc.df8fb4","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2115.1824798583984,"y":718.4749870300293,"z":"59d9d15d.d6cec","wires":[["82b454c3.44a828"]]},{"id":"82b454c3.44a828","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while looking for entry in EIPAM_IP_POOLS for V4 subnet in EIPAM.\" />\n\t","comments":"","x":2320.1824798583984,"y":732.4750175476074,"z":"59d9d15d.d6cec","wires":[]},{"id":"ef851ee3.4729d","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2121.4046669006348,"y":752.3637619018555,"z":"59d9d15d.d6cec","wires":[["82b454c3.44a828"]]},{"id":"afc2d16f.1f298","type":"save","name":"insert EIPAM_IP_SUBNETS for V6","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNETS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             service_type = $tmp.service-type ,\n             ip_address = $eipam-ip-block.ip-prefix ,\n             prefix_length = $eipam-ip-block.mask ,\n             plan_name = $network-model.eipam-v6-address-plan ,\n             status = 'ACTIVE' ,\n             pool_id = $pfx.eipam-pool-row.pool-id ,\n             address_family = $network-model.ipv6-ip-version ,\n             network_id = $tmp.network-id ,\n             network_instance_group_id = $tmp.network-instance-group-id ; \"\n    force='true'\n        pfx='pfx.eipam-v6subnet-row'>\n","comments":"","outputs":1,"x":2320.7775955200195,"y":1354.4443311691284,"z":"59d9d15d.d6cec","wires":[["501eb89c.f97d08"]]},{"id":"947c46b.dfcfcb8","type":"execute","name":"execute EIPAM allocateSubnet","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"allocateSubnet\">\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","outputs":1,"x":1953.5401306152344,"y":1247.4049797058105,"z":"59d9d15d.d6cec","wires":[["ca583d20.3e1f8"]]},{"id":"ca583d20.3e1f8","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2163.5401611328125,"y":1248.7953453063965,"z":"59d9d15d.d6cec","wires":[["6fe68b.5f646974"]]},{"id":"6fe68b.5f646974","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while allocating V6 subnet in EIPAM.\" />\n\t","comments":"","x":2327.5401916503906,"y":1251.7953758239746,"z":"59d9d15d.d6cec","wires":[]},{"id":"5f9cddac.d2bb54","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for V6","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $key-name ,\n             key_value = $key-value ,\n             level = $eipam-ip-block.level ; \"\n    force='true'\n        pfx='pfx.eipam-v6subnet-key-row'>\n","comments":"","outputs":1,"x":1991.27587890625,"y":1483.4440479278564,"z":"59d9d15d.d6cec","wires":[["2d0e4e09.d859a2","d8a4a0e7.a664c"]]},{"id":"fbd44536.a250d8","type":"get-resource","name":"get-resource V6 - get pool_id","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_POOLS WHERE plan_name = $network-model.eipam-v6-address-plan and level = $eipam-ip-block.level and key_value = $tmp.key-value ; \"\n        pfx='pfx.eipam-pool-row'>\n\n","comments":"","outputs":1,"x":1952.6481018066406,"y":1293.4050102233887,"z":"59d9d15d.d6cec","wires":[["d2f70b00.3b1238","58a4d35f.68dd1c"]]},{"id":"501eb89c.f97d08","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2580.1893730163574,"y":1350.6664409637451,"z":"59d9d15d.d6cec","wires":[["e3b79412.c323c8"]]},{"id":"d8a4a0e7.a664c","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2275.615858078003,"y":1531.9274969100952,"z":"59d9d15d.d6cec","wires":[[]]},{"id":"b37ca556.7661f8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNET_KEYS table.' />\n","comments":"","x":2426.828748703003,"y":1482.7773504257202,"z":"59d9d15d.d6cec","wires":[]},{"id":"e3b79412.c323c8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNETS table.' />\n","comments":"","x":2742.495735168457,"y":1349.666410446167,"z":"59d9d15d.d6cec","wires":[]},{"id":"2d0e4e09.d859a2","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2264.828748703003,"y":1482.7773504257202,"z":"59d9d15d.d6cec","wires":[["b37ca556.7661f8"]]},{"id":"7f1fcd55.6f8b64","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-generic-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v6-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$key-value`\"/>\n<parameter name=\"field6\" value=\"`$tmp.eipam-pool-row.pool-id`\"/>\n<parameter name=\"field7\" value=\"`$tmp.network_instance_group_id`\"/>\n<parameter name=\"field8\" value=\"`$eipam-ip-block.level`\"/>\n<parameter name=\"field9\" value=\"`$network-model.network-role`\"/>\n<parameter name=\"field10\" value=\"`$tmp.network-id`\"/>\n<parameter name=\"field11\" value=\"subnet info are saved to DB.\"/>","comments":"","outputs":1,"x":1877.46577835083,"y":1526.8555946350098,"z":"59d9d15d.d6cec","wires":[[]]},{"id":"d2f70b00.3b1238","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2160.2406311035156,"y":1280.5407524108887,"z":"59d9d15d.d6cec","wires":[["9e6cdba1.687738"]]},{"id":"9e6cdba1.687738","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while looking for entry in EIPAM_IP_POOLS for V6 subnet in EIPAM.\" />\n\t","comments":"","x":2365.2406311035156,"y":1294.5407829284668,"z":"59d9d15d.d6cec","wires":[]},{"id":"58a4d35f.68dd1c","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2174.2406311035156,"y":1315.5407524108887,"z":"59d9d15d.d6cec","wires":[["9e6cdba1.687738"]]},{"id":"888201dc.1fd6c","type":"set","name":"set: key-name/key-value","xml":"<set>\n\t<parameter name=\"key-name\" value=\"`$v4FQPN-output.pools[$eipam-ip-block.level - 1].key-name`\" />\t\n\t<parameter name=\"key-value\" value=\"`$v4FQPN-output.pools[$eipam-ip-block.level - 1].key-value`\" />\t","comments":"","x":2203.611068725586,"y":407.2221565246582,"z":"59d9d15d.d6cec","wires":[]},{"id":"4c29fe3a.88239","type":"set","name":"set: key-name/key-value","xml":"<set>\n\t<parameter name=\"key-name\" value=\"`$v6FQPN-output.pools[$eipam-ip-block.level - 1].key-name`\" />\t\n\t<parameter name=\"key-value\" value=\"`$v6FQPN-output.pools[$eipam-ip-block.level - 1].key-value`\" />\t","comments":"","x":2395.000030517578,"y":1072.5000095367432,"z":"59d9d15d.d6cec","wires":[]},{"id":"e34e99ee.7a2268","type":"switchNode","name":"test: subnet-use","xml":"<switch test=\"`$network-instance-group-data.subnet-assignment-policy.subnet-use`\">","comments":"","outputs":1,"x":1859.3629913330078,"y":840.7729730606079,"z":"59d9d15d.d6cec","wires":[["a853166b.b152b8","c0d37208.8f4c6","8a5e791b.815608"]]},{"id":"a853166b.b152b8","type":"other","name":"shared","xml":"<outcome value='shared'>","comments":"","outputs":1,"x":2036.465892791748,"y":807.2015380859375,"z":"59d9d15d.d6cec","wires":[["739a41cf.6ce14"]]},{"id":"c0d37208.8f4c6","type":"other","name":"Other","xml":"<outcome value='Other'>","comments":"","outputs":1,"x":2036.4658432006836,"y":842.5985565185547,"z":"59d9d15d.d6cec","wires":[["fe5f4f5e.816e8"]]},{"id":"8a5e791b.815608","type":"other","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":2040.4341659545898,"y":877.201623916626,"z":"59d9d15d.d6cec","wires":[["fe5f4f5e.816e8"]]},{"id":"fe5f4f5e.816e8","type":"save","name":"insert EIPAM_IP_SUBNETS for V4","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNETS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             service_type = $tmp.service-type ,\n             ip_address = $eipam-ip-block.ip-prefix ,\n             prefix_length = $eipam-ip-block.mask ,\n             plan_name = $network-model.eipam-v4-address-plan ,\n             status = 'ACTIVE' ,\n             pool_id = $pfx.eipam-pool-row.pool-id ,\n             address_family = $network-model.ipv4-ip-version ,\n             network_id = $tmp.network-id ; \"\n    force='true'\n        pfx='pfx.eipam-v4subnet-row'>\n","comments":"","outputs":1,"x":2258.680419921875,"y":851.3680419921875,"z":"59d9d15d.d6cec","wires":[["bb00f828.48b688"]]},{"id":"be19d35a.f6ee9","type":"switchNode","name":"test: subnet-use","xml":"<switch test=\"`$network-instance-group-data.subnet-assignment-policy.subnet-use`\">","comments":"","outputs":1,"x":1920.2359619140625,"y":1383.5902099609375,"z":"59d9d15d.d6cec","wires":[["2632d631.52c4aa","1340bc13.064864","1b2d9362.16f21d"]]},{"id":"2632d631.52c4aa","type":"other","name":"shared","xml":"<outcome value='shared'>","comments":"","outputs":1,"x":2097.3388633728027,"y":1350.018774986267,"z":"59d9d15d.d6cec","wires":[["afc2d16f.1f298"]]},{"id":"1340bc13.064864","type":"other","name":"Other","xml":"<outcome value='Other'>","comments":"","outputs":1,"x":2097.3388137817383,"y":1385.4157934188843,"z":"59d9d15d.d6cec","wires":[["9a6994e7.96b818"]]},{"id":"1b2d9362.16f21d","type":"other","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":2101.3071365356445,"y":1420.0188608169556,"z":"59d9d15d.d6cec","wires":[["9a6994e7.96b818"]]},{"id":"9a6994e7.96b818","type":"save","name":"insert EIPAM_IP_SUBNETS for V6","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNETS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             service_type = $tmp.service-type ,\n             ip_address = $eipam-ip-block.ip-prefix ,\n             prefix_length = $eipam-ip-block.mask ,\n             plan_name = $network-model.eipam-v6-address-plan ,\n             status = 'ACTIVE' ,\n             pool_id = $pfx.eipam-pool-row.pool-id ,\n             address_family = $network-model.ipv6-ip-version ,\n             network_id = $tmp.network-id ; \"\n    force='true'\n        pfx='pfx.eipam-v6subnet-row'>\n","comments":"","outputs":1,"x":2321.34716796875,"y":1405.8123779296875,"z":"59d9d15d.d6cec","wires":[["501eb89c.f97d08"]]}]