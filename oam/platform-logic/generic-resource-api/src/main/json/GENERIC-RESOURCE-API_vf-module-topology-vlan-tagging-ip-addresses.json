[{"id":"db4eae46.4b3fd","type":"dgstart","name":"DGSTART","outputs":1,"x":115,"y":52.5,"z":"da0dd7d5.9e19b8","wires":[["db0de74.4726e18"]]},{"id":"5d7faec4.53391","type":"method","name":"method vf-module-topology-vlan-tagging-ip-addresses","xml":"<method rpc='vf-module-topology-vlan-tagging-ip-addresses' mode='sync'>\n","comments":"","outputs":1,"x":314.26190185546875,"y":103.45635414123535,"z":"da0dd7d5.9e19b8","wires":[["aa02ce0c.30ff9"]]},{"id":"db0de74.4726e18","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":390.23819732666016,"y":52.69049263000488,"z":"da0dd7d5.9e19b8","wires":[["5d7faec4.53391"]]},{"id":"aa02ce0c.30ff9","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":226.75,"y":166.14295196533203,"z":"da0dd7d5.9e19b8","wires":[["3b787481.8b040c","774ce022.1da5f","bbb5d0b4.6c11c","fc89f675.3e0838","d2e3f64e.f6a748","3704ed43.9a9d72","a476f52c.2521b8","cde326ed.20e5f8","1f554749.0a5289","3aac8436.58ee6c","da5910d3.5b98d","bd90de81.a134","7a2137f8.de11d8","8a9adc86.dcb73","3f9be8dd.c4ce68"]]},{"id":"4bb7255e.8118dc","type":"get-resource","name":"get EIPAM_IP_SUBNETS by network-id","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='`$tmp.sql`' pfx='db.selected-subnet-data[]'>","comments":"","outputs":1,"x":1175.5833892822266,"y":1148.5596389770508,"z":"da0dd7d5.9e19b8","wires":[["2aa50b37.f28b94","ca6f72b2.6bf8"]]},{"id":"a6930049.b9e27","type":"get-resource","name":"get EIPAM_IP_SUBNET_KEYS with MAX level by entity_id","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='`$tmp.sql`' pfx='db.selected-subnet-keys'>","comments":"","outputs":1,"x":924.654972076416,"y":1837.2500929832458,"z":"da0dd7d5.9e19b8","wires":[["91f544f0.514358","c578b30f.c54f8"]]},{"id":"e5b62e72.36eb4","type":"comment","name":"selected-entity-id","info":"","comments":"","x":2006.155101776123,"y":1975.1430644989014,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"cde326ed.20e5f8","type":"for","name":"for didx in db.selected-subnet-data[]","xml":"<for index='didx' start='0' end='`$db.selected-subnet-data_length`' >\n","comments":"","outputs":1,"x":508.22641372680664,"y":1778.6786642074585,"z":"da0dd7d5.9e19b8","wires":[["a6930049.b9e27","f2df2449.d5fa58"]]},{"id":"77d16bd4.03a8c4","type":"comment","name":"subnet-use - unique","info":"","comments":"","x":1244.5121231079102,"y":1105.166790008545,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"d4f87d61.6fd29","type":"comment","name":"subnet-use - shared or VIP","info":"","comments":"","x":1894.0834503173828,"y":1416.4882650375366,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"eabd4324.7e31f","type":"comment","name":"Required INPUTS","info":"tmp.vt-ip.vm-type (for FIXED)\ntmp.vt-ip.vnfc-name (for FIXED)\ntmp.vt-ip.network-id (for FIXED)\ntmp.vt-ip.network-instance-group-id\ntmp.vt-ip.ip-version\ntmp.vt-ip.type (FIXED or VIP)\ntmp.vt-ip.network-instance-group-function\ntmp.vt-ip.nf-role (for VIP)\ntmp.vt-ip.vf-module-id (for FIXED)\ntmp.vt-ip.sequence-number (for FIXED)","comments":"","x":840,"y":71.25000381469727,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"bbb5d0b4.6c11c","type":"switchNode","name":"switch ip-version","xml":"<switch test='`$tmp.vt-ip.ip-version`'>\n","comments":"","outputs":1,"x":447.0000305175781,"y":304.0000171661377,"z":"da0dd7d5.9e19b8","wires":[["72646257.b1f07c","93c23a8c.f589b8","c8332654.c5e6a8"]]},{"id":"72646257.b1f07c","type":"outcome","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":650.0000228881836,"y":304.00001335144043,"z":"da0dd7d5.9e19b8","wires":[["6c9465e7.0f749c"]]},{"id":"6c9465e7.0f749c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='ip-version is required' />\n","comments":"","x":805.7500267028809,"y":303.75001335144043,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"3b787481.8b040c","type":"switchNode","name":"switch type","xml":"<switch test='`$tmp.vt-ip.type`'>\n","comments":"","outputs":1,"x":430.00000762939453,"y":212.50000286102295,"z":"da0dd7d5.9e19b8","wires":[["20137293.759cae"]]},{"id":"20137293.759cae","type":"outcome","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":595.0000114440918,"y":212.74999809265137,"z":"da0dd7d5.9e19b8","wires":[["1d3d243.4d9b8dc"]]},{"id":"1d3d243.4d9b8dc","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='type is required' />\n","comments":"","x":758.7500152587891,"y":212.49999809265137,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"3704ed43.9a9d72","type":"switchNode","name":"switch network-id && network-instance-group-id == NULL","xml":"<switch test=\"`$tmp.vt-ip.network-id == '' and $tmp.vt-ip.network-instance-group-id == '' `\">\n","comments":"","outputs":1,"x":578.4762496948242,"y":970.6309232711792,"z":"da0dd7d5.9e19b8","wires":[["cf259dac.da7ad"]]},{"id":"cf259dac.da7ad","type":"outcome","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":879.4762535095215,"y":970.8809185028076,"z":"da0dd7d5.9e19b8","wires":[["c428143a.3eb128"]]},{"id":"c428143a.3eb128","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='either network-id or network-isntance-group-id is required' />\n","comments":"","x":1043.2262573242188,"y":970.6309185028076,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"d2e3f64e.f6a748","type":"switchNode","name":"switch type","xml":"<switch test='`$tmp.vt-ip.type`'>\n","comments":"","outputs":1,"x":425.75000762939453,"y":524.5000076293945,"z":"da0dd7d5.9e19b8","wires":[["f308784f.30b748","7ce44ba.25dd7b4"]]},{"id":"f308784f.30b748","type":"outcome","name":"FIXED","xml":"<outcome value='FIXED'>\n","comments":"","outputs":1,"x":603.5000076293945,"y":524.5000076293945,"z":"da0dd7d5.9e19b8","wires":[["982de299.19cc"]]},{"id":"7ce44ba.25dd7b4","type":"outcome","name":"VIP","xml":"<outcome value='VIP'>\n","comments":"","outputs":1,"x":604.5000076293945,"y":760.0000448226929,"z":"da0dd7d5.9e19b8","wires":[["845733f4.78fad"]]},{"id":"8fda28f7.7fdf08","type":"switchNode","name":"switch vnfc-name","xml":"<switch test='`$tmp.vt-ip.vnfc-name`'>\n","comments":"","outputs":1,"x":993.0000152587891,"y":524.5000057220459,"z":"da0dd7d5.9e19b8","wires":[["ab97e748.b2aeb8"]]},{"id":"ab97e748.b2aeb8","type":"outcome","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1173.500015258789,"y":524.0000057220459,"z":"da0dd7d5.9e19b8","wires":[["b08630ad.cf34b"]]},{"id":"b08630ad.cf34b","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='vnfc-name is required for FIXED ip request' />\n","comments":"","x":1337.2500190734863,"y":523.7500057220459,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"982de299.19cc","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":766.5000114440918,"y":524.2500057220459,"z":"da0dd7d5.9e19b8","wires":[["8fda28f7.7fdf08","66187f63.a9f7e","dd589dc0.aebfe","a0c78a24.944498","b912e4a9.bce1c8"]]},{"id":"774ce022.1da5f","type":"switchNode","name":"switch network-instance-group-function","xml":"<switch test='`$tmp.vt-ip.network-instance-group-function`'>\n","comments":"","outputs":1,"x":517.0000152587891,"y":258.75000381469727,"z":"da0dd7d5.9e19b8","wires":[["15a40175.0679cf"]]},{"id":"15a40175.0679cf","type":"outcome","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":743.0000190734863,"y":258.9999990463257,"z":"da0dd7d5.9e19b8","wires":[["f4db1eb1.4950a"]]},{"id":"f4db1eb1.4950a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='network-instance-group-function is required for FIXED ip request' />\n","comments":"","x":906.7500228881836,"y":258.7499990463257,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"a649d68c.d9ddc8","type":"switchNode","name":"switch nf-role","xml":"<switch test='`$tmp.vt-ip.nf-role`'>\n","comments":"","outputs":1,"x":984.0000305175781,"y":760.7500190734863,"z":"da0dd7d5.9e19b8","wires":[["5c79549a.88776c"]]},{"id":"5c79549a.88776c","type":"outcome","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1149.0000343322754,"y":761.0000143051147,"z":"da0dd7d5.9e19b8","wires":[["9926dfb4.0e9b8"]]},{"id":"9926dfb4.0e9b8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='nf-role is required for VIP ip request' />\n","comments":"","x":1312.7500381469727,"y":760.7500143051147,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"d9fa5743.fc1308","type":"get-resource","name":"get EIPAM_IP_SUBNETS by network-instance-group-id","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='`$tmp.sql`' pfx='db.selected-subnet-data[]'>","comments":"","outputs":1,"x":1735.8334503173828,"y":1455.2382650375366,"z":"da0dd7d5.9e19b8","wires":[["b37129b.49908d8","6045f035.19ac7"]]},{"id":"a476f52c.2521b8","type":"switchNode","name":"switch network-id != NULL","xml":"<switch test=\"`$tmp.vt-ip.network-id != '' `\">\n","comments":"","outputs":1,"x":483.8334159851074,"y":1095.631085395813,"z":"da0dd7d5.9e19b8","wires":[["88f840b3.58c1b","5640206.4e6bbe"]]},{"id":"82d77d1b.3832d","type":"switchNode","name":"switch network-instance-group-id != NULL","xml":"<switch test=\"`$tmp.vt-ip.network-instance-group-id != '' `\">\n","comments":"","outputs":1,"x":963.9406204223633,"y":1403.1311302185059,"z":"da0dd7d5.9e19b8","wires":[["d644e347.015b8"]]},{"id":"88f840b3.58c1b","type":"outcome","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":701.3334045410156,"y":1095.6310873031616,"z":"da0dd7d5.9e19b8","wires":[["feedbf55.a5941"]]},{"id":"5640206.4e6bbe","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":711.440601348877,"y":1402.6311292648315,"z":"da0dd7d5.9e19b8","wires":[["82d77d1b.3832d"]]},{"id":"d644e347.015b8","type":"outcome","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1217.6905899047852,"y":1402.3811206817627,"z":"da0dd7d5.9e19b8","wires":[["ea702123.03399"]]},{"id":"93c23a8c.f589b8","type":"outcome","name":"ipv4","xml":"<outcome value='ipv4'>\n","comments":"","outputs":1,"x":650.7500228881836,"y":346.250018119812,"z":"da0dd7d5.9e19b8","wires":[["86ce5cb2.1cc9e"]]},{"id":"c8332654.c5e6a8","type":"outcome","name":"ipv6","xml":"<outcome value='ipv6'>\n","comments":"","outputs":1,"x":653.2500228881836,"y":392.500018119812,"z":"da0dd7d5.9e19b8","wires":[["e725105b.d0815"]]},{"id":"86ce5cb2.1cc9e","type":"set","name":"tmp.address-family = 4, mp.sql.address-family = %4","xml":"<set>\n<parameter name='tmp.address-family' value='4' />\n<parameter name='tmp.sql.address-family' value='%4' />\n","comments":"","x":927.5000381469727,"y":346.50002574920654,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"e725105b.d0815","type":"set","name":"tmp.address-family = 6, tmp.sql.address-family=%6","xml":"<set>\n<parameter name='tmp.address-family' value='6' />\n<parameter name='tmp.sql.address-family' value='%6' />\n","comments":"","x":928.0000381469727,"y":391.75002574920654,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"ae3a9d2a.85162","type":"switchNode","name":"switch level == 4","xml":"<switch test=\"`$db.selected-subnet-keys.level == '4' `\">\n","comments":"","outputs":1,"x":1407.7264976501465,"y":1881.0358905792236,"z":"da0dd7d5.9e19b8","wires":[["99bc0a56.f15958","8f3ae4a0.6b13c8"]]},{"id":"99bc0a56.f15958","type":"outcome","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1593.4764442443848,"y":1933.535888671875,"z":"da0dd7d5.9e19b8","wires":[["64ef27ad.e98c18"]]},{"id":"b055f0b1.143a8","type":"break","name":"break","xml":"<break>\n","comments":"","x":1898.1193084716797,"y":2100.678692817688,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"64ef27ad.e98c18","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1737.2264671325684,"y":1933.7859020233154,"z":"da0dd7d5.9e19b8","wires":[["87b119cf.86a188","34e320b6.cbbea","d275a6b.bf0f758","b055f0b1.143a8"]]},{"id":"87b119cf.86a188","type":"set","name":"set tmp.selected-entity-id","xml":"<set>\n<parameter name='tmp.selected-entity-id' value='`$db.selected-subnet-keys.entity-id`' />\n","comments":"","x":1949.6551094055176,"y":2006.3930673599243,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"b912e4a9.bce1c8","type":"set","name":"set tmp.eipam.info = vf-module-id","xml":"<set>\n<parameter name=\"tmp.eipam.info\" value=\"`$tmp.vt-ip.vf-module-id`\"/>\n","comments":"","x":1045.3335189819336,"y":691.16676902771,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"34e320b6.cbbea","type":"set","name":"set tmp.selected-plan-name","xml":"<set>\n<parameter name='tmp.selected-plan-name' value='`$db.selected-subnet-data[$didx].plan-name`' />\n","comments":"","x":1960.1550941467285,"y":2052.893054485321,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"3aac8436.58ee6c","type":"set","name":"set eipam-ip-block","xml":"<set>\n<parameter name='eipam-ip-block.plans[0].plan-name' value='`$tmp.selected-plan-name`' />\n<parameter name='eipam-ip-block.plans[0].address-family' value=\"`$tmp.vt-ip.ip-version`\" />\n<parameter name='eipam-ip-block.plans[0].requests[0].client-key' \n\tvalue=\"`$tmp.selected-client-key`\" />\n<parameter name=\"eipam-ip-block.plans[0].requests[0].info\" \n\tvalue=\"`$tmp.eipam.info`\"/>\n<parameter name=\"eipam-ip-block.plans[0].requests[0].pools_length\" value=\"4\"/>\n<parameter name='eipam-ip-block.plans[0].requests_length' value='1' />\n<parameter name=\"eipam-ip-block.plans_length\" value=\"1\"/>","comments":"","x":453.79777908325195,"y":2331.3573055267334,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"da5910d3.5b98d","type":"execute","name":"call EIPAM assignIPAddress","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"assignIPAddress\">","comments":"","outputs":1,"x":482.64345932006836,"y":2489.7617540359497,"z":"da0dd7d5.9e19b8","wires":[["9803868b.2b8d18"]]},{"id":"9803868b.2b8d18","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":696.6434593200684,"y":2489.7617540359497,"z":"da0dd7d5.9e19b8","wires":[["b38b998e.3c6108"]]},{"id":"e42ece58.9590a","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"`'An error occured while obtaining ip addresses from EIPAM: ' + $error-message`\" />\n","comments":"","x":1041.1434898376465,"y":2489.5117540359497,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"b38b998e.3c6108","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":858.4526481628418,"y":2490.011742591858,"z":"da0dd7d5.9e19b8","wires":[["e42ece58.9590a"]]},{"id":"dd589dc0.aebfe","type":"set","name":"set tmp.selected-client-key FIXED","xml":"<set>\n<parameter name=\"tmp.selected-client-key\" \n\tvalue=\"`$tmp.vt-ip.vm-type + '|' +\n\t\t\t$tmp.vt-ip.vnfc-name + '|' +\n\t\t\t$tmp.vt-ip.network-instance-group-function + '|' + \n\t\t\t$tmp.vt-ip.type + '|' + \n\t\t\t$tmp.address-family + '|' + \n\t\t\t$tmp.vt-ip.sequence-number`\" />\n\t\n<!--\t\nfixed-ip client-key:\nvm-type + VFCname + network-instance-group-function + \"FIXED\" + [ip-version(4/6)] + seqNo\n\t\tseqNo required for unique, but not required for shared\n-->","comments":"","x":1046.7501373291016,"y":649.0000076293945,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"d9ab5e25.a72d4","type":"set","name":"set tmp.selected-client-key VIP","xml":"<set>\n<parameter name='tmp.selected-client-key' \n\tvalue=\"`$tmp.vt-ip.nf-role + '|' + \n\t\t\t$tmp.vt-ip.network-instance-group-function + '|' +\n\t\t\t$tmp.vt-ip.type + '|' + \n\t\t\t$tmp.vt-ip.ip-version`\" />\n\t\n<!--\t\nloating-ip client-key:\nnf-role + network-instance-group-function + \"VIP\" + [ip-version(4/6)]\n-->","comments":"","x":1037.500015258789,"y":889.0000123977661,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"66187f63.a9f7e","type":"switchNode","name":"switch vf-module-id","xml":"<switch test='`$tmp.vt-ip.vf-module-id`'>\n","comments":"","outputs":1,"x":1000.2500152587891,"y":565.5000076293945,"z":"da0dd7d5.9e19b8","wires":[["2be7eff.1ecde1"]]},{"id":"2be7eff.1ecde1","type":"outcome","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1179.2500190734863,"y":565.750002861023,"z":"da0dd7d5.9e19b8","wires":[["d378b864.d20678"]]},{"id":"d378b864.d20678","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='vf-module-id is required' />\n","comments":"","x":1334.0000228881836,"y":565.500002861023,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"845733f4.78fad","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":771.0000152587891,"y":760.5000085830688,"z":"da0dd7d5.9e19b8","wires":[["a649d68c.d9ddc8","d9ab5e25.a72d4","42424dee.ed9f94","b5cd3280.de819"]]},{"id":"a0c78a24.944498","type":"switchNode","name":"switch sequence-number","xml":"<switch test='`$tmp.vt-ip.sequence-number`'>\n","comments":"","outputs":1,"x":1022.0000152587891,"y":606.5000076293945,"z":"da0dd7d5.9e19b8","wires":[["b1da28ce.48b808"]]},{"id":"b1da28ce.48b808","type":"outcome","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1218.0000190734863,"y":606.750002861023,"z":"da0dd7d5.9e19b8","wires":[["7474eec4.3c2ee"]]},{"id":"7474eec4.3c2ee","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='seq-num is required' />\n","comments":"","x":1372.7500228881836,"y":606.500002861023,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"8f3ae4a0.6b13c8","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":1590.9764442443848,"y":1881.2858848571777,"z":"da0dd7d5.9e19b8","wires":[["e4d528c2.841028"]]},{"id":"4d128fce.85a7e","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='No level 4 KeyName found in EIPAM_IP_SUBNET_KEYS' />\n","comments":"","x":860.6191253662109,"y":2157.750346183777,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"1f554749.0a5289","type":"get-resource","name":"get EIPAM_IP_SUBNET_KEYS by entity_id","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from EIPAM_IP_SUBNET_KEYS  \n  \twhere entity_id = $tmp.selected-entity-id order by level'\n  pfx='db.eipam-subnet-keys[]'>","comments":"","outputs":1,"x":532.0479011535645,"y":2216.35729265213,"z":"da0dd7d5.9e19b8","wires":[["c8ad41e7.8215d"]]},{"id":"b37129b.49908d8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2031.583480834961,"y":1455.2382621765137,"z":"da0dd7d5.9e19b8","wires":[["27b67a83.1da0b6"]]},{"id":"27b67a83.1da0b6","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value = 'Failed to read EIPAM_IP_SUBNETS table' />\n","comments":"","x":2181.58345413208,"y":1455.2382488250732,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"91f544f0.514358","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1229.4048881530762,"y":1837.5000734329224,"z":"da0dd7d5.9e19b8","wires":[["f1303259.8492"]]},{"id":"f1303259.8492","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value = 'Failed to read EIPAM_IP_SUBNET_KEYS table to find MAX level by entity_id' />\n","comments":"","x":1397.4048614501953,"y":1837.500060081482,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"c578b30f.c54f8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1233.9049072265625,"y":1881.0000886917114,"z":"da0dd7d5.9e19b8","wires":[["ae3a9d2a.85162"]]},{"id":"c8ad41e7.8215d","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":806.7977714538574,"y":2216.3572754859924,"z":"da0dd7d5.9e19b8","wires":[["b26cc25b.ca6da"]]},{"id":"b26cc25b.ca6da","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value = 'Failed to read EIPAM_IP_SUBNET_KEYS table by entity_id' />\n","comments":"","x":974.7977447509766,"y":2216.357262134552,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"2b7f2a7c.3c9776","type":"set","name":"set eipam-ip-block key-name/value","xml":"<set>\n<parameter name=\"eipam-ip-block.plans[0].requests[0].pools[$key].key-name\" \n\tvalue=\"`$db.eipam-subnet-keys[$key].key-name`\"/>\n<parameter name=\"eipam-ip-block.plans[0].requests[0].pools[$key].key-value\" \n\tvalue=\"`$db.eipam-subnet-keys[$key].key-value`\"/>\n","comments":"","x":818.7978019714355,"y":2279.1072945594788,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"7a2137f8.de11d8","type":"for","name":"for key in db.eipam-subnet-keys[]","xml":"<for index='key' start='0' end='`$db.eipam-subnet-keys_length`' >\n","comments":"","outputs":1,"x":500.0477714538574,"y":2278.8572754859924,"z":"da0dd7d5.9e19b8","wires":[["2b7f2a7c.3c9776"]]},{"id":"ea702123.03399","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1388.107219696045,"y":1401.9644470214844,"z":"da0dd7d5.9e19b8","wires":[["d9fa5743.fc1308","63c78328.8f2ecc","b2cfdd91.02334"]]},{"id":"b5cd3280.de819","type":"set","name":"set tmp.eipam.info = network-instance-group-id","xml":"<set>\n<parameter name=\"tmp.eipam.info\" value=\"`$tmp.vt-ip.network-instance-group-id`\"/>\n","comments":"","x":1087.7500305175781,"y":845.0000095367432,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"63c78328.8f2ecc","type":"set","name":"set eipam-ip-block network-instance-group-id","xml":"<set>\n<parameter name=\"eipam-ip-block.plans[0].requests[0].network-instance-group-id\" \n\tvalue=\"`$tmp.vt-ip.network-instance-group-id`\"/>\n","comments":"","x":1700.499984741211,"y":1548.5716457366943,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"2aa50b37.f28b94","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1420.9999542236328,"y":1148.1429443359375,"z":"da0dd7d5.9e19b8","wires":[["bb874230.642da"]]},{"id":"bb874230.642da","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value = 'Failed to read EIPAM_IP_SUBNETS table' />\n","comments":"","x":1570.999927520752,"y":1148.142930984497,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"feedbf55.a5941","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":866.7500228881836,"y":1095.7143869400024,"z":"da0dd7d5.9e19b8","wires":[["4bb7255e.8118dc","c33a5903.ba87e8","176f25a9.a8fe9a"]]},{"id":"c33a5903.ba87e8","type":"set","name":"set eipam-ip-block network-id","xml":"<set>\n<parameter name=\"eipam-ip-block.plans[0].requests[0].network-id\" \n\tvalue=\"`$tmp.vt-ip.network-id`\"/>\n","comments":"","x":1144.6070861816406,"y":1222.8215999603271,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"fc89f675.3e0838","type":"set","name":"initialize eipam-ip-block","xml":"<set>\n<parameter name='eipam-ip-block.' value='' />\n","comments":"","x":465.00001525878906,"y":457.00001525878906,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"42424dee.ed9f94","type":"switchNode","name":"switch network-instance-group-id == NULL","xml":"<switch test=\"`$tmp.vt-ip.network-instance-group-id == '' `\">\n","comments":"","outputs":1,"x":1074.000015258789,"y":806.2500114440918,"z":"da0dd7d5.9e19b8","wires":[["2490f93f.ceaa26"]]},{"id":"2490f93f.ceaa26","type":"outcome","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1320,"y":803.75,"z":"da0dd7d5.9e19b8","wires":[["23cbf379.9fba5c"]]},{"id":"23cbf379.9fba5c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='network-isntance-group-id is required for VIP' />\n","comments":"","x":1483.7500038146973,"y":803.5,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"bd90de81.a134","type":"execute","name":"printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/vlan-tag-ip.log' />\n","comments":"","outputs":1,"x":434.4643669128418,"y":2428.1905307769775,"z":"da0dd7d5.9e19b8","wires":[[]]},{"id":"ca6f72b2.6bf8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1430.857032775879,"y":1195.2856945991516,"z":"da0dd7d5.9e19b8","wires":[["c16a6051.0d9e5"]]},{"id":"c16a6051.0d9e5","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value = \"`'No EIPAM_IP_SUBNETS entry found with network-id = ' + $tmp.vt-ip.network-id + ' and address_family = ' + $tmp.address-family`\" />\n","comments":"","x":1592.2856788635254,"y":1195.285696029663,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"6045f035.19ac7","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2039.4286270141602,"y":1500.1429061889648,"z":"da0dd7d5.9e19b8","wires":[["9e4c2215.1e732"]]},{"id":"9e4c2215.1e732","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value = \"`'No EIPAM_IP_SUBNETS entry found with network-instance-group-id = ' + $tmp.vt-ip.network-instance-group-id + ' and address_family = ' + $tmp.address-family`\" />\n","comments":"","x":2200.8572731018066,"y":1500.1429076194763,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"f2df2449.d5fa58","type":"set","name":"set tmp.sql","xml":"<set>\n<parameter name='tmp.sql' \n\tvalue=\"`'SELECT a.entity_id, a.key_name, a.key_value, a.level from EIPAM_IP_SUBNET_KEYS a where level = (SELECT MAX(level) from EIPAM_IP_SUBNET_KEYS b where b.entity_id = a.entity_id and entity_id = ' + ' $db.selected-subnet-data[$didx].entity-id )'`\" />","comments":"","x":774.4286499023438,"y":1778.9048070907593,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"b2cfdd91.02334","type":"set","name":"set tmp.sql","xml":"<set>\n<parameter name='tmp.sql' \n\tvalue=\"`'SELECT * from EIPAM_IP_SUBNETS WHERE network_instance_group_id = '+ \n\t\t'$tmp.vt-ip.network-instance-group-id AND address_family like $tmp.sql.address-family'`\" />","comments":"","x":1597.285774230957,"y":1402.2859001159668,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"8a9adc86.dcb73","type":"set","name":"set tmp.level4-key-found = false","xml":"<set>\n<parameter name='tmp.level4-key-found' value='false' />\n","comments":"","x":496.8572540283203,"y":1638.904878616333,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"d275a6b.bf0f758","type":"set","name":"set tmp.level4-key-found = true","xml":"<set>\n<parameter name='tmp.level4-key-found' value='true' />\n","comments":"","x":1974.7143440246582,"y":1934.0477485656738,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"e4d528c2.841028","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1734.7143287658691,"y":1880.3334188461304,"z":"da0dd7d5.9e19b8","wires":[[]]},{"id":"176f25a9.a8fe9a","type":"set","name":"set tmp.sql","xml":"<set>\n<parameter name='tmp.sql' \n\tvalue=\"`'SELECT * from EIPAM_IP_SUBNETS WHERE network_id = ' + \n\t'$tmp.vt-ip.network-id AND address_family like $tmp.sql.address-family'`\" />","comments":"","x":1083.7143478393555,"y":1095.285852432251,"z":"da0dd7d5.9e19b8","wires":[]},{"id":"3f9be8dd.c4ce68","type":"switchNode","name":"switch tmp.level4-key-found","xml":"<switch test=\"`$tmp.level4-key-found`\">\n","comments":"","outputs":1,"x":486.85719299316406,"y":2157.4764404296875,"z":"da0dd7d5.9e19b8","wires":[["3719dfe1.2f538"]]},{"id":"3719dfe1.2f538","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":706.1429443359375,"y":2158.4763946533203,"z":"da0dd7d5.9e19b8","wires":[["4d128fce.85a7e"]]}]