[{"id":"84739dbd.562b4","type":"dgstart","name":"DGSTART","outputs":1,"x":120,"y":95,"z":"b47e4028.e9a92","wires":[["fa00f3bb.df6cd"]]},{"id":"fa00f3bb.df6cd","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":233.85713577270508,"y":134.80953788757324,"z":"b47e4028.e9a92","wires":[["17b1d2c2.856c2d"]]},{"id":"17b1d2c2.856c2d","type":"method","name":"method vf-module-topology-vlan-tagging-assign","xml":"<method rpc='vf-module-topology-vlan-tagging-assign' mode='sync'>\n","comments":"","outputs":1,"x":237.76195526123047,"y":176.66666316986084,"z":"b47e4028.e9a92","wires":[["b7a3821f.fc675"]]},{"id":"122d37e0.d78888","type":"comment","name":"vf-module-topology-vlan-tagging-assign","info":"","comments":"","x":525.3210983276367,"y":37.97569942474365,"z":"b47e4028.e9a92","wires":[]},{"id":"73a704cf.e221cc","type":"get-resource","name":"get-resource group uuids","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key=\"select distinct vmvm.vm_type, rg.group_uuid from VF_MODULE_TO_VFC_MAPPING vmvm, VFC_MODEL vm,\n  RESOURCE_GROUP_TO_TARGET_NODE_MAPPING rgm, RESOURCE_GROUP rg\n\twhere vf_module_customization_uuid = $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid\n\tand vmvm.vfc_customization_uuid = vm.customization_uuid\n\tand vmvm.vm_type = vm.vm_type\n\tand vm.uuid = rgm.target_node_uuid\n\tand rgm.target_type = 'CVFC'\n\tand rgm.group_uuid = rg.group_uuid\"\n  pfx='db.group-uuids[]'>\n\n","comments":"","outputs":1,"x":413.0000457763672,"y":1503.3333415985107,"z":"b47e4028.e9a92","wires":[["4b097e30.86422","1268ca71.5e3336","22ed74ea.6b1b1c"]]},{"id":"4b097e30.86422","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":662.1190910339355,"y":1413.714147567749,"z":"b47e4028.e9a92","wires":[["881c6e66.6f00e"]]},{"id":"1268ca71.5e3336","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":667.0238304138184,"y":1489.3331089019775,"z":"b47e4028.e9a92","wires":[["12fdec15.45d1b4"]]},{"id":"afd16428.1e4408","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"System error getting group uuids from DB\" />\n","comments":"","x":976.6667442321777,"y":1413.6666221618652,"z":"b47e4028.e9a92","wires":[]},{"id":"22ed74ea.6b1b1c","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":665.5718688964844,"y":1571.5716552734375,"z":"b47e4028.e9a92","wires":[["dc17103b.405dd"]]},{"id":"2e66316f.2aaede","type":"set","name":"set tmp.vm-type_length","xml":"<set>\n<parameter name='tmp.vm-type_length' value='`$db.vm-type-inst-func_length`' />\n","comments":"","x":4934.214881896973,"y":731.5960290431976,"z":"b47e4028.e9a92","wires":[]},{"id":"9616311b.542ae","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":4711.357864379883,"y":884.1675074100494,"z":"b47e4028.e9a92","wires":[["2e66316f.2aaede","d2ae3323.a20bc","2c14cb5b.c7d874","f2e246cf.107018"]]},{"id":"d2ae3323.a20bc","type":"for","name":"for each db vm-type","xml":"<for index='vm-type-index' start='0' end='`$db.vm-type-inst-func_length`' >\n","comments":"","outputs":1,"x":4922.215019226074,"y":763.024307012558,"z":"b47e4028.e9a92","wires":[["50b30664.abbed8"]]},{"id":"50b30664.abbed8","type":"set","name":"set tmp.vm-type[].vm-type and instance-group-function","xml":"<set>\n<parameter name='tmp.vm-type[$vm-type-index].vm-type' value='`$db.vm-type-inst-func[$vm-type-index].vm-type`' />\n<parameter name='tmp.vm-type[$vm-type-index].instance-group-function' value='`$db.vm-type-inst-func[$vm-type-index].attribute-value`' />\n","comments":"","x":5236.500591278076,"y":763.0245864391327,"z":"b47e4028.e9a92","wires":[]},{"id":"2c14cb5b.c7d874","type":"for","name":"for each instance group","xml":"<for index='ig-index' start='0' end='`$tmp.vm-type_length`' >\n","comments":"","outputs":1,"x":4936.453136444092,"y":1053.548066854477,"z":"b47e4028.e9a92","wires":[["1c6f5b80.b9f625"]]},{"id":"1c6f5b80.b9f625","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":5138.453170776367,"y":1052.1194140911102,"z":"b47e4028.e9a92","wires":[["3b0c05dc.2414da","c88a2d60.323cb","688d429e.2c231c","a9d55515.96d218","44b58669.183b78","61275292.ea0b2c","daa6fa1b.194cd8","a65f8578.358528","9572812.43b0d8","28ac4224.2be28e"]]},{"id":"8c47a6b5.66f338","type":"comment","name":"TODO: retrieve instance-group from A&AI","info":"","comments":"","x":5463.643356323242,"y":1127.3103320598602,"z":"b47e4028.e9a92","wires":[]},{"id":"e2862d21.e8842","type":"set","name":"set vlan-vnfc-instance-group data","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].instance-group-id'\n  value=\"bgb-net-inst-group-1\" />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].instance-group-function'\n  value=\"`$tmp.vm-type[$ig-index].instance-group-function`\" />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnf-id'\n  value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-id`\" />\n","comments":"","x":5837.881393432617,"y":1171.8337695598602,"z":"b47e4028.e9a92","wires":[]},{"id":"f2e246cf.107018","type":"set","name":"set vlan-vnfc-instance-group_length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group_length'\n  value='`$tmp.vm-type_length`' />\n","comments":"","x":4969.50065612793,"y":813.1672656536102,"z":"b47e4028.e9a92","wires":[]},{"id":"a9d55515.96d218","type":"set","name":"set vnfc_length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnfcs.vnfc_length'\n  value='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names_length`' />\n","comments":"","x":5382.833786010742,"y":1519.8337695598602,"z":"b47e4028.e9a92","wires":[]},{"id":"881c6e66.6f00e","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":812.9999809265137,"y":1413.3331279754639,"z":"b47e4028.e9a92","wires":[["afd16428.1e4408"]]},{"id":"44b58669.183b78","type":"for","name":"for each vnfc","xml":"<for index='vnfc-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names_length`' >\n","comments":"","outputs":1,"x":5369.5003662109375,"y":1624.1667964458466,"z":"b47e4028.e9a92","wires":[["9baf3641.f4fbc8"]]},{"id":"3b0c05dc.2414da","type":"set","name":"set found-vm-type to false","xml":"<set>\n<parameter name='found-vm-type' value='false' />\n","comments":"","x":5413.500411987305,"y":1312.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"c88a2d60.323cb","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm_length`' >\n","comments":"","outputs":1,"x":5387.500411987305,"y":1366.1667773723602,"z":"b47e4028.e9a92","wires":[["742589d9.79f2d8"]]},{"id":"742589d9.79f2d8","type":"switchNode","name":"vm-types match?","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-type\n  == $tmp.vm-type[$ig-index].vm-type`'>\n","comments":"","outputs":1,"x":5587.500411987305,"y":1365.1667773723602,"z":"b47e4028.e9a92","wires":[["cc993dc7.e829a"]]},{"id":"cc993dc7.e829a","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":5755.500411987305,"y":1364.1667773723602,"z":"b47e4028.e9a92","wires":[["2c85978.0797b68"]]},{"id":"2c85978.0797b68","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":5911.500411987305,"y":1364.1667773723602,"z":"b47e4028.e9a92","wires":[["c2de66da.adf908","7b235f79.2456"]]},{"id":"c2de66da.adf908","type":"set","name":"set found-vm-type to true","xml":"<set>\n<parameter name='found-vm-type' value='true' />\n","comments":"","x":6129.500411987305,"y":1334.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"7b235f79.2456","type":"break","name":"break","xml":"<break>\n","comments":"","x":6071.500411987305,"y":1384.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"688d429e.2c231c","type":"switchNode","name":"switch found-vm-type","xml":"<switch test='`$found-vm-type`'>\n","comments":"","outputs":1,"x":5401.500411987305,"y":1446.1667773723602,"z":"b47e4028.e9a92","wires":[["5b4e5adb.ebfc74"]]},{"id":"5b4e5adb.ebfc74","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":5585.500411987305,"y":1446.1667773723602,"z":"b47e4028.e9a92","wires":[["463f1ac9.ab06a4"]]},{"id":"463f1ac9.ab06a4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":5741.500411987305,"y":1446.1667773723602,"z":"b47e4028.e9a92","wires":[["9485f45e.dde5c8","a844387a.824798"]]},{"id":"a844387a.824798","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'AAI provided vm-type ' +\n      $tmp.vm-type[$ig-index].vm-type + ' but that was not found in vf-module-assignments.vms'`\" />\n","comments":"","x":5909.500411987305,"y":1466.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"9485f45e.dde5c8","type":"call","name":"call GENERIC-RESOURCE-API:vf-module-topology-assign-rollback","xml":"<call module='GENERIC-RESOURCE-API' rpc='vf-module-topology-assign-rollback' mode='sync' >\n","comments":"","outputs":1,"x":6081.83366394043,"y":1425.8332812786102,"z":"b47e4028.e9a92","wires":[[]]},{"id":"cf61ffc1.46d9f","type":"set","name":"set vnfc name","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnfcs.vnfc[$vnfc-index].vnfc-name'\n  value='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-name`' />\n","comments":"","x":5735.500457763672,"y":1550.166758298874,"z":"b47e4028.e9a92","wires":[]},{"id":"9baf3641.f4fbc8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":5553.500289916992,"y":1623.1667773723602,"z":"b47e4028.e9a92","wires":[["cf61ffc1.46d9f","fb2ba3c9.274db","3d91abff.5eaaa4"]]},{"id":"fb2ba3c9.274db","type":"save","name":"save instance-group relationships","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"instance-group:relationship-list\"\n   key=\"instance-group.id = $tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].instance-group-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"vnfc\" />\n    <parameter name=\"relationship-list.relationship[0].related-link\"\n      value=\"`'/aai/v$/network/vnfcs/vnfc/' +\n        $tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnfcs.vnfc[$vnfc-index].vnfc-name`\" />\n","comments":"","outputs":1,"x":5793.500335693359,"y":1621.166758298874,"z":"b47e4028.e9a92","wires":[["845c383c.277dc8","8e7375eb.ebbee8"]]},{"id":"845c383c.277dc8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":6013.333679199219,"y":1592.0385024547577,"z":"b47e4028.e9a92","wires":[["39d3f6b9.39218a"]]},{"id":"8e7375eb.ebbee8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":6021.905212402344,"y":1644.657646894455,"z":"b47e4028.e9a92","wires":[["f06696dc.dc5f68"]]},{"id":"61275292.ea0b2c","type":"switchNode","name":"DUMMY switch vm-type","xml":"<switch test='`$tmp.vm-type[$ig-index].vm-type`'>\n","comments":"","outputs":1,"x":5407.500289916992,"y":1199.1667773723602,"z":"b47e4028.e9a92","wires":[["bb2ba824.932678","79d4dac2.814e14"]]},{"id":"bb2ba824.932678","type":"outcome","name":"vm-type-5","xml":"<outcome value='vm-type-5'>\n","comments":"","outputs":1,"x":5601.500411987305,"y":1171.1667773723602,"z":"b47e4028.e9a92","wires":[["e2862d21.e8842"]]},{"id":"79d4dac2.814e14","type":"outcome","name":"vm-type-6","xml":"<outcome value='vm-type-6'>\n","comments":"","outputs":1,"x":5603.500411987305,"y":1217.1667773723602,"z":"b47e4028.e9a92","wires":[["dd634dbd.a8bf3"]]},{"id":"dd634dbd.a8bf3","type":"set","name":"set vlan-vnfc-instance-group data","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].instance-group-id'\n  value=\"bgb-net-inst-group-2\" />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].instance-group-function'\n  value=\"`$tmp.vm-type[$ig-index].instance-group-function`\" />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnf-id'\n  value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-id`\" />\n","comments":"","x":5835.500411987305,"y":1217.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"39d3f6b9.39218a","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":6183.500411987305,"y":1591.1667773723602,"z":"b47e4028.e9a92","wires":[["d3d8f852.725398","558f4bd3.863124"]]},{"id":"f06696dc.dc5f68","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":6181.500411987305,"y":1643.1667773723602,"z":"b47e4028.e9a92","wires":[["17e16892.ac0c77","558f4bd3.863124"]]},{"id":"d3d8f852.725398","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"System error creating instance-group relationship to vnfc\" />\n","comments":"","x":6361.500411987305,"y":1591.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"17e16892.ac0c77","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Not-found error relating instance group '\n      + $tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].instance-group-id\n      + ' to vnfc '\n      + $tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnfcs.vnfc[$vnfc-index].vnfc-name`\" />\n","comments":"","x":6359.500411987305,"y":1641.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"558f4bd3.863124","type":"call","name":"call GENERIC-RESOURCE-API:vf-module-topology-assign-rollback","xml":"<call module='GENERIC-RESOURCE-API' rpc='vf-module-topology-assign-rollback' mode='sync' >\n","comments":"","outputs":1,"x":6553.500411987305,"y":1537.1667773723602,"z":"b47e4028.e9a92","wires":[[]]},{"id":"3d91abff.5eaaa4","type":"set","name":"set data-created","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnfcs.vnfc[$vnfc-index].data-created' value='true' />\n","comments":"","x":5739.500411987305,"y":1699.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"daa6fa1b.194cd8","type":"set","name":"set vm-type (tmp)","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vm-type'\n  value='`$tmp.vm-type[$ig-index].vm-type`' />\n","comments":"","x":5385.500411987305,"y":1257.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"d048ce24.237da","type":"set","name":"DUMMY set first vnic-group data","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnfcs.vnfc[0].vnic-interface-role'\n  value='network-role-5' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnfcs.vnfc[0].sub-interface-capability-policy-name'\n  value='SDNC_Policy.Config_MS_TestSubInterfaceCapabilityVlanTagging01.*' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnfcs.vnfc[0].network-collection-function'\n  value='network-collection-function-5' />\n","comments":"","x":6365.500411987305,"y":1841.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"120733c7.ca097c","type":"comment","name":"TODO: get TOSCA data","info":"","comments":"","x":5401.500411987305,"y":1769.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"a65f8578.358528","type":"switchNode","name":"switch vnfc_length","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnfcs.vnfc_length`'>\n","comments":"","outputs":1,"x":5389.500411987305,"y":1815.1667773723602,"z":"b47e4028.e9a92","wires":[["9c786886.745c48","8a536d16.65c42","aee0285a.6d2328"]]},{"id":"9c786886.745c48","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":5575.500411987305,"y":1759.1667773723602,"z":"b47e4028.e9a92","wires":[["e8ce841a.7b1498"]]},{"id":"aee0285a.6d2328","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":5573.929000854492,"y":1943.4524219036102,"z":"b47e4028.e9a92","wires":[["b640c124.919db"]]},{"id":"8a536d16.65c42","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":5573.500411987305,"y":1801.1667773723602,"z":"b47e4028.e9a92","wires":[["e8ce841a.7b1498"]]},{"id":"e8ce841a.7b1498","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":5711.500411987305,"y":1777.1667773723602,"z":"b47e4028.e9a92","wires":[[]]},{"id":"b640c124.919db","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":5737.500411987305,"y":1942.1667773723602,"z":"b47e4028.e9a92","wires":[["96bfda47.08a858","52d6996a.a96b78"]]},{"id":"96bfda47.08a858","type":"switchNode","name":"DUMMY switch vm-type","xml":"<switch test='`$tmp.vm-type[$ig-index].vm-type`'>\n","comments":"","outputs":1,"x":5947.500411987305,"y":1871.1667773723602,"z":"b47e4028.e9a92","wires":[["53ef78e8.b92498","337f56ea.cd954a"]]},{"id":"53ef78e8.b92498","type":"outcome","name":"vm-type-5","xml":"<outcome value='vm-type-5'>\n","comments":"","outputs":1,"x":6141.500534057617,"y":1843.1667773723602,"z":"b47e4028.e9a92","wires":[["d048ce24.237da"]]},{"id":"337f56ea.cd954a","type":"outcome","name":"vm-type-6","xml":"<outcome value='vm-type-6'>\n","comments":"","outputs":1,"x":6143.500534057617,"y":1889.1667773723602,"z":"b47e4028.e9a92","wires":[["bc9a2845.e7d7b8"]]},{"id":"bc9a2845.e7d7b8","type":"set","name":"DUMMY set first vnic-group data","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnfcs.vnfc[0].vnic-interface-role'\n  value='network-role-6' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnfcs.vnfc[0].sub-interface-capability-policy-name'\n  value='SDNC_Policy.Config_MS_TestSubInterfaceCapabilityVlanTagging01.*' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vnfcs.vnfc[0].network-collection-function'\n  value='network-collection-function-6' />\n","comments":"","x":6363.500411987305,"y":1889.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"52d6996a.a96b78","type":"get-resource","name":"get-resource vnic counts","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key=\"select ipv4-count, ipv6-count from VF_MODULE_TO_VFC_MAPPING vmvm, VFC_TO_NETWORK_ROLE_MAPPING vnrm\n\twhere vmvm.vf_module_customization_uuid = $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid\n\tand vmvm.vm_type = $tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vm-type\n\tand vmvm.vfc_customization_uuid = vnrm.vfc_customization_uuid\"\n  pfx='db.ip-counts'>\n\n","comments":"","outputs":1,"x":5953.500534057617,"y":2017.1667773723602,"z":"b47e4028.e9a92","wires":[["9cdbf2e1.b72b6","6b06972c.2beaa8"]]},{"id":"6b06972c.2beaa8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":6139.500411987305,"y":1993.1667773723602,"z":"b47e4028.e9a92","wires":[["472f1b53.015fa4"]]},{"id":"9cdbf2e1.b72b6","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":6146.405197143555,"y":2042.7859179973602,"z":"b47e4028.e9a92","wires":[["622625a8.2f1acc"]]},{"id":"115158bc.b293c7","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"System error getting IP counts from TOSCA\" />\n","comments":"","x":6473.500534057617,"y":1991.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"aaf7198c.630318","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Not-found error getting IP counts from TOSCA for VM type '\n      + $tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$ig-index].vm-type`\" />\n","comments":"","x":6473.500534057617,"y":2041.1667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"d6af967f.3bb488","type":"call","name":"call GENERIC-RESOURCE-API:vf-module-topology-assign-rollback","xml":"<call module='GENERIC-RESOURCE-API' rpc='vf-module-topology-assign-rollback' mode='sync' >\n","comments":"","outputs":1,"x":6683.500534057617,"y":1939.1667773723602,"z":"b47e4028.e9a92","wires":[[]]},{"id":"12fdec15.45d1b4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":818.9999046325684,"y":1490.3331089019775,"z":"b47e4028.e9a92","wires":[[]]},{"id":"28ac4224.2be28e","type":"get-resource","name":"get-resource instance group function","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key=\"select attribute_value from VF_MODULE_MODEL vmm, VF_MODEL vf, ATTRIBUTE_VALUE_PAIR avp\n\twhere vmm.customization_uuid = $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid\n\tand vmm.vf_customization_uuid = vf.customization_uuid\n\tand vf.uuid = avp.resource_uuid\n\tand vmm.vf_customization_uuid = avp.resource_customization_uuid\n\tand avp.attribute_name = $tmp.vm-type[$ig-index].instance-group-function\"\n  pfx='db.attribute-value'>\n\n","comments":"","outputs":1,"x":5445.000289916992,"y":1016.6667773723602,"z":"b47e4028.e9a92","wires":[["26952ac4.2bb826","3171fe2a.9cbe32","fe8c8e5.f712d7"]]},{"id":"9572812.43b0d8","type":"execute","name":"instance-group-function starts with 'get_input='?","xml":"<execute plugin=\"org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils\" method=\"startsWith\" emitsOutcome='true' >\n<parameter name=\"source\" value=\"`$tmp.vm-type[$ig-index].instance-group-function`\" />\n<parameter name=\"target\" value=\"get_input=\" />\n","comments":"","outputs":1,"x":5483.000289916992,"y":890.6667773723602,"z":"b47e4028.e9a92","wires":[["43b4ce83.bedb1","91883493.44df88"]]},{"id":"91883493.44df88","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":5739.000289916992,"y":924.6667773723602,"z":"b47e4028.e9a92","wires":[["f23425c5.588cf8"]]},{"id":"43b4ce83.bedb1","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":5739.000297546387,"y":838.6669900417328,"z":"b47e4028.e9a92","wires":[["5f6db9ea.a70418"]]},{"id":"60117b57.b4fc44","type":"call","name":"call GENERIC-RESOURCE-API:vf-module-topology-assign-rollback","xml":"<call module='GENERIC-RESOURCE-API' rpc='vf-module-topology-assign-rollback' mode='sync' >\n","comments":"","outputs":1,"x":6241.000301361084,"y":814.3333327770233,"z":"b47e4028.e9a92","wires":[[]]},{"id":"935eed0b.82ea5","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Instance group function retrieved from TOSCA data is '\n      + $tmp.vm-type[$ig-index].instance-group-function\n      + ' but does not start with get_input='`\" />\n","comments":"","x":6069.000301361084,"y":856.3333327770233,"z":"b47e4028.e9a92","wires":[]},{"id":"4a0b0c56.a3a1e4","type":"execute","name":"truncate past 'get_input=' part","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='substring'>\n  <parameter name='result' value='tmp.truncated-value' />\n  <parameter name='string' value='`$db.parameters[$parameter-index].attribute-value`' />\n  <parameter name='begin-index' value='10' />\n","comments":"","outputs":1,"x":3240.000030517578,"y":732.0002918243408,"z":"b47e4028.e9a92","wires":[[]]},{"id":"c4aacbc.35d4538","type":"comment","name":"Chop off 'get_input=' from front of instance group function","info":"","comments":"","x":5795.000228881836,"y":771.000321149826,"z":"b47e4028.e9a92","wires":[]},{"id":"26952ac4.2bb826","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":5659.000289916992,"y":974.6667773723602,"z":"b47e4028.e9a92","wires":[["f782ad84.9919b"]]},{"id":"3171fe2a.9cbe32","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":5665.905075073242,"y":1016.2859179973602,"z":"b47e4028.e9a92","wires":[["f782ad84.9919b"]]},{"id":"f72523e0.3a5a9","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":6659.452877044678,"y":1210.8576381206512,"z":"b47e4028.e9a92","wires":[[]]},{"id":"a69b3646.ba6638","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to determine instance group function name for '\n      + $tmp.vm-type[$ig-index].instance-group-function`\" />\n","comments":"","x":5997.000289916992,"y":988.6667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"5f6db9ea.a70418","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":5889.000297546387,"y":836.6669900417328,"z":"b47e4028.e9a92","wires":[["60117b57.b4fc44","935eed0b.82ea5"]]},{"id":"f782ad84.9919b","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":5821.000289916992,"y":990.6667773723602,"z":"b47e4028.e9a92","wires":[["a69b3646.ba6638","60117b57.b4fc44"]]},{"id":"fe8c8e5.f712d7","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":5661.000289916992,"y":1058.6667773723602,"z":"b47e4028.e9a92","wires":[["fd8ab42d.1aec78"]]},{"id":"fd8ab42d.1aec78","type":"set","name":"overwrite instance group function","xml":"<set>\n<parameter name='tmp.vm-type[$ig-index].instance-group-function'\n  value='`$db.attribute-value`' />\n","comments":"","x":5877.000289916992,"y":1058.6667773723602,"z":"b47e4028.e9a92","wires":[]},{"id":"472f1b53.015fa4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":6287.000289916992,"y":1992.6667773723602,"z":"b47e4028.e9a92","wires":[["d6af967f.3bb488","115158bc.b293c7"]]},{"id":"622625a8.2f1acc","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":6295.000289916992,"y":2040.6667773723602,"z":"b47e4028.e9a92","wires":[["d6af967f.3bb488","aaf7198c.630318"]]},{"id":"f23425c5.588cf8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":5890.333541870117,"y":924.9997851848602,"z":"b47e4028.e9a92","wires":[["d209577c.d09538"]]},{"id":"d209577c.d09538","type":"set","name":"overwrite instance-group-function name","xml":"<set>\n<parameter name='tmp.vm-type[$ig-index].instance-group-function' value='`$tmp.truncated-value`' />\n","comments":"","x":6150.333633422852,"y":948.3331725597382,"z":"b47e4028.e9a92","wires":[]},{"id":"2dfb03a0.76eedc","type":"comment","name":"No subinterfaces to be created","info":"","comments":"","x":1021.3331985473633,"y":1486.9998245239258,"z":"b47e4028.e9a92","wires":[]},{"id":"d6a108ce.e84058","type":"get-resource","name":"get-resource parameters","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key=\"select attribute_name, attribute_value from ATTRIBUTE_VALUE_PAIR\n\twhere resource_uuid = $db.group-uuids[$group-index].group-uuid\n\tand attribute_name in ('vfc_instance_group_function','vfc_parent_port_role','network_collection_function')\"\n  pfx='db.parameters[]'>\n\n","comments":"","outputs":1,"x":1491.3334350585938,"y":575.9998474121094,"z":"b47e4028.e9a92","wires":[["a4afe263.1d375","9c57368f.cc2798","360f7297.4df8ee"]]},{"id":"4f1a6b56.d0d9c4","type":"for","name":"for each group uuid","xml":"<for index='group-index' start='0' end='`$db.group-uuids_length`' >\n","comments":"","outputs":1,"x":1022.6665954589844,"y":1568.6663818359375,"z":"b47e4028.e9a92","wires":[["cb3116d3.3e0178"]]},{"id":"a4afe263.1d375","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1687.999984741211,"y":501.33313941955566,"z":"b47e4028.e9a92","wires":[["f3d0f3fc.d2397"]]},{"id":"9c57368f.cc2798","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1691.2381286621094,"y":549.9523067474365,"z":"b47e4028.e9a92","wires":[["38b5a92d.df9d76"]]},{"id":"f3d0f3fc.d2397","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"System error getting parameters from ATTRIBUTE_VALUE_PAIR table\" />\n","comments":"","x":1836.547622680664,"y":501.28577041625977,"z":"b47e4028.e9a92","wires":[]},{"id":"38b5a92d.df9d76","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find parameters ATTRIBUTE_VALUE_PAIR table for group ' + $db.group-uuids[$group-index].group-uuid`\" />\n","comments":"","x":1840.3333740234375,"y":550.3333740234375,"z":"b47e4028.e9a92","wires":[]},{"id":"360f7297.4df8ee","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1684.6667938232422,"y":710.6665306091309,"z":"b47e4028.e9a92","wires":[["d4f2099f.01cce8"]]},{"id":"dc17103b.405dd","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":818.6665954589844,"y":1570.6663818359375,"z":"b47e4028.e9a92","wires":[["4f1a6b56.d0d9c4"]]},{"id":"d4f2099f.01cce8","type":"for","name":"for each parameter","xml":"<for index='parameter-index' start='0' end='`$db.parameters_length`' >\n","comments":"","outputs":1,"x":1860.6667938232422,"y":710.6665306091309,"z":"b47e4028.e9a92","wires":[["4ed288af.675838"]]},{"id":"4ed288af.675838","type":"switchNode","name":"switch attribute-name","xml":"<switch test='`$db.parameters[$parameter-index].attribute-name`'>\n","comments":"","outputs":1,"x":2070.666793823242,"y":708.6665306091309,"z":"b47e4028.e9a92","wires":[["521b1d95.d56654","87067f4.d4d328","dc6d8794.884ec8"]]},{"id":"521b1d95.d56654","type":"outcome","name":"vfc_parent_port_role","xml":"<outcome value='vfc_parent_port_role'>\n","comments":"","outputs":1,"x":2306.333251953125,"y":592.3331909179688,"z":"b47e4028.e9a92","wires":[["94730a30.6be618"]]},{"id":"87067f4.d4d328","type":"outcome","name":"vfc_instance_group_function","xml":"<outcome value='vfc_instance_group_function'>\n","comments":"","outputs":1,"x":2332.9999465942383,"y":738.6664772033691,"z":"b47e4028.e9a92","wires":[["aa0389e6.47be48"]]},{"id":"dc6d8794.884ec8","type":"outcome","name":"network_collection_function","xml":"<outcome value='network_collection_function'>\n","comments":"","outputs":1,"x":2327.6665954589844,"y":858.6665172576904,"z":"b47e4028.e9a92","wires":[["84e024fa.3032d8"]]},{"id":"aa0389e6.47be48","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2558.9999465942383,"y":737.6664772033691,"z":"b47e4028.e9a92","wires":[["c9562823.b83258","8a2ae114.7b5fc","91fc7b41.155df8"]]},{"id":"84e024fa.3032d8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2558.9999465942383,"y":858.6664772033691,"z":"b47e4028.e9a92","wires":[["c9562823.b83258","8a2ae114.7b5fc","8c34c0a7.286db"]]},{"id":"c9562823.b83258","type":"execute","name":"starts with 'get_input='?","xml":"<execute plugin=\"org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils\" method=\"startsWith\" emitsOutcome='true' >\n<parameter name=\"source\" value=\"`$db.parameters[$parameter-index].attribute-value`\" />\n<parameter name=\"target\" value=\"get_input=\" />\n","comments":"","outputs":1,"x":2837.666778564453,"y":700.9998035430908,"z":"b47e4028.e9a92","wires":[["76cf72a3.2c8a7c","e409b4e7.5c7e18"]]},{"id":"76cf72a3.2c8a7c","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":3039.666774749756,"y":662.9999647140503,"z":"b47e4028.e9a92","wires":[["e0ac34b2.d8e248"]]},{"id":"e409b4e7.5c7e18","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":3039.666778564453,"y":732.9998035430908,"z":"b47e4028.e9a92","wires":[["4a0b0c56.a3a1e4"]]},{"id":"91fc7b41.155df8","type":"set","name":"set vfc-instance-group-function value","xml":"<set>\n<parameter name='db.group-uuids[$group-index].vfc-instance-group-function' value='`$db.mapped-value.attribute-value`' />\n","comments":"","x":2882.333450317383,"y":854.3331108093262,"z":"b47e4028.e9a92","wires":[]},{"id":"8c34c0a7.286db","type":"set","name":"set network-collection-function value","xml":"<set>\n<parameter name='db.group-uuids[$group-index].network-collection-function' value='`$db.mapped-value.attribute-value`' />\n","comments":"","x":2879.333450317383,"y":902.6665077209473,"z":"b47e4028.e9a92","wires":[]},{"id":"cb3116d3.3e0178","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1211.6665954589844,"y":1568.3328857421875,"z":"b47e4028.e9a92","wires":[["ca18b446.544648","c625b42e.798378","24b7267.1df7bda","45843b31.c96d54","f833746b.1da0b8","a78de9bc.9c1a98","9d55b433.493f78","607082a0.d4249c","712bdfb7.74ee2","b6b5f931.eb4598","6c45eb32.9476b4","54ac6f71.5bbed","6ea857c3.2c1b58","e6e58901.9f43c8","885a5381.33f42","7ba342c.2344dbc","dfadd88e.36b558","d6a108ce.e84058","ecfd0fc4.045e","11be98c3.df80d7","34aa0803.4c3f08","65531882.49e7d8","18de97dd.b1aee8","e0a1c55a.c2c798","9f02d7a9.1c3a78","e95311b7.510f6","79bfeb99.430a74"]]},{"id":"11be98c3.df80d7","type":"get-resource","name":"get-resource instance group","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n  resource=\"instance-groups\" \n  key=\"instance-group.instance-group-function = $db.group-uuids[$group-index].vfc-instance-group-function\n    AND instance-group.instance-group-type = 'VNFC'\"\n  pfx='aai.instance-group' local-only='false' >\n\n","comments":"","outputs":1,"x":1512.333164215088,"y":1013.8329200744629,"z":"b47e4028.e9a92","wires":[["2c8f4549.fc1f8a","eb4f7227.341d2"]]},{"id":"eb4f7227.341d2","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1726.5792922973633,"y":1036.9837646484375,"z":"b47e4028.e9a92","wires":[["a9147101.d3e86"]]},{"id":"2c8f4549.fc1f8a","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1735.5079536437988,"y":990.2695093154907,"z":"b47e4028.e9a92","wires":[["c1ac3025.61603"]]},{"id":"9e43dd49.5a752","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n","comments":"","x":421.3333435058594,"y":3041.666540145874,"z":"b47e4028.e9a92","wires":[]},{"id":"b7a3821f.fc675","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":121.66665649414062,"y":2009.666404724121,"z":"b47e4028.e9a92","wires":[["73a704cf.e221cc","9e43dd49.5a752"]]},{"id":"e0ac34b2.d8e248","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\"\n      value=\"`'Parameter value for '\n        + $db.parameters[$parameter-index].attribute-name\n        + ' is '\n        + $db.parameters[$parameter-index].attribute-value\n        + ' but was expected to start with get_input='`\" />\n","comments":"","x":3185.666778564453,"y":662.6663074493408,"z":"b47e4028.e9a92","wires":[]},{"id":"8a2ae114.7b5fc","type":"get-resource","name":"get-resource instance group function","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key=\"select attribute_value from VF_MODULE_MODEL vmm, VF_MODEL vf, ATTRIBUTE_VALUE_PAIR avp\n\twhere vmm.customization_uuid = $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid\n\tand vmm.vf_customization_uuid = vf.customization_uuid\n\tand vf.uuid = avp.resource_uuid\n\tand vmm.vf_customization_uuid = avp.resource_customization_uuid\n\tand avp.attribute_name = $tmp.truncated-value\"\n  pfx='db.mapped-value'>\n\n","comments":"","outputs":1,"x":2876.6666145324707,"y":796.6665725708008,"z":"b47e4028.e9a92","wires":[["324c2535.eee8aa","839877d1.d651b8"]]},{"id":"324c2535.eee8aa","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":3094.000068664551,"y":774.6665668487549,"z":"b47e4028.e9a92","wires":[["3f68af66.76793"]]},{"id":"839877d1.d651b8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":3100.904853820801,"y":816.2857074737549,"z":"b47e4028.e9a92","wires":[["b12f7607.be9608"]]},{"id":"3f68af66.76793","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\"\n      value=\"`'System error retrieving mapped parameter value for '\n        + $db.parameters[$parameter-index].attribute-name`\" />\n","comments":"","x":3251.666534423828,"y":773.3332462310791,"z":"b47e4028.e9a92","wires":[]},{"id":"b12f7607.be9608","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\"\n      value=\"`'Unable to find mapped parameter value for '\n        + $db.parameters[$parameter-index].attribute-name\n        + ' value '\n        + $tmp.truncated-value`\" />\n","comments":"","x":3251.666816711426,"y":814.9999408721924,"z":"b47e4028.e9a92","wires":[]},{"id":"94730a30.6be618","type":"set","name":"set vfc_parent_port_role value","xml":"<set>\n<parameter name='db.group-uuids[$group-index].vfc_parent_port_role' value='`$db.parameters[$parameter-index].attribute-value`' />\n","comments":"","x":2550.0000228881836,"y":591.6666488647461,"z":"b47e4028.e9a92","wires":[]},{"id":"c1ac3025.61603","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\"\n      value=\"`'Unable to find AAI instance-group for instance-group-function '\n        + $db.group-uuids[$group-index].vfc-instance-group-function\n        + ' and instance-group-type VNFC'`\" />\n","comments":"","x":1893.6665306091309,"y":988.8333911895752,"z":"b47e4028.e9a92","wires":[]},{"id":"a9147101.d3e86","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\"\n      value=\"`'System error getting AAI instance-group for instance-group-function '\n        + $db.group-uuids[$group-index].vfc-instance-group-function\n        + ' and instance-group-type VNFC'`\" />\n","comments":"","x":1893.6664657592773,"y":1036.8333797454834,"z":"b47e4028.e9a92","wires":[]},{"id":"18236b4f.7d3b25","type":"for","name":"for each existing vlan-vnfc-instance-group","xml":"<for index='vvig-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group_length`' >\n","comments":"","outputs":1,"x":2256.666519165039,"y":1300.3335075378418,"z":"b47e4028.e9a92","wires":[["3c6ce8f8.909cb8"]]},{"id":"3c6ce8f8.909cb8","type":"switchNode","name":"instance-group-id exists already?","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].instance-group-id\n == $aai.instance-group.instance-group[$aai-ig-index].id`'>\n","comments":"","outputs":1,"x":2582.666519165039,"y":1300.3335075378418,"z":"b47e4028.e9a92","wires":[["19d5c419.1f3fdc"]]},{"id":"ca18b446.544648","type":"switchNode","name":"switch existing vlan-vnfc-instance-group_length","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group_length`'>\n","comments":"","outputs":1,"x":1578.3332824707031,"y":1270.3335180282593,"z":"b47e4028.e9a92","wires":[["de3bc458.faade8","7cda058.8f04dfc","17bb1c1.4cf0fe4"]]},{"id":"de3bc458.faade8","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1838.3332824707031,"y":1234.3335180282593,"z":"b47e4028.e9a92","wires":[["b24476d0.6a1e28"]]},{"id":"b24476d0.6a1e28","type":"set","name":"set vvig-index to 0","xml":"<set>\n<parameter name='vvig-index' value='0' />\n","comments":"","x":2016.9999694824219,"y":1233.3334712982178,"z":"b47e4028.e9a92","wires":[]},{"id":"7cda058.8f04dfc","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":1836.3332824707031,"y":1276.3335180282593,"z":"b47e4028.e9a92","wires":[["e996e2b3.26634"]]},{"id":"e996e2b3.26634","type":"break","name":"break","xml":"<break>\n","comments":"","x":1980.3332824707031,"y":1276.3335180282593,"z":"b47e4028.e9a92","wires":[]},{"id":"17bb1c1.4cf0fe4","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1838.3332824707031,"y":1320.3335180282593,"z":"b47e4028.e9a92","wires":[["bd9d1f00.4179b"]]},{"id":"19d5c419.1f3fdc","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2796.666519165039,"y":1298.3335075378418,"z":"b47e4028.e9a92","wires":[["fad5dc3c.3bbc9"]]},{"id":"fad5dc3c.3bbc9","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\"\n      value=\"`'Instance group id '\n        + $aai.instance-group.instance-group[$aai-ig-index].id\n        + ' already exists in MD-SAL under vlan-vnfc-instance-groups'`\" />\n","comments":"","x":2946.666519165039,"y":1296.3335075378418,"z":"b47e4028.e9a92","wires":[]},{"id":"c625b42e.798378","type":"set","name":"set vlan-vnfc-instance-group data","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].instance-group-id'\n  value='`$aai.instance-group.instance-group[$aai-ig-index].id`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].instance-group-function'\n  value='`$db.group-uuids[$group-index].vfc-instance-group-function`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnf-id'\n  value='`$service-data.vnfs.vnf[$vnf-index].vnf-id`' />\n","comments":"","x":1537.4999694824219,"y":1376.8336296081543,"z":"b47e4028.e9a92","wires":[]},{"id":"24b7267.1df7bda","type":"set","name":"set new vlan-vnfc-instance-group_length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group_length'\n  value='`$vvig-index + 1`' />\n","comments":"","x":1556.8331680297852,"y":1428.1668100357056,"z":"b47e4028.e9a92","wires":[]},{"id":"607082a0.d4249c","type":"set","name":"set vnfc_length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc_length'\n  value='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names_length`' />\n","comments":"","x":1478.0001182556152,"y":1753.0001907348633,"z":"b47e4028.e9a92","wires":[]},{"id":"712bdfb7.74ee2","type":"for","name":"for each vnfc","xml":"<for index='vnfc-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names_length`' >\n","comments":"","outputs":1,"x":1473.0001182556152,"y":1853.999870300293,"z":"b47e4028.e9a92","wires":[["a0d4952d.f2b928"]]},{"id":"f833746b.1da0b8","type":"set","name":"set found-vm-type to false","xml":"<set>\n<parameter name='found-vm-type' value='false' />\n","comments":"","x":1508.6667251586914,"y":1555.3332386016846,"z":"b47e4028.e9a92","wires":[]},{"id":"a78de9bc.9c1a98","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm_length`' >\n","comments":"","outputs":1,"x":1482.6667251586914,"y":1609.3332386016846,"z":"b47e4028.e9a92","wires":[["c521ab26.8c7ae8"]]},{"id":"c521ab26.8c7ae8","type":"switchNode","name":"vm-types match?","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-type\n  == $db.group-uuids[$group-index].vm-type`'>\n","comments":"","outputs":1,"x":1682.6667251586914,"y":1608.3332386016846,"z":"b47e4028.e9a92","wires":[["f3e12d9b.faa59"]]},{"id":"f3e12d9b.faa59","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1850.6667251586914,"y":1607.3332386016846,"z":"b47e4028.e9a92","wires":[["a967e904.3972f8"]]},{"id":"a967e904.3972f8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2006.6667251586914,"y":1607.3332386016846,"z":"b47e4028.e9a92","wires":[["83f5ed69.3b11f","27aa0191.883b9e"]]},{"id":"83f5ed69.3b11f","type":"set","name":"set found-vm-type to true","xml":"<set>\n<parameter name='found-vm-type' value='true' />\n","comments":"","x":2224.6667251586914,"y":1577.3332386016846,"z":"b47e4028.e9a92","wires":[]},{"id":"27aa0191.883b9e","type":"break","name":"break","xml":"<break>\n","comments":"","x":2166.6667251586914,"y":1627.3332386016846,"z":"b47e4028.e9a92","wires":[]},{"id":"9d55b433.493f78","type":"switchNode","name":"switch found-vm-type","xml":"<switch test='`$found-vm-type`'>\n","comments":"","outputs":1,"x":1496.6667251586914,"y":1689.3332386016846,"z":"b47e4028.e9a92","wires":[["1457c945.a28ef7"]]},{"id":"1457c945.a28ef7","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":1680.6667251586914,"y":1689.3332386016846,"z":"b47e4028.e9a92","wires":[["ccbdbb96.9ea6f8"]]},{"id":"ccbdbb96.9ea6f8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1836.6667251586914,"y":1689.3332386016846,"z":"b47e4028.e9a92","wires":[["914147aa.da8c48"]]},{"id":"914147aa.da8c48","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'TOSCA provided vm-type ' +\n      $db.group-uuids[$group-index].vm-type + ' but that was not found in vf-module-assignments.vms'`\" />\n","comments":"","x":2006.3334159851074,"y":1689.3331680297852,"z":"b47e4028.e9a92","wires":[]},{"id":"7ec1f150.8a298","type":"set","name":"set vnfc name","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnfc-name'\n  value='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-name`' />\n","comments":"","x":1825.6668395996094,"y":1798.3332405090332,"z":"b47e4028.e9a92","wires":[]},{"id":"a0d4952d.f2b928","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1643.666648864746,"y":1854.666501045227,"z":"b47e4028.e9a92","wires":[["7ec1f150.8a298","52160f29.32a73","e7172e6c.e2771"]]},{"id":"52160f29.32a73","type":"save","name":"save instance-group relationships","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"instance-group:relationship-list\"\n   key=\"instance-group.id = $tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].instance-group-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"vnfc\" />\n    <parameter name=\"relationship-list.relationship[0].related-link\"\n      value=\"`'/aai/v$/network/vnfcs/vnfc/' +\n        $tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnfc-name`\" />\n","comments":"","outputs":1,"x":1883.6666946411133,"y":1852.6664819717407,"z":"b47e4028.e9a92","wires":[["8fdc613f.8aa0e","4907cdeb.66fbb4"]]},{"id":"8fdc613f.8aa0e","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2103.5000381469727,"y":1823.5382261276245,"z":"b47e4028.e9a92","wires":[["b780e1fd.8ecea"]]},{"id":"4907cdeb.66fbb4","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2112.0715713500977,"y":1876.1573705673218,"z":"b47e4028.e9a92","wires":[["d399b84f.393178"]]},{"id":"b780e1fd.8ecea","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2273.6667709350586,"y":1822.666501045227,"z":"b47e4028.e9a92","wires":[["1c990e06.afc822"]]},{"id":"d399b84f.393178","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2271.6667709350586,"y":1874.666501045227,"z":"b47e4028.e9a92","wires":[["5eba244f.78562c"]]},{"id":"1c990e06.afc822","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"System error creating instance-group relationship to vnfc\" />\n","comments":"","x":2451.6667709350586,"y":1822.666501045227,"z":"b47e4028.e9a92","wires":[]},{"id":"5eba244f.78562c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Not-found error relating instance group '\n      + $tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].instance-group-id\n      + ' to vnfc '\n      + $tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnfc-name`\" />\n","comments":"","x":2449.6667709350586,"y":1872.666501045227,"z":"b47e4028.e9a92","wires":[]},{"id":"e7172e6c.e2771","type":"set","name":"set data-created","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].data-created' value='true' />\n","comments":"","x":1831.333381652832,"y":1915.666498184204,"z":"b47e4028.e9a92","wires":[]},{"id":"45843b31.c96d54","type":"set","name":"set vm-type (tmp)","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vm-type'\n  value='`$db.group-uuids[$group-index].vm-type`' />\n","comments":"","x":1480.6667251586914,"y":1500.3332386016846,"z":"b47e4028.e9a92","wires":[]},{"id":"65531882.49e7d8","type":"for","name":"for each returned instance-group","xml":"<for index='ig-index' start='0' end='`$aai.instance-group.instance-group_length`' >\n","comments":"","outputs":1,"x":1528.3333320617676,"y":1125.8333864212036,"z":"b47e4028.e9a92","wires":[["a178996d.953d88"]]},{"id":"a178996d.953d88","type":"for","name":"for each relationship","xml":"<for index='rel-index' start='0' end='`$aai.instance-group.instance-group[$ig-index].relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":1779.9999732971191,"y":1124.8333854675293,"z":"b47e4028.e9a92","wires":[["63a0562f.346d48"]]},{"id":"63a0562f.346d48","type":"for","name":"for each relationship-data","xml":"<for index='reldata-index' start='0' end='`$aai.instance-group.instance-group[$ig-index].relationship-list.relationship[$rel-index].relationship-data_length`' >\n","comments":"","outputs":1,"x":2006.6666450500488,"y":1124.1667594909668,"z":"b47e4028.e9a92","wires":[["d0cb0ddb.63e38"]]},{"id":"d0cb0ddb.63e38","type":"switchNode","name":"switch relationship-key == service-instance.service-instance-id","xml":"<switch test=\"`$aai.instance-group.instance-group[$ig-index].relationship-list.relationship[$rel-index].relationship-data[$reldata-index].relationship-key\n  == 'service-instance.service-instance-id'`\">\n","comments":"","outputs":1,"x":2365.000232696533,"y":1124.16667842865,"z":"b47e4028.e9a92","wires":[["ad32ca79.0cfde8"]]},{"id":"ad32ca79.0cfde8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2661.666690826416,"y":1124.1667108535767,"z":"b47e4028.e9a92","wires":[["ed36a015.51afe"]]},{"id":"ed36a015.51afe","type":"switchNode","name":"switch relationship-value == this service-instance-id","xml":"<switch test='`$aai.instance-group.instance-group[$ig-index].relationship-list.relationship[$rel-index].relationship-data[$reldata-index].relationship-value\n  == $service-data.service-information.service-instance-id`'>\n","comments":"","outputs":1,"x":2926.666515350342,"y":1124.1666803359985,"z":"b47e4028.e9a92","wires":[["b7529f5b.d8147"]]},{"id":"34aa0803.4c3f08","type":"set","name":"set found-instance-group to false","xml":"<set>\n<parameter name='found-instance-group' value='false' />\n","comments":"","x":1528.3332481384277,"y":1082.4998893737793,"z":"b47e4028.e9a92","wires":[]},{"id":"245c2935.69d8f6","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":3313.3332023620605,"y":1124.16667842865,"z":"b47e4028.e9a92","wires":[["9e921ed3.1e04c","73299009.38929","7d22df6b.481b"]]},{"id":"9e921ed3.1e04c","type":"set","name":"set found-instance-group to true","xml":"<set>\n<parameter name='found-instance-group' value='true' />\n","comments":"","x":3514.9997901916504,"y":1080.8333444595337,"z":"b47e4028.e9a92","wires":[]},{"id":"73299009.38929","type":"set","name":"set aai-ig-index","xml":"<set>\n<parameter name='aai-ig-index' value='`$ig-index`' />\n","comments":"","x":3464.999626159668,"y":1124.166760444641,"z":"b47e4028.e9a92","wires":[]},{"id":"7d22df6b.481b","type":"break","name":"break","xml":"<break>\n","comments":"","x":3436.6666984558105,"y":1167.500054359436,"z":"b47e4028.e9a92","wires":[]},{"id":"18de97dd.b1aee8","type":"switchNode","name":"switch found-instance-group","xml":"<switch test='`$found-instance-group`'>\n","comments":"","outputs":1,"x":1513.3333320617676,"y":1175.833511352539,"z":"b47e4028.e9a92","wires":[["c36d740b.e206d8"]]},{"id":"c36d740b.e206d8","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":1709.9999694824219,"y":1175.8333101272583,"z":"b47e4028.e9a92","wires":[["bf2d537.db427b"]]},{"id":"bf2d537.db427b","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\"\n      value=\"`'Unable to find AAI instance-group for instance-group-function '\n        + $db.group-uuids[$group-index].vfc-instance-group-function\n        + ' and instance-group-type VNFC'`\" />\n","comments":"","x":1859.9998588562012,"y":1174.1666707992554,"z":"b47e4028.e9a92","wires":[]},{"id":"b7529f5b.d8147","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":3186.6664848327637,"y":1124.1666707992554,"z":"b47e4028.e9a92","wires":[["245c2935.69d8f6"]]},{"id":"d8af59a5.37db38","type":"set","name":"set AAI test data","xml":"<set>\n<parameter name='aai.instance-group.instance-group[0].id' value='bgb-inst-group-1' />\n<parameter name='aai-ig-index' value='0' />\n","comments":"","x":1804.999870300293,"y":838.3333292007446,"z":"b47e4028.e9a92","wires":[]},{"id":"83c5513b.06322","type":"switchNode","name":"switch group-index","xml":"<switch test='`$group-index`'>\n","comments":"","outputs":1,"x":1481.6667251586914,"y":909.9999542236328,"z":"b47e4028.e9a92","wires":[["ba3335de.858798","ab04061b.fe7d48","a9f3da68.8836c8"]]},{"id":"ba3335de.858798","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":1644.999942779541,"y":839.9999933242798,"z":"b47e4028.e9a92","wires":[["d8af59a5.37db38"]]},{"id":"ab04061b.fe7d48","type":"outcome","name":"1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":1643.333251953125,"y":896.6666259765625,"z":"b47e4028.e9a92","wires":[["102bec13.078344"]]},{"id":"a9f3da68.8836c8","type":"outcome","name":"2","xml":"<outcome value='2'>\n","comments":"","outputs":1,"x":1644.9998245239258,"y":948.333330154419,"z":"b47e4028.e9a92","wires":[["51a91c65.7b2db4"]]},{"id":"102bec13.078344","type":"set","name":"set AAI test data","xml":"<set>\n<parameter name='aai.instance-group.instance-group[0].id' value='bgb-inst-group-1a' />\n<parameter name='aai-ig-index' value='0' />\n","comments":"","x":1801.6666259765625,"y":893.3333129882812,"z":"b47e4028.e9a92","wires":[]},{"id":"51a91c65.7b2db4","type":"set","name":"set AAI test data","xml":"<set>\n<parameter name='aai.instance-group.instance-group[0].id' value='bgb-inst-group-2' />\n<parameter name='aai-ig-index' value='0' />\n","comments":"","x":1799.9998779296875,"y":943.3333129882812,"z":"b47e4028.e9a92","wires":[]},{"id":"bd9d1f00.4179b","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1999.9998779296875,"y":1319.9999332427979,"z":"b47e4028.e9a92","wires":[["18236b4f.7d3b25","c2d5de12.508d1"]]},{"id":"c2d5de12.508d1","type":"set","name":"set vvig-index to the length","xml":"<set>\n<parameter name='vvig-index' value='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group_length`' />\n","comments":"","x":2208.33309173584,"y":1343.333387374878,"z":"b47e4028.e9a92","wires":[]},{"id":"b6b5f931.eb4598","type":"get-resource","name":"get-resource policy","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key=\"select property_name from VF_MODULE_TO_VFC_MAPPING vmvm,\n    RESOURCE_POLICY_TO_TARGET_NODE_MAPPING rptnm, RESOURCE_POLICY rp\n\twhere vmvm.vf_module_customization_uuid = $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid\n\tAND vmvm.vm_type = $db.group-uuids[$group-index].vm-type\n\tAND vmvm.vfc_customization_uuid = rptnm.target_node_uuid\n\tAND rptnm.policy_uuid = rp.policy_uuid\n\tAND rp.property_type = 'vlan_tag_policy'\n\tAND rp.policy_type = 'ecomp.policies.External'\n\tAND rp.property_source = 'Policy Manager'\"\n  pfx='db.policy[]'>\n\n","comments":"","outputs":1,"x":1490.000099182129,"y":1986.6665840148926,"z":"b47e4028.e9a92","wires":[["1603203c.5f928","edbea92a.2002f8"]]},{"id":"1603203c.5f928","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1663.3332786560059,"y":1963.6665420532227,"z":"b47e4028.e9a92","wires":[["f76e3c43.205b7"]]},{"id":"edbea92a.2002f8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1666.5714225769043,"y":2012.2857093811035,"z":"b47e4028.e9a92","wires":[["26246db4.523892"]]},{"id":"f76e3c43.205b7","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Failure retrieving policy for vm-type ' + $db.group-uuids[$group-index].vm-type`\" />\n","comments":"","x":1811.880916595459,"y":1963.6191730499268,"z":"b47e4028.e9a92","wires":[]},{"id":"26246db4.523892","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find policy for vm-type ' + $db.group-uuids[$group-index].vm-type`\" />\n","comments":"","x":1815.6666679382324,"y":2012.6667766571045,"z":"b47e4028.e9a92","wires":[]},{"id":"6c45eb32.9476b4","type":"set","name":"set input to get-data-from-policy","xml":"<set>\n<parameter name='get-data-from-policy-input.policy-instance-name' value='`$db.policy[0].property-name`' />\n","comments":"","x":1519.9998931884766,"y":2338.333595275879,"z":"b47e4028.e9a92","wires":[]},{"id":"54ac6f71.5bbed","type":"call","name":"call GENERIC-RESOURCE-API:get-data-from-policy","xml":"<call module='GENERIC-RESOURCE-API' rpc='get-data-from-policy' mode='sync' >\n","comments":"","outputs":1,"x":1586.6665573120117,"y":2391.6666860580444,"z":"b47e4028.e9a92","wires":[["7525d360.0f7b9c"]]},{"id":"7525d360.0f7b9c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1863.3333206176758,"y":2390.0002641677856,"z":"b47e4028.e9a92","wires":[["85f5011.c3fb2"]]},{"id":"85f5011.c3fb2","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n","comments":"","x":2024.9998245239258,"y":2388.3332719802856,"z":"b47e4028.e9a92","wires":[]},{"id":"6ea857c3.2c1b58","type":"set","name":"set vnic data for first vnfc","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[0].vnic-groups.vnic-group[0].vnic-interface-role'\n  value='`$db.group-uuids[$group-index].vfc_parent_port_role`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[0].vnic-groups.vnic-group[0].vlan-assignment-policy-name'\n  value='`$db.policy[0].property-name`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[0].vnic-groups.vnic-group[0].network-instance-group-function'\n  value='`$db.group-uuids[$group-index].network-collection-function`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[0].vnic-groups.vnic-group_length'\n  value='1' />\n  ","comments":"","x":1503.333236694336,"y":2056.6669158935547,"z":"b47e4028.e9a92","wires":[]},{"id":"e6e58901.9f43c8","type":"get-resource","name":"get-resource VFC_TO_NETWORK_ROLE_MAPPING","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key=\"select vnrm.* from VF_MODULE_TO_VFC_MAPPING vmvm, VFC_TO_NETWORK_ROLE_MAPPING vnrm\n\twhere vmvm.vf_module_customization_uuid = $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid\n\tAND vmvm.vm_type = $db.group-uuids[$group-index].vm-type\n\tAND vmvm.vfc_customization_uuid = vnrm.vfc_customization_uuid\n\tAND vnrm.network_role_tag = $db.group-uuids[$group-index].vfc_parent_port_role\"\n  pfx='db.vfc-to-network-role[]'>\n\n","comments":"","outputs":1,"x":1593.333122253418,"y":2116.6667556762695,"z":"b47e4028.e9a92","wires":[["7547a3f3.502e1c","5c706b9f.8610d4"]]},{"id":"7547a3f3.502e1c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1865.999526977539,"y":2091.9999265670776,"z":"b47e4028.e9a92","wires":[["46ee5ac5.db6584"]]},{"id":"5c706b9f.8610d4","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1873.2376708984375,"y":2140.6190938949585,"z":"b47e4028.e9a92","wires":[["d944efd1.49625"]]},{"id":"46ee5ac5.db6584","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Failure reading VFC_TO_NETWORK_ROLE_MAPPING for parent role ' + $db.group-uuids[$group-index].vfc_parent_port_role`\" />\n","comments":"","x":2014.5471687316895,"y":2091.952480316162,"z":"b47e4028.e9a92","wires":[]},{"id":"d944efd1.49625","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find rows in VFC_TO_NETWORK_ROLE_MAPPING for parent role ' + $db.group-uuids[$group-index].vfc_parent_port_role`\" />\n","comments":"","x":2022.3329162597656,"y":2141.0001611709595,"z":"b47e4028.e9a92","wires":[]},{"id":"885a5381.33f42","type":"for","name":"for each row returned","xml":"<for index='vnic-index' start='0' end='`$db.vfc-to-network-role_length`' >\n","comments":"","outputs":1,"x":1491.6665344238281,"y":2235.000340461731,"z":"b47e4028.e9a92","wires":[["ef0d6d68.2fa88"]]},{"id":"b0514055.d6444","type":"comment","name":"Create a vnic for every row returned","info":"","comments":"","x":1548.333366394043,"y":2193.3335905075073,"z":"b47e4028.e9a92","wires":[]},{"id":"f0a12477.186958","type":"set","name":"set vnic-port-id","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[0].vnic-groups.vnic-group[0].vlan-vnics.vlan-vnic[$vnic-index].vnic-port-id'\n  value='`$vnic-index`' />\n","comments":"","x":1819.6666717529297,"y":2233.333511352539,"z":"b47e4028.e9a92","wires":[]},{"id":"ef0d6d68.2fa88","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1664.9998817443848,"y":2233.3335132598877,"z":"b47e4028.e9a92","wires":[["f0a12477.186958"]]},{"id":"7ba342c.2344dbc","type":"set","name":"set vlan-vnic_length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[0].vnic-groups.vnic-group[0].vlan-vnics.vlan-vnic_length'\n  value='`$db.vfc-to-network-role_length`' />\n","comments":"","x":1484.9998664855957,"y":2285.000178337097,"z":"b47e4028.e9a92","wires":[]},{"id":"dfadd88e.36b558","type":"switchNode","name":"switch precreate-sub-intf-num > 0?","xml":"<switch test='`$get-data-from-policy-output.precreate-sub-intf-num &gt; 0`'>\n","comments":"","outputs":1,"x":1526.6667251586914,"y":2521.666763305664,"z":"b47e4028.e9a92","wires":[["999ca676.ed90a8"]]},{"id":"999ca676.ed90a8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1743.3334846496582,"y":2521.666684150696,"z":"b47e4028.e9a92","wires":[["17837ed3.10fac1"]]},{"id":"17837ed3.10fac1","type":"call","name":"call GENERIC-RESOURCE-API:assign-vlan-tags","xml":"<call module='GENERIC-RESOURCE-API' rpc='assign-vlan-tags' mode='sync' >\n","comments":"","outputs":1,"x":2021.6666641235352,"y":2521.000081062317,"z":"b47e4028.e9a92","wires":[["2d81dffe.b92d1"]]},{"id":"1248d138.5ec85f","type":"set","name":"set test data","xml":"<set>\n<parameter name='get-data-from-policy-output.precreate-sub-intf-num' value='5' />\n","comments":"","x":1463.333351135254,"y":2458.3334312438965,"z":"b47e4028.e9a92","wires":[]},{"id":"2d81dffe.b92d1","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2285,"y":2520,"z":"b47e4028.e9a92","wires":[["99766325.18459"]]},{"id":"99766325.18459","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n","comments":"","x":2446.66650390625,"y":2518.3330078125,"z":"b47e4028.e9a92","wires":[]},{"id":"c6555b10.d36328","type":"comment","name":"Now copy this vnfc to all subsequent vnfcs","info":"","comments":"","x":1506.6665954589844,"y":2571.666524887085,"z":"b47e4028.e9a92","wires":[]},{"id":"ecfd0fc4.045e","type":"for","name":"for each subsequent vnfc","xml":"<for index='vnfc-index' start='1' end='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc_length`' >\n","comments":"","outputs":1,"x":1491.6665573120117,"y":2619.9999408721924,"z":"b47e4028.e9a92","wires":[["ccac98a7.ef0888"]]},{"id":"ccac98a7.ef0888","type":"set","name":"copy vnfc","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnics-groups.'\n  value='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[0].vnics-groups.`' />\n","comments":"","x":1683.3332786560059,"y":2620.0000228881836,"z":"b47e4028.e9a92","wires":[]},{"id":"108e5290.061f0d","type":"comment","name":"Copy data to vnfc-networks","info":"","comments":"","x":1543.21439743042,"y":3638.9288997650146,"z":"b47e4028.e9a92","wires":[]},{"id":"e0a1c55a.c2c798","type":"for","name":"for each vnfc","xml":"<for index='vnfc-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc_length`' >\n","comments":"","outputs":1,"x":1470.8334515889483,"y":3684.1669365564976,"z":"b47e4028.e9a92","wires":[["95cb8961.7b5e18"]]},{"id":"95cb8961.7b5e18","type":"for","name":"for each vm vnfc","xml":"<for index='vm-vnfc-index' start='0'\n  end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names_length`' >\n","comments":"","outputs":1,"x":1649.642910003662,"y":3682.7860412597656,"z":"b47e4028.e9a92","wires":[["b445348d.04f928"]]},{"id":"b445348d.04f928","type":"switchNode","name":"switch vnfc names match?","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnfc-name\n  == $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vm-vnfc-index].vnfc-name`'>\n","comments":"","outputs":1,"x":1872.5002746582031,"y":3682.356981277466,"z":"b47e4028.e9a92","wires":[["c384ee4b.77391"]]},{"id":"c384ee4b.77391","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2061.0715827941895,"y":3681.3573999404907,"z":"b47e4028.e9a92","wires":[["6fd01e43.234ec"]]},{"id":"6fd01e43.234ec","type":"for","name":"for each vnic-group","xml":"<for index='vnic-group-index' start='0'\n  end='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group_length`' >\n","comments":"","outputs":1,"x":2226.7860069274902,"y":3680.3573999404907,"z":"b47e4028.e9a92","wires":[["1b08f760.46cec9"]]},{"id":"1b08f760.46cec9","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1606.5477485656738,"y":3872.7385063171387,"z":"b47e4028.e9a92","wires":[["e335d196.7a723","9725b99d.4febf8","63e5e26e.2e86cc"]]},{"id":"e335d196.7a723","type":"set","name":"set vnfc-network-index to -1","xml":"<set>\n<parameter name='vnfc-network-index' value='-1' />\n","comments":"","x":1818.2143211364746,"y":3784.6430082321167,"z":"b47e4028.e9a92","wires":[]},{"id":"9725b99d.4febf8","type":"for","name":"for each vnfc-network","xml":"<for index='vn-index' start='0'\n  end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-networks.vnfc-network-data_length`' >\n","comments":"","outputs":1,"x":1798.2143898010254,"y":3833.2144708633423,"z":"b47e4028.e9a92","wires":[["eb454f6f.0cb9c"]]},{"id":"eb454f6f.0cb9c","type":"switchNode","name":"switch vnfc-network-role == vnic-interface-role","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vnic-interface-role\n  == $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-networks.vnfc-network-data[$vn-index].vnfc-network-role`'>\n","comments":"","outputs":1,"x":2096.7857627868652,"y":3831.7857942581177,"z":"b47e4028.e9a92","wires":[["d97fb514.ac75c8"]]},{"id":"d97fb514.ac75c8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2345.3572216033936,"y":3830.3572578430176,"z":"b47e4028.e9a92","wires":[["70b317a4.7cc508"]]},{"id":"c59c96b4.69bf98","type":"set","name":"set vnfc-network-index","xml":"<set>\n<parameter name='vnfc-network-index' value='`$vn-index`' />\n","comments":"","x":2647.0239906311035,"y":3804.6430463790894,"z":"b47e4028.e9a92","wires":[]},{"id":"e0720be9.ad0128","type":"break","name":"break","xml":"<break>\n","comments":"","x":2597.0239219665527,"y":3850.3572969436646,"z":"b47e4028.e9a92","wires":[]},{"id":"63e5e26e.2e86cc","type":"switchNode","name":"switch vnfc-network-index","xml":"<switch test='`$vnfc-network-index`'>\n","comments":"","outputs":1,"x":1810.3573265075684,"y":3983.9286966323853,"z":"b47e4028.e9a92","wires":[["9361dfdd.29984","13d52642.fda30a"]]},{"id":"9361dfdd.29984","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":1996.7858848571777,"y":3903.2146253585815,"z":"b47e4028.e9a92","wires":[["fbb0dbfe.f85b28"]]},{"id":"13d52642.fda30a","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1998.4526748657227,"y":4075.2144804000854,"z":"b47e4028.e9a92","wires":[["638f4c3e.143404"]]},{"id":"638f4c3e.143404","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2138.2141494750977,"y":4075.595446586609,"z":"b47e4028.e9a92","wires":[["5c460ff5.5b0df","129e4121.2694ff"]]},{"id":"5c460ff5.5b0df","type":"set","name":"set vnfc-type to the vm-type","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-networks.vnfc-network-data[$vn-index].vnfc-network-role.vnfc-type'\n  value='`$db.group-uuids[$group-index].vm-type`' />\n","comments":"","x":2335.8333015441895,"y":3977.7384281158447,"z":"b47e4028.e9a92","wires":[]},{"id":"fbb0dbfe.f85b28","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value=\"`'Cannot find vnfc-network for network role '\n  + $tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vnic-interface-role`\" />\n","comments":"","x":2143.9287757873535,"y":3903.2144689559937,"z":"b47e4028.e9a92","wires":[]},{"id":"67480cdb.2760a4","type":"set","name":"set vnfc-port-index to -1","xml":"<set>\n<parameter name='vnfc-port-index' value='-1' />\n","comments":"","x":2654.166561126709,"y":4030.833158493042,"z":"b47e4028.e9a92","wires":[]},{"id":"bcc3aff.112a55","type":"for","name":"for each vnfc-port","xml":"<for silentFailure='true' index='v-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-networks.vnfc-network-data[$vn-index].vnfc-ports.vnfc-port_length`' >\n","comments":"","outputs":1,"x":2635.833393096924,"y":4079.16690158844,"z":"b47e4028.e9a92","wires":[["828492b6.a1bdd"]]},{"id":"129e4121.2694ff","type":"for","name":"for each vlan-vnic","xml":"<for index='vnic-index' start='0'\n  end='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic_length`' >\n","comments":"","outputs":1,"x":2300.8332328796387,"y":4187.500525474548,"z":"b47e4028.e9a92","wires":[["d8e6d7a2.2a1bf8"]]},{"id":"d8e6d7a2.2a1bf8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2467.499973297119,"y":4185.833487510681,"z":"b47e4028.e9a92","wires":[["67480cdb.2760a4","bcc3aff.112a55","5d6d857d.27928c","fa62ecdb.69843"]]},{"id":"828492b6.a1bdd","type":"switchNode","name":"switch port ids equal?","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-port-id\n  == $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-networks.vnfc-network-data[$vn-index].vnfc-ports.vnfc-port[$v-index].vnfc-port-id`'>\n","comments":"","outputs":1,"x":2852.5003089904785,"y":4079.16690158844,"z":"b47e4028.e9a92","wires":[["bcfa1beb.160c28"]]},{"id":"bcfa1beb.160c28","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":3029.166904449463,"y":4077.500234603882,"z":"b47e4028.e9a92","wires":[["f0a0227e.37f3e"]]},{"id":"8ae99aa8.1920a8","type":"set","name":"set vnfc-port-index","xml":"<set>\n<parameter name='vnfc-port-index' value='`$v-index`' />\n","comments":"","x":3327.499683380127,"y":4052.5002336502075,"z":"b47e4028.e9a92","wires":[]},{"id":"a67eee6e.a4887","type":"break","name":"break","xml":"<break>\n","comments":"","x":3290.833179473877,"y":4097.500072479248,"z":"b47e4028.e9a92","wires":[]},{"id":"5d6d857d.27928c","type":"switchNode","name":"switch vnfc-port-index","xml":"<switch test='`$vnfc-port-index`'>\n","comments":"","outputs":1,"x":2649.1661643981934,"y":4289.166746139526,"z":"b47e4028.e9a92","wires":[["36252103.1f8b6e","ad386d69.33c3"]]},{"id":"36252103.1f8b6e","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":2844.166410446167,"y":4240.833414077759,"z":"b47e4028.e9a92","wires":[["bde768af.7ac888"]]},{"id":"ad386d69.33c3","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2840.8334007263184,"y":4340.833659172058,"z":"b47e4028.e9a92","wires":[[]]},{"id":"bde768af.7ac888","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2982.4998302459717,"y":4239.167073249817,"z":"b47e4028.e9a92","wires":[["7c467817.823568","402ca21d.f33c0c","3c3825c4.1caaca"]]},{"id":"2d5840bf.165d2","type":"set","name":"set vnfc-port-index","xml":"<set>\n<parameter name='vnfc-port-index' value='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-networks.vnfc-network-data[$vn-index].vnfc-ports.vnfc-port_length`' />\n","comments":"","x":3529.1665229797363,"y":4200.833733558655,"z":"b47e4028.e9a92","wires":[]},{"id":"7c467817.823568","type":"set","name":"set vnfc-port-id and common-sub-interface-role","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-networks.vnfc-network-data[$vn-index].vnfc-ports.vnfc-port[$vnfc-port-index].vnfc-port-id'\n  value='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-port-id`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-networks.vnfc-network-data[$vn-index].vnfc-ports.vnfc-port[$vnfc-port-index].common-sub-interface-role'\n  value='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vnic-interface-role`' />\n","comments":"","x":3242.499746322632,"y":4240.834229469299,"z":"b47e4028.e9a92","wires":[]},{"id":"402ca21d.f33c0c","type":"set","name":"increment vnfc-port_length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-networks.vnfc-network-data[$vn-index].vnfc-ports.vnfc-port_length'\n  value='`$vnfc-port-index + 1`' />\n","comments":"","x":3179.1665019989014,"y":4292.500491142273,"z":"b47e4028.e9a92","wires":[]},{"id":"70b317a4.7cc508","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2469.1666221618652,"y":3829.1667737960815,"z":"b47e4028.e9a92","wires":[["c59c96b4.69bf98","e0720be9.ad0128"]]},{"id":"f0a0227e.37f3e","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":3160.8333702087402,"y":4077.5000257492065,"z":"b47e4028.e9a92","wires":[["8ae99aa8.1920a8","a67eee6e.a4887"]]},{"id":"3c3825c4.1caaca","type":"switchNode","name":"switch vnfc-port_length","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-networks.vnfc-network-data[$vn-index].vnfc-ports.vnfc-port_length`'>\n","comments":"","outputs":1,"x":3169.1668281555176,"y":4179.166741371155,"z":"b47e4028.e9a92","wires":[["b6dec4a6.afe198","a23af61e.5263b8"]]},{"id":"b6dec4a6.afe198","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":3354.1665115356445,"y":4152.499912261963,"z":"b47e4028.e9a92","wires":[["eadd9aab.260b18"]]},{"id":"a23af61e.5263b8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":3352.500087738037,"y":4200.833571434021,"z":"b47e4028.e9a92","wires":[["2d5840bf.165d2"]]},{"id":"eadd9aab.260b18","type":"set","name":"set vnfc-port-index","xml":"<set>\n<parameter name='vnfc-port-index' value='0' />\n","comments":"","x":3529.1666221618652,"y":4150.8335218429565,"z":"b47e4028.e9a92","wires":[]},{"id":"fa62ecdb.69843","type":"set","name":"copy vnic-sub-interfaces","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-networks.vnfc-network-data[$vn-index].vnfc-ports.vnfc-port[$vnfc-port-index].vnic-sub-interfaces.'\n  value='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.`' />\n","comments":"","x":2649.166805267334,"y":4387.499920845032,"z":"b47e4028.e9a92","wires":[]},{"id":"9f02d7a9.1c3a78","type":"for","name":"for each vnfc","xml":"<for index='vnfc-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc_length`' >\n","comments":"","outputs":1,"x":1448.5711936950684,"y":2939.7616481781006,"z":"b47e4028.e9a92","wires":[["fa79f908.4b46b8"]]},{"id":"fa79f908.4b46b8","type":"for","name":"for each vnic-group","xml":"<for index='vnic-group-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group_length`' >\n","comments":"","outputs":1,"x":1635.2378273010254,"y":2939.761568069458,"z":"b47e4028.e9a92","wires":[["2b59342c.313fcc"]]},{"id":"2b59342c.313fcc","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1831.9046325683594,"y":2938.094711303711,"z":"b47e4028.e9a92","wires":[["601857ae.7f6ea8","db73a3d1.05c4","9796972d.9f2a48"]]},{"id":"601857ae.7f6ea8","type":"set","name":"set variables for EIPAM calls","xml":"<set>\n<parameter name='tmp.vt-ip.network-instance-group-function'\n  value='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].network-instance-group-function`' />\n<parameter name='tmp.vt-ip.nf-role'\n  value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-role`' />\n<parameter name='tmp.vt-ip.vm-type'\n  value='`$db.group-uuids[$group-index].vm-type`' />\n<parameter name='tmp.vt-ip.vnfc-name'\n  value='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnfc-name`' />\n<parameter name='tmp.vt-ip.type'\n  value='FIXED' />\n<parameter name='tmp.vt-ip.vf-module-id'\n  value='`$vf-module-topology-operation-input.vf-module-information.vf-module-id`' />\n  ","comments":"","x":2065.475830078125,"y":2972.6189155578613,"z":"b47e4028.e9a92","wires":[]},{"id":"db73a3d1.05c4","type":"for","name":"for each network-instance-group","xml":"<for index='nig-index' start='0' end='`$service-data.network-instance-groups.network-instance-group_length`' >\n","comments":"","outputs":1,"x":2078.333251953125,"y":3014.999707221985,"z":"b47e4028.e9a92","wires":[["964b5676.ef5388"]]},{"id":"964b5676.ef5388","type":"switchNode","name":"network-instance-group-ids match?","xml":"<switch test='`$tmp.vt-ip.network-instance-group-id\n  == $service-data.network-instance-groups.network-instance-group[$nig-index].network-instance-group-id`'>\n","comments":"","outputs":1,"x":2376.6664276123047,"y":3013.33309173584,"z":"b47e4028.e9a92","wires":[["98d456a5.1cf438"]]},{"id":"98d456a5.1cf438","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2598.3331985473633,"y":3011.999870300293,"z":"b47e4028.e9a92","wires":[["e67407dc.796088"]]},{"id":"c7af04d.64239f8","type":"for","name":"for each subnet","xml":"<for silentFailure='true' index='subnet-index' start='0'\n  end='`$service-data.network-instance-groups.network-instance-group[$nig-index].subnets_length`' >\n","comments":"","outputs":1,"x":3292.2620964050293,"y":2773.0953102111816,"z":"b47e4028.e9a92","wires":[["d40215e.53e0fe8"]]},{"id":"d40215e.53e0fe8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3473.0950241088867,"y":2771.4285736083984,"z":"b47e4028.e9a92","wires":[["5c73cd33.21e734","a6fbc849.812c58","6f7a8f0a.2c389","c49bbf7a.28159","cc9945b9.70db88","57431c62.4b6574"]]},{"id":"5c73cd33.21e734","type":"set","name":"set ip-version, network-instance-group-id for EIPAM call","xml":"<set>\n<parameter name='tmp.vt-ip.ip-version'\n  value='`$service-data.network-instance-groups.network-instance-group[$nig-index].subnets[$subnet-index].ip-version`' />\n<parameter name='tmp.vt-ip.network-instance-group-id'\n  value='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].network-instance-group-id`' />\n<parameter name='tmp.vt-ip.sequence-number'\n  value='`$seq-no`' />\n","comments":"","x":3787.143035888672,"y":2650.9521379470825,"z":"b47e4028.e9a92","wires":[]},{"id":"a6fbc849.812c58","type":"call","name":"call GENERIC-RESOURCE-API:vf-module-topology-vlan-tagging-ip-addresses","xml":"<call module='GENERIC-RESOURCE-API' rpc='vf-module-topology-vlan-tagging-ip-addresses' mode='sync' >\n","comments":"","outputs":1,"x":3856.4284057617188,"y":2746.428496360779,"z":"b47e4028.e9a92","wires":[["9aef8761.f3f058"]]},{"id":"9aef8761.f3f058","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":4209.76176071167,"y":2744.761830329895,"z":"b47e4028.e9a92","wires":[["d28dd03b.0e47a"]]},{"id":"d28dd03b.0e47a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n","comments":"","x":4358.095184326172,"y":2743.0949697494507,"z":"b47e4028.e9a92","wires":[]},{"id":"e95311b7.510f6","type":"set","name":"set counter to 0","xml":"<set>\n<parameter name='counter' value='0' />\n","comments":"","x":1453.5714683532715,"y":2828.094596862793,"z":"b47e4028.e9a92","wires":[]},{"id":"6f7a8f0a.2c389","type":"execute","name":"printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value=\"`'/var/tmp/bgb-eipam.log' + $counter`\" />\n","comments":"","outputs":1,"x":3648.095115661621,"y":2954.7620677948,"z":"b47e4028.e9a92","wires":[[]]},{"id":"c49bbf7a.28159","type":"set","name":"increment counter","xml":"<set>\n<parameter name='counter' value='`$counter + 1`' />\n","comments":"","x":3671.428565979004,"y":2696.4284133911133,"z":"b47e4028.e9a92","wires":[]},{"id":"ce216cc2.c9b7e","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Test EIPAM call return\" />\n","comments":"","x":1444.9999389648438,"y":3096.666298866272,"z":"b47e4028.e9a92","wires":[]},{"id":"cc9945b9.70db88","type":"switchNode","name":"switch eipam-ip-block.plans_length","xml":"<switch test='`$eipam-ip-block.plans_length`'>\n","comments":"","outputs":1,"x":3720.475975036621,"y":2855.7143869400024,"z":"b47e4028.e9a92","wires":[["144603b9.0faebc","c042b2da.b4f24","c1e362f7.092ec"]]},{"id":"144603b9.0faebc","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":3935.9525718688965,"y":2797.3810873031616,"z":"b47e4028.e9a92","wires":[["aada1e9.b9463e"]]},{"id":"c1e362f7.092ec","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":3932.618869781494,"y":2928.571858882904,"z":"b47e4028.e9a92","wires":[["6bc96031.08dd9"]]},{"id":"c042b2da.b4f24","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":3935.952537536621,"y":2837.3810510635376,"z":"b47e4028.e9a92","wires":[["aada1e9.b9463e"]]},{"id":"aada1e9.b9463e","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":4058.809467315674,"y":2813.0954084396362,"z":"b47e4028.e9a92","wires":[[]]},{"id":"65594ccf.6be394","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":4467.142917633057,"y":2926.190381526947,"z":"b47e4028.e9a92","wires":[["4ce61717.c6e888","a66fd796.f9a498","12cb7fe5.883c3"]]},{"id":"a66fd796.f9a498","type":"set","name":"set fixed ip addresses","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item[$tmp.index].network-ips.network-ip[0]'\n  value='`$eipam-ip-block.plans[0].requests[0].ip-prefix`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item[$tmp.index].network-ips.network-ip_length'\n  value='1' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item[$tmp.index].ip-version'\n  value='`$tmp.vt-ip.ip-version`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item[$tmp.index].ip-count'\n  value='1' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item[$tmp.index].use-dhcp'\n  value='N' />\n","comments":"","x":4629.047386169434,"y":2941.666540145874,"z":"b47e4028.e9a92","wires":[]},{"id":"6bc96031.08dd9","type":"for","name":"for each vlan-vnic","xml":"<for index='vnic-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic_length`' >\n","comments":"","outputs":1,"x":4087.1428146362305,"y":2927.6190943717957,"z":"b47e4028.e9a92","wires":[["41cd84ee.e4081c"]]},{"id":"41cd84ee.e4081c","type":"for","name":"for each sub-interface","xml":"<for index='sub-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data_length`' >\n","comments":"","outputs":1,"x":4292.857174464634,"y":2926.1906106812617,"z":"b47e4028.e9a92","wires":[["65594ccf.6be394"]]},{"id":"4ce61717.c6e888","type":"switchNode","name":"switch network-information-item_length","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item_length`'>\n","comments":"","outputs":1,"x":4684.523948669434,"y":2853.09517288208,"z":"b47e4028.e9a92","wires":[["629d81c4.bd461","dd6ac299.b1ac7","59cf29ca.51f9f8"]]},{"id":"dd6ac299.b1ac7","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":4911.666732788086,"y":2808.809473991394,"z":"b47e4028.e9a92","wires":[["11c0f9f7.5eaf06"]]},{"id":"59cf29ca.51f9f8","type":"other","name":"1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":4908.571235656738,"y":2891.190526008606,"z":"b47e4028.e9a92","wires":[["19693af0.32cf35"]]},{"id":"629d81c4.bd461","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":4911.666698455811,"y":2848.80943775177,"z":"b47e4028.e9a92","wires":[["11c0f9f7.5eaf06"]]},{"id":"11c0f9f7.5eaf06","type":"set","name":"set network-information-item_length to 1","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item_length'\n  value='1' />\n<parameter name='tmp.index' value='0' />\n","comments":"","x":5161.666656494141,"y":2828.8095273971558,"z":"b47e4028.e9a92","wires":[]},{"id":"19693af0.32cf35","type":"set","name":"set network-information-item_length to 2","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item_length'\n  value='2' />\n<parameter name='tmp.index' value='1' />\n","comments":"","x":5160.238021850586,"y":2890.238184928894,"z":"b47e4028.e9a92","wires":[]},{"id":"e67407dc.796088","type":"switchNode","name":"switch get-data-from-policy-output.ip-assignment","xml":"<switch test='`$get-data-from-policy-output.ip-assignment`'>\n","comments":"","outputs":1,"x":2863.333450317383,"y":3011.6663856506348,"z":"b47e4028.e9a92","wires":[["5993e0d7.b751d","cd7b6ee6.2b53f","dd6e8db9.1eadf"]]},{"id":"cd7b6ee6.2b53f","type":"outcome","name":"unique","xml":"<outcome value='unique'>\n","comments":"","outputs":1,"x":3129.762119293213,"y":3157.7377042770386,"z":"b47e4028.e9a92","wires":[["d231887c.3355f8"]]},{"id":"5993e0d7.b751d","type":"outcome","name":"shared","xml":"<outcome value='shared'>\n","comments":"","outputs":1,"x":3136.6665592193604,"y":2774.166717529297,"z":"b47e4028.e9a92","wires":[["c7af04d.64239f8"]]},{"id":"d231887c.3355f8","type":"for","name":"for each subnet","xml":"<for silentFailure='true' index='subnet-index' start='0'\n  end='`$service-data.network-instance-groups.network-instance-group[$nig-index].subnets_length`' >\n","comments":"","outputs":1,"x":3286.4285011291504,"y":3156.9044942855835,"z":"b47e4028.e9a92","wires":[["1c48049f.44e89b"]]},{"id":"436e4d1f.7bdb84","type":"set","name":"set test EIPAM response","xml":"<set>\n<parameter name='eipam-ip-block.plans_length' value='2' />\n<parameter name='eipam-ip-block.plans[0].plan-name' value='plan-1' />\n<parameter name='eipam-ip-block.plans[0].requests_length' value='6' />\n<parameter name='eipam-ip-block.plans[0].requests[0].client-key'\n  value='vm-type-1|zmtn6nf-code-16code-1001|network-role-1|subnet-role-1|FIXED|4|1' />\n<parameter name='eipam-ip-block.plans[0].requests[0].ip-type' value='FIXED' />\n<parameter name='eipam-ip-block.plans[0].requests[0].ip-prefix' value='34.52.87.50' />\n<parameter name='eipam-ip-block.plans[0].requests[0].ip-version' value='4' />\n","comments":"","x":3711.6663246154785,"y":2798.3331184387207,"z":"b47e4028.e9a92","wires":[]},{"id":"aaf6e47a.ec3908","type":"set","name":"set test data ","xml":"<set>\n<parameter name='get-data-from-policy-output.ip-assignment' value='unique' />\n","comments":"","x":2012.3808670043945,"y":2882.1426334381104,"z":"b47e4028.e9a92","wires":[]},{"id":"12cb7fe5.883c3","type":"switchNode","name":"switch ip-version","xml":"<switch test='`$tmp.vt-ip.ip-version`'>\n","comments":"","outputs":1,"x":4611.666687011719,"y":3008.3332891464233,"z":"b47e4028.e9a92","wires":[["e6ba0b08.c385f8","2796f2bc.c1e76e"]]},{"id":"e6ba0b08.c385f8","type":"other","name":"ipv4","xml":"<outcome value='ipv4'>\n","comments":"","outputs":1,"x":4775.000026702881,"y":2986.6665410995483,"z":"b47e4028.e9a92","wires":[["2595e5de.0f26ea"]]},{"id":"2796f2bc.c1e76e","type":"other","name":"ipv6","xml":"<outcome value='ipv6'>\n","comments":"","outputs":1,"x":4775.000026702881,"y":3029.9997959136963,"z":"b47e4028.e9a92","wires":[["d99e17bd.f711b8"]]},{"id":"2595e5de.0f26ea","type":"set","name":"set vlan-common ipv4 address","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-common-ip-addresses.ip-addresses.ipv4-address'\n  value='`$eipam-ip-block.plans[0].requests[0].ip-prefix`' />\n","comments":"","x":4979.999702453613,"y":2985.0000381469727,"z":"b47e4028.e9a92","wires":[]},{"id":"d99e17bd.f711b8","type":"set","name":"set vlan-common ipv6 address","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-common-ip-addresses.ip-addresses.ipv6-address'\n  value='`$eipam-ip-block.plans[0].requests[0].ip-prefix`' />\n","comments":"","x":4978.3330078125,"y":3029.66650390625,"z":"b47e4028.e9a92","wires":[]},{"id":"1c48049f.44e89b","type":"for","name":"for each vlan-vnic","xml":"<for index='vnic-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic_length`' >\n","comments":"","outputs":1,"x":3474.7617835998535,"y":3156.9043741226196,"z":"b47e4028.e9a92","wires":[["6b888a10.2af214","e2eb46b9.cd0958"]]},{"id":"6b888a10.2af214","type":"set","name":"set ip-version for EIPAM call","xml":"<set>\n<parameter name='tmp.vt-ip.ip-version'\n  value='`$service-data.network-instance-groups.network-instance-group[$nig-index].subnets[$subnet-index].ip-version`' />\n  ","comments":"","x":3709.999755859375,"y":3104.999755859375,"z":"b47e4028.e9a92","wires":[]},{"id":"e593e01e.a0d5d","type":"set","name":"set network-id for EIPAM call","xml":"<set>\n<parameter name='tmp.vt-ip.network-id'\n  value='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-id`' />\n<parameter name='tmp.vt-ip.sequence-number'\n  value='`$seq-no`' />\n  ","comments":"","x":4103.33309173584,"y":3105.0000438690186,"z":"b47e4028.e9a92","wires":[]},{"id":"e2eb46b9.cd0958","type":"for","name":"for each sub-interface","xml":"<for index='sub-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data_length`' >\n","comments":"","outputs":1,"x":3691.190330505371,"y":3218.5712699890137,"z":"b47e4028.e9a92","wires":[["f5b5fc18.adec9"]]},{"id":"f5b5fc18.adec9","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3887.857078552246,"y":3217.5712699890137,"z":"b47e4028.e9a92","wires":[["e593e01e.a0d5d","9169ff30.c059b","f82c32b8.54697","4a868e39.b7b62","b558adee.b288c"]]},{"id":"9169ff30.c059b","type":"set","name":"increment counter","xml":"<set>\n<parameter name='counter' value='`$counter + 1`' />\n","comments":"","x":4069.999755859375,"y":3151.66650390625,"z":"b47e4028.e9a92","wires":[]},{"id":"f82c32b8.54697","type":"call","name":"call GENERIC-RESOURCE-API:vf-module-topology-vlan-tagging-ip-addresses","xml":"<call module='GENERIC-RESOURCE-API' rpc='vf-module-topology-vlan-tagging-ip-addresses' mode='sync' >\n","comments":"","outputs":1,"x":4258.3330078125,"y":3198.333251953125,"z":"b47e4028.e9a92","wires":[["f05d8a8d.478058"]]},{"id":"f05d8a8d.478058","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":4611.666362762451,"y":3196.666585922241,"z":"b47e4028.e9a92","wires":[["3d223580.4b9d6a"]]},{"id":"3d223580.4b9d6a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n","comments":"","x":4759.999786376953,"y":3194.999725341797,"z":"b47e4028.e9a92","wires":[]},{"id":"9fcb1974.64d6a8","type":"set","name":"set test EIPAM response","xml":"<set>\n<parameter name='eipam-ip-block.plans_length' value='2' />\n<parameter name='eipam-ip-block.plans[0].plan-name' value='plan-1' />\n<parameter name='eipam-ip-block.plans[0].requests_length' value='6' />\n<parameter name='eipam-ip-block.plans[0].requests[0].client-key'\n  value='vm-type-1|zmtn6nf-code-16code-1001|network-role-1|subnet-role-1|FIXED|4|1' />\n<parameter name='eipam-ip-block.plans[0].requests[0].ip-type' value='FIXED' />\n<parameter name='eipam-ip-block.plans[0].requests[0].ip-prefix' value=\"`'34.52.87.1' + $counter`\" />\n<parameter name='eipam-ip-block.plans[0].requests[0].ip-version' value='4' />\n","comments":"","x":4124.99959564209,"y":3261.6664695739746,"z":"b47e4028.e9a92","wires":[]},{"id":"4a868e39.b7b62","type":"switchNode","name":"switch eipam-ip-block.plans_length","xml":"<switch test='`$eipam-ip-block.plans_length`'>\n","comments":"","outputs":1,"x":4121.66650390625,"y":3306.66650390625,"z":"b47e4028.e9a92","wires":[["bcd9cbf.fd3c238","2b7250d8.51255","d8798d76.14939"]]},{"id":"bcd9cbf.fd3c238","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":4337.14306640625,"y":3288.333168029785,"z":"b47e4028.e9a92","wires":[["43694866.e652c8"]]},{"id":"2b7250d8.51255","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":4338.3330078125,"y":3246.66650390625,"z":"b47e4028.e9a92","wires":[["43694866.e652c8"]]},{"id":"43694866.e652c8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":4461.189903259277,"y":3262.3808250427246,"z":"b47e4028.e9a92","wires":[[]]},{"id":"d8798d76.14939","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":4335,"y":3331.66650390625,"z":"b47e4028.e9a92","wires":[["45f3520.c1775b"]]},{"id":"45f3520.c1775b","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":4483.3330078125,"y":3331.66650390625,"z":"b47e4028.e9a92","wires":[["7cfd053c.e09c8c","ddb9d0a2.646fa"]]},{"id":"ddb9d0a2.646fa","type":"set","name":"set fixed ip addresses","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item[$tmp.index].network-ips.network-ip[0]'\n  value='`$eipam-ip-block.plans[0].requests[0].ip-prefix`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item[$tmp.index].network-ips.network-ip_length'\n  value='1' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item[$tmp.index].ip-version'\n  value='`$tmp.vt-ip.ip-version`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item[$tmp.index].ip-count'\n  value='1' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item[$tmp.index].use-dhcp'\n  value='N' />\n","comments":"","x":4645.237476348877,"y":3347.142662525177,"z":"b47e4028.e9a92","wires":[]},{"id":"7cfd053c.e09c8c","type":"switchNode","name":"switch network-information-item_length","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item_length`'>\n","comments":"","outputs":1,"x":4700.714050292969,"y":3301.904588699341,"z":"b47e4028.e9a92","wires":[["40631e77.7daca","3d9262aa.af1f8e","39def6e7.3e5e5a"]]},{"id":"3d9262aa.af1f8e","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":4927.856834411621,"y":3257.618889808655,"z":"b47e4028.e9a92","wires":[["84f8b706.53a388"]]},{"id":"39def6e7.3e5e5a","type":"other","name":"1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":4924.761337280273,"y":3339.9999418258667,"z":"b47e4028.e9a92","wires":[["c8bce8ef.90c648"]]},{"id":"40631e77.7daca","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":4927.856800079346,"y":3297.6188535690308,"z":"b47e4028.e9a92","wires":[["84f8b706.53a388"]]},{"id":"84f8b706.53a388","type":"set","name":"set network-information-item_length to 1","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item_length'\n  value='1' />\n<parameter name='tmp.index' value='0' />\n","comments":"","x":5177.856758117676,"y":3277.6189432144165,"z":"b47e4028.e9a92","wires":[]},{"id":"c8bce8ef.90c648","type":"set","name":"set network-information-item_length to 2","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[$vvig-index].vnfcs.vnfc[$vnfc-index].vnic-groups.vnic-group[$vnic-group-index].vlan-vnics.vlan-vnic[$vnic-index].vnic-sub-interfaces.sub-interface-network-data[$sub-index].network-information-items.network-information-item_length'\n  value='2' />\n<parameter name='tmp.index' value='1' />\n","comments":"","x":5176.428123474121,"y":3339.047600746155,"z":"b47e4028.e9a92","wires":[]},{"id":"dd6e8db9.1eadf","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":3128.3332138061523,"y":3330.00013256073,"z":"b47e4028.e9a92","wires":[["53f499ac.325d38"]]},{"id":"53f499ac.325d38","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value=\"`'From policy: ip-assignment is '\n  + $get-data-from-policy-output.ip-assignment\n  + ' but must be unique or shared'`\" />\n","comments":"","x":3280.0000495910645,"y":3329.999888420105,"z":"b47e4028.e9a92","wires":[]},{"id":"9796972d.9f2a48","type":"set","name":"clear tmp.vt-ip variables","xml":"<set>\n<parameter name='tmp.vt-ip.' value='' />\n","comments":"","x":2049.9999237060547,"y":2927.1427364349365,"z":"b47e4028.e9a92","wires":[]},{"id":"79bfeb99.430a74","type":"set","name":"set seq-no to 1","xml":"<set>\n<parameter name='seq-no' value='1' />\n","comments":"","x":1451.6666259765625,"y":2881.66650390625,"z":"b47e4028.e9a92","wires":[]},{"id":"57431c62.4b6574","type":"set","name":"increment seq-no","xml":"<set>\n<parameter name='seq-no' value='`$seq-no + 1`' />\n","comments":"","x":3667.143112182617,"y":2907.1426334381104,"z":"b47e4028.e9a92","wires":[]},{"id":"b558adee.b288c","type":"set","name":"increment seq-no","xml":"<set>\n<parameter name='seq-no' value='`$seq-no + 1`' />\n","comments":"","x":4068.571533203125,"y":3367.142822265625,"z":"b47e4028.e9a92","wires":[]}]