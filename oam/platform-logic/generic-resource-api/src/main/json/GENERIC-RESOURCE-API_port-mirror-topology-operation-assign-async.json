[{"id":"bb268559.fd3938","type":"dgstart","name":"DGSTART","outputs":1,"x":101.66666412353516,"y":87.41365623474121,"z":"ad46ffb1.59044","wires":[["a124bed3.35031"]]},{"id":"a124bed3.35031","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":215.6190414428711,"y":127.65177726745605,"z":"ad46ffb1.59044","wires":[["db524fe9.5dfcc"]]},{"id":"db524fe9.5dfcc","type":"method","name":"method port-mirror-topology-operation-assign-async","xml":"<method rpc='port-mirror-topology-operation-assign-async' mode='sync'>\n","comments":"","outputs":1,"x":232.95244598388672,"y":168.84222412109375,"z":"ad46ffb1.59044","wires":[["ac3d53ca.aefc2"]]},{"id":"19977dc1.9b6832","type":"comment","name":"port-mirror-topology-operation-assign-async","info":"","comments":"","x":496.0115203857422,"y":35,"z":"ad46ffb1.59044","wires":[]},{"id":"e5fd1f58.74f01","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name='error-code' value='200' />\n","comments":"","x":410.2144241333008,"y":5452.700392484665,"z":"ad46ffb1.59044","wires":[]},{"id":"ac3d53ca.aefc2","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":156.15477752685547,"y":2545.485157728195,"z":"ad46ffb1.59044","wires":[["e5fd1f58.74f01","ced2d211.53467","f9889d49.6fbf5","ce052c1a.cbe7c","8b585d79.bc124","4847ddc2.32a804","94761f86.c5ad2","bae20099.07b1f","17bc986f.814148","ac2e3332.29b9f","b4b42190.25a09","94e068c9.523098","b7f41d13.6fd4c","1b63f2c6.c9c3cd","3278f6bc.28dd4a","b0683757.70acd8","fc4ca4c9.69e018","59373ca.423e2c4","c1689047.89198","d3bec9cf.937968","39eab347.ba000c","b40e2769.9b66e8","8854e0fa.60ed8","e53b0107.99046","53a52a6c.d1cd64","1bbc7787.e7f1b8","a92de2b4.d0018","6aa6e65.77d1a18","72ac5c76.c8ab14","6e6309e.a9b13f8","ba91d904.ffefc8","7ee1327.81d79cc","b4aa58d9.1a6638","7c523201.d63ddc","6c94d29e.c7544c","f3bec0f8.38123","569bdf72.3da37","43966c.cbf36994","b26e3f0d.1d7c8","fb861ac2.aeb8b8","497d568b.0f1998","1bc76bf3.eeff44","34f89d01.613262","a44e08eb.db9948","fa51468e.921388"]]},{"id":"ced2d211.53467","type":"set","name":"set tmp variables","xml":"<set>\n<parameter name='tmp.configuration-id' value='`$port-mirror-topology-operation-input.configuration-information.configuration-id`' />\n<parameter name='tmp.src-vnf-id' value='`$port-mirror-topology-operation-input.port-mirror-configuration-request-input.source-port.vnf-information.vnf-id`' />\n<parameter name='tmp.dest-vnf-id' value='`$port-mirror-topology-operation-input.port-mirror-configuration-request-input.dest-port.vnf-information.vnf-id`' />\n<parameter name='tmp.dest-pnf-name' value='`$port-mirror-topology-operation-input.port-mirror-configuration-request-input.dest-port.pnf-information.pnf-name`' />\n<parameter name='tmp.service-instance-id' value='`$port-mirror-topology-operation-input.service-information.service-instance-id`' />\n<parameter name='tmp.configuration-sub-type' value='`$port-mirror-topology-operation-input.configuration-information.configuration-sub-type`' />\n","comments":"","x":434.23812103271484,"y":219.31843376159668,"z":"ad46ffb1.59044","wires":[]},{"id":"f9889d49.6fbf5","type":"set","name":"set port-mirror-configuration data","xml":"<set>\n<parameter name='pm.configuration-id' value='`$tmp.configuration-id`' />\n<parameter name='pm.configuration-data.configuration-operation-information.sdnc-request-header.'\n  value='`$port-mirror-topology-operation-input.sdnc-request-header.`' />\n<parameter name='pm.configuration-data.configuration-operation-information.request-information.'\n  value='`$port-mirror-topology-operation-input.request-information.`' />\n<parameter name='pm.configuration-data.configuration-operation-information.service-information.'\n  value='`$port-mirror-topology-operation-input.service-information.`' />\n<parameter name='pm.configuration-data.configuration-operation-information.configuration-information.'\n  value='`$port-mirror-topology-operation-input.configuration-information.`' />\n<parameter name='pm.configuration-data.configuration-operation-information.port-mirror-configuration-request-input.'\n  value='`$port-mirror-topology-operation-input.port-mirror-configuration-request-input.`' />\n","comments":"","x":483.38097381591797,"y":265.8898448944092,"z":"ad46ffb1.59044","wires":[]},{"id":"4847ddc2.32a804","type":"execute","name":"execute RestApiCallNode - PUT port-mirror-configuration","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.portmirrorconfig.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.pmc-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-pmc\" />\n\n","comments":"","outputs":1,"x":541.8215942382812,"y":5323.652531385422,"z":"ad46ffb1.59044","wires":[["a3f19e94.a6218","a7b211de.53d8b","a4821754.dac1f8"]]},{"id":"a3f19e94.a6218","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":943.5581283569336,"y":5366.650751829147,"z":"ad46ffb1.59044","wires":[["df3069ed.4ad628"]]},{"id":"a7b211de.53d8b","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":935.9867630004883,"y":5325.150771856308,"z":"ad46ffb1.59044","wires":[["df3069ed.4ad628"]]},{"id":"a4821754.dac1f8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":939.7367553710938,"y":5285.50786948204,"z":"ad46ffb1.59044","wires":[["803a5100.a0eb2"]]},{"id":"803a5100.a0eb2","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1077.1070251464844,"y":5284.557212591171,"z":"ad46ffb1.59044","wires":[[]]},{"id":"ce052c1a.cbe7c","type":"execute","name":"execute readProperties","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":454.5238723754883,"y":312.41370940208435,"z":"ad46ffb1.59044","wires":[[]]},{"id":"8b585d79.bc124","type":"execute","name":"generate port-mirror-configuration url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.pm-configuration`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.pmc-url\"/>\n    <parameter name=\"target\" value=\"{configuration-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.configuration-id`\"/>\n","comments":"","outputs":1,"x":478.07159423828125,"y":5273.652478933334,"z":"ad46ffb1.59044","wires":[[]]},{"id":"ab26b1cb.6c458","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":773.642858505249,"y":350.2230501174927,"z":"ad46ffb1.59044","wires":[["c1e2010f.8bc8a"]]},{"id":"853dd343.7ef44","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":782.2142944335938,"y":393.50876331329346,"z":"ad46ffb1.59044","wires":[["c1e2010f.8bc8a"]]},{"id":"54196f0f.b7bed","type":"set","name":"set src TOSCA data","xml":"<set>\n<parameter name='tmp.src-pps' value='`$db.cap[$cap-idx].pps-capacity`' />\n<parameter name='tmp.src-nfc-naming-code' value='`$db.cap[$cap-idx].nfc-naming-code`' />\n<parameter name='tmp.src-network-role' value='`$db.cap[$cap-idx].network-role`' />\n","comments":"","x":1080.3809967041016,"y":428.8422772884369,"z":"ad46ffb1.59044","wires":[]},{"id":"94761f86.c5ad2","type":"for","name":"for each capability row","xml":"<for index='cap-idx' start='0' end='`$db.cap_length`' >\n","comments":"","outputs":1,"x":453.23809814453125,"y":455.9851453304291,"z":"ad46ffb1.59044","wires":[["5484d230.220e0c"]]},{"id":"5484d230.220e0c","type":"switchNode","name":"switch role","xml":"<switch test='`$db.cap[$cap-idx].role`'>\n","comments":"","outputs":1,"x":678.9523124694824,"y":455.9851453304291,"z":"ad46ffb1.59044","wires":[["d2c1922a.92cad","43255d7c.a2b224"]]},{"id":"d2c1922a.92cad","type":"outcome","name":"source","xml":"<outcome value='source'>\n","comments":"","outputs":1,"x":883.2380627223424,"y":428.84227674347994,"z":"ad46ffb1.59044","wires":[["54196f0f.b7bed"]]},{"id":"43255d7c.a2b224","type":"outcome","name":"collector","xml":"<outcome value='collector'>\n","comments":"","outputs":1,"x":886.5714073181152,"y":474.55655813217163,"z":"ad46ffb1.59044","wires":[["1912da.1a473d27"]]},{"id":"1912da.1a473d27","type":"set","name":"set dest TOSCA data","xml":"<set>\n<parameter name='tmp.dest-pps' value='`$db.cap[$cap-idx].pps-capacity`' />\n<parameter name='tmp.dest-nfc-naming-code' value='`$db.cap[$cap-idx].nfc-naming-code`' />\n<parameter name='tmp.dest-network-role' value='`$db.cap[$cap-idx].network-role`' />\n","comments":"","x":1086.5714569091797,"y":473.1279969215393,"z":"ad46ffb1.59044","wires":[]},{"id":"465844f2.75eb6c","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Error reading PORT_MIRROR_CONFIGURATION table\" />\n","comments":"","outputs":1,"x":1106.9777603149414,"y":343.73672008514404,"z":"ad46ffb1.59044","wires":[[]]},{"id":"48ebd9fd.1aa898","type":"comment","name":"Save data in port-mirror-configurations","info":"","comments":"","x":530.9287261962891,"y":5226.50967001915,"z":"ad46ffb1.59044","wires":[]},{"id":"b08e4195.35b89","type":"for","name":"for each vnfc-instance-group","xml":"<for index='vnfc-idx' start='0' end='`$service-data.vnfc-instance-groups.vnfc-instance-group_length`' >\n","comments":"","outputs":1,"x":1086.1905822753906,"y":764.8422791957855,"z":"ad46ffb1.59044","wires":[["cfce73db.444a"]]},{"id":"bae20099.07b1f","type":"switchNode","name":"switch vnfc-instance-group length","xml":"<switch test='`$service-data.vnfc-instance-groups.vnfc-instance-group_length`'>\n","comments":"","outputs":1,"x":484.19061279296875,"y":727.1279656887054,"z":"ad46ffb1.59044","wires":[["83784130.f9a6d","3bc49b20.bc69d4"]]},{"id":"83784130.f9a6d","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":715.4762191772461,"y":626.6994416713715,"z":"ad46ffb1.59044","wires":[["ef26b095.af478"]]},{"id":"3bc49b20.bc69d4","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":715.0476684570312,"y":831.9853875637054,"z":"ad46ffb1.59044","wires":[["c196ee7a.ca01e"]]},{"id":"4e1f1d25.97bcc4","type":"set","name":"set src and dest vnfc-instance-group indexes to 0 and 1","xml":"<set>\n<parameter name='tmp.src-vnfc-idx' value='0' />\n<parameter name='tmp.dest-vnfc-idx' value='1' />\n","comments":"","x":1426.666763305664,"y":596.937522649765,"z":"ad46ffb1.59044","wires":[]},{"id":"85ad272a.3311b8","type":"switchNode","name":"switch nfc-naming-code== src-nfc-naming-code","xml":"<switch test='`$service-data.vnfc-instance-groups.vnfc-instance-group[$vnfc-idx].nfc-naming-code == $tmp.src-nfc-naming-code`'>\n","comments":"","outputs":1,"x":2114.9048080444336,"y":711.0326793193817,"z":"ad46ffb1.59044","wires":[["904cff55.541c6"]]},{"id":"904cff55.541c6","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2365.952476501465,"y":709.3660762310028,"z":"ad46ffb1.59044","wires":[["d3793fdc.0a2ff"]]},{"id":"826084d1.080b38","type":"switchNode","name":"switch nfc-naming-code== dest-nfc-naming-code","xml":"<switch test='`$service-data.vnfc-instance-groups.vnfc-instance-group[$vnfc-idx].nfc-naming-code == $tmp.dest-nfc-naming-code`'>\n","comments":"","outputs":1,"x":2079.4290466308594,"y":810.0803000926971,"z":"ad46ffb1.59044","wires":[["76df0afb.11e574"]]},{"id":"76df0afb.11e574","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2363.8099822998047,"y":810.0803306102753,"z":"ad46ffb1.59044","wires":[["c21bf8.eab03408"]]},{"id":"f9f6a40c.995e38","type":"set","name":"set src and dest vnfc-instance-group indexes","xml":"<set>\n<parameter name='tmp.src-vnfc-idx' value='`$service-data.vnfc-instance-groups.vnfc-instance-group_length`' />\n<parameter name='tmp.dest-vnfc-idx' value='`$service-data.vnfc-instance-groups.vnfc-instance-group_length + 1`' />\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group_length' value='`$service-data.vnfc-instance-groups.vnfc-instance-group_length + 2`'/>\n","comments":"","x":1557.33349609375,"y":869.1279656887054,"z":"ad46ffb1.59044","wires":[]},{"id":"5497462d.218008","type":"switchNode","name":"switch instance-group-role == source network role","xml":"<switch test=\"`$service-data.vnfc-instance-groups.vnfc-instance-group[$vnfc-idx].instance-group-role == $tmp.src-network-role`\">\n","comments":"","outputs":1,"x":1599.76220703125,"y":713.1755731105804,"z":"ad46ffb1.59044","wires":[["25d48494.893ccc"]]},{"id":"25d48494.893ccc","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1858.5714683532715,"y":711.7470281124115,"z":"ad46ffb1.59044","wires":[["85ad272a.3311b8"]]},{"id":"7b66815b.00988","type":"set","name":"set vnfc-instance-group data","xml":"<set>\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group[$tmp.src-vnfc-idx].instance-group-role'\n  value='`$tmp.src-network-role`'/>\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group[$tmp.src-vnfc-idx].nfc-naming-code'\n  value='`$tmp.src-nfc-naming-code`'/>\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group[$tmp.src-vnfc-idx].group-type'\n  value='port-mirror-source'/>\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group[$tmp.src-vnfc-idx].configuration-id'\n  value='`$tmp.configuration-id`'/>\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group[$tmp.dest-vnfc-idx].instance-group-role'\n  value='`$tmp.dest-network-role`'/>\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group[$tmp.dest-vnfc-idx].nfc-naming-code'\n  value='`$tmp.dest-nfc-naming-code`'/>\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group[$tmp.dest-vnfc-idx].group-type'\n  value='port-mirror-dest'/>\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group[$tmp.dest-vnfc-idx].configuration-id'\n  value='`$tmp.configuration-id`'/>\n","comments":"","x":884.9523620605469,"y":2888.985690832138,"z":"ad46ffb1.59044","wires":[]},{"id":"a92de2b4.d0018","type":"save","name":"custom query: get owning entity","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n      resource=\"custom-query\"\n      key=\"format = 'resource'\"\n      force=\"true\"\n      local-only=\"false\"\n      pfx=\"tmp.AnAI-data.oe\">\n<parameter name=\"start[0]\" value=\"`'nodes/service-instances/service-instance?service-instance-id=' + $tmp.service-instance-id `\" />\n<parameter name=\"start_length\" value=\"1\" />\n<parameter name=\"query\" value=\"/query/owning-entity-fromService-instance\" /> \n","comments":"","outputs":1,"x":481.7143249511719,"y":1060.0568101406097,"z":"ad46ffb1.59044","wires":[["6b2910fe.e6dcc","d5b1a37.27eef6","2b7916ba.345d0a"]]},{"id":"cf8b1744.047588","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":749.6190490722656,"y":1272.1042115688324,"z":"ad46ffb1.59044","wires":[["49093ad5.e171a4"]]},{"id":"59373ca.423e2c4","type":"save","name":"custom query: get source network data","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n      resource=\"custom-query\"\n      key=\"format = 'resource'\"\n      force=\"true\"\n      local-only=\"false\"\n      pfx=\"tmp.AnAI-data.src-network\">\n      <parameter name=\"start[0]\" value=\"`'/cloud-infrastructure/cloud-regions/cloud-region/' + $tmp.cloud-owner + '/'  + $tmp.cloud-region-id`\" />\n      <parameter name=\"start_length\" value=\"1\" /> \n      <parameter name=\"query\" value=\"`'/query/network-name-fromNetwork-role?networkRole='  + $tmp.src-network-role`\" /> \n","comments":"","outputs":1,"x":510.4286651611328,"y":2466.6520936489105,"z":"ad46ffb1.59044","wires":[["12ac31cc.1492fe","7f7fb5ed.db5a5c"]]},{"id":"12ac31cc.1492fe","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":782.5715141296387,"y":2436.652218580246,"z":"ad46ffb1.59044","wires":[["b2ddda36.d1a248"]]},{"id":"8854e0fa.60ed8","type":"set","name":"copy A&AI data to topology","xml":"<set>\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.cloud-owner'\n  value='`$tmp.cloud-owner`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.cloud-region-id'\n  value='`$tmp.cloud-region-id`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.tenant'\n  value='`$tmp.tenant`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.tenant-id'\n  value='`$tmp.tenant-id`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.dest-tenant'\n  value='`$tmp.dest-tenant`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.dest-tenant-id'\n  value='`$tmp.dest-tenant-id`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.tenant-context'\n  value='`$tmp.tenant-context`' />\n","comments":"","x":476.90464782714844,"y":2320.6756768226624,"z":"ad46ffb1.59044","wires":[]},{"id":"ad263b73.9e1128","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3049.762275695801,"y":707.699319601059,"z":"ad46ffb1.59044","wires":[["e719dfbc.122c1","63c03f51.fc305"]]},{"id":"a08aecf8.1164d","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3050.4767150878906,"y":806.9849908351898,"z":"ad46ffb1.59044","wires":[["ddbbed4c.69b25","63c03f51.fc305"]]},{"id":"c196ee7a.ca01e","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":864.476318359375,"y":829.9851434230804,"z":"ad46ffb1.59044","wires":[["b08e4195.35b89","3f2e31c8.06f08e"]]},{"id":"c1e2010f.8bc8a","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":927.8571548461914,"y":368.8422498703003,"z":"ad46ffb1.59044","wires":[["465844f2.75eb6c","63c03f51.fc305"]]},{"id":"cf05af60.13994","type":"comment","name":"rpc-port-mirror-1040","info":"","comments":"","x":414.0476379394531,"y":613.8422734737396,"z":"ad46ffb1.59044","wires":[]},{"id":"df46f124.b18a4","type":"comment","name":"step 2 - create vnfc-instance-group (done)","info":"","comments":"","x":484.0476531982422,"y":653.8422296047211,"z":"ad46ffb1.59044","wires":[]},{"id":"569cc477.0c727c","type":"comment","name":"step 3 - get owning entity (aai-port-mirror-1140)","info":"","comments":"","x":494.9524230957031,"y":973.7233216762543,"z":"ad46ffb1.59044","wires":[]},{"id":"4c7a8bad.448c34","type":"comment","name":"step 4 - get cloud-owner, cloud-region-id, and tenant (aai-port-mirror-1150)","info":"","comments":"","x":576.7618713378906,"y":1231.53280043602,"z":"ad46ffb1.59044","wires":[]},{"id":"a38b575c.8e5978","type":"comment","name":"step 5 - get network data (aai-port-mirror-1120)","info":"","comments":"","x":540.4286079406738,"y":2419.5092465877533,"z":"ad46ffb1.59044","wires":[]},{"id":"ec7724b4.2efb38","type":"comment","name":"step 6/7 - get vservers, l-interfaces, etc (aai-port-mirror-1130)","info":"","comments":"","x":577.1905212402344,"y":2627.937910795212,"z":"ad46ffb1.59044","wires":[]},{"id":"93550f20.12036","type":"comment","name":"step 8 - write data to vnfc-instance-groups","info":"","comments":"","x":511.6190185546875,"y":2848.6046578884125,"z":"ad46ffb1.59044","wires":[]},{"id":"730bd1a2.6e1bc","type":"comment","name":"step 9/10 - write instance group variables and vnf-ids to assignments","info":"","comments":"","x":591.5238265991211,"y":2987.9374301433563,"z":"ad46ffb1.59044","wires":[]},{"id":"7c9558cd.b82ff8","type":"comment","name":"rpc-port-mirror-1030","info":"","comments":"","x":431.5476760864258,"y":3526.819870710373,"z":"ad46ffb1.59044","wires":[]},{"id":"c0a00a8e.d159f8","type":"comment","name":"step 4 - write configuration identifiers to topology (done)","info":"","comments":"","x":536.5239105224609,"y":4850.438508749008,"z":"ad46ffb1.59044","wires":[]},{"id":"2578aa22.458d06","type":"comment","name":"step 5 - map source to dest (rpc-port-mirror-1050)","info":"","comments":"","x":563.6191253662109,"y":3573.604864835739,"z":"ad46ffb1.59044","wires":[]},{"id":"5307699d.4d8ca8","type":"comment","name":"step 6 - call DG to create network policy","info":"","comments":"","x":497.5001411437988,"y":3768.4856355190277,"z":"ad46ffb1.59044","wires":[]},{"id":"ddc35f62.7f936","type":"comment","name":"step 7 - create logical links (aai-port-mirror-1030)","info":"","comments":"","x":543.690616607666,"y":4180.390530347824,"z":"ad46ffb1.59044","wires":[]},{"id":"9382bde2.bd7ce","type":"comment","name":"step 8 - update configuration object (aai-port-mirror-1020) (done)","info":"","comments":"","x":564.4286499023438,"y":4651.151960134506,"z":"ad46ffb1.59044","wires":[]},{"id":"3f064715.dd5548","type":"comment","name":"step 9 - update references to configuration object (done)","info":"","comments":"","x":539.6668701171875,"y":4934.818518400192,"z":"ad46ffb1.59044","wires":[]},{"id":"5a1791a8.eaa3c","type":"comment","name":"step 10  - update oper status (done)","info":"","comments":"","x":471.6192321777344,"y":5138.676261663437,"z":"ad46ffb1.59044","wires":[]},{"id":"dda98e98.66fdf","type":"set","name":"set assignments high-level data","xml":"<set>\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-vnfc-instance-group-id.nfc-naming-code'\n  value='`$tmp.src-nfc-naming-code`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-vnfc-instance-group-id.instance-group-role'\n  value='`$tmp.src-network-role`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-vnfc-instance-group-id.service-instance-id'\n  value='`$tmp.service-instance-id`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-vnfc-instance-group-id.configuration-id'\n  value='`$tmp.configuration-id`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-vnf-id'\n  value='`$tmp.src-vnf-id`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-capacity'\n  value='`$tmp.src-pps`' />\n  \n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.dest-vnfc-instance-group-id.nfc-naming-code'\n  value='`$tmp.dest-nfc-naming-code`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.dest-vnfc-instance-group-id.instance-group-role'\n  value='`$tmp.dest-network-role`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.dest-vnfc-instance-group-id.service-instance-id'\n  value='`$tmp.service-instance-id`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.dest-vnfc-instance-group-id.configuration-id'\n  value='`$tmp.configuration-id`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.dest-vnf-id'\n  value='`$tmp.dest-vnf-id`' />\n  \n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.probe-type'\n  value='vprobe' />\n  \n","comments":"","x":884.0475997924805,"y":3027.5565707683563,"z":"ad46ffb1.59044","wires":[]},{"id":"ac2e3332.29b9f","type":"set","name":"write configuration identifiers to topology","xml":"<set>\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.configuration-identifiers.configuration-id'\n  value='`$tmp.configuration-id`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.configuration-identifiers.configuration-type'\n  value='`$port-mirror-topology-operation-input.configuration-information.configuration-type`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.configuration-identifiers.configuration-sub-type'\n  value='`$port-mirror-topology-operation-input.configuration-information.configuration-sub-type`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.configuration-identifiers.parent-service-instance-id'\n  value='`$tmp.service-instance-id`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.configuration-identifiers.configuration-name'\n  value='`$tmp.configuration-name`' />\n","comments":"","x":497.4762268066406,"y":4894.724291563034,"z":"ad46ffb1.59044","wires":[]},{"id":"17bc986f.814148","type":"set","name":"copy A&AI data to topology","xml":"<set>\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.owning-entity' value='`$tmp.owning-entity`' />","comments":"","x":466.90484873453806,"y":1191.294898112615,"z":"ad46ffb1.59044","wires":[]},{"id":"b4b42190.25a09","type":"get-resource","name":"get-resource PORT_MIRROR_CAPABILITY","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='select role,nfc_naming_code,pps_capacity,network_role,policy_name\n    from PORT_MIRROR_CAPABILITY cap, PORT_MIRROR_CONFIGURATION conf, SERVICE_PROXY sp\n    where cap.port_mirror_capability_name=conf.port_mirror_capability_name\n     and cap.port_mirror_service_uuid=conf.port_mirror_service_uuid\n     and cap.service_proxy_name=conf.service_proxy_name\n     and cap.service_proxy_name=sp.service_proxy_name\n     and cap.port_mirror_service_uuid=sp.parent_service_uuid\n     and conf.customization_uuid = $port-mirror-topology-operation-input.configuration-information.onap-model-information.model-customization-uuid\n     and conf.port_mirror_service_uuid = $service-data.service-information.onap-model-information.model-uuid\n    order by role'\n  pfx='db.cap[]'>\n","comments":"","outputs":1,"x":520.7143173217773,"y":375.98510932922363,"z":"ad46ffb1.59044","wires":[["ab26b1cb.6c458","853dd343.7ef44"]]},{"id":"fc4ca4c9.69e018","type":"save","name":"custom query: get source interface data","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n      resource=\"custom-query\"\n      key=\"format = 'resource'\"\n      force=\"true\"\n      local-only=\"false\"\n      pfx=\"tmp.AnAI-data.src-li\">\n\t<parameter value=\"`'/network/generic-vnfs/generic-vnf/' + $tmp.src-vnf-id`\" name=\"start[0]\"/>\n\t<parameter value=\"1\" name=\"start_length\"/>\n\t<parameter value=\"`'/query/vserver-fromVnf?nfcNamingCode=' + $tmp.encoded-src-nfc-naming-code`\" name=\"query\"/>\n","comments":"","outputs":1,"x":512.2381591796875,"y":2681.937666654587,"z":"ad46ffb1.59044","wires":[["c71cf508.fbd108","bd71f446.ad9978"]]},{"id":"c71cf508.fbd108","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":783.4285697937012,"y":2662.4139783382416,"z":"ad46ffb1.59044","wires":[["864b2f27.10409"]]},{"id":"3673b9cb.5e0016","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":1953.5473327636719,"y":6067.818812131882,"z":"ad46ffb1.59044","wires":[]},{"id":"96200486.022548","type":"configure","name":"send error to MSO","xml":"<configure activate=\"true\" adaptor=\"com.att.sdnctl.sli.adaptor.mso.MSOAdaptor\" key=\"__READ_FROM_PARAMETERS__\">\n<parameter name=\"notification-url\" value=\"`$port-mirror-topology-operation-input.sdnc-request-header.svc-notification-url`\" />\n<parameter name=\"input.ack-final-indicator\" value=\"Y\" />\n<parameter name=\"input.response-code\" value=\"500\" />\n<parameter name=\"input.response-message\" value=\"`$error-message`\" />\n<parameter name=\"input.svc-request-id\" value=\"`$port-mirror-topology-operation-input.sdnc-request-header.svc-request-id`\" />\n<parameter name=\"input.service-information.service-type\" value=\"`$port-mirror-topology-operation-input.service-information.subscription-service-type`\" />\n<parameter name=\"input.service-information.service-instance-id\" value=\"`$port-mirror-topology-operation-input.service-information.service-instance-id`\" />\n","comments":"","outputs":1,"x":1972.906379699707,"y":6019.618288755417,"z":"ad46ffb1.59044","wires":[[]]},{"id":"63c03f51.fc305","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":1800.2141189575195,"y":6040.676154851913,"z":"ad46ffb1.59044","wires":[["96200486.022548","3673b9cb.5e0016"]]},{"id":"e719dfbc.122c1","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"`'Source nfc-naming-code of ' + $tmp.src-nfc-naming-code + ' already exists in vnfc-instance-groups for this configuration-id'`\" />\n","comments":"","outputs":1,"x":3274.0480422973633,"y":679.1278855800629,"z":"ad46ffb1.59044","wires":[[]]},{"id":"ddbbed4c.69b25","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"`'Dest nfc-naming-code of ' + $tmp.dest-nfc-naming-code + ' already exists in vnfc-instance-groups for this configuration-id'`\" />\n","comments":"","outputs":1,"x":3271.0480346679688,"y":776.127916097641,"z":"ad46ffb1.59044","wires":[[]]},{"id":"49093ad5.e171a4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":922.1904983520508,"y":1273.056488752365,"z":"ad46ffb1.59044","wires":[["4b208346.335cec","63c03f51.fc305"]]},{"id":"4b208346.335cec","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to AAI custom query: cloud-region-fromVnf\" />\n","comments":"","outputs":1,"x":1135.190528869629,"y":1273.0565965175629,"z":"ad46ffb1.59044","wires":[[]]},{"id":"539e08.2cbc11f8","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to AAI custom query: network-name-fromNetwork-role\" />\n","comments":"","outputs":1,"x":1156.1429634094238,"y":2429.7950398921967,"z":"ad46ffb1.59044","wires":[[]]},{"id":"3cbceaf3.21fa26","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to AAI custom query vserver-fromVnf for source vnf\" />\n","comments":"","outputs":1,"x":1172.6190490722656,"y":2662.794835805893,"z":"ad46ffb1.59044","wires":[[]]},{"id":"b2ddda36.d1a248","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":951.8096046447754,"y":2430.4615848064423,"z":"ad46ffb1.59044","wires":[["539e08.2cbc11f8","63c03f51.fc305"]]},{"id":"864b2f27.10409","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":942.9524192810059,"y":2662.128130197525,"z":"ad46ffb1.59044","wires":[["3cbceaf3.21fa26","63c03f51.fc305"]]},{"id":"39eab347.ba000c","type":"save","name":"custom query: get cloud region from vnf","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n      resource=\"custom-query\"\n      key=\"format = 'resource&amp;nodesOnly=true'\"\n      force=\"true\"\n      local-only=\"false\"\n      pfx=\"tmp.AnAI-data.vnf\">\n<parameter name=\"start[0]\" value=\"`'/network/generic-vnfs/generic-vnf/' + $tmp.src-vnf-id `\" />\n<parameter name=\"start_length\" value=\"1\" />\n<parameter name=\"query\" value=\"query/cloud-region-fromVnf\" /> \n","comments":"","outputs":1,"x":505.0476379394531,"y":1294.10408949852,"z":"ad46ffb1.59044","wires":[["cf8b1744.047588","d0e9d16b.5ac0d"]]},{"id":"6b2910fe.e6dcc","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":731.9524116516113,"y":1013.7232768535614,"z":"ad46ffb1.59044","wires":[["3d2afe64.53a9e2"]]},{"id":"3d2afe64.53a9e2","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":899.6667404174805,"y":1013.4374158382416,"z":"ad46ffb1.59044","wires":[["6b3fecc6.167694","63c03f51.fc305"]]},{"id":"6b3fecc6.167694","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to AAI custom query: owning-entity-fromService-instance\" />\n","comments":"","outputs":1,"x":1100.2382011413574,"y":1013.1517369747162,"z":"ad46ffb1.59044","wires":[[]]},{"id":"d5b1a37.27eef6","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":739.0953063964844,"y":1059.43750166893,"z":"ad46ffb1.59044","wires":[["498bf269.3bee4c"]]},{"id":"498bf269.3bee4c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":903.3810157775879,"y":1058.008983373642,"z":"ad46ffb1.59044","wires":[["ee857f71.e7279","63c03f51.fc305"]]},{"id":"ee857f71.e7279","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"No owning entity returned from AAI: owning-entity-fromService-instance\" />\n","comments":"","outputs":1,"x":1103.9524765014648,"y":1057.7233045101166,"z":"ad46ffb1.59044","wires":[[]]},{"id":"d0e9d16b.5ac0d","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":763.3333435058594,"y":1322.961267232895,"z":"ad46ffb1.59044","wires":[["7f9ea47.0a4d75c"]]},{"id":"7f9ea47.0a4d75c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":927.6190528869629,"y":1321.5327489376068,"z":"ad46ffb1.59044","wires":[["84c17964.af8038","63c03f51.fc305"]]},{"id":"84c17964.af8038","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"No cloud region returned from AAI: cloud-region-fromVnf\" />\n","comments":"","outputs":1,"x":1128.1905136108398,"y":1321.2470700740814,"z":"ad46ffb1.59044","wires":[[]]},{"id":"7f7fb5ed.db5a5c","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":791.8571510314941,"y":2485.4616515636444,"z":"ad46ffb1.59044","wires":[["5d211eb.2a894e"]]},{"id":"5d211eb.2a894e","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":956.1428604125977,"y":2484.0331332683563,"z":"ad46ffb1.59044","wires":[["a2e4d3b6.99b26","63c03f51.fc305"]]},{"id":"a2e4d3b6.99b26","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"No network information returned from AAI: network-name-fromNetwork-role\" />\n","comments":"","outputs":1,"x":1155.0475883483887,"y":2482.0807683467865,"z":"ad46ffb1.59044","wires":[[]]},{"id":"bd71f446.ad9978","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":791.9999694824219,"y":2716.461442708969,"z":"ad46ffb1.59044","wires":[["3ea31ed7.03df92"]]},{"id":"3ea31ed7.03df92","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":956.2856788635254,"y":2715.032924413681,"z":"ad46ffb1.59044","wires":[["7dbff819.5bfbe8","63c03f51.fc305"]]},{"id":"7dbff819.5bfbe8","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"No interface data returned from AAI vserver-fromVnf for source vnf\" />\n","comments":"","outputs":1,"x":1155.1904067993164,"y":2713.080559492111,"z":"ad46ffb1.59044","wires":[[]]},{"id":"b7f41d13.6fd4c","type":"set","name":"set provided-configuration references","xml":"<set>\n<parameter name='service-data.provided-configurations.provided-configuration[$tmp.provided-conf-idx].configuration-id'\n  value='`$tmp.configuration-id`' />\n<parameter name='service-data.provided-configurations.provided-configuration[$tmp.provided-conf-idx].configuration-type'\n  value='`$port-mirror-topology-operation-input.configuration-information.configuration-type`' />\n<parameter name='service-data.provided-configurations.provided-configuration[$tmp.provided-conf-idx].configuration-sub-type'\n  value='`$port-mirror-topology-operation-input.configuration-information.configuration-sub-type`' />\n<parameter name='service-data.provided-configurations.provided-configuration[$tmp.provided-conf-idx].configuration-topology-link'\n  value=\"`'restconf/config/GENERIC-RESOURCE-API:port-mirror-configurations/port-mirror-configuration/' + $tmp.configuration-id + '/configuration-data/port-mirror-configuration-topology'`\" />\n","comments":"","x":485.0953826904297,"y":5088.533381223679,"z":"ad46ffb1.59044","wires":[]},{"id":"6e0f32b2.2cbbfc","type":"set","name":"set tmp.provided-conf-idx to 0","xml":"<set>\n<parameter name='tmp.provided-conf-idx' value='0' />\n","comments":"","x":935.0953140258789,"y":4983.533135175705,"z":"ad46ffb1.59044","wires":[]},{"id":"94e068c9.523098","type":"switchNode","name":"switch provided-configuration_length","xml":"<switch test='`$service-data.provided-configurations.provided-configuration_length`'>\n","comments":"","outputs":1,"x":485.0954284667969,"y":5016.866305112839,"z":"ad46ffb1.59044","wires":[["9b5988f1.682ef8","fd407f90.6b97d"]]},{"id":"9b5988f1.682ef8","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":720.0953674316406,"y":4985.199560880661,"z":"ad46ffb1.59044","wires":[["6e0f32b2.2cbbfc"]]},{"id":"fd407f90.6b97d","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":720.3334655761719,"y":5042.818625211716,"z":"ad46ffb1.59044","wires":[["b5bce153.d8e4b"]]},{"id":"b5bce153.d8e4b","type":"set","name":"set tmp.provided-conf-idx to current length","xml":"<set>\n<parameter name='tmp.provided-conf-idx' value='`$service-data.provided-configurations.provided-configuration_length`' />\n<parameter name='service-data.provided-configurations.provided-configuration_length' value='`$tmp.provided-conf-idx + 1`' />\n","comments":"","x":973.4286880493164,"y":5043.532810926437,"z":"ad46ffb1.59044","wires":[]},{"id":"1b63f2c6.c9c3cd","type":"set","name":"set oper-status","xml":"<set>\n<parameter name='pm.configuration-data.configuration-oper-status.order-status'\n  value='Created' />\n<parameter name='pm.configuration-data.configuration-oper-status.last-action'\n  value='`$port-mirror-topology-operation-input.request-information.request-action`' />\n<parameter name='pm.configuration-data.configuration-oper-status.last-rpc-action'\n  value='`$port-mirror-topology-operation-input.sdnc-request-header.svc-action`' />\n","comments":"","x":413.0954284667969,"y":5183.199943304062,"z":"ad46ffb1.59044","wires":[]},{"id":"7c21534.f0151ac","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Error updating md-sal for port-mirror-configuration\" />\n","comments":"","outputs":1,"x":1292.9762725830078,"y":5313.223598241806,"z":"ad46ffb1.59044","wires":[[]]},{"id":"df3069ed.4ad628","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1098.9762725830078,"y":5339.223598241806,"z":"ad46ffb1.59044","wires":[["7c21534.f0151ac","b9471f80.beb4f"]]},{"id":"3278f6bc.28dd4a","type":"save","name":"update configuration object","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"configuration\"\n   key=\"configuration.configuration-id = $tmp.configuration-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"configuration-name\" value=\"`$tmp.configuration-name`\" />\n<parameter name=\"operational-status\" value=\"out-of-service-path\" />\n<parameter name=\"configuration-selflink\" value=\"`'/config/GENERIC-RESOURCE-API:port-mirror-configurations/port-mirror-configuration/'\n  + $port-mirror-topology-operation-input.configuration-information.configuration-id + '/configuration-data/port-mirror-configuration-topology'`\" />\n","comments":"","outputs":1,"x":458.2381057739258,"y":4726.151884794235,"z":"ad46ffb1.59044","wires":[["5afb000a.4d7de","5869bf9c.0fe5a"]]},{"id":"5afb000a.4d7de","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":662.5954246520996,"y":4749.771194219589,"z":"ad46ffb1.59044","wires":[["69096410.56db8c"]]},{"id":"5869bf9c.0fe5a","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":671.1668395996094,"y":4699.056997060776,"z":"ad46ffb1.59044","wires":[["db67428e.c1fa4"]]},{"id":"69096410.56db8c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":844.9047698974609,"y":4751.151537656784,"z":"ad46ffb1.59044","wires":[["f4035afd.1eff48","b9471f80.beb4f"]]},{"id":"db67428e.c1fa4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":844.9047470092773,"y":4699.485204458237,"z":"ad46ffb1.59044","wires":[["37f18fcb.abe9a","b9471f80.beb4f"]]},{"id":"f4035afd.1eff48","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failure updating configuration object in AAI\" />\n","comments":"","outputs":1,"x":1031.5713958740234,"y":4751.151537656784,"z":"ad46ffb1.59044","wires":[[]]},{"id":"37f18fcb.abe9a","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Unable to find configuration object in AAI\" />\n","comments":"","outputs":1,"x":1041.5713577270508,"y":4697.818469762802,"z":"ad46ffb1.59044","wires":[[]]},{"id":"b0683757.70acd8","type":"switchNode","name":"switch input configuration-name","xml":"<switch test='`$port-mirror-topology-operation-input.configuration-information.configuration-name`'>\n","comments":"","outputs":1,"x":478.0001220703125,"y":3948.6045615673065,"z":"ad46ffb1.59044","wires":[["9aad7446.82ff88","7fbcc8b1.312ee8"]]},{"id":"9aad7446.82ff88","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":716.3334503173828,"y":3926.9377343654633,"z":"ad46ffb1.59044","wires":[["f4b25a9.9b490a8"]]},{"id":"7fbcc8b1.312ee8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":716.5715103149414,"y":3971.223790884018,"z":"ad46ffb1.59044","wires":[["1cfb2e4.fae17d2"]]},{"id":"f4b25a9.9b490a8","type":"set","name":"generate name","xml":"<set>\n<parameter name='tmp.configuration-name' value=\"`'PMC_' + $tmp.tenant + '_' + $tmp.cloud-region-id + '_' + $port-mirror-topology-operation-input.configuration-information.configuration-type + '_' + $tmp.configuration-id`\" />\n","comments":"","x":894.6667861938477,"y":3926.937853574753,"z":"ad46ffb1.59044","wires":[]},{"id":"1cfb2e4.fae17d2","type":"set","name":"copy name to tmp.configuration-name","xml":"<set>\n<parameter name='tmp.configuration-name' value='`$port-mirror-topology-operation-input.configuration-information.configuration-name`' />\n","comments":"","x":963.0000610351562,"y":3970.2711083889008,"z":"ad46ffb1.59044","wires":[]},{"id":"3f4d2f6e.a6f3f","type":"save","name":"custom query: get dest interface data","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n      resource=\"custom-query\"\n      key=\"format = 'resource'\"\n      force=\"true\"\n      local-only=\"false\"\n      pfx=\"tmp.AnAI-data.dest-li\">\n\t<parameter value=\"`'/network/generic-vnfs/generic-vnf/' + $tmp.dest-vnf-id`\" name=\"start[0]\"/>\n\t<parameter value=\"1\" name=\"start_length\"/>\n\t<parameter value=\"`'/query/vserver-fromVnf?nfcNamingCode=' + $tmp.encoded-dest-nfc-naming-code`\" name=\"query\"/>\n","comments":"","outputs":1,"x":900.0000152587891,"y":2779.794685125351,"z":"ad46ffb1.59044","wires":[["eabfaba8.1a1b58","e8fa0fb9.d067f"]]},{"id":"eabfaba8.1a1b58","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1171.1904258728027,"y":2760.2709968090057,"z":"ad46ffb1.59044","wires":[["645c5606.f95b48"]]},{"id":"5934b8dd.233468","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to AAI custom query vserver-fromVnf for dest vnf\" />\n","comments":"","outputs":1,"x":1560.3809051513672,"y":2760.651854276657,"z":"ad46ffb1.59044","wires":[[]]},{"id":"645c5606.f95b48","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1330.7142753601074,"y":2759.985148668289,"z":"ad46ffb1.59044","wires":[["5934b8dd.233468","63c03f51.fc305"]]},{"id":"e8fa0fb9.d067f","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1179.7618255615234,"y":2814.3184611797333,"z":"ad46ffb1.59044","wires":[["bfca4c81.3f76"]]},{"id":"bfca4c81.3f76","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1344.047534942627,"y":2812.889942884445,"z":"ad46ffb1.59044","wires":[["f19b293.d210ed8","63c03f51.fc305"]]},{"id":"f19b293.d210ed8","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"No interface data returned from AAI vserver-fromVnf for dest vnf\" />\n","comments":"","outputs":1,"x":1542.952262878418,"y":2810.9375779628754,"z":"ad46ffb1.59044","wires":[[]]},{"id":"bccb28e8.16a9b8","type":"save","name":"custom query: get dest network data","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n      resource=\"custom-query\"\n      key=\"format = 'resource'\"\n      force=\"true\"\n      local-only=\"false\"\n      pfx=\"tmp.AnAI-data.dest-network\">\n      <parameter name=\"start[0]\" value=\"`'/cloud-infrastructure/cloud-regions/cloud-region/' + $tmp.cloud-owner + '/'  + $tmp.cloud-region-id`\" />\n      <parameter name=\"start_length\" value=\"1\" /> \n      <parameter name=\"query\" value=\"`'/query/network-name-fromNetwork-role?networkRole='  + $tmp.dest-network-role`\" /> \n","comments":"","outputs":1,"x":905.0000457763672,"y":2559.794838666916,"z":"ad46ffb1.59044","wires":[["ee6bb08a.94728","53108b40.4bfeb4"]]},{"id":"ee6bb08a.94728","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1177.142894744873,"y":2529.7949635982513,"z":"ad46ffb1.59044","wires":[["17c66940.45d1c7"]]},{"id":"65f00856.6009c8","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to AAI custom query: network-name-fromNetwork-role\" />\n","comments":"","outputs":1,"x":1550.7143440246582,"y":2522.937784910202,"z":"ad46ffb1.59044","wires":[[]]},{"id":"17c66940.45d1c7","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1346.3809852600098,"y":2523.6043298244476,"z":"ad46ffb1.59044","wires":[["65f00856.6009c8","63c03f51.fc305"]]},{"id":"53108b40.4bfeb4","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1186.4285316467285,"y":2578.60439658165,"z":"ad46ffb1.59044","wires":[["60989e30.be117"]]},{"id":"60989e30.be117","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1350.714241027832,"y":2577.1758782863617,"z":"ad46ffb1.59044","wires":[["92a79ef5.fa3e","63c03f51.fc305"]]},{"id":"92a79ef5.fa3e","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"No network information returned from AAI: network-name-fromNetwork-role\" />\n","comments":"","outputs":1,"x":1549.618968963623,"y":2575.223513364792,"z":"ad46ffb1.59044","wires":[[]]},{"id":"30c54a00.afa5d6","type":"comment","name":"walk through the data returned from A&AI","info":"","comments":"","x":212.3333854675293,"y":3317.4135043621063,"z":"ad46ffb1.59044","wires":[]},{"id":"c1689047.89198","type":"for","name":"for each src network","xml":"<for index='src-nw-idx' start='0' end='`$tmp.AnAI-data.src-network.results_length`' >\n","comments":"","outputs":1,"x":443.0000648498535,"y":3169.4611241817474,"z":"ad46ffb1.59044","wires":[["2cd007ca.1929a8"]]},{"id":"2cd007ca.1929a8","type":"switchNode","name":"switch network-name","xml":"<switch test='`$tmp.AnAI-data.src-network.results[$src-nw-idx].l3-network.network-name`'>\n","comments":"","outputs":1,"x":671.3334274291992,"y":3166.12770819664,"z":"ad46ffb1.59044","wires":[["d7919be.53eda68","c29693c7.fb429"]]},{"id":"d7919be.53eda68","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":856.3333625793457,"y":3139.461038351059,"z":"ad46ffb1.59044","wires":[["362c8304.4cbdfc"]]},{"id":"c29693c7.fb429","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":856.3332939147949,"y":3190.8897111415863,"z":"ad46ffb1.59044","wires":[["a4a87364.b0d06"]]},{"id":"362c8304.4cbdfc","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1018.0000267028809,"y":3140.1753146648407,"z":"ad46ffb1.59044","wires":[[]]},{"id":"a4a87364.b0d06","type":"switchNode","name":"switch tmp.src-network-name","xml":"<switch test='`$tmp.src-network-name`'>\n","comments":"","outputs":1,"x":1061.3334617614746,"y":3189.46128821373,"z":"ad46ffb1.59044","wires":[["605de0a1.ea25b","1fd130aa.f375ff"]]},{"id":"605de0a1.ea25b","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1267.9999885559082,"y":3162.794290304184,"z":"ad46ffb1.59044","wires":[["9fdf6659.2008e8"]]},{"id":"1fd130aa.f375ff","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1267.9999198913574,"y":3214.2229630947113,"z":"ad46ffb1.59044","wires":[["ae6d4e1c.b688b"]]},{"id":"ae6d4e1c.b688b","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1426.3333625793457,"y":3212.794290304184,"z":"ad46ffb1.59044","wires":[["8adf8a07.c692b8","63c03f51.fc305"]]},{"id":"8adf8a07.c692b8","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"`'More than one l3-network returned from AAI for network-role ' + $tmp.src-network-role`\" />\n","comments":"","outputs":1,"x":1628.5715026855469,"y":3210.841985464096,"z":"ad46ffb1.59044","wires":[[]]},{"id":"625b85e.683ee7c","type":"for","name":"for each dest network","xml":"<for index='dest-nw-idx' start='0' end='`$tmp.AnAI-data.dest-network.results_length`' >\n","comments":"","outputs":1,"x":1014.3333587646484,"y":3317.461047887802,"z":"ad46ffb1.59044","wires":[["f3dfbef3.6ed35"]]},{"id":"f3dfbef3.6ed35","type":"switchNode","name":"switch network-name","xml":"<switch test='`$tmp.AnAI-data.dest-network.results[$dest-nw-idx].l3-network.network-name`'>\n","comments":"","outputs":1,"x":1242.6667213439941,"y":3314.1276319026947,"z":"ad46ffb1.59044","wires":[["678c96f2.cc4388","ec3b96ff.47f7a8"]]},{"id":"678c96f2.cc4388","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1427.6666564941406,"y":3287.4609620571136,"z":"ad46ffb1.59044","wires":[["587cf5c6.ba63ec"]]},{"id":"ec3b96ff.47f7a8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1427.6665878295898,"y":3338.889634847641,"z":"ad46ffb1.59044","wires":[["9c35b414.e31698"]]},{"id":"587cf5c6.ba63ec","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1589.3333206176758,"y":3288.1752383708954,"z":"ad46ffb1.59044","wires":[[]]},{"id":"9c35b414.e31698","type":"switchNode","name":"switch tmp.dest-network-name","xml":"<switch test='`$tmp.dest-network-name`'>\n","comments":"","outputs":1,"x":1632.6667556762695,"y":3337.4612119197845,"z":"ad46ffb1.59044","wires":[["aba201a4.051ba","7a095d13.048ae4"]]},{"id":"aba201a4.051ba","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1839.3332824707031,"y":3310.7942140102386,"z":"ad46ffb1.59044","wires":[["9d76aa87.81e4e8"]]},{"id":"7a095d13.048ae4","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1839.3332138061523,"y":3362.222886800766,"z":"ad46ffb1.59044","wires":[["2a5e35ab.cdec4a"]]},{"id":"2a5e35ab.cdec4a","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1997.6666564941406,"y":3360.7942140102386,"z":"ad46ffb1.59044","wires":[["8bfc73ed.fc9f","63c03f51.fc305"]]},{"id":"8bfc73ed.fc9f","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"`'More than one l3-network returned from AAI for network-role ' + $tmp.dest-network-role`\" />\n","comments":"","outputs":1,"x":2199.904796600342,"y":3358.8419091701508,"z":"ad46ffb1.59044","wires":[[]]},{"id":"43220e3c.7f04b","type":"comment","name":"determine src and dest network names","info":"","comments":"","x":536.3333778381348,"y":3122.794374227524,"z":"ad46ffb1.59044","wires":[]},{"id":"d3bec9cf.937968","type":"switchNode","name":"switch tmp.src-network-name","xml":"<switch test='`$tmp.src-network-name`'>\n","comments":"","outputs":1,"x":468.6666717529297,"y":3249.461126089096,"z":"ad46ffb1.59044","wires":[["abaf7b95.e9d2a8"]]},{"id":"abaf7b95.e9d2a8","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":677.0000190734863,"y":3248.7944705486298,"z":"ad46ffb1.59044","wires":[["6e9098e0.3b0088"]]},{"id":"6e9098e0.3b0088","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":830.3333282470703,"y":3248.127874135971,"z":"ad46ffb1.59044","wires":[["4f6fc74.a7c5038","63c03f51.fc305"]]},{"id":"4f6fc74.a7c5038","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Cannot determine source network name from AAI data\" />\n","comments":"","outputs":1,"x":1021.9999542236328,"y":3247.794378042221,"z":"ad46ffb1.59044","wires":[[]]},{"id":"6e2daa52.cd5594","type":"switchNode","name":"switch tmp.dest-network-name","xml":"<switch test='`$tmp.dest-network-name`'>\n","comments":"","outputs":1,"x":1038.0000381469727,"y":3423.1277639865875,"z":"ad46ffb1.59044","wires":[["4c56824a.8a235c"]]},{"id":"4c56824a.8a235c","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1246.3333854675293,"y":3421.461108446121,"z":"ad46ffb1.59044","wires":[["8d7d1967.e0a578"]]},{"id":"8d7d1967.e0a578","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1399.6666946411133,"y":3419.7945120334625,"z":"ad46ffb1.59044","wires":[["fde3a27f.3918f","63c03f51.fc305"]]},{"id":"fde3a27f.3918f","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Cannot determine dest network name from AAI data\" />\n","comments":"","outputs":1,"x":1591.3333206176758,"y":3416.4610159397125,"z":"ad46ffb1.59044","wires":[[]]},{"id":"b40e2769.9b66e8","type":"for","name":"for each returned result","xml":"<for index='result-idx' start='0' end='`$tmp.AnAI-data.vnf.results_length`' >\n","comments":"","outputs":1,"x":452.0000457763672,"y":1553.294564962387,"z":"ad46ffb1.59044","wires":[["ccbe45ed.d09b58"]]},{"id":"ccbe45ed.d09b58","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":660.3333435058594,"y":1553.294564962387,"z":"ad46ffb1.59044","wires":[["a5ce191e.435038","78aa9e8c.548e","524fa73b.dde868","4dee36e.58e6bc8","7f533d3d.edc374"]]},{"id":"a5ce191e.435038","type":"switchNode","name":"switch tenant-name","xml":"<switch test='`$tmp.AnAI-data.vnf.results[$result-idx].tenant.tenant-name`'>\n","comments":"","outputs":1,"x":893.6667098999023,"y":1383.294781446457,"z":"ad46ffb1.59044","wires":[["98836081.83ee2","49da7d2e.a5da44"]]},{"id":"98836081.83ee2","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1093.6666145324707,"y":1364.961406469345,"z":"ad46ffb1.59044","wires":[["c542e7ec.b41f78"]]},{"id":"49da7d2e.a5da44","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1091.999885559082,"y":1404.72345328331,"z":"ad46ffb1.59044","wires":[["7963162e.49a188"]]},{"id":"c542e7ec.b41f78","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1235.333288192749,"y":1364.9614474773407,"z":"ad46ffb1.59044","wires":[[]]},{"id":"7963162e.49a188","type":"set","name":"set tmp.tenant from tenant-name","xml":"<set>\n<parameter name='tmp.tenant' value='`$tmp.AnAI-data.vnf.results[$result-idx].tenant.tenant-name`' />\n","comments":"","x":1315.333366394043,"y":1404.961490392685,"z":"ad46ffb1.59044","wires":[]},{"id":"78aa9e8c.548e","type":"switchNode","name":"switch cloud-owner","xml":"<switch test='`$tmp.AnAI-data.vnf.results[$result-idx].cloud-region.cloud-owner`'>\n","comments":"","outputs":1,"x":887.0002746582031,"y":1628.2948701381683,"z":"ad46ffb1.59044","wires":[["71f1efb2.58789","a0f74502.c40b78"]]},{"id":"71f1efb2.58789","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1087.0001792907715,"y":1609.9614951610565,"z":"ad46ffb1.59044","wires":[["51b8c84b.a15a58"]]},{"id":"a0f74502.c40b78","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1085.3334503173828,"y":1649.7235419750214,"z":"ad46ffb1.59044","wires":[["c5078c32.1a81b"]]},{"id":"51b8c84b.a15a58","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1228.6668529510498,"y":1609.9615361690521,"z":"ad46ffb1.59044","wires":[[]]},{"id":"c5078c32.1a81b","type":"set","name":"set tmp.cloud-owner","xml":"<set>\n<parameter name='tmp.cloud-owner' value='`$tmp.AnAI-data.vnf.results[$result-idx].cloud-region.cloud-owner`' />\n","comments":"","x":1265.3336791992188,"y":1653.2949311733246,"z":"ad46ffb1.59044","wires":[]},{"id":"524fa73b.dde868","type":"switchNode","name":"switch cloud-region-id","xml":"<switch test='`$tmp.AnAI-data.vnf.results[$result-idx].cloud-region.cloud-region-id`'>\n","comments":"","outputs":1,"x":895.3336181640625,"y":1716.6279618740082,"z":"ad46ffb1.59044","wires":[["4cd41d77.62d1d4","fd25effc.e7aca"]]},{"id":"4cd41d77.62d1d4","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1087.000186920166,"y":1696.6279199123383,"z":"ad46ffb1.59044","wires":[["99f0220c.25b96"]]},{"id":"fd25effc.e7aca","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1085.3334579467773,"y":1736.389966726303,"z":"ad46ffb1.59044","wires":[["fa8958ae.e93378"]]},{"id":"99f0220c.25b96","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1228.6668605804443,"y":1696.6279609203339,"z":"ad46ffb1.59044","wires":[[]]},{"id":"fa8958ae.e93378","type":"set","name":"set tmp.cloud-region-id","xml":"<set>\n<parameter name='tmp.cloud-region-id' value='`$tmp.AnAI-data.vnf.results[$result-idx].cloud-region.cloud-region-id`' />\n","comments":"","x":1275.3335418701172,"y":1736.627985715866,"z":"ad46ffb1.59044","wires":[]},{"id":"e53b0107.99046","type":"switchNode","name":"switch tmp.tenant","xml":"<switch test='`$tmp.tenant`'>\n","comments":"","outputs":1,"x":440.0000686645508,"y":1781.9614572525024,"z":"ad46ffb1.59044","wires":[["871be54d.651f78"]]},{"id":"871be54d.651f78","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":675.0000330607099,"y":1778.627943356832,"z":"ad46ffb1.59044","wires":[["9e59cffc.17c17"]]},{"id":"9e59cffc.17c17","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":833.3333460489912,"y":1778.627943356832,"z":"ad46ffb1.59044","wires":[["2fae4fcd.563b7","63c03f51.fc305"]]},{"id":"2fae4fcd.563b7","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to retrieve source tenant from AAI\" />\n","comments":"","outputs":1,"x":1033.9048067728681,"y":1778.3422644933066,"z":"ad46ffb1.59044","wires":[[]]},{"id":"53a52a6c.d1cd64","type":"switchNode","name":"switch tmp.cloud-region-id","xml":"<switch test='`$tmp.cloud-region-id`'>\n","comments":"","outputs":1,"x":466.00001525878906,"y":1876.9612882137299,"z":"ad46ffb1.59044","wires":[["7e86423b.eb811c"]]},{"id":"7e86423b.eb811c","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":672.6666361490888,"y":1876.961163600286,"z":"ad46ffb1.59044","wires":[["82a1ad5f.91c0a"]]},{"id":"82a1ad5f.91c0a","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":830.9999491373701,"y":1876.961163600286,"z":"ad46ffb1.59044","wires":[["da9fb459.35a968","63c03f51.fc305"]]},{"id":"da9fb459.35a968","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to retrieve tenant from AAI\" />\n","comments":"","outputs":1,"x":1031.571409861247,"y":1876.6754847367606,"z":"ad46ffb1.59044","wires":[[]]},{"id":"1bbc7787.e7f1b8","type":"switchNode","name":"switch tmp.cloud-owner","xml":"<switch test='`$tmp.cloud-owner`'>\n","comments":"","outputs":1,"x":458,"y":1921.9612500667572,"z":"ad46ffb1.59044","wires":[["6d6681d5.c0eda"]]},{"id":"6d6681d5.c0eda","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":674.6666361490888,"y":1923.6277895768485,"z":"ad46ffb1.59044","wires":[["752bd23f.167a0c"]]},{"id":"752bd23f.167a0c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":832.9999491373701,"y":1923.6277895768485,"z":"ad46ffb1.59044","wires":[["9eae290b.710ba8","63c03f51.fc305"]]},{"id":"9eae290b.710ba8","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to retrieve tenant from AAI\" />\n","comments":"","outputs":1,"x":1033.571409861247,"y":1923.342110713323,"z":"ad46ffb1.59044","wires":[[]]},{"id":"6aa8217a.be7a8","type":"call","name":"call api-contrail-route-topology-operation-create","xml":"<call module='GENERIC-RESOURCE-API' rpc='api-contrail-route-topology-operation-create' mode='sync' >\n\n","comments":"","outputs":1,"x":1091.3572235107422,"y":3827.5327785015106,"z":"ad46ffb1.59044","wires":[["45726510.62287c"]]},{"id":"45726510.62287c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1362.5477600097656,"y":3826.103891134262,"z":"ad46ffb1.59044","wires":[["db838c10.6d034"]]},{"id":"cf530372.3cdf2","type":"set","name":"set parameters","xml":"<set>\n<parameter name='cto-api.parent-service-instance-id' value='`$tmp.service-instance-id`' />\n<parameter name='cto-api.port-mirror-configuration-instance-id' value='`$tmp.configuration-id`' />\n<parameter name='cto-api.source-network-role' value='`$tmp.src-network-role`' />\n<parameter name='cto-api.collector-network-role' value='`$tmp.dest-network-role`' />\n<parameter name='cto-api.default-domain' value='default-domain' />\n<parameter name='cto-api.default-project' value='`$tmp.tenant`' />\n<parameter name='cto-api.cloud-region-id' value='`$tmp.cloud-region-id`' />\n<parameter name='cto-api.cloud-owner' value='`$tmp.cloud-owner`' />\n<parameter name='cto-api.service-type' value='`$port-mirror-topology-operation-input.service-information.subscription-service-type`' />\n<parameter name='cto-api.owning-entity' value='`$tmp.owning-entity`' />\n","comments":"","x":993.6905212402344,"y":3780.866028547287,"z":"ad46ffb1.59044","wires":[]},{"id":"2b7916ba.345d0a","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":734.3333841959634,"y":1103.9613708655038,"z":"ad46ffb1.59044","wires":[["e03fa6c8.93c8e8"]]},{"id":"e03fa6c8.93c8e8","type":"set","name":"set tmp.owning-entity","xml":"<set>\n<parameter name='tmp.owning-entity' value='`$tmp.AnAI-data.oe.results[0].owning-entity.owning-entity-id`' />\n","comments":"","x":922.6666717529297,"y":1102.2947480678558,"z":"ad46ffb1.59044","wires":[]},{"id":"6aa6e65.77d1a18","type":"switchNode","name":"switch tmp.owning-entity","xml":"<switch test='`$tmp.owning-entity`'>\n","comments":"","outputs":1,"x":460.66676330566406,"y":1143.9613778591156,"z":"ad46ffb1.59044","wires":[["a1f43b.6baa9bc8"]]},{"id":"a1f43b.6baa9bc8","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":697.3334376017256,"y":1150.627945025762,"z":"ad46ffb1.59044","wires":[["89c6a8e0.6ffd88"]]},{"id":"89c6a8e0.6ffd88","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":862.3333803812666,"y":1150.6278639634452,"z":"ad46ffb1.59044","wires":[["6cf20a3f.e1e824","63c03f51.fc305"]]},{"id":"6cf20a3f.e1e824","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to retrieve owning-entity from AAI\" />\n","comments":"","outputs":1,"x":1059.5715071360273,"y":1148.6754713853202,"z":"ad46ffb1.59044","wires":[[]]},{"id":"333d39df.29c386","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1049.0000305175781,"y":4139.832871198654,"z":"ad46ffb1.59044","wires":[["92eadb34.b09bc8"]]},{"id":"2899e13d.c0f5ae","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1057.571460723877,"y":4184.118584394455,"z":"ad46ffb1.59044","wires":[["92eadb34.b09bc8"]]},{"id":"6e6309e.a9b13f8","type":"for","name":"for each mapped source port","xml":"<for index='src-idx' start='0' end='`$pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-to-dest-maps.source-to-dest-map_length`' >\n","comments":"","outputs":1,"x":464.16675186157227,"y":4325.86591219902,"z":"ad46ffb1.59044","wires":[["d1f3d5d3.3b9cf8"]]},{"id":"d1f3d5d3.3b9cf8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":687.5000801086426,"y":4327.532335996628,"z":"ad46ffb1.59044","wires":[["a717ffcc.3b10e","9f479696.018ee8","c0c9e1a0.c1dd8","a249b3c4.30176","dbd95e4a.02811"]]},{"id":"a249b3c4.30176","type":"save","name":"save logical-link","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"logical-link\" \n\tkey=\"logical-link.link-name = $tmp.link-name\" >\n<parameter name=\"link-name\" value=\"`$tmp.link-name`\" />\n<parameter name=\"in-maint\" value=\"false\" />\n<parameter name=\"link-type\" value=\"port-mirror-configuration\" />\n","comments":"","outputs":1,"x":884.1666946411133,"y":4158.961284399033,"z":"ad46ffb1.59044","wires":[["333d39df.29c386","2899e13d.c0f5ae"]]},{"id":"a717ffcc.3b10e","type":"set","name":"set tmp.link-name","xml":"<set>\n<parameter name='tmp.link-name' value=\"`'PMC_' + $tmp.configuration-id\n  + '_Source' + $pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-to-dest-maps.source-to-dest-map[$src-idx].source-port-name\n  + '_Dest' + $pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-to-dest-maps.source-to-dest-map[$src-idx].dest-port-name`\" />\n","comments":"","x":887.5001068115234,"y":4047.293805837631,"z":"ad46ffb1.59044","wires":[]},{"id":"a5acd743.ffb818","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"`'Failed to create logical link ' + $tmp.link-name\n  + ' in AAI'`\" />\n","comments":"","outputs":1,"x":1405.8334426879883,"y":4153.961203336716,"z":"ad46ffb1.59044","wires":[[]]},{"id":"92eadb34.b09bc8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1217.5000534057617,"y":4153.96112704277,"z":"ad46ffb1.59044","wires":[["a5acd743.ffb818","ade54b7b.1c2f78"]]},{"id":"ade54b7b.1c2f78","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":1886.952075958252,"y":5729.55632185936,"z":"ad46ffb1.59044","wires":[["4014d89b.66e348","8ab7174a.76f6c8","4877f4d7.9e8e3c","db838c10.6d034"]]},{"id":"f5553e43.be0e4","type":"comment","name":"rollback network policy","info":"","comments":"","x":2192.666328430176,"y":5643.365671873093,"z":"ad46ffb1.59044","wires":[]},{"id":"8753137e.a72be","type":"save","name":"save vprobe logical-link relationships","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"logical-link:relationship-list\"\n   key=\"logical-link.link-name = $tmp.link-name\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"l-interface\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-label\" value=\"org.onap.relationships.inventory.Source\" />\n    <parameter name=\"relationship-list.relationship[0].related-link\"\n      value=\"`'/aai/v$/cloud-infrastructure/cloud-regions/cloud-region/'\n        + $tmp.cloud-owner + '/' + $tmp.cloud-region-id + '/tenants/tenant/'\n        + $tmp.tenant-id + '/vservers/vserver/' \n        + $pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-to-dest-maps.source-to-dest-map[$src-idx].source-vserver-id\n        + '/l-interfaces/l-interface/'\n        + $tmp.encoded-source-port-name`\" />\n    <parameter name=\"relationship-list.relationship[1].related-to\" value=\"l-interface\" />\n    <parameter name=\"relationship-list.relationship[1].relationship-label\" value=\"org.onap.relationships.inventory.Destination\" />\n    <parameter name=\"relationship-list.relationship[1].related-link\"\n      value=\"`'/aai/v$/cloud-infrastructure/cloud-regions/cloud-region/'\n        + $tmp.cloud-owner + '/' + $tmp.cloud-region-id + '/tenants/tenant/'\n        + $tmp.dest-tenant-id + '/vservers/vserver/' \n        + $pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-to-dest-maps.source-to-dest-map[$src-idx].dest-vserver-id\n        + '/l-interfaces/l-interface/'\n        + $tmp.encoded-dest-port-name`\" />\n","comments":"","outputs":1,"x":1626.3094787597656,"y":4375.86571764946,"z":"ad46ffb1.59044","wires":[["aca151d2.78cad","dbe217c5.2519a8"]]},{"id":"aca151d2.78cad","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1905.5952415466309,"y":4375.627018690109,"z":"ad46ffb1.59044","wires":[["81fec963.f0c378"]]},{"id":"60444368.d2d1cc","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"`'Failed creating relationships for logical link ' + $tmp.link-name\n  + ' in AAI'`\" />\n","comments":"","outputs":1,"x":2267.4285621643066,"y":4396.422187566757,"z":"ad46ffb1.59044","wires":[[]]},{"id":"81fec963.f0c378","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2070.761848449707,"y":4396.421943426132,"z":"ad46ffb1.59044","wires":[["60444368.d2d1cc","b9471f80.beb4f"]]},{"id":"60456976.e6ca48","type":"comment","name":"delete logical links","info":"","comments":"","x":2184.3328399658203,"y":5493.365961790085,"z":"ad46ffb1.59044","wires":[]},{"id":"302fb759.f86fc8","type":"for","name":"for each mapped source port","xml":"<for index='src-idx' start='0' end='`$pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-to-dest-maps.source-to-dest-map_length`' >\n","comments":"","outputs":1,"x":2173.856689453125,"y":5537.88894534111,"z":"ad46ffb1.59044","wires":[["cdbe21d2.0c705"]]},{"id":"cdbe21d2.0c705","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":2397.1900177001953,"y":5539.555369138718,"z":"ad46ffb1.59044","wires":[["89353571.082fa8","fff62f5.45f62d"]]},{"id":"fff62f5.45f62d","type":"save","name":"delete logical-link","xml":"<delete plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"logical-link\" \n\tkey=\"logical-link.link-name = $tmp.link-name\" >\n","comments":"","outputs":1,"x":2578.6187286376953,"y":5566.222370862961,"z":"ad46ffb1.59044","wires":[[]]},{"id":"89353571.082fa8","type":"set","name":"set tmp.link-name","xml":"<set>\n<parameter name='tmp.link-name' value=\"`'PMC_' + $tmp.configuration-id\n  + '_Source' + $pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-to-dest-maps.source-to-dest-map[$src-idx].source-port-name\n  + '_Dest' + $pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-to-dest-maps.source-to-dest-map[$src-idx].dest-port-name`\" />\n","comments":"","x":2582.1901092529297,"y":5514.555414915085,"z":"ad46ffb1.59044","wires":[]},{"id":"b9471f80.beb4f","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":1945.9996948242188,"y":5540.032742261887,"z":"ad46ffb1.59044","wires":[["302fb759.f86fc8","ade54b7b.1c2f78"]]},{"id":"72ac5c76.c8ab14","type":"configure","name":"send success to MSO","xml":"<configure activate=\"true\" adaptor=\"com.att.sdnctl.sli.adaptor.mso.MSOAdaptor\" key=\"__READ_FROM_PARAMETERS__\">\n<parameter name=\"notification-url\" value=\"`$port-mirror-topology-operation-input.sdnc-request-header.svc-notification-url`\" />\n<parameter name=\"input.ack-final-indicator\" value=\"Y\" />\n<parameter name=\"input.response-code\" value=\"200\" />\n<parameter name=\"input.svc-request-id\" value=\"`$port-mirror-topology-operation-input.sdnc-request-header.svc-request-id`\" />\n<parameter name=\"input.service-information.service-type\" value=\"`$port-mirror-topology-operation-input.service-information.subscription-service-type`\" />\n<parameter name=\"input.service-information.service-instance-id\" value=\"`$port-mirror-topology-operation-input.service-information.service-instance-id`\" />\n","comments":"","outputs":1,"x":433.3095016479492,"y":5402.223337888718,"z":"ad46ffb1.59044","wires":[[]]},{"id":"4dee36e.58e6bc8","type":"switchNode","name":"switch tenant-id","xml":"<switch test='`$tmp.AnAI-data.vnf.results[$result-idx].tenant.tenant-id`'>\n","comments":"","outputs":1,"x":886.9999923706055,"y":1466.6281173229218,"z":"ad46ffb1.59044","wires":[["cf05309.dfe44d","9c4d114c.68b9b"]]},{"id":"cf05309.dfe44d","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1086.9998970031738,"y":1448.29474234581,"z":"ad46ffb1.59044","wires":[["b95b05a3.f39c58"]]},{"id":"9c4d114c.68b9b","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1085.3331680297852,"y":1488.0567891597748,"z":"ad46ffb1.59044","wires":[["b197215.06e19e"]]},{"id":"b95b05a3.f39c58","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1228.6665706634521,"y":1448.2947833538055,"z":"ad46ffb1.59044","wires":[[]]},{"id":"b197215.06e19e","type":"set","name":"set tmp.tenant-id from tenant-id","xml":"<set>\n<parameter name='tmp.tenant-id' value='`$tmp.AnAI-data.vnf.results[$result-idx].tenant.tenant-id`' />\n","comments":"","x":1308.666648864746,"y":1488.2948262691498,"z":"ad46ffb1.59044","wires":[]},{"id":"9f479696.018ee8","type":"save","name":"save configuration relationship to logical-link","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"configuration:relationship-list\"\n   key=\"configuration.configuration-id = $tmp.configuration-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"logical-link\" />\n    <parameter name=\"relationship-list.relationship[0].related-link\"\n      value=\"`'/aai/v$/network/logical-links/logical-link/' + $tmp.encoded-link-name`\" />\n","comments":"","outputs":1,"x":962.9286804199219,"y":4532.532779455185,"z":"ad46ffb1.59044","wires":[["790263b6.af947c","47af693f.8cd828"]]},{"id":"790263b6.af947c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1225.8333625793457,"y":4509.675470352173,"z":"ad46ffb1.59044","wires":[["bbdabb63.782468"]]},{"id":"e22d9d06.89265","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"`'Failed creating logical-link relationship for configuration ' + $tmp.configuration-id\n  + ' in AAI'`\" />\n","comments":"","outputs":1,"x":1598.6191215515137,"y":4530.23245215416,"z":"ad46ffb1.59044","wires":[[]]},{"id":"bbdabb63.782468","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1401.952407836914,"y":4530.232208013535,"z":"ad46ffb1.59044","wires":[["e22d9d06.89265","b9471f80.beb4f"]]},{"id":"76baa0fa.2967c","type":"save","name":"save configuration relationship to allotted-resource","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"configuration:relationship-list\"\n   key=\"configuration.configuration-id = $tmp.configuration-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"allotted-resource\" />\n    <parameter name=\"relationship-list.relationship[0].related-link\"\n      value=\"`'/aai/v$/business/customers/customer/' + $service-data.service-information.global-customer-id\n      + '/service-subscriptions/service-subscription/' + $port-mirror-topology-operation-input.service-information.subscription-service-type\n      + '/service-instances/service-instance/' + $tmp.service-instance-id\n\t  + '/allotted-resources/allotted-resource/' + $cto-api.contrail-route-allotted-instance-id`\" />\n","comments":"","outputs":1,"x":957.8332977294922,"y":4801.508413076401,"z":"ad46ffb1.59044","wires":[["fbb7f484.ef58f8"]]},{"id":"fbb7f484.ef58f8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1217.595142364502,"y":4801.508203268051,"z":"ad46ffb1.59044","wires":[["d530397.7d127c8"]]},{"id":"fa746551.40b958","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"`'Failed creating logical-link relationship for configuration ' + $tmp.configuration-id\n  + ' in AAI'`\" />\n","comments":"","outputs":1,"x":1586.0951538085938,"y":4800.63653922081,"z":"ad46ffb1.59044","wires":[[]]},{"id":"d530397.7d127c8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1389.4284400939941,"y":4800.636295080185,"z":"ad46ffb1.59044","wires":[["fa746551.40b958","b9471f80.beb4f"]]},{"id":"c31b80a8.b4288","type":"set","name":"set allotted-resource-id","xml":"<set>\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.route-allotted-resource-id'\n  value='`$cto-api.contrail-route-allotted-instance-id`' />\n","comments":"","x":1017.0238265991211,"y":3879.199120283127,"z":"ad46ffb1.59044","wires":[]},{"id":"d3793fdc.0a2ff","type":"switchNode","name":"switch configuration-id = input configuration-id","xml":"<switch test='`$service-data.vnfc-instance-groups.vnfc-instance-group[$vnfc-idx].configuration-id == $tmp.configuration-id`'>\n","comments":"","outputs":1,"x":2627.3808822631836,"y":709.1279284954071,"z":"ad46ffb1.59044","wires":[["f850adb4.3d4cc"]]},{"id":"f850adb4.3d4cc","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2894.047882080078,"y":709.1279418468475,"z":"ad46ffb1.59044","wires":[["ad263b73.9e1128"]]},{"id":"e1f68e84.fcd0a","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2891.905387878418,"y":809.84219622612,"z":"ad46ffb1.59044","wires":[["a08aecf8.1164d"]]},{"id":"8ab7174a.76f6c8","type":"call","name":"call api-contrail-route-topology-operation-delete","xml":"<call module='GENERIC-RESOURCE-API' rpc='api-contrail-route-topology-operation-delete' mode='sync' >\n\n","comments":"","outputs":1,"x":2158.49991607666,"y":5728.604483366013,"z":"ad46ffb1.59044","wires":[[]]},{"id":"4014d89b.66e348","type":"set","name":"set parameters","xml":"<set>\n<parameter name='cto-api.default-domain' value='default-domain' />\n<parameter name='cto-api.default-project' value='`$tmp.tenant`' />\n<parameter name='cto-api.cloud-region-id' value='`$tmp.cloud-region-id`' />\n<parameter name='cto-api.configuration-id' value='`$tmp.configuration-id`' />\n<parameter name='cto-api.rollback-flag' value='true' />\n<parameter name='tmp.saved-error-message' value='`$error-message`' />\n","comments":"","x":2061.3569564819336,"y":5682.17448592186,"z":"ad46ffb1.59044","wires":[]},{"id":"4877f4d7.9e8e3c","type":"set","name":"set error-message","xml":"<set>\n<parameter name='error-message' value='`$tmp.saved-error-message`' />\n","comments":"","x":2069.3329849243164,"y":5776.223969221115,"z":"ad46ffb1.59044","wires":[]},{"id":"c21bf8.eab03408","type":"switchNode","name":"switch configuration-id = input configuration-id","xml":"<switch test='`$service-data.vnfc-instance-groups.vnfc-instance-group[$vnfc-idx].configuration-id == $tmp.configuration-id`'>\n","comments":"","outputs":1,"x":2619.0476837158203,"y":809.1279685497284,"z":"ad46ffb1.59044","wires":[["e1f68e84.fcd0a"]]},{"id":"cfce73db.444a","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1305.0000610351562,"y":764.1279561519623,"z":"ad46ffb1.59044","wires":[["5497462d.218008","d391bbf3.6fb278"]]},{"id":"d391bbf3.6fb278","type":"switchNode","name":"switch instance-group-role == dest network role","xml":"<switch test=\"`$service-data.vnfc-instance-groups.vnfc-instance-group[$vnfc-idx].instance-group-role == $tmp.dest-network-role`\">\n","comments":"","outputs":1,"x":1585.000144958496,"y":812.4613530635834,"z":"ad46ffb1.59044","wires":[["ae1da850.aa5c38"]]},{"id":"ae1da850.aa5c38","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1845.0000839233398,"y":810.7946927547455,"z":"ad46ffb1.59044","wires":[["826084d1.080b38"]]},{"id":"ef26b095.af478","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":926.6667404174805,"y":625.7469708919525,"z":"ad46ffb1.59044","wires":[["366c2bd1.d0f054","e2a4a4ac.7745d8"]]},{"id":"366c2bd1.d0f054","type":"outcome","name":"vprobe","xml":"<outcome value='vprobe'>\n","comments":"","outputs":1,"x":1133.3333358764648,"y":597.4137017726898,"z":"ad46ffb1.59044","wires":[["4e1f1d25.97bcc4"]]},{"id":"e2a4a4ac.7745d8","type":"outcome","name":"pprobe","xml":"<outcome value='pprobe'>\n","comments":"","outputs":1,"x":1131.6665077209473,"y":650.7469975948334,"z":"ad46ffb1.59044","wires":[["fdd5e4da.854ea8"]]},{"id":"fdd5e4da.854ea8","type":"set","name":"set src vnfc-instance-group indexes to 0","xml":"<set>\n<parameter name='tmp.src-vnfc-idx' value='0' />\n","comments":"","x":1380.000015258789,"y":650.7469937801361,"z":"ad46ffb1.59044","wires":[]},{"id":"3f2e31c8.06f08e","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":1090.3333740234375,"y":898.0803582668304,"z":"ad46ffb1.59044","wires":[["46551bfb.574f74","3d428c98.dd8054"]]},{"id":"46551bfb.574f74","type":"outcome","name":"vprobe","xml":"<outcome value='vprobe'>\n","comments":"","outputs":1,"x":1296.9999694824219,"y":869.7470891475677,"z":"ad46ffb1.59044","wires":[["f9f6a40c.995e38"]]},{"id":"3d428c98.dd8054","type":"outcome","name":"pprobe","xml":"<outcome value='pprobe'>\n","comments":"","outputs":1,"x":1295.333137512207,"y":928.0803475379944,"z":"ad46ffb1.59044","wires":[["74f9ecf9.aaa254"]]},{"id":"74f9ecf9.aaa254","type":"set","name":"set src vnfc-instance-group index","xml":"<set>\n<parameter name='tmp.src-vnfc-idx' value='`$service-data.vnfc-instance-groups.vnfc-instance-group_length`' />\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group_length' value='`$service-data.vnfc-instance-groups.vnfc-instance-group_length + 1`'/>\n","comments":"","x":1520.3333740234375,"y":922.0803582668304,"z":"ad46ffb1.59044","wires":[]},{"id":"ba91d904.ffefc8","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":481.33335876464844,"y":2562.080483198166,"z":"ad46ffb1.59044","wires":[["a7a79641.236e88"]]},{"id":"a7a79641.236e88","type":"outcome","name":"vprobe","xml":"<outcome value='vprobe'>\n","comments":"","outputs":1,"x":679.3333587646484,"y":2562.080483198166,"z":"ad46ffb1.59044","wires":[["bccb28e8.16a9b8"]]},{"id":"7ee1327.81d79cc","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":480.3333282470703,"y":2781.413825750351,"z":"ad46ffb1.59044","wires":[["c029ac7.4e95f5"]]},{"id":"c029ac7.4e95f5","type":"outcome","name":"vprobe","xml":"<outcome value='vprobe'>\n","comments":"","outputs":1,"x":678.3333282470703,"y":2781.413825750351,"z":"ad46ffb1.59044","wires":[["3f4d2f6e.a6f3f"]]},{"id":"b4aa58d9.1a6638","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":475.3333435058594,"y":2917.747165441513,"z":"ad46ffb1.59044","wires":[["779de296.e05f0c","1c0d42a5.c3ea0d"]]},{"id":"779de296.e05f0c","type":"outcome","name":"vprobe","xml":"<outcome value='vprobe'>\n","comments":"","outputs":1,"x":681.9999389648438,"y":2889.4138963222504,"z":"ad46ffb1.59044","wires":[["7b66815b.00988"]]},{"id":"1c0d42a5.c3ea0d","type":"outcome","name":"pprobe","xml":"<outcome value='pprobe'>\n","comments":"","outputs":1,"x":680.3331108093262,"y":2942.747192144394,"z":"ad46ffb1.59044","wires":[["9a90328a.f8f3f"]]},{"id":"9a90328a.f8f3f","type":"set","name":"set vnfc-instance-group data","xml":"<set>\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group[$tmp.src-vnfc-idx].instance-group-role'\n  value='`$tmp.src-network-role`'/>\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group[$tmp.src-vnfc-idx].nfc-naming-code'\n  value='`$tmp.src-nfc-naming-code`'/>\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group[$tmp.src-vnfc-idx].group-type'\n  value='port-mirror-source'/>\n<parameter name='service-data.vnfc-instance-groups.vnfc-instance-group[$tmp.src-vnfc-idx].configuration-id'\n  value='`$tmp.configuration-id`'/>\n","comments":"","x":887.3333435058594,"y":2941.747165441513,"z":"ad46ffb1.59044","wires":[]},{"id":"7c523201.d63ddc","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":470.3333053588867,"y":3056.7470004558563,"z":"ad46ffb1.59044","wires":[["c96eb82f.f93d98","2c14fac4.bb6a36"]]},{"id":"c96eb82f.f93d98","type":"outcome","name":"vprobe","xml":"<outcome value='vprobe'>\n","comments":"","outputs":1,"x":676.9999008178711,"y":3028.4137313365936,"z":"ad46ffb1.59044","wires":[["dda98e98.66fdf"]]},{"id":"2c14fac4.bb6a36","type":"outcome","name":"pprobe","xml":"<outcome value='pprobe'>\n","comments":"","outputs":1,"x":675.3330726623535,"y":3081.747027158737,"z":"ad46ffb1.59044","wires":[["4c1abfdf.199e8"]]},{"id":"4c1abfdf.199e8","type":"set","name":"set assignments high-level data","xml":"<set>\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-vnfc-instance-group-id.nfc-naming-code'\n  value='`$tmp.src-nfc-naming-code`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-vnfc-instance-group-id.instance-group-role'\n  value='`$tmp.src-network-role`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-vnfc-instance-group-id.service-instance-id'\n  value='`$tmp.service-instance-id`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-vnfc-instance-group-id.configuration-id'\n  value='`$tmp.configuration-id`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-vnf-id'\n  value='`$tmp.src-vnf-id`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-capacity'\n  value='`$tmp.src-pps`' />\n\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.dest-pnf-name'\n  value='`$tmp.dest-pnf-name`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.dest-p-interface'\n  value='`$tmp.dest-p-interface`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.dest-pnf-port-policy-name'\n  value='`$db.cap[0].policy-name`' />\n\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.probe-type'\n  value='pprobe' />\n","comments":"","x":886.3332901000977,"y":3080.746999502182,"z":"ad46ffb1.59044","wires":[]},{"id":"6c94d29e.c7544c","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":469.33334732055664,"y":3370.7470166683197,"z":"ad46ffb1.59044","wires":[["1c67b9f0.492966"]]},{"id":"1c67b9f0.492966","type":"outcome","name":"vprobe","xml":"<outcome value='vprobe'>\n","comments":"","outputs":1,"x":667.3333473205566,"y":3370.7470166683197,"z":"ad46ffb1.59044","wires":[["ae6055fe.670a38"]]},{"id":"ae6055fe.670a38","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":811.3333473205566,"y":3370.7470166683197,"z":"ad46ffb1.59044","wires":[["625b85e.683ee7c","6e2daa52.cd5594"]]},{"id":"eef77adb.8474d8","type":"call","name":"call port-mirror-topology-operation-mapping-vprobe","xml":"<call module='GENERIC-RESOURCE-API' rpc='port-mirror-topology-operation-mapping-vprobe' mode='sync' >\n","comments":"","outputs":1,"x":953.9999542236328,"y":3615.0802524089813,"z":"ad46ffb1.59044","wires":[["627e8543.3e36bc"]]},{"id":"627e8543.3e36bc","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1222.333236694336,"y":3635.0804545879364,"z":"ad46ffb1.59044","wires":[["63c03f51.fc305"]]},{"id":"f3bec0f8.38123","type":"call","name":"call port-mirror-topology-operation-create-vnfcs","xml":"<call module='GENERIC-RESOURCE-API' rpc='port-mirror-topology-operation-create-vnfcs' mode='sync' >\n","comments":"","outputs":1,"x":523.6666641235352,"y":3477.4136922359467,"z":"ad46ffb1.59044","wires":[["dfead08.322943"]]},{"id":"dfead08.322943","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":781.6666641235352,"y":3477.4136922359467,"z":"ad46ffb1.59044","wires":[["63c03f51.fc305"]]},{"id":"569bdf72.3da37","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":469.9999237060547,"y":3642.413380384445,"z":"ad46ffb1.59044","wires":[["7741ec73.021014","368bf59f.c05efa"]]},{"id":"7741ec73.021014","type":"outcome","name":"vprobe","xml":"<outcome value='vprobe'>\n","comments":"","outputs":1,"x":682.9999389648438,"y":3615.7467544078827,"z":"ad46ffb1.59044","wires":[["eef77adb.8474d8"]]},{"id":"368bf59f.c05efa","type":"outcome","name":"pprobe","xml":"<outcome value='pprobe'>\n","comments":"","outputs":1,"x":683.6665802001953,"y":3664.079884290695,"z":"ad46ffb1.59044","wires":[["2a760035.fd29a"]]},{"id":"2a760035.fd29a","type":"call","name":"call port-mirror-topology-operation-mapping-pprobe","xml":"<call module='GENERIC-RESOURCE-API' rpc='port-mirror-topology-operation-mapping-pprobe' mode='sync' >\n","comments":"","outputs":1,"x":952.9999389648438,"y":3664.0798423290253,"z":"ad46ffb1.59044","wires":[["627e8543.3e36bc"]]},{"id":"db838c10.6d034","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":1851.1187477111816,"y":5889.080706357956,"z":"ad46ffb1.59044","wires":[["63c03f51.fc305","fc45d5c3.cb8368"]]},{"id":"a420df.c0984f2","type":"call","name":"call port-mirror-rollback-capacity-db","xml":"<call module='GENERIC-RESOURCE-API' rpc='port-mirror-rollback-capacity-db' mode='sync' >\n\n","comments":"","outputs":1,"x":2485.16609954834,"y":5887.413600683212,"z":"ad46ffb1.59044","wires":[[]]},{"id":"36218a22.f604d6","type":"call","name":"call port-mirror-get-policy","xml":"<call module='GENERIC-RESOURCE-API' rpc='port-mirror-get-policy' mode='sync' >\n","comments":"","outputs":1,"x":1113.6902923583984,"y":2369.91375041008,"z":"ad46ffb1.59044","wires":[["8ebef83f.b47318"]]},{"id":"8ebef83f.b47318","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1306.690315246582,"y":2369.91375041008,"z":"ad46ffb1.59044","wires":[["63c03f51.fc305"]]},{"id":"43966c.cbf36994","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":482.0237731933594,"y":2371.5804069042206,"z":"ad46ffb1.59044","wires":[["e3d46d1c.4449f"]]},{"id":"e3d46d1c.4449f","type":"outcome","name":"pprobe","xml":"<outcome value='pprobe'>\n","comments":"","outputs":1,"x":681.6904029846191,"y":2370.913699865341,"z":"ad46ffb1.59044","wires":[["3b89a5ce.4bc88a"]]},{"id":"7f533d3d.edc374","type":"switchNode","name":"switch tenant-context","xml":"<switch test='`$tmp.AnAI-data.vnf.results[$result-idx].tenant.tenant-context`'>\n","comments":"","outputs":1,"x":886.6666030883789,"y":1548.2469975948334,"z":"ad46ffb1.59044","wires":[["87286e2c.30f99","d66314a3.a8eb78"]]},{"id":"87286e2c.30f99","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1086.6665077209473,"y":1529.9136226177216,"z":"ad46ffb1.59044","wires":[["ecc298c.8fc9b68"]]},{"id":"d66314a3.a8eb78","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1084.9997787475586,"y":1569.6756694316864,"z":"ad46ffb1.59044","wires":[["4cf523d9.55ff7c"]]},{"id":"ecc298c.8fc9b68","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1228.3331813812256,"y":1529.9136636257172,"z":"ad46ffb1.59044","wires":[[]]},{"id":"4cf523d9.55ff7c","type":"set","name":"set tmp.tenant-context from tenant-context","xml":"<set>\n<parameter name='tmp.tenant-context' value='`$tmp.AnAI-data.vnf.results[$result-idx].tenant.tenant-context`' />\n","comments":"","x":1338.3332595825195,"y":1569.913804769516,"z":"ad46ffb1.59044","wires":[]},{"id":"b26e3f0d.1d7c8","type":"switchNode","name":"switch tmp.tenant-id","xml":"<switch test='`$tmp.tenant-id`'>\n","comments":"","outputs":1,"x":448.3333206176758,"y":1828.2468166351318,"z":"ad46ffb1.59044","wires":[["f0ddd506.47fa28"]]},{"id":"f0ddd506.47fa28","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":674.9999415079756,"y":1826.5800231297812,"z":"ad46ffb1.59044","wires":[["fceefe81.bdc8e"]]},{"id":"fceefe81.bdc8e","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":833.3332544962568,"y":1826.5800231297812,"z":"ad46ffb1.59044","wires":[["df6b4834.202878","63c03f51.fc305"]]},{"id":"df6b4834.202878","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to retrieve source tenant-id from AAI\" />\n","comments":"","outputs":1,"x":1033.9047152201338,"y":1826.2943442662558,"z":"ad46ffb1.59044","wires":[[]]},{"id":"3b89a5ce.4bc88a","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":831.1904144287109,"y":2370.7468860149384,"z":"ad46ffb1.59044","wires":[["36218a22.f604d6"]]},{"id":"fc45d5c3.cb8368","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":2063.4996643066406,"y":5888.7467267513275,"z":"ad46ffb1.59044","wires":[["4b208ae1.40adb4"]]},{"id":"4b208ae1.40adb4","type":"outcome","name":"vprobe","xml":"<outcome value='vprobe'>\n","comments":"","outputs":1,"x":2261.4996643066406,"y":5888.7467267513275,"z":"ad46ffb1.59044","wires":[["a420df.c0984f2"]]},{"id":"c0c9e1a0.c1dd8","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":918.5715026855469,"y":4324.318286657333,"z":"ad46ffb1.59044","wires":[["336ce22b.42a1ae","ee09a4eb.1fe158"]]},{"id":"336ce22b.42a1ae","type":"outcome","name":"vprobe","xml":"<outcome value='vprobe'>\n","comments":"","outputs":1,"x":1134.4285507202148,"y":4243.365930318832,"z":"ad46ffb1.59044","wires":[["18535f5.1200da1"]]},{"id":"ee09a4eb.1fe158","type":"outcome","name":"pprobe","xml":"<outcome value='pprobe'>\n","comments":"","outputs":1,"x":1135.0952835083008,"y":4395.984510183334,"z":"ad46ffb1.59044","wires":[["6c233b94.0bcdc4"]]},{"id":"c3f6701a.7032f","type":"save","name":"save pprobe logical-link relationships","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"logical-link:relationship-list\"\n   key=\"logical-link.link-name = $tmp.link-name\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"l-interface\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-label\" value=\"org.onap.relationships.inventory.Source\" />\n    <parameter name=\"relationship-list.relationship[0].related-link\"\n      value=\"`'/aai/v$/cloud-infrastructure/cloud-regions/cloud-region/'\n        + $tmp.cloud-owner + '/' + $tmp.cloud-region-id + '/tenants/tenant/'\n        + $tmp.tenant-id + '/vservers/vserver/' \n        + $pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-to-dest-maps.source-to-dest-map[$src-idx].source-vserver-id\n        + '/l-interfaces/l-interface/'\n        + $tmp.encoded-source-port-name`\" />\n    <parameter name=\"relationship-list.relationship[1].related-to\" value=\"l-interface\" />\n    <parameter name=\"relationship-list.relationship[1].relationship-label\" value=\"org.onap.relationships.inventory.Destination\" />\n    <parameter name=\"relationship-list.relationship[1].related-link\"\n      value=\"`'/aai/v$/network/pnfs/pnf/'\n        + $tmp.dest-pnf-name + '/p-interfaces/p-interface/'\n        + $tmp.encoded-dest-p-interface + '/l-interfaces/l-interface/' \n        + $tmp.encoded-dest-port-name`\" />\n","comments":"","outputs":1,"x":1626.9047546386719,"y":4424.556483030319,"z":"ad46ffb1.59044","wires":[["aca151d2.78cad","dbe217c5.2519a8"]]},{"id":"fb861ac2.aeb8b8","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":471.6667175292969,"y":3834.0801408290863,"z":"ad46ffb1.59044","wires":[["ea2b6c9c.21d7f"]]},{"id":"ea2b6c9c.21d7f","type":"outcome","name":"vprobe","xml":"<outcome value='vprobe'>\n","comments":"","outputs":1,"x":669.6667175292969,"y":3834.0801408290863,"z":"ad46ffb1.59044","wires":[["6c7aeb00.1010d4"]]},{"id":"6c7aeb00.1010d4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":816.6666412353516,"y":3834.080167531967,"z":"ad46ffb1.59044","wires":[["6aa8217a.be7a8","c31b80a8.b4288","cf530372.3cdf2"]]},{"id":"497d568b.0f1998","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":463.1903839111328,"y":4800.794217824936,"z":"ad46ffb1.59044","wires":[["650f3d05.c7b2c4"]]},{"id":"650f3d05.c7b2c4","type":"outcome","name":"vprobe","xml":"<outcome value='vprobe'>\n","comments":"","outputs":1,"x":661.1903839111328,"y":4800.794217824936,"z":"ad46ffb1.59044","wires":[["76baa0fa.2967c"]]},{"id":"1bc76bf3.eeff44","type":"execute","name":"encode spaces in src-nfc-naming-code","xml":"<execute plugin=\"org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils\" method=\"replace\">\n\t<parameter name=\"source\" value=\"`$tmp.src-nfc-naming-code`\" />\n\t<parameter name=\"target\" value=\" \" />\n\t<parameter name=\"replacement\" value=\"%20\" />\n\t<parameter name=\"outputPath\" value=\"tmp.encoded-src-nfc-naming-code\" />\n","comments":"","outputs":1,"x":502.85723876953125,"y":515.9523913860321,"z":"ad46ffb1.59044","wires":[[]]},{"id":"34f89d01.613262","type":"execute","name":"encode spaces in dest-nfc-naming-code","xml":"<execute plugin=\"org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils\" method=\"replace\">\n\t<parameter name=\"source\" value=\"`$tmp.dest-nfc-naming-code`\" />\n\t<parameter name=\"target\" value=\" \" />\n\t<parameter name=\"replacement\" value=\"%20\" />\n\t<parameter name=\"outputPath\" value=\"tmp.encoded-dest-nfc-naming-code\" />\n","comments":"","outputs":1,"x":507.85709381103516,"y":564.2857167720795,"z":"ad46ffb1.59044","wires":[[]]},{"id":"a44e08eb.db9948","type":"switchNode","name":"switch source-to-dest-map_length","xml":"<switch test='`$pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-to-dest-maps.source-to-dest-map_length`'>\n","comments":"","outputs":1,"x":482.8571319580078,"y":3722.6186966896057,"z":"ad46ffb1.59044","wires":[["f7202318.a956f","868aa975.671c78"]]},{"id":"f7202318.a956f","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":707.8571395874023,"y":3699.285307407379,"z":"ad46ffb1.59044","wires":[["e98cc52b.20adf8"]]},{"id":"868aa975.671c78","type":"other","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":706.1904525756836,"y":3739.285307407379,"z":"ad46ffb1.59044","wires":[["e98cc52b.20adf8"]]},{"id":"e98cc52b.20adf8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":859.5237655639648,"y":3720.952055454254,"z":"ad46ffb1.59044","wires":[["51295bdc.47f6c4","63c03f51.fc305"]]},{"id":"51295bdc.47f6c4","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"No usable source l-interfaces found in AAI data\" />\n","comments":"","outputs":1,"x":1056.1903915405273,"y":3719.285307407379,"z":"ad46ffb1.59044","wires":[[]]},{"id":"47af693f.8cd828","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1234.2856826782227,"y":4553.571910619736,"z":"ad46ffb1.59044","wires":[["bbdabb63.782468"]]},{"id":"4573744a.834e0c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1392.999870300293,"y":1951.2380549907684,"z":"ad46ffb1.59044","wires":[["b375f194.02676"]]},{"id":"b375f194.02676","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1565.5713195800781,"y":1952.1903321743011,"z":"ad46ffb1.59044","wires":[["437bd1a1.f2c9d","63c03f51.fc305"]]},{"id":"437bd1a1.f2c9d","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to AAI custom query: cloud-region-fromVnf, for destination vnf\" />\n","comments":"","outputs":1,"x":1778.5713500976562,"y":1952.190439939499,"z":"ad46ffb1.59044","wires":[[]]},{"id":"e6609e5f.34d39","type":"save","name":"custom query: get cloud region from dest vnf","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n      resource=\"custom-query\"\n      key=\"format = 'resource&amp;nodesOnly=true'\"\n      force=\"true\"\n      local-only=\"false\"\n      pfx=\"tmp.AnAI-data.dest-vnf\">\n<parameter name=\"start[0]\" value=\"`'/network/generic-vnfs/generic-vnf/' + $tmp.dest-vnf-id `\" />\n<parameter name=\"start_length\" value=\"1\" />\n<parameter name=\"query\" value=\"query/cloud-region-fromVnf\" /> \n","comments":"","outputs":1,"x":1138.428466796875,"y":1977.523785352707,"z":"ad46ffb1.59044","wires":[["4573744a.834e0c","154faeaa.368d41"]]},{"id":"154faeaa.368d41","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1406.7141647338867,"y":2002.095110654831,"z":"ad46ffb1.59044","wires":[["a89eaf11.7e0b1"]]},{"id":"a89eaf11.7e0b1","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1570.9998741149902,"y":2000.6665923595428,"z":"ad46ffb1.59044","wires":[["eb95e0ab.146cb","63c03f51.fc305"]]},{"id":"eb95e0ab.146cb","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"No cloud region returned from AAI: cloud-region-fromVnf, for destination vnf\" />\n","comments":"","outputs":1,"x":1771.5713348388672,"y":2000.3809134960175,"z":"ad46ffb1.59044","wires":[[]]},{"id":"fa51468e.921388","type":"switchNode","name":"switch configuration-sub-type","xml":"<switch test='`$tmp.configuration-sub-type`'>\n","comments":"","outputs":1,"x":477.28565979003906,"y":2119.809517621994,"z":"ad46ffb1.59044","wires":[["ed9d1841.db2a08"]]},{"id":"ed9d1841.db2a08","type":"outcome","name":"vprobe","xml":"<outcome value='vprobe'>\n","comments":"","outputs":1,"x":676.9522895812988,"y":2119.1428105831146,"z":"ad46ffb1.59044","wires":[["ff18461b.76ee58"]]},{"id":"ff18461b.76ee58","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":828.7142486572266,"y":2118.3809287548065,"z":"ad46ffb1.59044","wires":[["e6609e5f.34d39","faf4a613.ee5ff8","f6377325.42056","cc1ea987.81d3e8"]]},{"id":"faf4a613.ee5ff8","type":"for","name":"for each returned result","xml":"<for index='result-idx' start='0' end='`$tmp.AnAI-data.dest-vnf.results_length`' >\n","comments":"","outputs":1,"x":1065.8570861816406,"y":2109.8095004558563,"z":"ad46ffb1.59044","wires":[["a9bff298.d99cf","38457a45.bbc4b6"]]},{"id":"a9bff298.d99cf","type":"switchNode","name":"switch tenant-name","xml":"<switch test='`$tmp.AnAI-data.dest-vnf.results[$result-idx].tenant.tenant-name`'>\n","comments":"","outputs":1,"x":1299.1903610229492,"y":2062.6665506362915,"z":"ad46ffb1.59044","wires":[["4ad4e6b8.e0e368","e71b1e71.f9183"]]},{"id":"4ad4e6b8.e0e368","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1485.8569679260254,"y":2044.3332135677338,"z":"ad46ffb1.59044","wires":[["9f17745d.6422c8"]]},{"id":"e71b1e71.f9183","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1484.1902389526367,"y":2084.0952603816986,"z":"ad46ffb1.59044","wires":[["e0c49a34.d24088"]]},{"id":"9f17745d.6422c8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1627.5236415863037,"y":2044.3332545757294,"z":"ad46ffb1.59044","wires":[[]]},{"id":"e0c49a34.d24088","type":"set","name":"set tmp.dest-tenant from tenant-name","xml":"<set>\n<parameter name='tmp.dest-tenant' value='`$tmp.AnAI-data.dest-vnf.results[$result-idx].tenant.tenant-name`' />\n","comments":"","x":1723.3808517456055,"y":2082.66651058197,"z":"ad46ffb1.59044","wires":[]},{"id":"f6377325.42056","type":"switchNode","name":"switch tmp.dest-tenant","xml":"<switch test='`$tmp.dest-tenant`'>\n","comments":"","outputs":1,"x":1059.8571166992188,"y":2221.238068342209,"z":"ad46ffb1.59044","wires":[["18391ea.86616e1"]]},{"id":"18391ea.86616e1","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1259.4284744262695,"y":2220.3329684734344,"z":"ad46ffb1.59044","wires":[["76e5f52c.7c1e9c"]]},{"id":"76e5f52c.7c1e9c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1412.0475234985352,"y":2219.904328107834,"z":"ad46ffb1.59044","wires":[["3f92a68b.6bc4fa","63c03f51.fc305"]]},{"id":"3f92a68b.6bc4fa","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to retrieve destination tenant from AAI\" />\n","comments":"","outputs":1,"x":1599.7618713378906,"y":2219.0472552776337,"z":"ad46ffb1.59044","wires":[[]]},{"id":"9fdf6659.2008e8","type":"set","name":"set tmp.src-network-name and contrail fqdn","xml":"<set>\n<parameter name='tmp.src-network-name' value='`$tmp.AnAI-data.src-network.results[$src-nw-idx].l3-network.network-name`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-network-fqdn'\n  value='`$tmp.AnAI-data.src-network.results[$src-nw-idx].l3-network.contrail-network-fqdn`' />\n","comments":"","x":1516.1903686523438,"y":3162.6187646389008,"z":"ad46ffb1.59044","wires":[]},{"id":"9d76aa87.81e4e8","type":"set","name":"set tmp.dest-network-name and contrail fqdn","xml":"<set>\n<parameter name='tmp.dest-network-name' value='`$tmp.AnAI-data.dest-network.results[$dest-nw-idx].l3-network.network-name`' />\n<parameter name='pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.dest-network-fqdn'\n  value='`$tmp.AnAI-data.dest-network.results[$dest-nw-idx].l3-network.contrail-network-fqdn`' />\n","comments":"","x":2094.5237197875977,"y":3309.6187703609467,"z":"ad46ffb1.59044","wires":[]},{"id":"dbe217c5.2519a8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1909.047695159912,"y":4424.523663282394,"z":"ad46ffb1.59044","wires":[["81fec963.f0c378"]]},{"id":"dbd95e4a.02811","type":"execute","name":"urlEncode tmp.encoded-link-name","xml":"<execute plugin=\"org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils\" method=\"urlEncode\">\n\t<parameter name=\"source\" value=\"`$tmp.link-name`\" />\n\t<parameter name=\"outputPath\" value=\"tmp.encoded-link-name\" />\n","comments":"","outputs":1,"x":940.2381286621094,"y":4094.9998967647552,"z":"ad46ffb1.59044","wires":[[]]},{"id":"18535f5.1200da1","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1284.5238037109375,"y":4243.571359395981,"z":"ad46ffb1.59044","wires":[["c7ea99b1.29bf58","1ad1135d.a56a9d","8753137e.a72be"]]},{"id":"6c233b94.0bcdc4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1284.523754119873,"y":4396.428431272507,"z":"ad46ffb1.59044","wires":[["c7ea99b1.29bf58","dc67e39d.28897","c3f6701a.7032f","1ad1135d.a56a9d"]]},{"id":"1ad1135d.a56a9d","type":"execute","name":"urlEncode tmp.encoded-dest-port-name","xml":"<execute plugin=\"org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils\" method=\"urlEncode\">\n\t<parameter name=\"source\" value=\"`$pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-to-dest-maps.source-to-dest-map[$src-idx].dest-port-name`\" />\n\t<parameter name=\"outputPath\" value=\"tmp.encoded-dest-port-name\" />\n","comments":"","outputs":1,"x":1633.0952606201172,"y":4276.428080320358,"z":"ad46ffb1.59044","wires":[[]]},{"id":"c7ea99b1.29bf58","type":"execute","name":"urlEncode tmp.encoded-source-port-name","xml":"<execute plugin=\"org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils\" method=\"urlEncode\">\n\t<parameter name=\"source\" value=\"`$pm.configuration-data.port-mirror-configuration-topology.port-mirror-configuration-assignments.source-to-dest-maps.source-to-dest-map[$src-idx].source-port-name`\" />\n\t<parameter name=\"outputPath\" value=\"tmp.encoded-source-port-name\" />\n","comments":"","outputs":1,"x":1638.8096389770508,"y":4226.428150892258,"z":"ad46ffb1.59044","wires":[[]]},{"id":"dc67e39d.28897","type":"execute","name":"urlEncode tmp.encoded-dest-p-interface","xml":"<execute plugin=\"org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils\" method=\"urlEncode\">\n\t<parameter name=\"source\" value=\"`$tmp.dest-p-interface`\" />\n\t<parameter name=\"outputPath\" value=\"tmp.encoded-dest-p-interface\" />\n","comments":"","outputs":1,"x":1633.0952377319336,"y":4324.999651670456,"z":"ad46ffb1.59044","wires":[[]]},{"id":"38457a45.bbc4b6","type":"switchNode","name":"switch tenant-id","xml":"<switch test='`$tmp.AnAI-data.dest-vnf.results[$result-idx].tenant.tenant-id`'>\n","comments":"","outputs":1,"x":1287.3809661865234,"y":2140.7142856121063,"z":"ad46ffb1.59044","wires":[["8241f9f.db88c08","b6dabfd4.14d6f"]]},{"id":"8241f9f.db88c08","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1487.3808708190918,"y":2122.3809106349945,"z":"ad46ffb1.59044","wires":[["3d4e5fe7.561ce"]]},{"id":"b6dabfd4.14d6f","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1485.7141418457031,"y":2162.1429574489594,"z":"ad46ffb1.59044","wires":[["d1261b6b.8c1048"]]},{"id":"3d4e5fe7.561ce","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1629.0475444793701,"y":2122.38095164299,"z":"ad46ffb1.59044","wires":[[]]},{"id":"d1261b6b.8c1048","type":"set","name":"set tmp.dest-tenant-id from tenant-id","xml":"<set>\n<parameter name='tmp.dest-tenant-id' value='`$tmp.AnAI-data.dest-vnf.results[$result-idx].tenant.tenant-id`' />\n","comments":"","x":1721.9047088623047,"y":2162.3809468746185,"z":"ad46ffb1.59044","wires":[]},{"id":"cc1ea987.81d3e8","type":"switchNode","name":"switch tmp.dest-tenant-id","xml":"<switch test='`$tmp.dest-tenant-id`'>\n","comments":"","outputs":1,"x":1065.952377319336,"y":2267.8571078777313,"z":"ad46ffb1.59044","wires":[["8bb3d822.e12b08"]]},{"id":"8bb3d822.e12b08","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1259.5237350463867,"y":2266.952008008957,"z":"ad46ffb1.59044","wires":[["1a002ab2.dc1e45"]]},{"id":"1a002ab2.dc1e45","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1412.1427841186523,"y":2266.5233676433563,"z":"ad46ffb1.59044","wires":[["f1e988bd.457508"]]},{"id":"f1e988bd.457508","type":"configure","name":"set error-message","xml":"<set>\n<parameter name=\"error-message\" value=\"Failed call to retrieve destination tenant-id from AAI\" />\n","comments":"","outputs":1,"x":1599.8571319580078,"y":2265.666294813156,"z":"ad46ffb1.59044","wires":[[]]}]