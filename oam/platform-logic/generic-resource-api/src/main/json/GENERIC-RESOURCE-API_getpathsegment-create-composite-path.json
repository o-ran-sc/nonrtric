[{"id":"38b3fdb6.1bce32","type":"dgstart","name":"DGSTART","outputs":1,"x":101.66666412353516,"y":83.33332824707031,"z":"acdffee6.4646","wires":[["99e272a4.4e9a8"]]},{"id":"99e272a4.4e9a8","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":216.95236206054688,"y":123.5714340209961,"z":"acdffee6.4646","wires":[["1e63d80b.85a448"]]},{"id":"1e63d80b.85a448","type":"method","name":"method getpathsegment-create-composite-path","xml":"<method rpc='getpathsegment-create-composite-path' mode='sync'>\n","comments":"","outputs":1,"x":221.0952911376953,"y":164.3333225250244,"z":"acdffee6.4646","wires":[["df2ed6c2.cce068"]]},{"id":"1c6cd94a.dfdc47","type":"comment","name":"getpathsegment-create-composite-path","info":"","comments":"","x":496.0115203857422,"y":30.9196720123291,"z":"acdffee6.4646","wires":[]},{"id":"df2ed6c2.cce068","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":304.5000534057617,"y":303.46728324890137,"z":"acdffee6.4646","wires":[["fc83ec6a.1d401","d895c970.3dbc78"]]},{"id":"fc83ec6a.1d401","type":"get-resource","name":"get-resource PATH_SEGMENT","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from PATH_SEGMENT WHERE service_uuid = $getpathsegment-topology-operation-input.service-information.onap-model-information.model-uuid\n    AND path_name = $db.forwarding-path[$path-index].path-name ORDER BY path_segment_seq'\n  pfx='db.path-segment[]'>\n\n","comments":"","outputs":1,"x":527.6190452575684,"y":373.0952377319336,"z":"acdffee6.4646","wires":[["7ff0a241.207e8c","8b411eeb.03fd7","e62cb2cc.8b1b1"]]},{"id":"c64c7acf.8db458","type":"for","name":"for each path segment","xml":"<for index='path-segment-index' start='0' end='`$db.path-segment_length`' >\n","comments":"","outputs":1,"x":560.7738571166992,"y":557.4404888153076,"z":"acdffee6.4646","wires":[["c804b632.fcc3c8"]]},{"id":"c804b632.fcc3c8","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":758.9286117553711,"y":557.261869430542,"z":"acdffee6.4646","wires":[["4637dda4.0531c4","c55591ca.552ba"]]},{"id":"227d76b8.b8f89a","type":"set","name":"set serv-cust_length to 0","xml":"<set>\n<parameter name='serv-cust_length' value='0' />\n","comments":"","x":569.1667022705078,"y":509.58334255218506,"z":"acdffee6.4646","wires":[]},{"id":"4637dda4.0531c4","type":"set","name":"add source ids to serv-cust[]","xml":"<set>\n<parameter name='serv-cust[$serv-cust_length].id' value='`$db.path-segment[$path-segment-index].source-association-uuid`' />\n<parameter name='serv-cust_length' value='`$serv-cust_length + 1`' />\n","comments":"","x":984.1667098999023,"y":535.8333425521851,"z":"acdffee6.4646","wires":[]},{"id":"c55591ca.552ba","type":"switchNode","name":"is this the last path-segment?","xml":"<switch test='`$path-segment-index == ( $db.path-segment_length - 1) `'>\n","comments":"","outputs":1,"x":987.9167175292969,"y":580.8333435058594,"z":"acdffee6.4646","wires":[["f40592ef.6d056"]]},{"id":"f40592ef.6d056","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1184.1667194366455,"y":580.5833435058594,"z":"acdffee6.4646","wires":[["65efc56f.f80dcc"]]},{"id":"65efc56f.f80dcc","type":"set","name":"add target ids to serv-cust[]","xml":"<set>\n<parameter name='serv-cust[$serv-cust_length].id' value='`$db.path-segment[$path-segment-index].target-association-uuid`' />\n<parameter name='serv-cust_length' value='`$serv-cust_length + 1`' />\n","comments":"","x":1373.1667137145996,"y":579.8333435058594,"z":"acdffee6.4646","wires":[]},{"id":"d6d2ff5a.a38e6","type":"comment","name":"create list of service customization/invariant ids","info":"","comments":"","x":750.0000495910645,"y":460.41664600372314,"z":"acdffee6.4646","wires":[]},{"id":"eba93f08.848f6","type":"get-resource","name":"custom query - get runtime service-instances","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n\tresource=\"custom-query\"\n\tkey=\"format = 'resource'\"\n\tforce=\"true\"\n\tlocal-only=\"false\"\n\tpfx=\"aai.service-instances\" >\n\t<parameter name=\"start[0]\" value=\"`'nodes/service-instances?model-invariant-id=' + $serv-cust[$serv-index].inv-id`\" />\n\t<parameter name=\"start_length\" value=\"1\" />\n","comments":"","outputs":1,"x":1164.1666870117188,"y":815.5833110809326,"z":"acdffee6.4646","wires":[["4c07202b.a6ebd","465c9f69.063cf","dc42dfdf.fdb5"]]},{"id":"465c9f69.063cf","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1425.9129028320312,"y":806.4841794967651,"z":"acdffee6.4646","wires":[["e9829c01.c3518"]]},{"id":"4c07202b.a6ebd","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1434.8414993286133,"y":764.7699127197266,"z":"acdffee6.4646","wires":[["22fcdcd6.409e54"]]},{"id":"d895c970.3dbc78","type":"set","name":"set match-type","xml":"<set>\n<parameter name='match-type' value='network-name' />\n","comments":"","x":475.00000762939453,"y":243.33336734771729,"z":"acdffee6.4646","wires":[]},{"id":"3337a2c8.4f2c0e","type":"for","name":"for each service","xml":"<for index='serv-index' start='0' end='`$serv-cust_length`' >\n","comments":"","outputs":1,"x":542.9166564941406,"y":795.8333034515381,"z":"acdffee6.4646","wires":[["ea262156.5bc25"]]},{"id":"ba80debf.cd0aa","type":"for","name":"for each runtime service-instance","xml":"<for index='runtime-index' start='0' end='`$aai.service-instances.results_length`' >\n","comments":"","outputs":1,"x":1787.3809661865234,"y":897.261890411377,"z":"acdffee6.4646","wires":[["f4f23919.fbf798"]]},{"id":"37e396a3.2783fa","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":1601.487964630127,"y":1169.583387374878,"z":"acdffee6.4646","wires":[["e16fa584.ce8668","c9267106.d99d1","b7b866f.22cfd98","9f400084.68537","a4663c40.d0b5d"]]},{"id":"22fcdcd6.409e54","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"`'Unable to find runtime service instances for invariant UUID ' + $serv-cust[$serv-index].inv-id`\" />\n","comments":"","x":1639.1667098999023,"y":764.5833187103271,"z":"acdffee6.4646","wires":[]},{"id":"e9829c01.c3518","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"`'System error finding runtime service instances for customization UUID ' + $serv-cust[$serv-index].inv-id`\" />\n","comments":"","x":1637.9166870117188,"y":805.8333110809326,"z":"acdffee6.4646","wires":[]},{"id":"dc42dfdf.fdb5","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1427.5595741271973,"y":895.6547050476074,"z":"acdffee6.4646","wires":[["1a046dd0.664552"]]},{"id":"1a046dd0.664552","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":1568.8095741271973,"y":896.9047050476074,"z":"acdffee6.4646","wires":[["ba80debf.cd0aa","5a25eaf8.84c624","2fed2a61.3ba6d6"]]},{"id":"c9267106.d99d1","type":"execute","name":"generate port-mirror-configuration url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.service`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.service-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$serv-inst.service-instance-id`\"/>\n","comments":"","outputs":1,"x":1911.4878692626953,"y":1190.8334407806396,"z":"acdffee6.4646","wires":[[]]},{"id":"b7b866f.22cfd98","type":"execute","name":"execute RestApiCallNode - get service","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.service-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-service\" />\n\n","comments":"","outputs":1,"x":1918.8212051391602,"y":1473.9286651611328,"z":"acdffee6.4646","wires":[["44737e00.fd61a","e1d027ae.6e1bf8"]]},{"id":"44737e00.fd61a","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2181.367099761963,"y":1296.1292266845703,"z":"acdffee6.4646","wires":[["73b87896.db1488"]]},{"id":"e1d027ae.6e1bf8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2182.809181213379,"y":1772.3094692230225,"z":"acdffee6.4646","wires":[["e72fa4b8.6bb8f8"]]},{"id":"8d022a9b.038888","type":"comment","name":"Is this service in GENERIC-RESOURCE-API?","info":"","comments":"","x":1925.2497940063477,"y":1426.4286623001099,"z":"acdffee6.4646","wires":[]},{"id":"e16fa584.ce8668","type":"set","name":"clear mdsal-service and serv-inst.api","xml":"<set>\n<parameter name='mdsal-service.' value='' />\n<parameter name='serv-inst.api' value='' />\n","comments":"","x":1907.0712242126465,"y":1139.9405155181885,"z":"acdffee6.4646","wires":[]},{"id":"8786ac57.03e15","type":"set","name":"set serv-inst.service-instance-id","xml":"<set>\n<parameter name='serv-inst.service-instance-id' value='`$aai.service-instances.results[$runtime-index].service-instance.service-instance-id`' />\n","comments":"","x":2592.880962371826,"y":814.6428813934326,"z":"acdffee6.4646","wires":[]},{"id":"73b87896.db1488","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":2335.2379302978516,"y":1295.0833110809326,"z":"acdffee6.4646","wires":[["bae35c98.23485"]]},{"id":"bae35c98.23485","type":"switchNode","name":"switch vnf_length","xml":"<switch test='`$mdsal-service.service[0].service-data.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":2520.237953186035,"y":1293.8333282470703,"z":"acdffee6.4646","wires":[["5de50820.6365a8","6a33778b.f0d2b8","8b08a0fc.3d573","156859cc.f57d36"]]},{"id":"5de50820.6365a8","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":2698.988010406494,"y":1145.8333530426025,"z":"acdffee6.4646","wires":[["5d43b7a0.cc8368"]]},{"id":"6a33778b.f0d2b8","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":2700.238010406494,"y":1184.5833530426025,"z":"acdffee6.4646","wires":[["5d43b7a0.cc8368"]]},{"id":"8b08a0fc.3d573","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2700.737949371338,"y":1520.8333282470703,"z":"acdffee6.4646","wires":[["7f9faf98.11444"]]},{"id":"7f9faf98.11444","type":"switchNode","name":"switch forwarding-path_length","xml":"<switch test='`$mdsal-service.service[0].service-data.forwarding-paths.forwarding-path_length`'>\n","comments":"","outputs":1,"x":2916.987953186035,"y":1522.0833282470703,"z":"acdffee6.4646","wires":[["b12a45c2.9c00f8","df779983.f9ee18","efeee58f.366df8"]]},{"id":"156859cc.f57d36","type":"outcome","name":"1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":2703.988010406494,"y":1324.8333549499512,"z":"acdffee6.4646","wires":[["d321c3e5.b08ea"]]},{"id":"b12a45c2.9c00f8","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":3128.9879837036133,"y":1458.3333358764648,"z":"acdffee6.4646","wires":[["6574fc05.7aa8d4"]]},{"id":"df779983.f9ee18","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":3130.2379837036133,"y":1497.0833358764648,"z":"acdffee6.4646","wires":[["6574fc05.7aa8d4"]]},{"id":"efeee58f.366df8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":3127.3809661865234,"y":1591.7262210845947,"z":"acdffee6.4646","wires":[["cbc2b125.4a032"]]},{"id":"5d43b7a0.cc8368","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='data-error' value=\"`'Service instance ' + $si.service-instance-id + ' has no VNFs, skipping'`\" />\n","comments":"","x":2897.7379837036133,"y":1163.3333358764648,"z":"acdffee6.4646","wires":[]},{"id":"6574fc05.7aa8d4","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='data-error' value=\"`'Service instance ' + $serv-inst.service-instance-id + ' has multiple VNFs but no forwarding paths were found'`\" />\n","comments":"","x":3317.7379837036133,"y":1475.8333358764648,"z":"acdffee6.4646","wires":[]},{"id":"389f4f59.b5385","type":"call","name":"call GENERIC-RESOURCE-API:getpathsegment-populate-from-grapi","xml":"<call module='GENERIC-RESOURCE-API' rpc='getpathsegment-populate-from-grapi' mode='sync' >\n","comments":"","outputs":1,"x":3186.737953186035,"y":1274.0833282470703,"z":"acdffee6.4646","wires":[[]]},{"id":"ed8af0c2.a5e1e","type":"call","name":"call GENERIC-RESOURCE-API:getpathsegment-populate-from-vnfapi","xml":"<call module='GENERIC-RESOURCE-API' rpc='getpathsegment-populate-from-vnfapi' mode='sync' >\n","comments":"","outputs":1,"x":2647.80948638916,"y":1723.0832061767578,"z":"acdffee6.4646","wires":[[]]},{"id":"a8c16a6d.0d2f18","type":"success","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2661.2022552490234,"y":1910.5475997924805,"z":"acdffee6.4646","wires":[["ac5e9274.a71eb"]]},{"id":"23ce8b1d.277d04","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":2658.7022666931152,"y":1776.6310663223267,"z":"acdffee6.4646","wires":[["1300cf7.befc831"]]},{"id":"1300cf7.befc831","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='data-error' value=\"`'Failure finding service instance ' + $si.service-instance-id + ' in either GENERIC-REOURCE-API or VNF-API'`\" />\n","comments":"","x":2872.452236175537,"y":1775.1310510635376,"z":"acdffee6.4646","wires":[]},{"id":"ac5e9274.a71eb","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2812.4525032043457,"y":1909.2975997924805,"z":"acdffee6.4646","wires":[["bab97280.4fcff"]]},{"id":"3f21a433.f89dbc","type":"set","name":"copy serv-inst to serv-insts array","xml":"<set>\n<parameter name='serv-cust[$serv-index].serv-insts[$tmp.serv-insts_length].' value='`$serv-inst.`' />\n","comments":"","x":3074.237953186035,"y":1327.8333282470703,"z":"acdffee6.4646","wires":[]},{"id":"f723823c.14d35","type":"set","name":"increment serv-insts_length","xml":"<set>\n<parameter name='tmp.serv-insts_length' value='`$tmp.serv-insts_length + 1`' />\n","comments":"","x":3055.487922668457,"y":1382.833309173584,"z":"acdffee6.4646","wires":[]},{"id":"d321c3e5.b08ea","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":2853.9879837036133,"y":1324.5833358764648,"z":"acdffee6.4646","wires":[["389f4f59.b5385","3f21a433.f89dbc","f723823c.14d35"]]},{"id":"5a25eaf8.84c624","type":"set","name":"set tmp.serv-insts_length to 0","xml":"<set>\n<parameter name='tmp.serv-insts_length' value='0' />\n","comments":"","x":1781.1309967041016,"y":848.1547393798828,"z":"acdffee6.4646","wires":[]},{"id":"e72fa4b8.6bb8f8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2309.297294616699,"y":1780.047555923462,"z":"acdffee6.4646","wires":[["ed8af0c2.a5e1e","78b047cf.ed86c8"]]},{"id":"78b047cf.ed86c8","type":"switchNode","name":"switch serv-inst.api","xml":"<switch test='`$serv-inst.api`'>\n","comments":"","outputs":1,"x":2492.393165588379,"y":1845.1666173934937,"z":"acdffee6.4646","wires":[["23ce8b1d.277d04","a8c16a6d.0d2f18"]]},{"id":"2de86e6.3962e92","type":"set","name":"copy serv-inst to serv-insts array","xml":"<set>\n<parameter name='serv-cust[$serv-index].serv-insts[$tmp.serv-insts_length].' value='`$serv-inst.`' />\n","comments":"","x":3539.0593872070312,"y":2006.5000267028809,"z":"acdffee6.4646","wires":[]},{"id":"f4f23919.fbf798","type":"switchNode","name":"switch orchestration-status","xml":"<switch test='`$aai.service-instances.results[$runtime-index].service-instance.orchestration-status`'>\n","comments":"","outputs":1,"x":2059.7024688720703,"y":897.0832557678223,"z":"acdffee6.4646","wires":[["83f502d6.2f5a4"]]},{"id":"83f502d6.2f5a4","type":"outcome","name":"Active","xml":"<outcome value='Active'>\n","comments":"","outputs":1,"x":2254.1665954589844,"y":895.8332214355469,"z":"acdffee6.4646","wires":[["442aff0f.a1283"]]},{"id":"1398c294.3f952d","type":"for","name":"for each service","xml":"<for index='serv-index' start='0' end='`$serv-cust_length`' >\n","comments":"","outputs":1,"x":539.583366394043,"y":668.7500200271606,"z":"acdffee6.4646","wires":[["ecfee624.daec78"]]},{"id":"f6adfe96.32d5f","type":"comment","name":"convert customization uuid to invariant uuid","info":"","comments":"","x":668.3334045410156,"y":626.250018119812,"z":"acdffee6.4646","wires":[]},{"id":"15831d68.36e8b3","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1121.2024307250977,"y":625.3093452453613,"z":"acdffee6.4646","wires":[["be78a9fd.371368"]]},{"id":"745ebab0.1a84e4","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1127.2738418579102,"y":666.0950517654419,"z":"acdffee6.4646","wires":[["dfab331.23ebcd"]]},{"id":"ecfee624.daec78","type":"get-resource","name":"get-resource SERVICE_PROXY, SERVICE_MODEL","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='select sm.invariant_uuid\n    from SERVICE_PROXY sp, SERVICE_MODEL sm\n    where sp.source_service_uuid = sm.service_uuid\n    and sp.customization_uuid = $serv-cust[$serv-index].id'\n  pfx='db'>\n","comments":"","outputs":1,"x":844.5238189697266,"y":668.5714359283447,"z":"acdffee6.4646","wires":[["15831d68.36e8b3","745ebab0.1a84e4","577c9bbc.66ccc4"]]},{"id":"577c9bbc.66ccc4","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1122.083351135254,"y":707.5000200271606,"z":"acdffee6.4646","wires":[["1848871c.fbafd9"]]},{"id":"1848871c.fbafd9","type":"set","name":"store invariant id","xml":"<set>\n<parameter name='serv-cust[$serv-index].inv-id' value='`$db.invariant-uuid`' />\n","comments":"","x":1287.0833587646484,"y":707.5000200271606,"z":"acdffee6.4646","wires":[]},{"id":"be78a9fd.371368","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"`'Failure reading SERVICE_PROXY and SERVICE_MODEL for customization uuid ' + $serv-cust[$serv-index].id`\" />\n","comments":"","x":1315.8333549499512,"y":625.0000190734863,"z":"acdffee6.4646","wires":[]},{"id":"dfab331.23ebcd","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"`'Cannot find entries in SERVICE_PROXY and SERVICE_MODEL for customization uuid ' + $serv-cust[$serv-index].id`\" />\n","comments":"","x":1315.8333358764648,"y":665.0000104904175,"z":"acdffee6.4646","wires":[]},{"id":"ea262156.5bc25","type":"switchNode","name":"switch invariant uuid","xml":"<switch test='`$serv-cust[$serv-index].inv-id`'>\n","comments":"","outputs":1,"x":741.6666793823242,"y":794.5833110809326,"z":"acdffee6.4646","wires":[["6e5ea8a8.3f7578","38fd826b.e7840e"]]},{"id":"6e5ea8a8.3f7578","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":907.9166831970215,"y":765.8333110809326,"z":"acdffee6.4646","wires":[["458e60e8.0fa83"]]},{"id":"38fd826b.e7840e","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":908.7381553649902,"y":816.1192016601562,"z":"acdffee6.4646","wires":[["eba93f08.848f6"]]},{"id":"458e60e8.0fa83","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1044.1666831970215,"y":765.0833101272583,"z":"acdffee6.4646","wires":[[]]},{"id":"3b868648.17a23a","type":"call","name":"call GENERIC-RESOURCE-API:getpathsegment-composite-match-pair","xml":"<call module='GENERIC-RESOURCE-API' rpc='getpathsegment-composite-match-pair' mode='sync' >\n","comments":"","outputs":1,"x":687.9287109375,"y":2361.2736377716064,"z":"acdffee6.4646","wires":[[]]},{"id":"cbc2b125.4a032","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":3256.1309661865234,"y":1591.7262210845947,"z":"acdffee6.4646","wires":[["e63540a5.81689","c13e34b7.f42fb8","a14b9b6d.2bbee8","7ace4a44.fb42f4"]]},{"id":"e63540a5.81689","type":"set","name":"copy forwarding-paths to serv-insts array","xml":"<set>\n<parameter name='serv-cust[$serv-index].serv-insts[$tmp.serv-insts_length].forwarding-paths.'\n  value='`$mdsal-service.service[0].service-data.forwarding-paths.`' />\n","comments":"","x":3503.988082885742,"y":1615.2975959777832,"z":"acdffee6.4646","wires":[]},{"id":"c13e34b7.f42fb8","type":"set","name":"increment serv-insts_length","xml":"<set>\n<parameter name='tmp.serv-insts_length' value='`$tmp.serv-insts_length + 1`' />\n","comments":"","x":3462.5592651367188,"y":1662.0834131240845,"z":"acdffee6.4646","wires":[]},{"id":"a14b9b6d.2bbee8","type":"call","name":"call GENERIC-RESOURCE-API:getpathsegment-populate-from-grapi","xml":"<call module='GENERIC-RESOURCE-API' rpc='getpathsegment-populate-from-grapi' mode='sync' >\n","comments":"","outputs":1,"x":3588.2736282348633,"y":1527.0833358764648,"z":"acdffee6.4646","wires":[[]]},{"id":"7ace4a44.fb42f4","type":"set","name":"copy serv-inst to serv-insts array","xml":"<set>\n<parameter name='serv-cust[$serv-index].serv-insts[$tmp.serv-insts_length].' value='`$serv-inst.`' />\n","comments":"","x":3475.4166946411133,"y":1568.5119247436523,"z":"acdffee6.4646","wires":[]},{"id":"9f400084.68537","type":"set","name":"clear serv-inst","xml":"<set>\n<parameter name='serv-inst.' value='' />\n","comments":"","x":1837.9879150390625,"y":1518.511981010437,"z":"acdffee6.4646","wires":[]},{"id":"2fed2a61.3ba6d6","type":"set","name":"set final serv-insts_length","xml":"<set>\n<parameter name='serv-cust[$serv-index].serv-insts_length' value='`$tmp.serv-insts_length`' />\n","comments":"","x":1765.4167137145996,"y":942.7975521087646,"z":"acdffee6.4646","wires":[]},{"id":"e2bb1296.6a77f","type":"comment","name":"Create forwarding-path structure","info":"","comments":"","x":1804.2026138305664,"y":2759.249895095825,"z":"acdffee6.4646","wires":[]},{"id":"9c1deb3.fce3a18","type":"switchNode","name":"switch service-paths.service-path_length","xml":"<switch test='`$service-paths.service-path_length`'>\n","comments":"","outputs":1,"x":588.7024993896484,"y":2585.0833568573,"z":"acdffee6.4646","wires":[["c17848c4.7aa328","891625b0.f7b498","2b7b5767.caf788"]]},{"id":"c17848c4.7aa328","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":868.7024803161621,"y":2441.7497968673706,"z":"acdffee6.4646","wires":[["9234ee5.d733b1"]]},{"id":"891625b0.f7b498","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":869.9524803161621,"y":2480.4997968673706,"z":"acdffee6.4646","wires":[["9234ee5.d733b1"]]},{"id":"2b7b5767.caf788","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":865.9524955749512,"y":2712.0001287460327,"z":"acdffee6.4646","wires":[["db0b5e4d.138fb"]]},{"id":"9234ee5.d733b1","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1002.0358390808105,"y":2455.0831298828125,"z":"acdffee6.4646","wires":[[]]},{"id":"9957ee7a.eb839","type":"set","name":"set top-level data","xml":"<set>\n<parameter name='forwarding-path.forwarding-path-name' value='`$db.path-segment[0].path-name`' />\n<parameter name='forwarding-path.forwarding-path-type' value='Service' />\n<parameter name='forwarding-path.onap-model-information.model-name' value='`$db.path-segment[0].path-name`' />\n","comments":"","x":1715.0359230041504,"y":2846.749963760376,"z":"acdffee6.4646","wires":[]},{"id":"2464da2e.bc2576","type":"execute","name":"generate forwarding-path-id","xml":"<execute plugin=\"org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils\" method=\"generateUUID\" >\n<parameter name=\"ctx-destination\" value=\"forwarding-path.forwarding-path-id\" />\n","comments":"","outputs":1,"x":1747.1192169189453,"y":2800.916626930237,"z":"acdffee6.4646","wires":[[]]},{"id":"5d113599.9797dc","type":"set","name":"copy service-path","xml":"<set>\n<parameter name='forwarding-path.service-paths.' value='`$service-paths.`' />\n","comments":"","x":1713.3692474365234,"y":2891.7502098083496,"z":"acdffee6.4646","wires":[]},{"id":"654073a0.8dc7dc","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1525.0359649658203,"y":3155.0832328796387,"z":"acdffee6.4646","wires":[["2464da2e.bc2576","9957ee7a.eb839","5d113599.9797dc","7ecab0fa.15895","76d060fc.5c71a","94003a26.69b068","532dd116.0d3c4"]]},{"id":"a4663c40.d0b5d","type":"switchNode","name":"switch runtime-index","xml":"<switch test='`$runtime-index`'>\n","comments":"","outputs":1,"x":1859.7022666931152,"y":1011.8452968597412,"z":"acdffee6.4646","wires":[["4db5c1dc.9f95c"]]},{"id":"4db5c1dc.9f95c","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":2029.7022972106934,"y":1011.8453140258789,"z":"acdffee6.4646","wires":[["dcb4004e.9356a"]]},{"id":"dcb4004e.9356a","type":"set","name":"save service.service-role","xml":"<set>\n<parameter name='service.service-role' value='`$aai.service-instances.results[0].service-instance.service-role`' />\n","comments":"","x":2208.2736206054688,"y":1011.8452968597412,"z":"acdffee6.4646","wires":[]},{"id":"442aff0f.a1283","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2380.416763305664,"y":895.4166278839111,"z":"acdffee6.4646","wires":[["37e396a3.2783fa","efbbd2cc.0e547","8786ac57.03e15"]]},{"id":"efbbd2cc.0e547","type":"switchNode","name":"switch output-global-customer-id","xml":"<switch test='`$output-global-customer-id`'>\n","comments":"","outputs":1,"x":2595.4166717529297,"y":860.4166126251221,"z":"acdffee6.4646","wires":[["9b84fbe4.e396d8"]]},{"id":"9b84fbe4.e396d8","type":"outcome","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":2802.0833892822266,"y":858.7499856948853,"z":"acdffee6.4646","wires":[["6b285851.2f4b58"]]},{"id":"30bb031c.093bcc","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":3375.416572570801,"y":855.4166278839111,"z":"acdffee6.4646","wires":[["b34e010d.49543","966e7225.52122"]]},{"id":"6b285851.2f4b58","type":"save","name":"custom query: get service instance","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n      resource=\"custom-query\"\n      key=\"format = 'resource_and_url'\"\n      force=\"true\"\n      local-only=\"false\"\n      pfx=\"tmp.AnAI-data.si\">\n\t<parameter name=\"start[0]\" value=\"`'nodes/service-instance/' + $serv-inst.service-instance-id `\" />\n\t<parameter name=\"start_length\" value=\"1\" />\n","comments":"","outputs":1,"x":3020.416534423828,"y":857.083399772644,"z":"acdffee6.4646","wires":[["5e0c0bf4.dca7b4"]]},{"id":"b34e010d.49543","type":"execute","name":"execute split","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n\t<parameter name=\"original_string\" value=\"`$tmp.AnAI-data.si.results[0].url`\" />\n\t<parameter name=\"regex\" value=\"/\"/>\n\t<parameter name=\"limit\" value=\"11\" />\n\t<parameter name=\"ctx_memory_result_key\" value=\"split\" />\n","comments":"","outputs":1,"x":3528.749973297119,"y":835.4167575836182,"z":"acdffee6.4646","wires":[[]]},{"id":"5e0c0bf4.dca7b4","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":3242.0832595825195,"y":856.7500123977661,"z":"acdffee6.4646","wires":[["30bb031c.093bcc"]]},{"id":"966e7225.52122","type":"set","name":"set output-global-customer-id, etc","xml":"<set>\n<parameter name='output-global-customer-id' value='`$split[6]`' />\n<parameter name='output-service-type' value='`$split[9]`' />\n<parameter name='output-service-role' value='`$tmp.AnAI-data.si.results[0].service-instance.service-role`' />\n","comments":"","x":3595.416763305664,"y":880.4166374206543,"z":"acdffee6.4646","wires":[]},{"id":"7d31078f.efb3d8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2128.60733795166,"y":3068.8931226730347,"z":"acdffee6.4646","wires":[["87ecc4ba.953798","e1f74301.3a592","ea9cb947.2f8788","7177f03.da2611","960587e2.909438"]]},{"id":"87ecc4ba.953798","type":"execute","name":"generate service-instance-id","xml":"<execute plugin=\"org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils\" method=\"generateUUID\" >\n<parameter name=\"ctx-destination\" value=\"tmp.service-instance-id\" />\n","comments":"","outputs":1,"x":2335.274076461792,"y":2968.1788692474365,"z":"acdffee6.4646","wires":[[]]},{"id":"14ba220e.0a427e","type":"comment","name":"Make a new service instance in GR-API","info":"","comments":"","x":2441.5239963531494,"y":2931.0953826904297,"z":"acdffee6.4646","wires":[]},{"id":"7177f03.da2611","type":"save","name":"save service-instance to A&AI","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"service-instance\" \n\tkey=\"customer.global-customer-id = $output-global-customer-id\n\t  AND service-subscription.service-type = $output-service-type\n\t  AND service-instance.service-instance-id = $tmp.service-instance-id\" >\n<parameter name=\"service-instance-id\" value=\"`$tmp.service-instance-id`\" />\n<parameter name=\"global-customer-id\" value=\"`$output-global-customer-id`\" />\n<parameter name=\"service-type\" value=\"`$output-service-type`\" />\n<parameter name=\"service-role\" value=\"`$output-service-role`\" />\n","comments":"","outputs":1,"x":2339.202896118164,"y":3150.0238361358643,"z":"acdffee6.4646","wires":[["2ad23b25.4eac74","8b691431.cc9278"]]},{"id":"83430cdc.a419d","type":"comment","name":"Make a new service instance in A&AI","info":"","comments":"","x":2429.917154312134,"y":3092.16690826416,"z":"acdffee6.4646","wires":[]},{"id":"ea9cb947.2f8788","type":"execute","name":"execute RestApiCallNode - PUT service-instance","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.csm.serviceinstance.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.service-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-sr\" />\n\n","comments":"","outputs":1,"x":2400.2742023468018,"y":3054.845375061035,"z":"acdffee6.4646","wires":[["97c9808b.9352c"]]},{"id":"e1f74301.3a592","type":"execute","name":"generate service-instance url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.service`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.service-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.service-instance-id`\"/>\n","comments":"","outputs":1,"x":2336.5242023468018,"y":3012.345374107361,"z":"acdffee6.4646","wires":[[]]},{"id":"7ecab0fa.15895","type":"switchNode","name":"switch output-service-instance-id","xml":"<switch test='`$output-service-instance-id`'>\n","comments":"","outputs":1,"x":1767.4168243408203,"y":3076.5121965408325,"z":"acdffee6.4646","wires":[["6bc7823b.9fccbc","f3d20003.45381"]]},{"id":"7ff0a241.207e8c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":738.7499389648438,"y":328.75,"z":"acdffee6.4646","wires":[["ae348eba.10a95"]]},{"id":"8b411eeb.03fd7","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":747.3213691711426,"y":372.0357131958008,"z":"acdffee6.4646","wires":[["6abf5986.be9818"]]},{"id":"ae348eba.10a95","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":892.0120735168457,"y":327.0715398788452,"z":"acdffee6.4646","wires":[["4a5f6f0b.dcc33"]]},{"id":"6abf5986.be9818","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":892.0120964050293,"y":372.07152938842773,"z":"acdffee6.4646","wires":[["8def3ed6.72da5"]]},{"id":"4a5f6f0b.dcc33","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"`'System error reading PATH_SEGMENT table for uuid '\n  + $getpathsegment-topology-operation-input.service-information.onap-model-information.model-uuid\n  + ' and path '\n  + $db.forwarding-path[$path-index].path-name`\" />\n","comments":"","x":1092.0122184753418,"y":325.4048738479614,"z":"acdffee6.4646","wires":[]},{"id":"8def3ed6.72da5","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"`'No entries in PATH_SEGMENT table for uuid '\n  + $getpathsegment-topology-operation-input.service-information.onap-model-information.model-uuid\n  + ' and path '\n  + $db.forwarding-path[$path-index].path-name`\" />\n","comments":"","x":1092.012035369873,"y":372.07152938842773,"z":"acdffee6.4646","wires":[]},{"id":"e62cb2cc.8b1b1","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":743.6787948608398,"y":415.4048881530762,"z":"acdffee6.4646","wires":[["766a7c4c.6db704"]]},{"id":"766a7c4c.6db704","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":113.6309585571289,"y":1673.2737884521484,"z":"acdffee6.4646","wires":[["227d76b8.b8f89a","c64c7acf.8db458","1398c294.3f952d","3337a2c8.4f2c0e","3b868648.17a23a","9c1deb3.fce3a18","31223e46.c39562"]]},{"id":"6bc7823b.9fccbc","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1988.607292175293,"y":3055.5597352981567,"z":"acdffee6.4646","wires":[["7d31078f.efb3d8"]]},{"id":"f3d20003.45381","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":1988.4287033081055,"y":3097.1668796539307,"z":"acdffee6.4646","wires":[["7d31078f.efb3d8"]]},{"id":"960587e2.909438","type":"set","name":"set output-service-instance-id","xml":"<set>\n<parameter name='output-service-instance-id' value='`$tmp.service-instance-id`' />\n","comments":"","x":2334.797737121582,"y":3214.6070919036865,"z":"acdffee6.4646","wires":[]},{"id":"94003a26.69b068","type":"execute","name":"execute RestApiCallNode - PUT forwarding-path","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.forwardingpath.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.fp-url + $forwarding-path.forwarding-path-id`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-fp\" />\n\n","comments":"","outputs":1,"x":1810.0359344482422,"y":3339.3693075180054,"z":"acdffee6.4646","wires":[["e3e2ddf6.f153f","b2430abe.dc8828"]]},{"id":"e3e2ddf6.f153f","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2080.5224685668945,"y":3363.6175785064697,"z":"acdffee6.4646","wires":[["aac11982.8688f8"]]},{"id":"b2430abe.dc8828","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2072.951103210449,"y":3322.1175985336304,"z":"acdffee6.4646","wires":[["aac11982.8688f8"]]},{"id":"aac11982.8688f8","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"Failure writing forwarding-path to MD-SAL\" />\n","comments":"","x":2292.5359420776367,"y":3336.8693075180054,"z":"acdffee6.4646","wires":[]},{"id":"76d060fc.5c71a","type":"execute","name":"generate forwarding-path url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.forwarding-path`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.fp-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$output-service-instance-id`\"/>\n","comments":"","outputs":1,"x":1747.952766418457,"y":3282.285427093506,"z":"acdffee6.4646","wires":[[]]},{"id":"ec6851e3.24d41","type":"save","name":"save forwarding-path to A&AI","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"forwarding-path\" \n\tkey=\"forwarding-path.forwarding-path-id = $forwarding-path.service-paths.service-path[$sp-index].service-path-instance-id\" >\n<parameter name=\"forwarding-path-id\" value=\"`$forwarding-path.service-paths.service-path[$sp-index].service-path-instance-id`\" />\n<parameter name=\"forwarding-path-name\" value=\"`$forwarding-path.service-paths.service-path[$sp-index].service-path-instance-name`\" />\n<parameter name=\"selflink\" value=\"`'/restconf/config/GENERIC-RESOURCE-API:services/service/'\n  + $output-service-instance-id\n  + '/forwarding-paths/forwarding-path/'\n  + $forwarding-path.forwarding-path-id\n  + '/services-paths/service-path/'\n  + $forwarding-path.service-paths.service-path[$sp-index].service-path-instance-id`\" />\n","comments":"","outputs":1,"x":2564.072067260742,"y":3421.226315498352,"z":"acdffee6.4646","wires":[["782723e.d6f5edc","173a4200.c682ae"]]},{"id":"f9f23fe5.c832e","type":"save","name":"save forwarding-path relationship to service-instance","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"forwarding-path:relationship-list\"\n   key=\"forwarding-path.forwarding-path-id = $forwarding-path.service-paths.service-path[$sp-index].service-path-instance-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"service-instance\" />\n    <parameter name=\"relationship-list.relationship[0].related-link\"\n      value=\"`'/aai/v$/business/customers/customer/'\n        + $output-global-customer-id\n        + '/service-subscriptions/service-subscription/'\n        + $output-service-type\n        + '/service-instances/service-instance/'\n        + $output-service-instance-id`\" />\n","comments":"","outputs":1,"x":2635.73876953125,"y":3501.46435546875,"z":"acdffee6.4646","wires":[["c1b3e443.b892d8","a4072ca.00fd3d"]]},{"id":"2f92c949.4d6476","type":"for","name":"for each vnf","xml":"<for index='vnf-index' start='0' end='`$forwarding-path.service-paths.service-path[$sp-index].service[$service-index].vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":2725.500457763672,"y":3630.274257659912,"z":"acdffee6.4646","wires":[["d2f257bf.d8fd58"]]},{"id":"d2f257bf.d8fd58","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2870.2624740600586,"y":3629.8454303741455,"z":"acdffee6.4646","wires":[["81a978c4.55a318","1825f2cc.d9255d"]]},{"id":"81a978c4.55a318","type":"save","name":"save forwarder to A&AI","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"forwarder\" \n\tkey=\"forwarding-path.forwarding-path-id = $forwarding-path.service-paths.service-path[$sp-index].service-path-instance-id\n\t  AND forwarder.sequence = $forwarding-path.service-paths.service-path[$sp-index].service[$service-index].vnfs.vnf[$vnf-index].vnf-path-sequence-id\" >\n<parameter name=\"sequence\" value=\"`$forwarding-path.service-paths.service-path[$sp-index].service[$service-index].vnfs.vnf[$vnf-index].vnf-path-sequence-id`\" />\n","comments":"","outputs":1,"x":3051.262517929077,"y":3585.750457763672,"z":"acdffee6.4646","wires":[["a8b88931.1b04b8","18196271.6ec47e"]]},{"id":"1825f2cc.d9255d","type":"save","name":"save forwarder relationship to generic-vnf","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"forwarder:relationship-list\"\n   key=\"forwarding-path.forwarding-path-id = $forwarding-path.service-paths.service-path[$sp-index].service-path-instance-id\n     AND forwarder.sequence = $forwarding-path.service-paths.service-path[$sp-index].service[$service-index].vnfs.vnf[$vnf-index].vnf-path-sequence-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"generic-vnf\" />\n    <parameter name=\"relationship-list.relationship[0].related-link\"\n      value=\"`'/aai/v$/network/generic-vnfs/generic-vnf/'\n        + $forwarding-path.service-paths.service-path[$sp-index].service[$service-index].vnfs.vnf[$vnf-index].vnf-instance-id`\" />\n","comments":"","outputs":1,"x":3105.262519836426,"y":3675.036106109619,"z":"acdffee6.4646","wires":[["9e2d3b55.8e6d18","be4a1ccd.60699"]]},{"id":"31223e46.c39562","type":"execute","name":"printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/gpsx.log' />\n","comments":"","outputs":1,"x":507.0833282470703,"y":2412.0832509994507,"z":"acdffee6.4646","wires":[[]]},{"id":"173a4200.c682ae","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2772.750198364258,"y":3441.0832204818726,"z":"acdffee6.4646","wires":[["7abb5ae4.45ef84"]]},{"id":"782723e.d6f5edc","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2765.1788330078125,"y":3399.583240509033,"z":"acdffee6.4646","wires":[["7abb5ae4.45ef84"]]},{"id":"7abb5ae4.45ef84","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"Failure writing forwarding-path to AAI\" />\n","comments":"","x":2969.7636108398438,"y":3414.3350400924683,"z":"acdffee6.4646","wires":[]},{"id":"a4072ca.00fd3d","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2917.7501792907715,"y":3524.4164247512817,"z":"acdffee6.4646","wires":[["38f6157.8f1caea"]]},{"id":"c1b3e443.b892d8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2908.5120849609375,"y":3477.916492462158,"z":"acdffee6.4646","wires":[["38f6157.8f1caea"]]},{"id":"38f6157.8f1caea","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"Failure writing forwarding-path relationship to AAI\" />\n","comments":"","x":3113.096908569336,"y":3492.6682138442993,"z":"acdffee6.4646","wires":[]},{"id":"18196271.6ec47e","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":3242.7502117156982,"y":3607.749852180481,"z":"acdffee6.4646","wires":[["ede6f0bd.9d33c"]]},{"id":"a8b88931.1b04b8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":3235.178846359253,"y":3566.2498722076416,"z":"acdffee6.4646","wires":[["ede6f0bd.9d33c"]]},{"id":"ede6f0bd.9d33c","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"Failure writing forwarder to AAI\" />\n","comments":"","x":3438.0970458984375,"y":3581.001434326172,"z":"acdffee6.4646","wires":[]},{"id":"be4a1ccd.60699","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":3347.7501678466797,"y":3699.416358947754,"z":"acdffee6.4646","wires":[["6576c8ed.7d6ce8"]]},{"id":"9e2d3b55.8e6d18","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":3340.1788024902344,"y":3657.9163789749146,"z":"acdffee6.4646","wires":[["6576c8ed.7d6ce8"]]},{"id":"6576c8ed.7d6ce8","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"Failure writing forwarder relationship to AAI\" />\n","comments":"","x":3541.4303436279297,"y":3672.667942047119,"z":"acdffee6.4646","wires":[]},{"id":"ee78a452.895eb8","type":"for","name":"for each service","xml":"<for index='service-index' start='0' end='`$service-paths.service-path[$sp-index].service_length`' >\n","comments":"","outputs":1,"x":2534.416831970215,"y":3631.083258628845,"z":"acdffee6.4646","wires":[["2f92c949.4d6476"]]},{"id":"8b691431.cc9278","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2550.0833892822266,"y":3170.4164781570435,"z":"acdffee6.4646","wires":[["28ee0b7.a193cf4"]]},{"id":"2ad23b25.4eac74","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2542.5120239257812,"y":3128.916498184204,"z":"acdffee6.4646","wires":[["28ee0b7.a193cf4"]]},{"id":"28ee0b7.a193cf4","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"Failure creating service instance in AAI\" />\n","comments":"","x":2745.430223464966,"y":3143.6680603027344,"z":"acdffee6.4646","wires":[]},{"id":"97c9808b.9352c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2660.0833892822266,"y":3053.7497301101685,"z":"acdffee6.4646","wires":[["1818ef16.6dc701"]]},{"id":"1818ef16.6dc701","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"Failure creating service instance in MD-SAL\" />\n","comments":"","x":2850.0833892822266,"y":3052.0829820632935,"z":"acdffee6.4646","wires":[]},{"id":"d843bbaa.11f848","type":"set","name":"increment serv-insts_length","xml":"<set>\n<parameter name='tmp.serv-insts_length' value='`$tmp.serv-insts_length + 1`' />\n","comments":"","x":3523.7498168945312,"y":2057.916774749756,"z":"acdffee6.4646","wires":[]},{"id":"532dd116.0d3c4","type":"for","name":"for each service-path","xml":"<for index='sp-index' start='0' end='`$service-paths.service-path_length`' >\n","comments":"","outputs":1,"x":1718.4169311523438,"y":3522.0831785202026,"z":"acdffee6.4646","wires":[["6026a1f0.02df4"]]},{"id":"bab97280.4fcff","type":"switchNode","name":"switch vnf_length","xml":"<switch test='`$serv-inst.vnf-list_length`'>\n","comments":"","outputs":1,"x":2978.809280395508,"y":2006.4284648895264,"z":"acdffee6.4646","wires":[["83930c1.6232af","415745e9.86f9ec","a96c0af7.4076f8","7fb684c8.1e8ddc"]]},{"id":"83930c1.6232af","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":3181.6666107177734,"y":1924.9999256134033,"z":"acdffee6.4646","wires":[["495a7820.28bb28"]]},{"id":"415745e9.86f9ec","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":3182.9166107177734,"y":1963.7499256134033,"z":"acdffee6.4646","wires":[["495a7820.28bb28"]]},{"id":"495a7820.28bb28","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='data-error' value=\"`'Service instance ' + $si.service-instance-id + ' has no VNFs, skipping'`\" />\n","comments":"","x":3380.4165573120117,"y":1942.4998750686646,"z":"acdffee6.4646","wires":[]},{"id":"a96c0af7.4076f8","type":"outcome","name":"1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":3181.666549682617,"y":2032.4999074935913,"z":"acdffee6.4646","wires":[["bff428c8.cc6008"]]},{"id":"bff428c8.cc6008","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":3331.6665229797363,"y":2032.249888420105,"z":"acdffee6.4646","wires":[["2de86e6.3962e92","d843bbaa.11f848"]]},{"id":"7fb684c8.1e8ddc","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":3184.166717529297,"y":2166.6664543151855,"z":"acdffee6.4646","wires":[["93bc2b5.8b736d8"]]},{"id":"93bc2b5.8b736d8","type":"get-resource","name":"get-resource SERVICE_INSTANCE_TO_COMPOSITE_INSTANCE_MAPPING","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT forwarding_path_service_instance_id from SERVICE_INSTANCE_TO_COMPOSITE_INSTANCE_MAPPING WHERE simple_service_instance_id = $serv-inst.service-instance-id'\n  pfx='db.mapped-service-instance-id'>\n\n","comments":"","outputs":1,"x":3556.5481567382812,"y":2165.952667236328,"z":"acdffee6.4646","wires":[["30b771e0.9efa2e","ac42250b.451688","9c7d869c.656378"]]},{"id":"30b771e0.9efa2e","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":3923.1668853759766,"y":2097.642951965332,"z":"acdffee6.4646","wires":[["3cc43602.d355aa"]]},{"id":"ac42250b.451688","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":3931.7383155822754,"y":2141.928665161133,"z":"acdffee6.4646","wires":[["c6af0644.d6e838"]]},{"id":"3cc43602.d355aa","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='data-error' value=\"System error reading SERVICE_INSTANCE_TO_COMPOSITE_INSTANCE_MAPPING table\" />\n","comments":"","x":4140.000244140625,"y":2095.8333253860474,"z":"acdffee6.4646","wires":[]},{"id":"c6af0644.d6e838","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='data-error' value=\"`'No entry in SERVICE_INSTANCE_TO_COMPOSITE_INSTANCE_MAPPING table for service instance ' + $serv-inst.service-instance-id`\" />\n","comments":"","x":4140.000076293945,"y":2142.166621208191,"z":"acdffee6.4646","wires":[]},{"id":"9c7d869c.656378","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":3928.333480834961,"y":2237.500123023987,"z":"acdffee6.4646","wires":[["47635cab.dcb404"]]},{"id":"47635cab.dcb404","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":4064.9997482299805,"y":2235.8332090377808,"z":"acdffee6.4646","wires":[["3ffa27b1.735848","cbac044e.797f28"]]},{"id":"3ffa27b1.735848","type":"execute","name":"generate port-mirror-configuration url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.service`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.service-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$db.mapped-service-instance-id.forwarding-path-service-instance-id`\"/>\n","comments":"","outputs":1,"x":4285.00008392334,"y":2194.166865348816,"z":"acdffee6.4646","wires":[[]]},{"id":"cbac044e.797f28","type":"execute","name":"execute RestApiCallNode - get service","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.service-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-service\" />\n\n","comments":"","outputs":1,"x":4288.332931518555,"y":2280.8332109451294,"z":"acdffee6.4646","wires":[["8ee34d45.6e794","f93605ea.7e7b88"]]},{"id":"f93605ea.7e7b88","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":4516.666107177734,"y":2342.499878883362,"z":"acdffee6.4646","wires":[["a4725830.66d628"]]},{"id":"8ee34d45.6e794","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":4516.442153930664,"y":2235.3466358184814,"z":"acdffee6.4646","wires":[["dd9a7f75.ee19c"]]},{"id":"dd9a7f75.ee19c","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='data-error' value=\"`'Cannot find service instance ' + $db.mapped-service-instance-id.forwarding-path-service-instance-id + ' in MD-SAL'`\" />\n","comments":"","x":4710.000076293945,"y":2234.166537284851,"z":"acdffee6.4646","wires":[]},{"id":"a4725830.66d628","type":"switchNode","name":"switch forwarding-path_length","xml":"<switch test='`$mdsal-service.service[0].service-data.forwarding-paths.forwarding-path_length`'>\n","comments":"","outputs":1,"x":4720.000076293945,"y":2342.500033378601,"z":"acdffee6.4646","wires":[["f4cd3b16.9f1b48","e02ba6d7.e68a68","f2da480c.9764c8"]]},{"id":"f4cd3b16.9f1b48","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":4932.000106811523,"y":2278.7500410079956,"z":"acdffee6.4646","wires":[["7f12cf21.a3af1"]]},{"id":"e02ba6d7.e68a68","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":4933.250106811523,"y":2317.5000410079956,"z":"acdffee6.4646","wires":[["7f12cf21.a3af1"]]},{"id":"f2da480c.9764c8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":4930.393089294434,"y":2412.1429262161255,"z":"acdffee6.4646","wires":[["966b6bde.cc8f88"]]},{"id":"7f12cf21.a3af1","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='data-error' value=\"`'Service instance ' + $db.mapped-service-instance-id.forwarding-path-service-instance-id + ' has multiple VNFs but no forwarding paths were found'`\" />\n","comments":"","x":5120.750106811523,"y":2296.2500410079956,"z":"acdffee6.4646","wires":[]},{"id":"966b6bde.cc8f88","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":5059.143089294434,"y":2412.1429262161255,"z":"acdffee6.4646","wires":[["73c62547.358c5c","2c341601.f78f1a","18d9283c.3cd808"]]},{"id":"73c62547.358c5c","type":"set","name":"copy forwarding-paths to serv-insts array","xml":"<set>\n<parameter name='serv-cust[$serv-index].serv-insts[$tmp.serv-insts_length].forwarding-paths.'\n  value='`$mdsal-service.service[0].service-data.forwarding-paths.`' />\n","comments":"","x":5296.666580200195,"y":2412.500033378601,"z":"acdffee6.4646","wires":[]},{"id":"2c341601.f78f1a","type":"set","name":"copy serv-inst to serv-insts array","xml":"<set>\n<parameter name='serv-cust[$serv-index].serv-insts[$tmp.serv-insts_length].' value='`$serv-inst.`' />\n","comments":"","x":5272,"y":2366,"z":"acdffee6.4646","wires":[]},{"id":"18d9283c.3cd808","type":"set","name":"increment serv-insts_length","xml":"<set>\n<parameter name='tmp.serv-insts_length' value='`$tmp.serv-insts_length + 1`' />\n","comments":"","x":5254.6904296875,"y":2459.416748046875,"z":"acdffee6.4646","wires":[]},{"id":"ab273d26.ee67d","type":"switchNode","name":"switch service_length == serv-cust_length","xml":"<switch test='`$service-paths.service-path[$sp-index].service_length == $serv-cust_length`'>\n","comments":"","outputs":1,"x":1463.3333282470703,"y":2587.6667375564575,"z":"acdffee6.4646","wires":[["57af92ff.0a268c"]]},{"id":"432943b9.13704c","type":"for","name":"for each service-path","xml":"<for index='sp-index' start='0' end='`$service-paths.service-path_length`' >\n","comments":"","outputs":1,"x":1183.3333282470703,"y":2588.6667375564575,"z":"acdffee6.4646","wires":[["ab273d26.ee67d"]]},{"id":"db0b5e4d.138fb","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1001.3333282470703,"y":2710.6667375564575,"z":"acdffee6.4646","wires":[["b67f5438.96b3a8","432943b9.13704c","ed2004a7.484e98"]]},{"id":"b67f5438.96b3a8","type":"set","name":"set found-service-path to false","xml":"<set>\n<parameter name='found-service-path' value='false' />\n","comments":"","x":1211.3333282470703,"y":2542.6667375564575,"z":"acdffee6.4646","wires":[]},{"id":"57af92ff.0a268c","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1697.3333282470703,"y":2586.6667375564575,"z":"acdffee6.4646","wires":[["14f78ce9.5e1413"]]},{"id":"14f78ce9.5e1413","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1823.3333282470703,"y":2586.6667375564575,"z":"acdffee6.4646","wires":[["51e6f6dd.41b898","8e5d432a.80844"]]},{"id":"51e6f6dd.41b898","type":"set","name":"set found-service-path to true","xml":"<set>\n<parameter name='found-service-path' value='true' />\n","comments":"","x":2017.3333282470703,"y":2558.6667375564575,"z":"acdffee6.4646","wires":[]},{"id":"8e5d432a.80844","type":"break","name":"break","xml":"<break>\n","comments":"","x":1947.3333282470703,"y":2606.6667375564575,"z":"acdffee6.4646","wires":[]},{"id":"ed2004a7.484e98","type":"switchNode","name":"switch found-service-path","xml":"<switch test='`$found-service-path`'>\n","comments":"","outputs":1,"x":1197.3333282470703,"y":2922.6667375564575,"z":"acdffee6.4646","wires":[["902c3da4.38f8e","cc4f97d7.be3168"]]},{"id":"cc4f97d7.be3168","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1401.3333282470703,"y":3156.6667375564575,"z":"acdffee6.4646","wires":[["654073a0.8dc7dc"]]},{"id":"902c3da4.38f8e","type":"outcomeTrue","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":1383.3333282470703,"y":2702.6667375564575,"z":"acdffee6.4646","wires":[["95ceba9c.126508"]]},{"id":"95ceba9c.126508","type":"set","name":"set error (for logging only)","xml":"<set>\n<parameter name='error-message' value=\"`'No service paths found for path name '\n  + $db.path-segment[0].path-name`\" />\n","comments":"","x":1573.3333282470703,"y":2702.6667375564575,"z":"acdffee6.4646","wires":[]},{"id":"6026a1f0.02df4","type":"switchNode","name":"switch service_length == serv-cust_length","xml":"<switch test='`$service-paths.service-path[$sp-index].service_length == $serv-cust_length`'>\n","comments":"","outputs":1,"x":2000,"y":3522,"z":"acdffee6.4646","wires":[["ce386471.0c3478"]]},{"id":"ce386471.0c3478","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2234,"y":3521,"z":"acdffee6.4646","wires":[["c64714d6.1fcac8"]]},{"id":"c64714d6.1fcac8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2360,"y":3521,"z":"acdffee6.4646","wires":[["ec6851e3.24d41","f9f23fe5.c832e","ee78a452.895eb8"]]}]