[{"id":"7570f0f1.92a5b","type":"dgstart","name":"DGSTART","outputs":1,"x":151,"y":77,"z":"bf2de7b8.413148","wires":[["d3b5c6d7.62aef"]]},{"id":"d3b5c6d7.62aef","type":"service-logic","name":"GENERIC-RESOURCE-API 1.2.0-SNAPSHOT-111502","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":285.23809814453125,"y":128.952392578125,"z":"bf2de7b8.413148","wires":[["c52f0437.0bb6a8"]]},{"id":"c52f0437.0bb6a8","type":"method","name":"brg-topology-operation-assign","xml":"<method rpc='brg-topology-operation-assign' mode='sync'>\n","comments":"","outputs":1,"x":293.15485763549805,"y":173.19044589996338,"z":"bf2de7b8.413148","wires":[["5d72c5be.42607c"]]},{"id":"5d72c5be.42607c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":201.47619247436523,"y":316.5237879753113,"z":"bf2de7b8.413148","wires":[["ce4415de.9f0f4","d0247918.df4a68","20bd770e.2b589","f626fedf.f8fe98","5de71d7a.6cddd4"]]},{"id":"7d236fa8.ed7de","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":1044.6666564941406,"y":2243.5477046966553,"z":"bf2de7b8.413148","wires":[]},{"id":"410f6b01.d7177c","type":"set","name":"set output to api handler","xml":"<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='tunnelxconn-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $brg-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n","comments":"","x":1081.7540550231934,"y":2122.432439804077,"z":"bf2de7b8.413148","wires":[]},{"id":"98199cc9.6a499","type":"set","name":"set allotted-resource-oper-status","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='PendingCreate' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$brg-topology-operation-input.request-information.request-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$brg-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$brg-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n","comments":"","x":1153.468376159668,"y":1539.6228160858154,"z":"bf2de7b8.413148","wires":[]},{"id":"d0247918.df4a68","type":"set","name":"set tmp.ar.self-link","xml":"<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:tunnelxconn-allotted-resources/tunnelxconn-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/tunnelxconn-topology/'` \" />\n\n","comments":"","x":631.7380676269531,"y":208.33331298828125,"z":"bf2de7b8.413148","wires":[]},{"id":"ce4415de.9f0f4","type":"set","name":"set tmp.ar.allotted-resource-id,etc","xml":"<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$brg-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n<parameter name='tmp.ar.parent-service-instance-id' value='`$brg-topology-operation-input.allotted-resource-information.parent-service-instance-id`' />\n\n\n","comments":"","x":684.997314453125,"y":170.59259033203125,"z":"bf2de7b8.413148","wires":[]},{"id":"93640943.c5ad8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":834.8148803710938,"y":356.26727294921875,"z":"bf2de7b8.413148","wires":[["87e21149.4f9e4"]]},{"id":"f12334c3.4295d","type":"execute","name":"execute RestApiCallNode - PUT AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.brg.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":1174.8626251220703,"y":1764.1008231639862,"z":"bf2de7b8.413148","wires":[["fd12f3ff.cf69e","ab1088f2.67d178","b1a1234c.07f858"]]},{"id":"fd12f3ff.cf69e","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1443.5040016174316,"y":1815.4322349056602,"z":"bf2de7b8.413148","wires":[["8a32e9ad.06d778"]]},{"id":"ab1088f2.67d178","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1434.504051208496,"y":1783.9322606548667,"z":"bf2de7b8.413148","wires":[["8a32e9ad.06d778"]]},{"id":"b1a1234c.07f858","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1438.2540893554688,"y":1754.289365530014,"z":"bf2de7b8.413148","wires":[["22dd0dd8.431072"]]},{"id":"8a32e9ad.06d778","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for tunnelxconn-allotted-resource\" />\n","comments":"","x":1604.2540893554688,"y":1784.6822844967246,"z":"bf2de7b8.413148","wires":[]},{"id":"1f10f3f4.abae94","type":"set","name":"set oper-status","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$brg-ar.allotted-resource-data.allotted-resource-operation-information.request-information.request-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$brg-ar.allotted-resource-status.rpc-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$brg-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.svc-request-id`' />\n\n","comments":"","x":1184.5294189453125,"y":457.05291748046875,"z":"bf2de7b8.413148","wires":[]},{"id":"7cf9af45.cf036","type":"comment","name":"Save consumed-allotted-resources to mdsal","info":"","comments":"","x":1252.2434692382812,"y":1138.7196044921875,"z":"bf2de7b8.413148","wires":[]},{"id":"6194dab8.45fb04","type":"comment","name":"GET tunnelxconn-allotted-resource from mdsal","info":"","comments":"","x":557.8148193359375,"y":326.7672119140625,"z":"bf2de7b8.413148","wires":[]},{"id":"87e21149.4f9e4","type":"returnFailure","name":"return failure - tunnelxconn already exists","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" \n    value=\"`'Existing brg-allotted-resource with order status of ' + $mdsal-ar.allotted-resource-data.allotted-resource-oper-status.order-status + '.'`\" />\n","comments":"","x":1144.129150390625,"y":352.6243896484375,"z":"bf2de7b8.413148","wires":[]},{"id":"d7e419ac.10dda8","type":"set","name":"set brg-ar-identifiers","xml":"<set>\n<parameter name='brg-ar-identifiers.consuming-service-instance-id' value=\"`$brg-topology-operation-input.service-information.service-instance-id` \" />\n<parameter name='brg-ar-identifiers.parent-service-instance-id' value=\"`$brg-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n<parameter name='brg-ar-identifiers.allotted-resource-type' value=\"`$brg-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='brg-ar-identifiers.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n\n","comments":"","x":1194.38623046875,"y":550.6243896484375,"z":"bf2de7b8.413148","wires":[]},{"id":"29e4a25b.07caae","type":"comment","name":"Set allotted-resource-identifiers","info":"","comments":"","x":1221.338623046875,"y":509.338623046875,"z":"bf2de7b8.413148","wires":[]},{"id":"a7fa051c.ec08b8","type":"set","name":"set identifiers in overall structure","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.allotted-resource-identifiers.' \nvalue=\"`$brg-ar-identifiers.`\" />\n\n\n","comments":"","x":1211.38623046875,"y":858.910400390625,"z":"bf2de7b8.413148","wires":[]},{"id":"a1de8aef.82fc18","type":"set","name":"set onap model information from input","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.brg-topology.onap-model-information.' \nvalue=\"`$brg-topology-operation-input.allotted-resource-information.onap-model-information.`\" />\n\n\n","comments":"","x":1239.957763671875,"y":593.9100952148438,"z":"bf2de7b8.413148","wires":[]},{"id":"a718dba2.92623","type":"switchNode","name":"switch model-invariant-uuid is null","xml":"<switch test='$brg-topology-operation-input.allotted-resource-information.onap-model-information.model-invariant-uuid'>\n","comments":"","outputs":1,"x":1219.8148193359375,"y":633.19580078125,"z":"bf2de7b8.413148","wires":[["7ca287e7.711478"]]},{"id":"7ca287e7.711478","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1447.9576988220215,"y":634.6243271827698,"z":"bf2de7b8.413148","wires":[["71896d4.b06f794"]]},{"id":"71896d4.b06f794","type":"set","name":"set model-invariant-uuid","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.onap-model-information.model-invariant-uuid' \nvalue=\"`$ar-model.invariant-uuid`\" />\n\n\n","comments":"","x":1649.38627243042,"y":634.0528798103333,"z":"bf2de7b8.413148","wires":[]},{"id":"8606bb79.93a638","type":"switchNode","name":"switch model-uuid is null","xml":"<switch test='$brg-topology-operation-input.allotted-resource-information.onap-model-information.model-uuid'>\n","comments":"","outputs":1,"x":1192.2434158325195,"y":667.4815106391907,"z":"bf2de7b8.413148","wires":[["79f93f5.6db044"]]},{"id":"79f93f5.6db044","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1393.6719818115234,"y":668.0529322624207,"z":"bf2de7b8.413148","wires":[["c81e4cfe.eaa8d8"]]},{"id":"c81e4cfe.eaa8d8","type":"set","name":"set model-uuid","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.onap-model-information.model-uuid' \nvalue=\"`$ar-model.uuid`\" />\n\n\n","comments":"","x":1586.529140472412,"y":668.0528540611267,"z":"bf2de7b8.413148","wires":[]},{"id":"d9e258a7.c1071","type":"switchNode","name":"switch model-version is null","xml":"<switch test='$brg-topology-operation-input.allotted-resource-information.onap-model-information.model-version'>\n","comments":"","outputs":1,"x":1200.8148193359375,"y":700.3386378288269,"z":"bf2de7b8.413148","wires":[["8ee38127.aa0868"]]},{"id":"8ee38127.aa0868","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1450.8148002624512,"y":700.3386225700378,"z":"bf2de7b8.413148","wires":[["610bece7.c45dd4"]]},{"id":"610bece7.c45dd4","type":"set","name":"set model-version","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.model-version' \nvalue=\"`$ar-model.version`\" />\n\n\n","comments":"","x":1643.6719589233398,"y":700.3385443687439,"z":"bf2de7b8.413148","wires":[]},{"id":"7885bfde.a79488","type":"switchNode","name":"switch ar-model.ecomp-generated-naming","xml":"<switch test='`$ar-model.ecomp-generated-naming`'>\n","comments":"","outputs":1,"x":1264.38623046875,"y":802.7672729492188,"z":"bf2de7b8.413148","wires":[["9239a2ce.fafa4","e195da86.529e68"]]},{"id":"9239a2ce.fafa4","type":"other","name":"outcome Y","xml":"<outcome value='Y'>\n","comments":"","outputs":1,"x":1550.3862915039062,"y":802.1958618164062,"z":"bf2de7b8.413148","wires":[["cad0403.cd4d94"]]},{"id":"cad0403.cd4d94","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">\n","atomic":"true","comments":"","outputs":1,"x":1704.1363525390625,"y":804.69580078125,"z":"bf2de7b8.413148","wires":[["35d70668.6be0d2"]]},{"id":"e195da86.529e68","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1569.608642578125,"y":891.1958618164062,"z":"bf2de7b8.413148","wires":[["d35a58bc.e50138"]]},{"id":"d35a58bc.e50138","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error in allotted-resource-model data.  Ecomp-generated-naming should be true\" />\n\n","comments":"","x":1752.608642578125,"y":896.1958618164062,"z":"bf2de7b8.413148","wires":[]},{"id":"35d70668.6be0d2","type":"switchNode","name":"switch ar-model.ecomp-generated-naming","xml":"<switch test='`$ar-model.naming-policy`'>\n","comments":"","outputs":1,"x":1840.38623046875,"y":853.767333984375,"z":"bf2de7b8.413148","wires":[["c5a38d06.972378","d046dbae.b5109"]]},{"id":"c5a38d06.972378","type":"other","name":"outcome oam_network_policy","xml":"<outcome value='oam_network_policy'>\n","comments":"","outputs":1,"x":2215.244140625,"y":857.3453369140625,"z":"bf2de7b8.413148","wires":[["53d31de0.592f64"]]},{"id":"d046dbae.b5109","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2129.671875,"y":934.1958618164062,"z":"bf2de7b8.413148","wires":[["53d31de0.592f64"]]},{"id":"a6d75105.5c52c8","type":"set","name":"set ar_name","xml":"<set>\n<parameter name='tmp.ar-name' value='$TenantOAMNetworkRole_$LandingNetworkRole_SZ' />\n","comments":"","x":2521.100830078125,"y":892.7672729492188,"z":"bf2de7b8.413148","wires":[]},{"id":"af081f6c.54a4d","type":"execute","name":"execute SliStringUtils - replace TenantOAMNetworkRole","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$TenantOAMNetworkRole\"/>\n    <parameter name=\"replacement\" value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.untrusted-network-role`\"/>\n\n","comments":"","outputs":1,"x":2665.2437858581543,"y":936.6244196891785,"z":"bf2de7b8.413148","wires":[[]]},{"id":"86105782.997358","type":"execute","name":"execute SliStringUtils - replace LandingNetworkRole","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$LandingNetworkRole\"/>\n    <parameter name=\"replacement\" value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.trusted-network-role`\"/>\n\n","comments":"","outputs":1,"x":2652.243896484375,"y":976.7672729492188,"z":"bf2de7b8.413148","wires":[[]]},{"id":"53d31de0.592f64","type":"block","name":"block: atomic","xml":"<block atomic='true'>\n","atomic":"false","comments":"","outputs":1,"x":2329.5292015075684,"y":932.3387522697449,"z":"bf2de7b8.413148","wires":[["a6d75105.5c52c8","af081f6c.54a4d","86105782.997358","8d2f4598.fa58"]]},{"id":"8d2f4598.fa58","type":"set","name":"set identifiers.allotted-resource-name","xml":"<set>\n<parameter name='brg-ar-identifiers.allotted-resource-name' value='`$tmp.ar-name`' />\n","comments":"","x":2610.1005859375,"y":1027.052978515625,"z":"bf2de7b8.413148","wires":[]},{"id":"489a55af.96a154","type":"set","name":"set assignments in overall structure","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.brg-assignments.' \nvalue=\"`$brg-ar-assignments.`\" />\n\n\n","comments":"","x":1219.8624572753906,"y":1063.6246919631958,"z":"bf2de7b8.413148","wires":[]},{"id":"6e15816e.dc1a18","type":"set","name":"Handle brg-ar-assignments","xml":"<set>\n<parameter name='brg-ar-assignments.vbrg-wan-ip' value='127.0.0.1'/>\n","comments":"","x":1199.529052734375,"y":960.0530395507812,"z":"bf2de7b8.413148","wires":[]},{"id":"93589f82.f74e7","type":"for","name":"for cidx..service-data.consumed-allotted-resources.consumed-allotted-resource[]","xml":"<for index='cidx' start='0' end='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' >\n","comments":"","outputs":1,"x":2237.8155822753906,"y":1337.0411586761475,"z":"bf2de7b8.413148","wires":[["10287613.ac1c5a"]]},{"id":"6a7c81a4.d6b458","type":"switchNode","name":"switch service-data.consumed-allotted-resources_length","xml":"<switch test='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`'>\n","comments":"","outputs":1,"x":1268.8148193359375,"y":1224.505126953125,"z":"bf2de7b8.413148","wires":[["93c6f9b5.58d778","7c7889c0.2dcf9"]]},{"id":"93c6f9b5.58d778","type":"other","name":"outcome Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1644.2077865600586,"y":1229.1124458312988,"z":"bf2de7b8.413148","wires":[["51706315.19d304"]]},{"id":"7c7889c0.2dcf9","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1642.9577865600586,"y":1319.1124477386475,"z":"bf2de7b8.413148","wires":[["97e6df3f.75cba"]]},{"id":"10287613.ac1c5a","type":"switchNode","name":"switch allotted-resource-id","xml":"<switch test=\"`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].allotted-resource-id == $tmp.ar.allotted-resource-id`\">\n\n","comments":"","outputs":1,"x":2672.4106826782227,"y":1338.85085105896,"z":"bf2de7b8.413148","wires":[["b1182dc2.599"]]},{"id":"b1182dc2.599","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2879.220375061035,"y":1342.064962387085,"z":"bf2de7b8.413148","wires":[["4a37e6ba.7ef7c8"]]},{"id":"97e6df3f.75cba","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1800.834976196289,"y":1325.4885501861572,"z":"bf2de7b8.413148","wires":[["93589f82.f74e7","af2682ec.9c827"]]},{"id":"4a37e6ba.7ef7c8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3047.4817276000977,"y":1346.9222631454468,"z":"bf2de7b8.413148","wires":[["4d3df632.b7a47","b70883dd.4d196"]]},{"id":"51706315.19d304","type":"set","name":"set cidx","xml":"<set>\n<parameter name='tmp.cidx' value=\"`0`\" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value=\"1\" />\n\n\n","comments":"","x":1823.0647735595703,"y":1231.3266830444336,"z":"bf2de7b8.413148","wires":[]},{"id":"4d3df632.b7a47","type":"set","name":"set tmp.cidx and ctx.consumed-ar","xml":"<set>\n<parameter name='tmp.cidx' value='`$cidx`' />\n<parameter name='ctx.consumed-ar.' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].`' />\n<parameter name='tmp.found-cidx' value='true' />","comments":"","x":3293.3391876220703,"y":1341.4937419891357,"z":"bf2de7b8.413148","wires":[]},{"id":"764d1d1a.157ec4","type":"set","name":"set consumed allotted resources","xml":"<set>\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-type' value=\"`$brg-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-pointer' value=\"`$tmp.ar.self-link` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value='`$tmp.cidx + 1`' />\n\n","comments":"","x":1179.6720123291016,"y":1389.826681137085,"z":"bf2de7b8.413148","wires":[]},{"id":"22dd0dd8.431072","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1579.910057067871,"y":1750.4815347194672,"z":"bf2de7b8.413148","wires":[["c6583a43.de49f"]]},{"id":"20da9a61.ce80de","type":"comment","name":"Add BRG AR to mdsal","info":"","comments":"","x":1104.148208618164,"y":1725.1957080364227,"z":"bf2de7b8.413148","wires":[]},{"id":"d18da704.925258","type":"execute","name":"execute getTime","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n","comments":"","outputs":1,"x":1120.4814224243164,"y":1463.671986579895,"z":"bf2de7b8.413148","wires":[[]]},{"id":"485cf3c4.63339c","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":840.57666015625,"y":407.4814453125,"z":"bf2de7b8.413148","wires":[["f17f867f.41ed8"]]},{"id":"f17f867f.41ed8","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":788.57666015625,"y":903.2908325195312,"z":"bf2de7b8.413148","wires":[["c9560d04.6cea5","d7e419ac.10dda8","a1de8aef.82fc18","a718dba2.92623","8606bb79.93a638","d9e258a7.c1071","1f10f3f4.abae94","7885bfde.a79488","a7fa051c.ec08b8","6e15816e.dc1a18","489a55af.96a154","6a7c81a4.d6b458","764d1d1a.157ec4","d18da704.925258","98199cc9.6a499","1ef29606.df61aa","f12334c3.4295d","410f6b01.d7177c","7d236fa8.ed7de"]]},{"id":"c9560d04.6cea5","type":"set","name":"set id","xml":"<set>\n<parameter name='brg-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='brg-ar.allotted-resource-status.action' value=\"`$brg-topology-operation-input.request-information.request-action` \" />\n<parameter name='brg-ar.allotted-resource-status.rpc-name' value=\"brg-topology-operation\" />\n<parameter name='brg-ar.allotted-resource-status.rpc-action' value=\"`$brg-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$brg-topology-operation-input.request-information.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$brg-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$brg-topology-operation-input.service-information.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$brg-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.tunnelxconn-request-input.' value=\"`$brg-topology-operation-input.brg-request-input.` \" />","comments":"","x":1159.2434387207031,"y":413.433837890625,"z":"bf2de7b8.413148","wires":[]},{"id":"1ef29606.df61aa","type":"update","name":"update AAI allotted-resource","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $brg-topology-operation-input.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $brg-topology-operation-input.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $brg-topology-operation-input.allotted-resource-information.parent-service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n\t<parameter name=\"description\" value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-type`\" />\n\t<parameter name=\"selflink\" value=\"`$tmp.ar.self-link`\" />\n\t<parameter name=\"model-invariant-id\" value=\"`$ar-model.invariant-uuid`\" />\n\t<parameter name=\"model-version-id\" value=\"`$ar-model.uuid`\" />\n\t<parameter name=\"operational-status\" value=\"null\" />\n","comments":"","outputs":1,"x":1141.0529327392578,"y":1631.5767517089844,"z":"bf2de7b8.413148","wires":[["d36496a4.dab97","995b6679.f48c1"]]},{"id":"d36496a4.dab97","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1396.814842224121,"y":1614.5292553901672,"z":"bf2de7b8.413148","wires":[["b90d9c62.7bb3c"]]},{"id":"b90d9c62.7bb3c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n","comments":"","x":1563.338722229004,"y":1626.1483263969421,"z":"bf2de7b8.413148","wires":[]},{"id":"995b6679.f48c1","type":"failure","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1403.9101295471191,"y":1647.2912230491638,"z":"bf2de7b8.413148","wires":[["b90d9c62.7bb3c"]]},{"id":"af2682ec.9c827","type":"switchNode","name":"switch tmp.found-cidx","xml":"<switch test='`$tmp.found-cidx`'>\n","comments":"","outputs":1,"x":2052.743423461914,"y":1583.2315921783447,"z":"bf2de7b8.413148","wires":[["d9e9d9ac.d49268"]]},{"id":"d9e9d9ac.d49268","type":"outcomeTrue","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":2242.743377685547,"y":1583.2315292358398,"z":"bf2de7b8.413148","wires":[["a1cb35d3.82d23"]]},{"id":"a1cb35d3.82d23","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2408.743377685547,"y":1583.2315292358398,"z":"bf2de7b8.413148","wires":[["b0efdb24.9fd4c"]]},{"id":"b0efdb24.9fd4c","type":"set","name":"set tmp.cidx ","xml":"<set>\n<parameter name='tmp.cidx' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' />\n","comments":"","x":2654.600706100464,"y":1583.8030033111572,"z":"bf2de7b8.413148","wires":[]},{"id":"c6583a43.de49f","type":"execute","name":"execute RestApiCallNode - Update parent provided service AR","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.parentsvc.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.parent-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='DELETE' />\n    <parameter name=\"responsePrefix\" value=\"parent\" />\n\n","comments":"","outputs":1,"x":1930.9521980285645,"y":1750.1904199123383,"z":"bf2de7b8.413148","wires":[["9ff1a968.b8411","551760d4.5414a8","4b3d2583.fd580c"]]},{"id":"86908d89.d4e3e8","type":"comment","name":"Rollback parent","info":"","comments":"","x":1774.9521255493164,"y":1719.8570504188538,"z":"bf2de7b8.413148","wires":[]},{"id":"9ff1a968.b8411","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2302.2602462768555,"y":1810.8553862571716,"z":"bf2de7b8.413148","wires":[["5bf32973.a0689"]]},{"id":"551760d4.5414a8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2293.26029586792,"y":1779.3554120063782,"z":"bf2de7b8.413148","wires":[["5bf32973.a0689"]]},{"id":"4b3d2583.fd580c","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2297.0103340148926,"y":1749.7125168815255,"z":"bf2de7b8.413148","wires":[["5bf32973.a0689"]]},{"id":"5bf32973.a0689","type":"block","name":"block","xml":"<block>","atomic":"false","comments":"","outputs":1,"x":2438.666301727295,"y":1745.9046860709786,"z":"bf2de7b8.413148","wires":[[]]},{"id":"d3365f28.2dd8d","type":"comment","name":"Generate naming","info":"","comments":"","x":1195.3862762451172,"y":760.7672252655029,"z":"bf2de7b8.413148","wires":[]},{"id":"20bd770e.2b589","type":"get-resource","name":"get-resource tunnelxconn-allotted-resource","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='GENERIC-RESOURCE-API' key='brg-allotted-resources/brg-allotted-resource/$brg-topology-operation-input.allotted-resource-information.allotted-resource-id/' pfx='mdsal-ar' >\n","comments":"","outputs":1,"x":540,"y":359,"z":"bf2de7b8.413148","wires":[["485cf3c4.63339c"]]},{"id":"f626fedf.f8fe98","type":"execute","name":"execute Properties","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":616,"y":250,"z":"bf2de7b8.413148","wires":[[]]},{"id":"5de71d7a.6cddd4","type":"execute","name":"generate allotted-resource url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.brg-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n","comments":"","outputs":1,"x":623,"y":290,"z":"bf2de7b8.413148","wires":[[]]},{"id":"b70883dd.4d196","type":"break","name":"break","xml":"<break>","comments":"","x":3206.243507385254,"y":1386.7316856384277,"z":"bf2de7b8.413148","wires":[]}]
