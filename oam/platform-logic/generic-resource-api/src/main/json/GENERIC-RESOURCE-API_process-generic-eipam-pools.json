[{"id":"6639e046.20571","type":"comment","name":"Required INPUTS","info":"required INPUTS:\n\n$aai.cloud-region.cloud-region-id from AAI, vf-module-topology-operation-input or RA\nnetwork-model - from Tosca model or RA\ntmp.skip-first-level - set to Y if already created in EIPAM\ntmp.allocate-subnet-flag - Y if EIPAM should allocate automatically, \n       else N in which case eipam-allocate-generic-subnet will be called \n       to allocate subnet using same key_names & key_values as the createPool \n       based on generate-FQPN outputs.\nif driven by capabilities input, set following accordingly\n\t\t\tnetwork-model.eipam-v4-address-plan\n\t\t\tnetwork-model.eipam-v6-address-plan\n\t\t\tnetwork-model.use-ipv4\n\t\t\tnetwork-model.use-ipv6\n\nSet the necessary values as inputs for all the key_values as needed\n for the specific Address Plans based on generate-FQPN DG required inputs:\n\ngenerate-FQPN-input.aic-cloud-region\ngenerate-FQPN-input.location-clli8\ngenerate-FQPN-input.complex-region\ngenerate-FQPN-input.network-name\ngenerate-FQPN-input.network-role\ngenerate-FQPN-input.vrf-name\ngenerate-FQPN-input.network-collection\ngenerate-FQPN-input.network-id\ngenerate-FQPN-input.subnet-role\ngenerate-FQPN-input.zone\ngenerate-FQPN-input.equipment\n\nOptional Inputs\n\t\ntmp.activate-subnet-flag - set to Y or N to have EIPAM activate it(Default to Y)\t\n(If for shared network)\nnetwork-topology-operation-input.network-request-input.network-instance-group-id\n","comments":"","x":637.7777709960938,"y":99.99999809265137,"z":"5699c5cb.963a7c","wires":[]},{"id":"fbf3c5c8.de5c78","type":"dgstart","name":"DGSTART","outputs":1,"x":145.8730239868164,"y":25.55555534362793,"z":"5699c5cb.963a7c","wires":[["c869b773.2f8a58"]]},{"id":"c869b773.2f8a58","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":208.44445419311523,"y":77.5198392868042,"z":"5699c5cb.963a7c","wires":[["2dc4b3d0.17207c"]]},{"id":"2dc4b3d0.17207c","type":"method","name":"process-generic-eipam-pools","xml":"<method rpc=\"process-generic-eipam-pools\" mode=\"sync\">","comments":"This DG relys on generate-FQPN to determine the key_names & key_values for all levels for the specified plan-name.","outputs":1,"x":177.2222137451172,"y":157.8254165649414,"z":"5699c5cb.963a7c","wires":[["f85abacd.8c5448"]]},{"id":"4020be51.23848","type":"comment","name":"GENERIC-RESOURCE-API: process-generic-eipam-pools","info":"1806 - Used by VLAN-Tagging for network-collection. This can be reused by adding \nother key-values as needed by other Address Plans.","comments":"","x":509.9999694824219,"y":27.77777671813965,"z":"5699c5cb.963a7c","wires":[]},{"id":"7ef17b38.7db444","type":"for","name":"for l-idx: getPlanTopologyResponse.TopologyDetails[]","xml":"<for index=\"l-idx\" start=\"1\" end=\"`$eipam-ip-block.getPlanTopologyResponse.TopologyDetails_length + 1`\">","comments":"","outputs":1,"x":384.3253059387207,"y":2139.920602798462,"z":"5699c5cb.963a7c","wires":[["fc1b7d2e.0283"]]},{"id":"f85abacd.8c5448","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":117.77777099609375,"y":264.4444408416748,"z":"5699c5cb.963a7c","wires":[["9b260fd6.396cf","8ca80066.09737","a6616785.d520f8","7ef17b38.7db444","801abe02.e2e1b","72c6fa14.eb5414","4f1fda53.55bbe4","9b3275bb.0d36d8","b17da27b.64d35","b8e79a11.50fec8","adf823e9.02928","98682fc4.05c22","a551348.af4dac8","e85e7565.d76da8","5e9374f6.85274c"]]},{"id":"9b260fd6.396cf","type":"set","name":"set: data initialization","xml":"<set>\n\t<parameter name=\"tmp.eipam-error\" value=\"false\" />\n\t<parameter name=\"tmp.create-v4-pool-flag\" value=\"N\" />\n\t<parameter name=\"tmp.create-v6-pool-flag\" value=\"N\" />\n\t<parameter name='eipam-ip-block.plans_length' value='0' />\n\t<parameter name=\"eipam-pool.v4.pre-existing\" value=\"false\"/>\n\t<parameter name=\"eipam-pool.v6.pre-existing\" value=\"false\"/>\n<!-- <parameter name=\"tmp.network-id\" value=\"`$tmp.l3-network.network-id`\" /> -->\n\t<parameter name=\"tmp.network-id\" value=\"`$network-topology-operation-input.network-information.network-id`\" />\n\n","comments":"","x":378.0159149169922,"y":201.1111421585083,"z":"5699c5cb.963a7c","wires":[]},{"id":"dc240e90.7c143","type":"call","name":"call: generate-FQPN","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-FQPN' mode='sync' >","comments":"","outputs":1,"x":884.0478057861328,"y":1528.511996269226,"z":"5699c5cb.963a7c","wires":[["d7b5dc50.66bae"]]},{"id":"d7b5dc50.66bae","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":1057.1430835723877,"y":1527.7025480270386,"z":"5699c5cb.963a7c","wires":[["c8e18c62.f671c"]]},{"id":"c8e18c62.f671c","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"`'An error occured while generating FQPN: '+ $error-message`\" />\n","comments":"","x":1203.1430854797363,"y":1527.7025480270386,"z":"5699c5cb.963a7c","wires":[]},{"id":"acef8d81.05eac","type":"set","name":"set generate-FQPN-input.plan-name v4","xml":"<set>\n<parameter name='generate-FQPN-input.plan-name' value='`$network-model.eipam-v4-address-plan`' />\n","comments":"","x":958.4131126403809,"y":1449.742238998413,"z":"5699c5cb.963a7c","wires":[]},{"id":"8ca80066.09737","type":"switchNode","name":"switch: network-model.use-ipv4","xml":"<switch test=\"`$network-model.use-ipv4`\">","comments":"","outputs":1,"x":312.36134338378906,"y":1563.7501077651978,"z":"5699c5cb.963a7c","wires":[["cb7c8c1c.091c9","5ff70d5e.fcb184","90712d6.6f872d"]]},{"id":"5ff70d5e.fcb184","type":"other","name":"NULL","xml":"<outcome value=\"\">","comments":"","outputs":1,"x":521.8614349365234,"y":1616.750150680542,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"cb7c8c1c.091c9","type":"other","name":"Y","xml":"<outcome value='Y'>","comments":"","outputs":1,"x":520.8614921569824,"y":1569.0000972747803,"z":"5699c5cb.963a7c","wires":[["be3bd336.71a94"]]},{"id":"be3bd336.71a94","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":678.3335800170898,"y":1527.7223300933838,"z":"5699c5cb.963a7c","wires":[["dc240e90.7c143","3e7b82c9.2f3e8e","acef8d81.05eac"]]},{"id":"90712d6.6f872d","type":"other","name":"N","xml":"<outcome value='N'>","comments":"","outputs":1,"x":517.8613967895508,"y":1525.9400367736816,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"fc1b7d2e.0283","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":664.722110748291,"y":2143.0636167526245,"z":"5699c5cb.963a7c","wires":[["e878ceff.dd9e7","4fdc7750.bee6d8","a5b75182.1e4e"]]},{"id":"4f1fda53.55bbe4","type":"switchNode","name":"switch: generate-FQPN-input.zone","xml":"<switch test='`$generate-FQPN-input.zone`'>\n","comments":"","outputs":1,"x":403.7500057220459,"y":430.0000114440918,"z":"5699c5cb.963a7c","wires":[["7d09f53.0ec530c"]]},{"id":"7d09f53.0ec530c","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":615.0000114440918,"y":429.5000066757202,"z":"5699c5cb.963a7c","wires":[["2c36f082.69714"]]},{"id":"138dbc4b.50e054","type":"comment","name":"go thru each level in topology","info":"Level 1 is special case, since if EIPAM already created it, \nthen just skip.","comments":"","x":310.0596046447754,"y":2064.0476608276367,"z":"5699c5cb.963a7c","wires":[]},{"id":"e878ceff.dd9e7","type":"set","name":"set values needed for eipam","xml":"<set>\n<parameter name='eipam-ip-block.entity-id' value='' />\n<parameter name='eipam-ip-block.ip-prefix' value='' />\n<parameter name='eipam-ip-block.mask' value='' />\n<parameter name=\"eipam-ip-block.level\" value='`$l-idx`' />\n<parameter name='eipam-pool.v4.pre-existing' value='false' />\n<parameter name='eipam-pool.v6.pre-existing' value='false' />\n","comments":"","x":874.8808746337891,"y":2141.8332347869873,"z":"5699c5cb.963a7c","wires":[]},{"id":"23866667.fbee0a","type":"comment","name":"Create pools for each level - includes v4 and v6","info":"","comments":"","x":368.2938117980957,"y":2101.095058441162,"z":"5699c5cb.963a7c","wires":[]},{"id":"4fdc7750.bee6d8","type":"call","name":"call eipam-create-generic-pool for l-idx level","xml":"<call module='GENERIC-RESOURCE-API' rpc='eipam-create-generic-pool' mode='sync' >\n","comments":"tmp.level should be set to 1","outputs":1,"x":921.9128074645996,"y":2178.5236492156982,"z":"5699c5cb.963a7c","wires":[["40f29997.00db98","af688d4d.bea39"]]},{"id":"40f29997.00db98","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":1224.6744422912598,"y":2179.328414916992,"z":"5699c5cb.963a7c","wires":[["61dca39.09b5f5c"]]},{"id":"64182e18.d54fa","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while creating pool\" />\n\t","comments":"","x":1587.7342262268066,"y":2176.0069007873535,"z":"5699c5cb.963a7c","wires":[]},{"id":"67b6f066.f59d3","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"GENERIC-RESOURCE-API.process-generic-eipam-pools:REQID\"/>\n<parameter name=\"field3\" value=\"`$network-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"`$l-idx`\"/>\n<parameter name=\"field5\" value=\"`$eipam-pool.v4.pre-existing`\"/>\n<parameter name=\"field6\" value=\"eipam-pool.v4.pre-existing\"/>\n<parameter name=\"field7\" value=\"`$eipam-pool.v6.pre-existing`\"/>\n<parameter name=\"field8\" value=\"tmp.create-v4-pool-flag\" />\n<parameter name=\"field9\" value=\"`$tmp.create-v4-pool-flag`\" />\n<parameter name=\"field10\" value=\"tmp.create-v6-pool-flag\" />\n<parameter name=\"field11\" value=\"`$tmp.create-v6-pool-flag`\" />\n<parameter name=\"field12\" value=\"Successful\" />\n","comments":"","outputs":1,"x":1576.3542213439941,"y":2211.2271785736084,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"af688d4d.bea39","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1224.4969902038574,"y":2210.8778958320618,"z":"5699c5cb.963a7c","wires":[["cd684d36.53dbb"]]},{"id":"cd684d36.53dbb","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":1393.6080780029297,"y":2210.13196516037,"z":"5699c5cb.963a7c","wires":[["67b6f066.f59d3"]]},{"id":"61dca39.09b5f5c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":1392.1162338256836,"y":2156.3464679718018,"z":"5699c5cb.963a7c","wires":[["64182e18.d54fa","a8738c2a.45fc"]]},{"id":"a8738c2a.45fc","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"GENERIC-RESOURCE-API.process-generic-eipam-pools:REQID\"/>\n<parameter name=\"field3\" value=\"`$network-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"Error creating pool for level\"/>\n<parameter name=\"field5\" value=\"`$l-idx`\"/>\n\n","comments":"","outputs":1,"x":1570.985252380371,"y":2131.7431964874268,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"3e7b82c9.2f3e8e","type":"set","name":"set v4FQPN-output","xml":"<set>\n\t<parameter name=\"v4FQPN-output.\" value=\"generate-FQPN-output.\"/>\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":883.1549301147461,"y":1594.166742324829,"z":"5699c5cb.963a7c","wires":[]},{"id":"e6178867.650b28","type":"call","name":"call: generate-FQPN","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-FQPN' mode='sync' >","comments":"","outputs":1,"x":891.2699584960938,"y":1732.916711807251,"z":"5699c5cb.963a7c","wires":[["51c1bf8e.d4ee8"]]},{"id":"51c1bf8e.d4ee8","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":1064.3652362823486,"y":1732.1072635650635,"z":"5699c5cb.963a7c","wires":[["1b67d960.c217c7"]]},{"id":"1b67d960.c217c7","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"`'An error occured while generating FQPN: '+ $error-message`\" />\n","comments":"","x":1210.3652381896973,"y":1732.1072635650635,"z":"5699c5cb.963a7c","wires":[]},{"id":"96ff74dd.aeb058","type":"set","name":"set generate-FQPN-input.plan-name v6","xml":"<set>\n<parameter name='generate-FQPN-input.plan-name' value='`$network-model.eipam-v6-address-plan`' />\n","comments":"","x":944.2064781188965,"y":1680.7541151046753,"z":"5699c5cb.963a7c","wires":[]},{"id":"a6616785.d520f8","type":"switchNode","name":"switch: network-model.use-ipv6","xml":"<switch test=\"`$network-model.use-ipv6`\">","comments":"","outputs":1,"x":319.58349609375,"y":1768.1548233032227,"z":"5699c5cb.963a7c","wires":[["4f012967.c289a8","cf85cf74.c416b","e049d83c.4571c8"]]},{"id":"cf85cf74.c416b","type":"other","name":"NULL","xml":"<outcome value=\"\">","comments":"","outputs":1,"x":529.0835876464844,"y":1821.154866218567,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"4f012967.c289a8","type":"other","name":"Y","xml":"<outcome value='Y'>","comments":"","outputs":1,"x":528.0836448669434,"y":1773.4048128128052,"z":"5699c5cb.963a7c","wires":[["da6bc1e.6da914"]]},{"id":"da6bc1e.6da914","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":680.0201263427734,"y":1772.1271743774414,"z":"5699c5cb.963a7c","wires":[["e6178867.650b28","f5a220bc.5210c","96ff74dd.aeb058"]]},{"id":"e049d83c.4571c8","type":"other","name":"N","xml":"<outcome value='N'>","comments":"","outputs":1,"x":525.0835494995117,"y":1730.3447523117065,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"f5a220bc.5210c","type":"set","name":"set v6FQPN-output","xml":"<set>\n\t<parameter name=\"v6FQPN-output.\" value=\"generate-FQPN-output.\"/>\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":890.3771286010742,"y":1798.5714092254639,"z":"5699c5cb.963a7c","wires":[]},{"id":"9dff2817.fe14a8","type":"comment","name":"Check for mask override","info":"Only needed for allocateSubnet","comments":"","x":308.8663635253906,"y":1915.8623867034912,"z":"5699c5cb.963a7c","wires":[]},{"id":"44d80ecf.eafed","type":"for","name":"for pidx..$network-topology-operation-input.network-request-input.network-input-parameters[]","xml":"<for index='pidx' start='0' end='`$network-topology-operation-input.network-request-input.network-input-parameters.param_length`' >\n","comments":"","outputs":1,"x":1521.7236022949219,"y":1981.4338660240173,"z":"5699c5cb.963a7c","wires":[["bcee52bc.a960d"]]},{"id":"72c6fa14.eb5414","type":"switchNode","name":"network-topology-operation-input.network-request-input.network-input-parameters.param_length","xml":"<switch test=\"`$network-topology-operation-input.network-request-input.network-input-parameters.param_length`\">","comments":"","outputs":1,"x":534.5806274414062,"y":1948.719524383545,"z":"5699c5cb.963a7c","wires":[["9b1de44.065e618","bb217635.69a128"]]},{"id":"9b1de44.065e618","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":966.0090999603271,"y":1949.1481075286865,"z":"5699c5cb.963a7c","wires":[["dd0b8cb9.090d4"]]},{"id":"dd0b8cb9.090d4","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1131.4377310616628,"y":1949.2909652165004,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"bb217635.69a128","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":950.2947731018066,"y":1981.576675415039,"z":"5699c5cb.963a7c","wires":[["1532ecad.3b8f83"]]},{"id":"1532ecad.3b8f83","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1122.2948837280273,"y":1981.5766677856445,"z":"5699c5cb.963a7c","wires":[["44d80ecf.eafed"]]},{"id":"bcee52bc.a960d","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1956.8660583496094,"y":1981.6719074249268,"z":"5699c5cb.963a7c","wires":[["434f2ab8.2dbe94","b8d20e27.f4ff8"]]},{"id":"434f2ab8.2dbe94","type":"execute","name":"SliStringUtils - check v4 override","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='contains'  emitsOutcome='true' >\n    <parameter name=\"source\" value=\"`$network-topology-operation-input.network-request-input.network-input-parameters.param[$pidx].name`\" />\n    <parameter name=\"target\" value=\"network_assignments_ipv4_subnet_default_assignment_cidr_mask\"/>\n  \n","comments":"","outputs":1,"x":2221.1993865966797,"y":1981.3385486602783,"z":"5699c5cb.963a7c","wires":[["40772195.8256f"]]},{"id":"40772195.8256f","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2448.5329551696777,"y":1981.3385925292969,"z":"5699c5cb.963a7c","wires":[["ed6c781b.a3ac38"]]},{"id":"ed6c781b.a3ac38","type":"set","name":"set subnet override for v4","xml":"<set>\n<parameter name='eipam-ip-block.subnet-size-override-v4' value='`$network-topology-operation-input.network-request-input.network-input-parameters.param[$pidx].value`' />\n\n","comments":"","x":2654.8663024902344,"y":1981.3385334014893,"z":"5699c5cb.963a7c","wires":[]},{"id":"b8d20e27.f4ff8","type":"execute","name":"SliStringUtils - check v6 override","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='contains'  emitsOutcome='true' >\n    <parameter name=\"source\" value=\"`$network-topology-operation-input.network-request-input.network-input-parameters.param[$pidx].name`\" />\n    <parameter name=\"target\" value=\"network_assignments_ipv6_subnet_default_assignment_cidr_mask\"/>\n  \n","comments":"","outputs":1,"x":2219.4496002197266,"y":2024.5052280426025,"z":"5699c5cb.963a7c","wires":[["71f73fc7.4a33a"]]},{"id":"71f73fc7.4a33a","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2448.7831687927246,"y":2025.505271911621,"z":"5699c5cb.963a7c","wires":[["eda6c591.c61198"]]},{"id":"eda6c591.c61198","type":"set","name":"set subnet override for v6","xml":"<set>\n<parameter name='eipam-ip-block.subnet-size-override-v6' value='`$network-topology-operation-input.network-request-input.network-input-parameters.param[$pidx].value`' />\n\n","comments":"","x":2654.6163940429688,"y":2025.5052347183228,"z":"5699c5cb.963a7c","wires":[]},{"id":"801abe02.e2e1b","type":"set","name":"set subnet override if not set","xml":"<set>\n\t<parameter name=\"eipam-ip-block.subnet-size-override-v4\" value=\"`$network-model.ipv4-cidr-mask`\" />\n\t<parameter name=\"eipam-ip-block.subnet-size-override-v6\" value=\"`$network-model.ipv6-cidr-mask`\" />","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":315.8661880493164,"y":1891.3385677337646,"z":"5699c5cb.963a7c","wires":[]},{"id":"b00c44bd.c95888","type":"set","name":"set: data initialization","xml":"<set>\n<parameter name=\"generate-FQPN-input.zone\" value=\"`$aai.cloud-region.cloud-zone`\" />\n","comments":"","x":963.7500152587891,"y":427.5000057220459,"z":"5699c5cb.963a7c","wires":[]},{"id":"2c36f082.69714","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":771.2500114440918,"y":427.5000057220459,"z":"5699c5cb.963a7c","wires":[["b00c44bd.c95888"]]},{"id":"9b3275bb.0d36d8","type":"switchNode","name":"switch: tmp.service-type","xml":"<switch test='`$tmp.service-type`'>\n","comments":"","outputs":1,"x":384.04766845703125,"y":256.1905059814453,"z":"5699c5cb.963a7c","wires":[["956294d5.bcf718"]]},{"id":"956294d5.bcf718","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":594.1071624755859,"y":254.73813247680664,"z":"5699c5cb.963a7c","wires":[["25f5220c.ae8cde"]]},{"id":"b4de5ae6.712548","type":"set","name":"set: data initialization","xml":"<set>\n<parameter name=\"tmp.service-type\" value=\"`$service-data.service-information.subscription-service-type`\" />","comments":"","x":984.0476474761963,"y":253.69050407409668,"z":"5699c5cb.963a7c","wires":[]},{"id":"25f5220c.ae8cde","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":753.21435546875,"y":253.6905059814453,"z":"5699c5cb.963a7c","wires":[["b4de5ae6.712548"]]},{"id":"b17da27b.64d35","type":"switchNode","name":"switch: generate-FQPN-input.network-collection","xml":"<switch test='`$generate-FQPN-input.network-collection`'>\n","comments":"","outputs":1,"x":438.57142639160156,"y":498.5714416503906,"z":"5699c5cb.963a7c","wires":[["b8f3f8e4.6c2538"]]},{"id":"b8f3f8e4.6c2538","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":671.2500534057617,"y":496.6428699493408,"z":"5699c5cb.963a7c","wires":[["f3de6cc4.41db3"]]},{"id":"545e806.2fb928","type":"set","name":"set: aai-network-collection.collection-name","xml":"<set>\n<parameter name=\"generate-FQPN-input.network-collection\" value=\"`$aai-network-collection.collection-name`\" />\n","comments":"","x":1061.4285583496094,"y":496.0714511871338,"z":"5699c5cb.963a7c","wires":[]},{"id":"f3de6cc4.41db3","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":806.0714321136475,"y":496.0714359283447,"z":"5699c5cb.963a7c","wires":[["545e806.2fb928"]]},{"id":"86ca1ebb.981a9","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1165.031940460205,"y":765.4999933242798,"z":"5699c5cb.963a7c","wires":[["9d2d3fba.a2a9d"]]},{"id":"9d2d3fba.a2a9d","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving cloud region from AAI\" />\n","comments":"","x":1340.0319137573242,"y":765.5000295639038,"z":"5699c5cb.963a7c","wires":[]},{"id":"da212f7d.7dcf1","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1173.960536956787,"y":716.7857265472412,"z":"5699c5cb.963a7c","wires":[["381c75fc.e73bea"]]},{"id":"381c75fc.e73bea","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"`'aic-cloud-region, '+ $generate-fqpn-input.aic-cloud-region + ' not found in AAI'`\" />\n","comments":"","x":1340.309814453125,"y":716.0913038253784,"z":"5699c5cb.963a7c","wires":[]},{"id":"ca932ed8.9d846","type":"for","name":"for relationship list","xml":"<for index='ridx' start='0' end='`$aai.cloud-region.relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":905.7619552612305,"y":956.6062526702881,"z":"5699c5cb.963a7c","wires":[["efe6069a.2b0288"]]},{"id":"9717a9fb.4c8bf8","type":"get-resource","name":"get-resource: AAI cloud region","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"cloud-region\" \n\t\tkey=\"cloud-region.cloud-owner = $prop.cloud-region.cloud-owner AND \n\t\t     cloud-region.cloud-region-id = $aai.cloud-region.cloud-region-id AND\n\t\t     depth = '0'\"\n        pfx='aai.cloud-region' >\n\n","comments":"","outputs":1,"x":945.5357322692871,"y":739.5991458892822,"z":"5699c5cb.963a7c","wires":[["da212f7d.7dcf1","86ca1ebb.981a9"]]},{"id":"fb22d8a.f128c28","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2278.230480194092,"y":1152.3372926712036,"z":"5699c5cb.963a7c","wires":[["301f2e89.56c8c2"]]},{"id":"301f2e89.56c8c2","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving complex from AAI\" />\n","comments":"","x":2444.766124725342,"y":1151.837332725525,"z":"5699c5cb.963a7c","wires":[]},{"id":"1bdd0a0a.ab33f6","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2284.7304763793945,"y":1108.3373537063599,"z":"5699c5cb.963a7c","wires":[["f024720e.f09cf"]]},{"id":"f024720e.f09cf","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Complex not found in AAI\" />\n","comments":"","x":2452.508403778076,"y":1108.6427011489868,"z":"5699c5cb.963a7c","wires":[]},{"id":"28bc7ee.8785882","type":"get-resource","name":"get-resource complex","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"complex\" \n\t\tkey=\"complex.physical-location-id = $aai.cloud-region.relationship-list.relationship[$ridx].relationship-data[$rdidx].relationship-value\"\n    pfx='aai.complex' >\n        \n\n\n","comments":"","outputs":1,"x":2076.876953125,"y":1108.2938966751099,"z":"5699c5cb.963a7c","wires":[["1bdd0a0a.ab33f6","fb22d8a.f128c28"]]},{"id":"d739427d.15e62","type":"switchNode","name":"switch: relationship-key","xml":"<switch test='`$aai.cloud-region.relationship-list.relationship[$ridx].relationship-data[$rdidx].relationship-key`'>\n","comments":"","outputs":1,"x":1355.6786727905273,"y":956.3931171894073,"z":"5699c5cb.963a7c","wires":[["98a7bb6b.95b5d8"]]},{"id":"98a7bb6b.95b5d8","type":"other","name":"complex.physical-location-id","xml":"<outcome value='complex.physical-location-id'>\n","comments":"","outputs":1,"x":1611.6074142456055,"y":956.666912317276,"z":"5699c5cb.963a7c","wires":[["b87b5e4d.10389"]]},{"id":"9475a09a.394d","type":"block","name":"block","xml":"<block>","atomic":"false","comments":"","outputs":1,"x":2023.9759368896484,"y":956.3218030929565,"z":"5699c5cb.963a7c","wires":[["8d249718.6ab0b8","9b601edb.f09cc","c9a7d699.c01ec8"]]},{"id":"8d249718.6ab0b8","type":"set","name":"set tmp.aic-clli","xml":"<set>\n<parameter name='tmp.aic-clli' value='`$aai.cloud-region.relationship-list.relationship[$ridx].relationship-data[$rdidx].relationship-value`' />\n\n","comments":"","x":2228.952850341797,"y":954.6828660964966,"z":"5699c5cb.963a7c","wires":[]},{"id":"fbc819eb.798958","type":"switchNode","name":"switch cloud-region.relationship_length","xml":"<switch test='`$aai.cloud-region.relationship-list.relationship_length`'>\n","comments":"","outputs":1,"x":970.3690147399902,"y":843.0991458892822,"z":"5699c5cb.963a7c","wires":[["ab469986.4e2c88","da9bb44.0e72648"]]},{"id":"ab469986.4e2c88","type":"other","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":1220.6190867953828,"y":819.5992327796089,"z":"5699c5cb.963a7c","wires":[["7374cc22.079c84"]]},{"id":"da9bb44.0e72648","type":"other","name":"null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1223.869083404541,"y":868.5992679595947,"z":"5699c5cb.963a7c","wires":[["7374cc22.079c84"]]},{"id":"7374cc22.079c84","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"cloud-region missing relationships in AAI\" />\n","comments":"","x":1395.3690910339355,"y":839.5992670059204,"z":"5699c5cb.963a7c","wires":[]},{"id":"efe6069a.2b0288","type":"for","name":"for relationship data","xml":"<for silentFailure='false' index='rdidx' start='0' end=\"`$aai.cloud-region.relationship-list.relationship[$ridx].relationship-data_length`\" >\n","comments":"","outputs":1,"x":1130.583351135254,"y":956.5158245563507,"z":"5699c5cb.963a7c","wires":[["d739427d.15e62"]]},{"id":"1803ac81.8f2153","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":669.5,"y":740.0991821289062,"z":"5699c5cb.963a7c","wires":[["9717a9fb.4c8bf8","fbc819eb.798958","ca932ed8.9d846","4aa2f647.930768","e039c810.d4c378"]]},{"id":"9b601edb.f09cc","type":"execute","name":"substring aic-clli to 8 chars","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='substring'>\n   <parameter name='result' value='tmp.truncated.clli8' />\n   <parameter name='string' value='`$tmp.aic-clli`' />\n   <parameter name='begin-index' value='0' />\n   <parameter name='end-index' value='8' />\n","comments":"","outputs":1,"x":2269.4998092651367,"y":1002.833295583725,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"c9a7d699.c01ec8","type":"set","name":"set generate-FQPN-input.location-clli8","xml":"<set>\n<parameter name='generate-FQPN-input.location-clli8' value='`$tmp.truncated.clli8`' />\n","comments":"","x":2306.888832092285,"y":1050.1664941310883,"z":"5699c5cb.963a7c","wires":[]},{"id":"98340d5a.0362c","type":"set","name":"set generate-FQPN-input.complex-region","xml":"<set>\n<parameter name='generate-FQPN-input.complex-region' value='`$aai.complex.region`' />\n","comments":"","x":2136.8333740234375,"y":1201.8332271575928,"z":"5699c5cb.963a7c","wires":[]},{"id":"b87b5e4d.10389","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1844.4999046325684,"y":956.4999418258667,"z":"5699c5cb.963a7c","wires":[["9475a09a.394d","28bc7ee.8785882","98340d5a.0362c"]]},{"id":"4aa2f647.930768","type":"set","name":"set generate-FQPN-input.aic-cloud-region","xml":"<set>\n<parameter name='generate-FQPN-input.aic-cloud-region' \n\tvalue='`$aai.cloud-region.cloud-region-id`' />\n","comments":"","x":972.3094863891602,"y":1029.4998931884766,"z":"5699c5cb.963a7c","wires":[]},{"id":"7db1b35.ac8294c","type":"comment","name":"generate-FQPN-input","info":"","comments":"","x":382.07144927978516,"y":720.9285545349121,"z":"5699c5cb.963a7c","wires":[]},{"id":"ed117b9f.a2e7e8","type":"comment","name":"generate-FQPN-input","info":"","comments":"","x":2539.214080810547,"y":1024.0237035751343,"z":"5699c5cb.963a7c","wires":[]},{"id":"96f4e3b.c6c072","type":"comment","name":"generate-FQPN-input","info":"","comments":"","x":2236.8331985473633,"y":1226.166579246521,"z":"5699c5cb.963a7c","wires":[]},{"id":"491cd8eb.eb1878","type":"comment","name":"generate-FQPN calls getPlanTopology","info":"also sets all the key_values for the FQPN in \ncontext memory, generate-FQPN-output.","comments":"","x":962.5,"y":1490,"z":"5699c5cb.963a7c","wires":[]},{"id":"1822dfed.b1cc9","type":"comment","name":"generate-FQPN calls getPlanTopology","info":"also sets all the key_values for the FQPN in \ncontext memory, generate-FQPN-output.","comments":"","x":995,"y":1766.25,"z":"5699c5cb.963a7c","wires":[]},{"id":"b8e79a11.50fec8","type":"switchNode","name":"switch: generate-FQPN-input.aic-cloud-region","xml":"<switch test='`$generate-FQPN-input.aic-cloud-region`'>\n","comments":"","outputs":1,"x":434,"y":556,"z":"5699c5cb.963a7c","wires":[["59f6597b.6ffc58"]]},{"id":"59f6597b.6ffc58","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":666.6786270141602,"y":554.0714282989502,"z":"5699c5cb.963a7c","wires":[["1803ac81.8f2153"]]},{"id":"adf823e9.02928","type":"switchNode","name":"switch: generate-FQPN-input.location-clli8","xml":"<switch test='`$generate-FQPN-input.location-clli8`'>\n","comments":"","outputs":1,"x":436,"y":608,"z":"5699c5cb.963a7c","wires":[["67c0821f.539b8c"]]},{"id":"67c0821f.539b8c","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":668.6786270141602,"y":606.0714282989502,"z":"5699c5cb.963a7c","wires":[["1803ac81.8f2153"]]},{"id":"98682fc4.05c22","type":"switchNode","name":"switch: generate-FQPN-input.complex-region","xml":"<switch test='`$generate-FQPN-input.complex-region`'>\n","comments":"","outputs":1,"x":450,"y":654,"z":"5699c5cb.963a7c","wires":[["82e9c9a2.d20dc8"]]},{"id":"82e9c9a2.d20dc8","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":682.6786270141602,"y":652.0714282989502,"z":"5699c5cb.963a7c","wires":[["1803ac81.8f2153"]]},{"id":"a551348.af4dac8","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n\t<parameter name=\"error-code\" value=\"200\" />\n","comments":"","x":263.0357360839844,"y":3660.2740812301636,"z":"5699c5cb.963a7c","wires":[]},{"id":"d1765fc3.935b1","type":"call","name":"call eipam-allocate-generic-subnet for pool","xml":"<call module='GENERIC-RESOURCE-API' rpc='eipam-allocate-generic-subnet' mode='sync' >\n","comments":"","outputs":1,"x":2356.666793823242,"y":3254.841824531555,"z":"5699c5cb.963a7c","wires":[["3b3626f5.f162fa","42cbb94.17a6648"]]},{"id":"3b3626f5.f162fa","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2663.8931198120117,"y":3306.598602771759,"z":"5699c5cb.963a7c","wires":[["2310bb6.a2a2d44"]]},{"id":"2310bb6.a2a2d44","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":2853.636161804199,"y":3304.7354435920715,"z":"5699c5cb.963a7c","wires":[["e18dd490.2c0658"]]},{"id":"42cbb94.17a6648","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2674.656089782715,"y":3240.1005959510803,"z":"5699c5cb.963a7c","wires":[["35f38429.2717ec"]]},{"id":"5057c561.1fec3c","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"GENERIC-RESOURCE-API.process-eipam-pools:REQID\"/>\n<parameter name=\"field3\" value=\"`$network-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"eipam-ip-block.ip-prefix\"/>\n<parameter name=\"field5\" value=\"`$eipam-ip-block.ip-prefix`\"/>\n<parameter name=\"field6\" value=\"eipam-ip-block.mask\"/>\n<parameter name=\"field7\" value=\"`$eipam-ip-block.v6.allocateSubnetResponse.Mask`\"/>\n<parameter name=\"field8\" value=\"ipv6\"/>\n<parameter name=\"field9\" value=\"`$l-idx`\" />\n\n","comments":"","outputs":1,"x":3000.346607208252,"y":3244.6600856781006,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"aaa362d4.f1a14","type":"set","name":"set values needed for eipam","xml":"<set>\n<parameter name='eipam-ip-block.entity-id' value='' />\n<parameter name='eipam-ip-block.ip-prefix' value='' />\n<parameter name='eipam-ip-block.mask' value='' />\n<parameter name=\"eipam-ip-block.allocate-version\" value='ipv6' />\n<parameter name='eipam-ip-block.plans_length' value='0' />\n\n","comments":"","x":2320.9418411254883,"y":3214.5453169345856,"z":"5699c5cb.963a7c","wires":[]},{"id":"d64954e8.a03148","type":"set","name":"set l3-network","xml":"<set>\n<parameter name='tmp.l3-network.level1.v6.subnet.pre-existing' value='' />\n<parameter name='tmp.l3-network.level1.v6.entity-id' value='`$eipam-ip-block.entity-id`' />\n<parameter name='tmp.l3-network.level1.v6.ip-prefix' value='`$eipam-ip-block.ip-prefix`' />\n<parameter name='tmp.l3-network.level1.v6.mask' value='`$eipam-ip-block.mask`' />\n","comments":"","x":3210.2033157348633,"y":3119.461950302124,"z":"5699c5cb.963a7c","wires":[]},{"id":"35f38429.2717ec","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":2839.6822662353516,"y":3238.6985173225403,"z":"5699c5cb.963a7c","wires":[["5057c561.1fec3c","2d3968a5.a9c078"]]},{"id":"650f65f9.50eb5c","type":"get-resource","name":"get-resource V6 - validate if subnet does not exists","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_SUBNETS s, EIPAM_IP_SUBNET_KEYS k WHERE s.plan_name = $network-model.eipam-v6-address-plan and s.entity_id = k.entity_id and k.level = $l-idx and k.key_value = $key-value ; \"\n        pfx='tmp.eipam-subnet-row'>\n\n","comments":"","outputs":1,"x":1680.0796661376953,"y":3170.920791864395,"z":"5699c5cb.963a7c","wires":[["8f2a02b7.9ab9","386387b5.398a38"]]},{"id":"8f2a02b7.9ab9","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1935.6986198425293,"y":3161.3971016407013,"z":"5699c5cb.963a7c","wires":[["605fd1e9.217db"]]},{"id":"386387b5.398a38","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":1944.560749053955,"y":3207.397132396698,"z":"5699c5cb.963a7c","wires":[["1d82ae2a.4003d2"]]},{"id":"1d82ae2a.4003d2","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2094.7769203186035,"y":3205.3610911369324,"z":"5699c5cb.963a7c","wires":[["aaa362d4.f1a14","d1765fc3.935b1"]]},{"id":"86a8580d.287a38","type":"comment","name":"Check if ipv6 subnet exists","info":"","comments":"","x":1595.4447479248047,"y":3139.254208803177,"z":"5699c5cb.963a7c","wires":[]},{"id":"605fd1e9.217db","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":2118.9207878112793,"y":3161.3971016407013,"z":"5699c5cb.963a7c","wires":[["c57058d3.2193a8","5a07c5f5.d6169c"]]},{"id":"c57058d3.2193a8","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"GENERIC-RESOURCE-API.process-eipam-pools:REQID\"/>\n<parameter name=\"field3\" value=\"`$network-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"Existing eipam-ip-block.ip-prefix for level:\" />\n<parameter name=\"field5\" value=\"`$l-idx`\" />\n<parameter name=\"field6\" value=\"Existing eipam-ip-block.mask for level:\" />\n<parameter name=\"field7\" value=\"`$tmp.eipam-subnet-row.prefix-length`\"/>\n<parameter name=\"field8\" value=\"ipv6\"/>\n<parameter name=\"field9\" value=\"`$tmp.eipam-subnet-row.ip-address`\"/>\n","comments":"","outputs":1,"x":2265.492088317871,"y":3135.1115028858185,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"5a07c5f5.d6169c","type":"set","name":"set pre-existing for l3subnet for level1","xml":"<set>\n<parameter name='tmp.l3-network.level1.v6.subnet.pre-existing' value='true' />\n<parameter name='tmp.l3-network.level1.v6.entity-id' value='`$tmp.eipam-row.entity-id`' />\n<parameter name='tmp.l3-network.level1.v6.ip-prefix' value='`$tmp.eipam-row.ip-address`' />\n<parameter name='tmp.l3-network.level1.v6.mask' value='`$tmp.eipam-row.prefix-length`' />\n\n","comments":"","x":2341.4918212890625,"y":3175.841957092285,"z":"5699c5cb.963a7c","wires":[]},{"id":"e18dd490.2c0658","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"GENERIC-RESOURCE-API.process-eipam-pools:REQID\"/>\n<parameter name=\"field3\" value=\"`$network-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"Failed to allocate ipv6 subnet - failure from eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field9\" value=\"`$l-idx`\" />\n\n\n","comments":"","outputs":1,"x":3024.8099517822266,"y":3304.5238814353943,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"a5b75182.1e4e","type":"switchNode","name":"switch: tmp.allocate-subnet-flag","xml":"<switch test=\"`$tmp.allocate-subnet-flag`\">","comments":"","outputs":1,"x":886.6665802001953,"y":2265.3331823349,"z":"5699c5cb.963a7c","wires":[["3e556ee3.331412","d2460beb.20a458","ca0d59da.ac99f8"]]},{"id":"d2460beb.20a458","type":"other","name":"NULL","xml":"<outcome value=\"\">","comments":"","outputs":1,"x":1091.6667938232422,"y":2260.8889875411987,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"ca0d59da.ac99f8","type":"other","name":"Y","xml":"<outcome value='Y'>","comments":"","outputs":1,"x":1037.0953903198242,"y":3348.853012084961,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"8239630d.c2116","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1122.425054550171,"y":2319.7187461853027,"z":"5699c5cb.963a7c","wires":[["6b70862c.498308","4a1da2fb.b241dc"]]},{"id":"3e556ee3.331412","type":"other","name":"N","xml":"<outcome value='N'>","comments":"","outputs":1,"x":973.6192321777344,"y":2319.6030082702637,"z":"5699c5cb.963a7c","wires":[["8239630d.c2116"]]},{"id":"3f20acf7.1dafa4","type":"comment","name":"Check if need to allocateSubnet","info":" tmp.allocate-subnet-flag = 'Y', \n \tif EIPAM should create subnet\n \n tmp.allocate-subnet-flag = 'N', \n \twe need to explicitly call allocateSubnet","comments":"","x":902.8412017822266,"y":2358.984079360962,"z":"5699c5cb.963a7c","wires":[]},{"id":"3ff3fe7e.90a822","type":"call","name":"call eipam-allocate-generic-subnet for pool","xml":"<call module='GENERIC-RESOURCE-API' rpc='eipam-allocate-generic-subnet' mode='sync' >\n","comments":"","outputs":1,"x":2354.5716094970703,"y":2513.5078859329224,"z":"5699c5cb.963a7c","wires":[["e1bdb83c.a688b8","f3e9c5a5.d9a7a8"]]},{"id":"e1bdb83c.a688b8","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2597.559352874756,"y":2563.2649002075195,"z":"5699c5cb.963a7c","wires":[["3c8c2b49.ef4c44"]]},{"id":"3c8c2b49.ef4c44","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":2751.0524711608887,"y":2563.901786804199,"z":"5699c5cb.963a7c","wires":[["1f76867c.edc97a"]]},{"id":"f3e9c5a5.d9a7a8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2592.9889640808105,"y":2479.433473587036,"z":"5699c5cb.963a7c","wires":[["29886065.7b87a"]]},{"id":"6b7a605a.82a84","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"GENERIC-RESOURCE-API.process-eipam-pools:REQID\"/>\n<parameter name=\"field3\" value=\"`$network-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"eipam-ip-block.ip-prefix\"/>\n<parameter name=\"field5\" value=\"`$eipam-ip-block.ip-prefix`\"/>\n<parameter name=\"field6\" value=\"eipam-ip-block.mask\"/>\n<parameter name=\"field7\" value=\"`$eipam-ip-block.v4.allocateSubnetResponse.Mask`\"/>\n<parameter name=\"field8\" value=\"ipv4\"/>\n<parameter name=\"field9\" value=\"`$l-idx`\" />\n\n","comments":"","outputs":1,"x":2921.179618835449,"y":2484.826536178589,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"1d0d24bf.20366b","type":"set","name":"set values needed for eipam","xml":"<set>\n<parameter name='eipam-ip-block.entity-id' value='' />\n<parameter name='eipam-ip-block.ip-prefix' value='' />\n<parameter name='eipam-ip-block.mask' value='' />\n<parameter name=\"eipam-ip-block.allocate-version\" value='ipv4' />\n<parameter name='eipam-ip-block.plans_length' value='0' />\n\n","comments":"","x":2324.8463745117188,"y":2470.6400938034058,"z":"5699c5cb.963a7c","wires":[]},{"id":"8a808da6.c949c","type":"set","name":"set allocateSubnetResponse","xml":"<set>\n<parameter name='eipam-ip-block.v4.allocateSubnetResponse.' value='eipam-ip-block.allocateSubnetResponse.' />\n","comments":"","x":2983.179039001465,"y":2445.735324859619,"z":"5699c5cb.963a7c","wires":[]},{"id":"29886065.7b87a","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":2758.0151405334473,"y":2478.031394958496,"z":"5699c5cb.963a7c","wires":[["6b7a605a.82a84","8a808da6.c949c"]]},{"id":"54544b58.e03b54","type":"get-resource","name":"get-resource V4 - validate if subnet does not exists","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_SUBNETS s, EIPAM_IP_SUBNET_KEYS k WHERE s.plan_name = $network-model.eipam-v4-address-plan and s.entity_id = k.entity_id and k.level = $l-idx and k.key_value = $key-value ; \"\n        pfx='tmp.eipam-subnet-row'>\n\n","comments":"","outputs":1,"x":1626.4810829162598,"y":2451.1004180908203,"z":"5699c5cb.963a7c","wires":[["8187134c.209d9","647284d.c22dc7c"]]},{"id":"8187134c.209d9","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1891.6240577697754,"y":2442.945469856262,"z":"5699c5cb.963a7c","wires":[["36963d61.1dcad2"]]},{"id":"647284d.c22dc7c","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":1891.7361183166504,"y":2472.6955013275146,"z":"5699c5cb.963a7c","wires":[["8f13420f.962d7"]]},{"id":"8f13420f.962d7","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2048.202308654785,"y":2469.4094285964966,"z":"5699c5cb.963a7c","wires":[["1d0d24bf.20366b","3ff3fe7e.90a822"]]},{"id":"36963d61.1dcad2","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":2045.7393035888672,"y":2433.4455308914185,"z":"5699c5cb.963a7c","wires":[["314e158d.d4258a","1284868e.f212b9"]]},{"id":"314e158d.d4258a","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"GENERIC-RESOURCE-API.process-eipam-pools:REQID\"/>\n<parameter name=\"field3\" value=\"`$network-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"Existing eipam-ip-block.ip-prefix for level:\" />\n<parameter name=\"field5\" value=\"`$l-idx`\" />\n<parameter name=\"field6\" value=\"Existing eipam-ip-block.mask for level:\" />\n<parameter name=\"field7\" value=\"`$tmp.eipam-subnet-row.prefix-length`\"/>\n<parameter name=\"field8\" value=\"ipv4\"/>\n<parameter name=\"field9\" value=\"`$tmp.eipam-subnet-row.ip-address`\"/>\n\n","comments":"","outputs":1,"x":2245.2626991271973,"y":2396.6121950149536,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"1284868e.f212b9","type":"set","name":"set pre-existing for l3subnet for level","xml":"<set>\n<parameter name='tmp.l3-network.level1.v4.subnet.pre-existing' value='true' />\n<parameter name='tmp.l3-network.level1.v4.entity-id' value='`$tmp.eipam-row.entity-id`' />\n<parameter name='tmp.l3-network.level1.v4.ip-prefix' value='`$tmp.eipam-row.ip-address`' />\n<parameter name='tmp.l3-network.level1.v4.mask' value='`$tmp.eipam-row.prefix-length`' />\n\n\n","comments":"","x":2337.0009002685547,"y":2439.2357625961304,"z":"5699c5cb.963a7c","wires":[]},{"id":"1f76867c.edc97a","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"GENERIC-RESOURCE-API.process-eipam-pools:REQID\"/>\n<parameter name=\"field3\" value=\"`$network-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"Failed to allocate ipv4 subnet - failure from eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field5\" value=\"`$l-idx`\" />\n\n\n","comments":"","outputs":1,"x":2900.905590057373,"y":2564.1433877944946,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"7da7a71d.1d7828","type":"comment","name":"Check if ipv4 subnet exists","info":"","comments":"","x":1723.9205627441406,"y":2411.444664955139,"z":"5699c5cb.963a7c","wires":[]},{"id":"6b70862c.498308","type":"switchNode","name":"switch: network-model.use-ipv4","xml":"<switch test=\"`$network-model.use-ipv4`\">","comments":"","outputs":1,"x":1340.0001068115234,"y":2321.7145385742188,"z":"5699c5cb.963a7c","wires":[["c212db95.eddde8","53f30b08.a1b714","2727e599.65d53a"]]},{"id":"53f30b08.a1b714","type":"other","name":"NULL","xml":"<outcome value=\"\">","comments":"","outputs":1,"x":1558.0716514587402,"y":2360.4288005828857,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"c212db95.eddde8","type":"other","name":"Y","xml":"<outcome value='Y'>","comments":"","outputs":1,"x":1557.0719757080078,"y":2319.8218784332275,"z":"5699c5cb.963a7c","wires":[["eebf3959.20d158"]]},{"id":"2727e599.65d53a","type":"other","name":"N","xml":"<outcome value='N'>","comments":"","outputs":1,"x":1555.5000534057617,"y":2276.7615671157837,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"eebf3959.20d158","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1350.0000457763672,"y":2451.2383489608765,"z":"5699c5cb.963a7c","wires":[["54544b58.e03b54"]]},{"id":"4a1da2fb.b241dc","type":"switchNode","name":"switch: network-model.use-ipv6","xml":"<switch test=\"`$network-model.use-ipv6`\">","comments":"","outputs":1,"x":1259.523796081543,"y":3030.7622203826904,"z":"5699c5cb.963a7c","wires":[["f2572e73.48074","867a323f.a6147","127b2530.ff579b"]]},{"id":"867a323f.a6147","type":"other","name":"NULL","xml":"<outcome value=\"\">","comments":"","outputs":1,"x":1469.0238876342773,"y":3083.7622632980347,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"f2572e73.48074","type":"other","name":"Y","xml":"<outcome value='Y'>","comments":"","outputs":1,"x":1465.1668853759766,"y":3038.8696851730347,"z":"5699c5cb.963a7c","wires":[["8ddbfb35.fa6be8"]]},{"id":"127b2530.ff579b","type":"other","name":"N","xml":"<outcome value='N'>","comments":"","outputs":1,"x":1465.0238494873047,"y":2992.9521493911743,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"8ddbfb35.fa6be8","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1398.5715637207031,"y":3170.7620363235474,"z":"5699c5cb.963a7c","wires":[["650f65f9.50eb5c"]]},{"id":"e85e7565.d76da8","type":"switchNode","name":"switch: generate-FQPN-input.network-name","xml":"<switch test='`$generate-FQPN-input.network-name`'>\n","comments":"","outputs":1,"x":428.33331298828125,"y":368.33331298828125,"z":"5699c5cb.963a7c","wires":[["579a6475.72ab8c"]]},{"id":"579a6475.72ab8c","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":656.7261581420898,"y":363.5476026535034,"z":"5699c5cb.963a7c","wires":[["196e4862.4a59a8"]]},{"id":"377485c2.ec409a","type":"set","name":"set: data initialization","xml":"<set>\n<parameter name=\"generate-FQPN-input.network-name\" value=\"`$network-topology-identifier-structure.network-name`\" />\n","comments":"","x":988.3333225250244,"y":365.83330726623535,"z":"5699c5cb.963a7c","wires":[]},{"id":"196e4862.4a59a8","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":795.8333187103271,"y":365.83330726623535,"z":"5699c5cb.963a7c","wires":[["377485c2.ec409a"]]},{"id":"5e9374f6.85274c","type":"switchNode","name":"switch: tmp.network-instance-group-id","xml":"<switch test='`$tmp.network-instance-group-id`'>\n","comments":"","outputs":1,"x":383.33331298828125,"y":298.33331298828125,"z":"5699c5cb.963a7c","wires":[["7636bd97.fe7f74"]]},{"id":"7636bd97.fe7f74","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":593.3928070068359,"y":296.8809394836426,"z":"5699c5cb.963a7c","wires":[["3812c68b.d31d3a"]]},{"id":"6cc90794.819c48","type":"set","name":"set: data initialization","xml":"<set>\n<parameter name=\"tmp.network-instance-group-id\" value=\"`$network-topology-operation-input.network-request-input.network-instance-group-id`\" />","comments":"","x":983.3332920074463,"y":295.8333110809326,"z":"5699c5cb.963a7c","wires":[]},{"id":"3812c68b.d31d3a","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":752.5,"y":295.83331298828125,"z":"5699c5cb.963a7c","wires":[["6cc90794.819c48"]]},{"id":"e039c810.d4c378","type":"execute","name":"get prop","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n<parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n<parameter name='contextPrefix' value='prop' />","comments":"","outputs":1,"x":878.9027913411458,"y":668.9236195882162,"z":"5699c5cb.963a7c","wires":[[]]},{"id":"91fc65fd.117318","type":"set","name":"set l3-network","xml":"<set>\n<parameter name='tmp.l3-network.level1.v4.subnet.pre-existing' value='' />\n<parameter name='tmp.l3-network.level1.v4.entity-id' value='`$eipam-ip-block.entity-id`' />\n<parameter name='tmp.l3-network.level1.v4.ip-prefix' value='`$eipam-ip-block.ip-prefix`' />\n<parameter name='tmp.l3-network.level1.v4.mask' value='`$eipam-ip-block.mask`' />\n","comments":"","x":3064.265625,"y":2372.5390625,"z":"5699c5cb.963a7c","wires":[]},{"id":"2d3968a5.a9c078","type":"set","name":"set allocateSubnetResponse","xml":"<set>\n<parameter name='eipam-ip-block.v6.allocateSubnetResponse.' value='eipam-ip-block.allocateSubnetResponse.' />\n","comments":"","x":3062.5157508850098,"y":3202.538601875305,"z":"5699c5cb.963a7c","wires":[]}]