[{"id":"13071f3.b7d9ce1","type":"dgstart","name":"DGSTART","outputs":1,"x":100,"y":82.85714721679688,"z":"9879faaf.578818","wires":[["aeabe994.f8df78"]]},{"id":"aeabe994.f8df78","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":215.28571319580078,"y":123.09526062011719,"z":"9879faaf.578818","wires":[["396a8522.a9e2ca"]]},{"id":"396a8522.a9e2ca","type":"method","name":"method vf-module-topology-operation-deactivate","xml":"<method rpc='vf-module-topology-operation-deactivate' mode='sync'>\n","comments":"","outputs":1,"x":225.09529876708984,"y":162.8571434020996,"z":"9879faaf.578818","wires":[["bd866b95.6f7af8"]]},{"id":"6558f1be.58032","type":"comment","name":"vf-module-topology-operation-deactivate","info":"","comments":"","x":494.34485626220703,"y":30.443490982055664,"z":"9879faaf.578818","wires":[]},{"id":"88623168.6874f","type":"switchNode","name":"switch request-action","xml":"<switch test='`$vf-module-topology-operation-input.request-information.request-action`'>\n","comments":"","outputs":1,"x":503.52381134033203,"y":261.7142848968506,"z":"9879faaf.578818","wires":[["6a841189.d0d6b","75789769.e51bc8"]]},{"id":"6a841189.d0d6b","type":"outcome","name":"DeleteVfModuleInstance","xml":"<outcome value='DeleteVfModuleInstance'>\n","comments":"","outputs":1,"x":765.5714263916016,"y":238.85717105865479,"z":"9879faaf.578818","wires":[["8cc46eff.ba0dc"]]},{"id":"75789769.e51bc8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":709.2380714416504,"y":284.2381601333618,"z":"9879faaf.578818","wires":[["16129ba.dc43964"]]},{"id":"8cc46eff.ba0dc","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":955.4285907745361,"y":238.85720252990723,"z":"9879faaf.578818","wires":[[]]},{"id":"16129ba.dc43964","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"If svc-action is 'deactivate' then request-action must be 'DeleteVfModuleInstance'\" />\n","comments":"","x":974.2380790710449,"y":284.5714726448059,"z":"9879faaf.578818","wires":[]},{"id":"bd866b95.6f7af8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":163.33333587646484,"y":627.8571338653564,"z":"9879faaf.578818","wires":[["88623168.6874f","1049d50a.0bf20b","d78c8798.03c208","e4675d09.2b00d","4f2b2a2c.598fa4","fe8ce13.f8c932","23a16cba.a08e54","68811534.7548ec","37836293.8a32be","bcec521d.e4f3f","ecefd25.6df343","7fdaa4ba.1e989c","6479e61d.234e48","d5cf2da3.75dd1"]]},{"id":"d78c8798.03c208","type":"switchNode","name":"switch service-data.vnfs.vnf_length","xml":"<switch test='`$service-data.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":549.9999847412109,"y":406.1904602050781,"z":"9879faaf.578818","wires":[["a8fe6112.36125","20ca97dd.7de2c8"]]},{"id":"a8fe6112.36125","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":790.7142562866211,"y":383.3332004547119,"z":"9879faaf.578818","wires":[["7fc607f0.18d098"]]},{"id":"20ca97dd.7de2c8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":790.4760971069336,"y":424.2857189178467,"z":"9879faaf.578818","wires":[["e1eb34fc.63e7a8"]]},{"id":"7fc607f0.18d098","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"There are no VNFs defined in MD-SAL\" />\n","comments":"","x":957.3808708190918,"y":382.6189556121826,"z":"9879faaf.578818","wires":[]},{"id":"e1eb34fc.63e7a8","type":"for","name":"for each vnf","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":952.714241027832,"y":423.95233726501465,"z":"9879faaf.578818","wires":[["978adb95.1c9808"]]},{"id":"978adb95.1c9808","type":"switchNode","name":"switch service data vnf == input vnf","xml":"<switch test='`$service-data.vnfs.vnf[$idx].vnf-id == $vf-module-topology-operation-input.vnf-information.vnf-id`'>\n","comments":"","outputs":1,"x":1204.0474586486816,"y":423.6190242767334,"z":"9879faaf.578818","wires":[["2370e2ab.dca6be"]]},{"id":"2370e2ab.dca6be","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1434.047550201416,"y":422.95237827301025,"z":"9879faaf.578818","wires":[["30b4374c.141a18"]]},{"id":"1049d50a.0bf20b","type":"set","name":"set vnf-index to -1","xml":"<set>\n<parameter name='vnf-index' value='-1' />\n","comments":"","x":499.047607421875,"y":337.6189594268799,"z":"9879faaf.578818","wires":[]},{"id":"8cbdf2c0.29c63","type":"set","name":"set vnf-index to idx","xml":"<set>\n<parameter name='vnf-index' value='`$idx`' />\n","comments":"","x":1755.7141876220703,"y":393.95233631134033,"z":"9879faaf.578818","wires":[]},{"id":"e4675d09.2b00d","type":"switchNode","name":"switch vnf-index","xml":"<switch test='`$vnf-index`'>\n","comments":"","outputs":1,"x":489.04761505126953,"y":474.2856559753418,"z":"9879faaf.578818","wires":[["47db849e.30270c"]]},{"id":"47db849e.30270c","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":667.3810005187988,"y":473.61903190612793,"z":"9879faaf.578818","wires":[["dc1e72ee.c74b3"]]},{"id":"dc1e72ee.c74b3","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find VNF ID ' + $vf-module-topology-operation-input.vnf-information.vnf-id + ' in MD-SAL'`\" />\n","comments":"","x":827.3809089660645,"y":472.952335357666,"z":"9879faaf.578818","wires":[]},{"id":"30b4374c.141a18","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1582.3810119628906,"y":421.8720769882202,"z":"9879faaf.578818","wires":[["8cbdf2c0.29c63","3a37ad6f.aa2402"]]},{"id":"3a37ad6f.aa2402","type":"break","name":"break","xml":"<break>\n","comments":"","x":1717.3809776306152,"y":443.5386629104614,"z":"9879faaf.578818","wires":[]},{"id":"fe8ce13.f8c932","type":"switchNode","name":"switch service-data...vf-module_length","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`'>\n","comments":"","outputs":1,"x":563.3332977294922,"y":596.1904850006104,"z":"9879faaf.578818","wires":[["b0abce56.c29c2","9790b40d.9d6b28"]]},{"id":"b0abce56.c29c2","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":814.047607421875,"y":574.999888420105,"z":"9879faaf.578818","wires":[["f30c800c.a6fd4"]]},{"id":"9790b40d.9d6b28","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":813.8094482421875,"y":615.9524068832397,"z":"9879faaf.578818","wires":[["ba9a5b3d.831648"]]},{"id":"f30c800c.a6fd4","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'There are no VF modules defined in MD-SAL for VNF ' + $vf-module-topology-operation-input.vnf-information.vnf-id`\" />\n","comments":"","x":980.7142219543457,"y":574.2856435775757,"z":"9879faaf.578818","wires":[]},{"id":"ba9a5b3d.831648","type":"for","name":"for each vf-module","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' >\n","comments":"","outputs":1,"x":976.0475921630859,"y":615.6190252304077,"z":"9879faaf.578818","wires":[["7616e353.b44a6c"]]},{"id":"7616e353.b44a6c","type":"switchNode","name":"switch service data vf-module == input vf-module","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id == $vf-module-topology-operation-input.vf-module-information.vf-module-id`'>\n","comments":"","outputs":1,"x":1282.3807525634766,"y":615.2857608795166,"z":"9879faaf.578818","wires":[["1ba3253d.82b1bb"]]},{"id":"1ba3253d.82b1bb","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1552.3808059692383,"y":612.9523658752441,"z":"9879faaf.578818","wires":[["ea9fdaef.8b5c38"]]},{"id":"4f2b2a2c.598fa4","type":"set","name":"set vf-module-index to -1","xml":"<set>\n<parameter name='vf-module-index' value='-1' />\n","comments":"","x":519.0475921630859,"y":530.9523220062256,"z":"9879faaf.578818","wires":[]},{"id":"deaa7aac.717e78","type":"set","name":"set vf-module-index to idx","xml":"<set>\n<parameter name='vf-module-index' value='`$idx`' />\n","comments":"","x":1882.3808975219727,"y":583.9523448944092,"z":"9879faaf.578818","wires":[]},{"id":"23a16cba.a08e54","type":"switchNode","name":"switch vf-module-index","xml":"<switch test='`$vf-module-index`'>\n","comments":"","outputs":1,"x":510.7142753601074,"y":667.6190347671509,"z":"9879faaf.578818","wires":[["bc010e95.612a6"]]},{"id":"bc010e95.612a6","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":689.0476608276367,"y":666.952410697937,"z":"9879faaf.578818","wires":[["dec2ac79.d9a78"]]},{"id":"dec2ac79.d9a78","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find VF module ID ' + $vf-module-topology-operation-input.vf-module-information.vf-module-id + ' in MD-SAL'`\" />\n","comments":"","x":849.0475692749023,"y":666.2857141494751,"z":"9879faaf.578818","wires":[]},{"id":"ea9fdaef.8b5c38","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1685.7143478393555,"y":611.8721055984497,"z":"9879faaf.578818","wires":[["deaa7aac.717e78","f772ee69.83042"]]},{"id":"f772ee69.83042","type":"break","name":"break","xml":"<break>\n","comments":"","x":1820.71431350708,"y":633.5386915206909,"z":"9879faaf.578818","wires":[]},{"id":"68811534.7548ec","type":"set","name":"set order-status to PendingDelete","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-level-oper-status.order-status'\n  value='PendingDelete' />\n","comments":"","x":548.3334045410156,"y":1121.9047660827637,"z":"9879faaf.578818","wires":[]},{"id":"37836293.8a32be","type":"set","name":"set vf-module-status to PendingDelete","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-topology.vf-module-assignments.vf-module-status' value='PendingDelete' />\n","comments":"","x":559.6667175292969,"y":943.5715074539185,"z":"9879faaf.578818","wires":[]},{"id":"bcec521d.e4f3f","type":"save","name":"update vf-module to PendingDelete","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"vf-module\"\n   key=\"vf-module.vf-module-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id\n      AND generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"orchestration-status\" value=\"PendingDelete\" />\n","comments":"","outputs":1,"x":550.0000915527344,"y":1005.2381162643433,"z":"9879faaf.578818","wires":[["ef5b4d43.e0382","d6456b4b.1e9658"]]},{"id":"cd129c6d.597f","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No vf-module found in AAI for vf module ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id`\" />\n","comments":"","x":942.8573112487793,"y":1031.6667289733887,"z":"9879faaf.578818","wires":[]},{"id":"ef5b4d43.e0382","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":782.6907348632812,"y":987.1906127929688,"z":"9879faaf.578818","wires":[["28df6473.5f7f9c"]]},{"id":"d6456b4b.1e9658","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":791.2621650695801,"y":1031.4763259887695,"z":"9879faaf.578818","wires":[["cd129c6d.597f"]]},{"id":"28df6473.5f7f9c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating vf-module in AAI\" />\n","comments":"","x":945.5479049682617,"y":988.42893409729,"z":"9879faaf.578818","wires":[]},{"id":"ecefd25.6df343","type":"set","name":"copy input data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.sdnc-request-header.'\n   value='$vf-module-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.request-information.'\n   value='$vf-module-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.service-information.'\n   value='$vf-module-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vnf-information.'\n   value='$vf-module-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-information.'\n   value='$vf-module-topology-operation-input.vf-module-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-request-input.'\n   value='$vf-module-topology-operation-input.vf-module-request-input.' />\n\n","comments":"","x":488.3333435058594,"y":1075.2381238937378,"z":"9879faaf.578818","wires":[]},{"id":"7fdaa4ba.1e989c","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":486.66668701171875,"y":1171.9048109054565,"z":"9879faaf.578818","wires":[]},{"id":"6479e61d.234e48","type":"switchNode","name":"switch vlan-vnfc-instance-group_length","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group_length`'>\n","comments":"","outputs":1,"x":563.3332977294922,"y":756.1904830932617,"z":"9879faaf.578818","wires":[["be1e70ac.411ba","be0d4928.ca9998","20551dc0.451a22"]]},{"id":"be1e70ac.411ba","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":796.1904754638672,"y":709.047571182251,"z":"9879faaf.578818","wires":[["3a138253.a29bde"]]},{"id":"be0d4928.ca9998","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":796.1903667449951,"y":754.761833190918,"z":"9879faaf.578818","wires":[["3a138253.a29bde"]]},{"id":"20551dc0.451a22","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":794.7618179321289,"y":803.8094940185547,"z":"9879faaf.578818","wires":[["f82088b8.905898"]]},{"id":"3a138253.a29bde","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":924.7618713378906,"y":729.0475482940674,"z":"9879faaf.578818","wires":[[]]},{"id":"f82088b8.905898","type":"call","name":"call GENERIC-RESOURCE-API:vf-module-topology-vlan-tagging-deactivate","xml":"<call module='GENERIC-RESOURCE-API' rpc='vf-module-topology-vlan-tagging-deactivate' mode='sync' >\n","comments":"","outputs":1,"x":1129.2857208251953,"y":803.2855625152588,"z":"9879faaf.578818","wires":[["80fabf7b.14c17"]]},{"id":"80fabf7b.14c17","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1467.618984222412,"y":802.619140625,"z":"9879faaf.578818","wires":[["4fa8ba6e.f33474"]]},{"id":"4fa8ba6e.f33474","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n","comments":"","x":1617.618881225586,"y":800.9522953033447,"z":"9879faaf.578818","wires":[]},{"id":"d5cf2da3.75dd1","type":"for","name":"for each vm-type","xml":"<for silentFailure='true' index='vm-type-index' start='0'\n  end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-assignments.vms.vm_length`' >\n","comments":"","outputs":1,"x":492.85713958740234,"y":879.9998893737793,"z":"9879faaf.578818","wires":[["ddc0e538.28e1d8"]]},{"id":"ddc0e538.28e1d8","type":"for","name":"for each vnfc","xml":"<for silentFailure='true' index='vnfc-index' start='0' end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names_length`' >\n","comments":"","outputs":1,"x":669.5238800048828,"y":879.3810844421387,"z":"9879faaf.578818","wires":[["380a3916.dbad36"]]},{"id":"380a3916.dbad36","type":"save","name":"update vnfc to PendingDelete","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"vnfc\"\n   key=\"vnfc.vnfc-name = $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-name\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"orchestration-status\" value=\"PendingDelete\" />\n","comments":"","outputs":1,"x":884.2857513427734,"y":878.5713691711426,"z":"9879faaf.578818","wires":[["6aa9d43c.d59dfc","ffb27a5e.b18188"]]},{"id":"191b9efa.36be11","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No vnfc found in AAI for vnfc name ' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-name`\" />\n","comments":"","x":1247.1427955627441,"y":897.5714683532715,"z":"9879faaf.578818","wires":[]},{"id":"6aa9d43c.d59dfc","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1084.119155883789,"y":854.0953531265259,"z":"9879faaf.578818","wires":[["2b9f56c7.63713a"]]},{"id":"ffb27a5e.b18188","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1092.690586090088,"y":898.3810663223267,"z":"9879faaf.578818","wires":[["191b9efa.36be11"]]},{"id":"2b9f56c7.63713a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating vnfc in AAI\" />\n","comments":"","x":1249.8333892822266,"y":854.3336734771729,"z":"9879faaf.578818","wires":[]}]