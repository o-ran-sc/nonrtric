[{"id":"aa32063c.93243","type":"dgstart","name":"DGSTART","outputs":1,"x":236,"y":109,"z":"6c1fa692.a38a58","wires":[["833978dd.304958"]]},{"id":"833978dd.304958","type":"service-logic","name":"GENERIC-RESOURCE-API","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":332.2380790710449,"y":169.95239067077637,"z":"6c1fa692.a38a58","wires":[["b96884bf.17b1d8"]]},{"id":"b96884bf.17b1d8","type":"method","name":"brg-topology-operation-activate","xml":"<method rpc='brg-topology-operation-activate' mode='sync'>\n","comments":"","outputs":1,"x":378.15485763549805,"y":205.19044589996338,"z":"6c1fa692.a38a58","wires":[["c66eed15.187018"]]},{"id":"c66eed15.187018","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":245.9761962890625,"y":2112.02392578125,"z":"6c1fa692.a38a58","wires":[["50cb6b9d.38fa3c","ad1d1588.d76d","1afb7e82.eefe39","62d81f8c.21d7e8","7b6d22c9.e07ccc","1e99334.059e24d","1fbb479c.9b3e88","bb9bf99c.661c18","a41547ad.552528","7f6e2b92.2edeec","6a1a8118.ef901","761cfa6d.4a86bc","26582af.1a68ed6","e30e637f.d69ce8","536b348f.d4cf9c","d5288677.a2085","4cafc9eb.8872b","b8b17236.7bf06","7946e793.89f08","2e22cf41.82e978","a173f61c.f54af","25449935.bf4046","534527cb.5330b","fbbea4d5.1f17","bcd27cb7.187a6","574f0bbd.60c3ec","3451b716.87d158","52a794a3.717be4","4fe4fbe1.fdb434","803aa305.29b728","fcd41611.21ace","66b07f90.f3cf2","fe0cd6c.e5be028","e51d221e.ee2ab8","1879320e.a502ce","2e1dc18a.e0a76e"]]},{"id":"ad1d1588.d76d","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":550.5002098083496,"y":2665.381863594055,"z":"6c1fa692.a38a58","wires":[]},{"id":"50cb6b9d.38fa3c","type":"set","name":"set output to api handler","xml":"<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='brg-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $tmp.service-data.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n <!--\nbrg-topology-operation-input.allotted-resource-information.parent-service-instance-id\n \n brg-topology-operation-input.service-information.service-instance-id\n -->\n","comments":"","x":576.2541198730469,"y":2622.504550933838,"z":"6c1fa692.a38a58","wires":[]},{"id":"7f6e2b92.2edeec","type":"set","name":"set allotted-resource-oper-status","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='Active' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$brg-topology-operation-input.request-information.request-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$brg-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$brg-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n","comments":"","x":592.7542190551758,"y":729.0514001846313,"z":"6c1fa692.a38a58","wires":[]},{"id":"62d81f8c.21d7e8","type":"set","name":"set tmp.ar.self-link","xml":"<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:brg-allotted-resources/brg-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/brg-topology/'` \" />\n\n","comments":"","x":546.738037109375,"y":341.33331298828125,"z":"6c1fa692.a38a58","wires":[]},{"id":"1afb7e82.eefe39","type":"set","name":"set tmp.ar.allotted-resource-id,etc","xml":"<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$brg-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n<parameter name='tmp.ar.parent-service-instance-id' value='`$brg-topology-operation-input.allotted-resource-information.parent-service-instance-id`' />\n<!--\n<parameter name='tmp.ar.brg-vnf-id' value='`$brg-topology-operation-input.allotted-resource-data.brg-topology.brg-assignments.brg-vnf-id`' />\n-->\n\n","comments":"","x":586.997314453125,"y":256.59259033203125,"z":"6c1fa692.a38a58","wires":[]},{"id":"7b6d22c9.e07ccc","type":"execute","name":"execute Properties","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":552.9934196472168,"y":379.23152446746826,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"1fbb479c.9b3e88","type":"execute","name":"execute RestApiCallNode - Get AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":617.5187530517578,"y":519.4594917297363,"z":"6c1fa692.a38a58","wires":[["158f0da2.87450a","5d6d055b.455bac"]]},{"id":"1e99334.059e24d","type":"execute","name":"generate allotted-resource url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.brg-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n","comments":"","outputs":1,"x":581.0648536682129,"y":439.0172290802002,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"158f0da2.87450a","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":874.8148918151855,"y":518.2672522068024,"z":"6c1fa692.a38a58","wires":[["39c8028b.d1ebd6"]]},{"id":"bb9bf99c.661c18","type":"execute","name":"execute RestApiCallNode - PUT AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.brg.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":625.5293121337891,"y":872.4341316223145,"z":"6c1fa692.a38a58","wires":[["38d0e910.62fe16","b331edc.274599","6a7f51cd.da458"]]},{"id":"38d0e910.62fe16","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1149.8373832702637,"y":897.4324235916138,"z":"6c1fa692.a38a58","wires":[["cc616362.9090e8"]]},{"id":"b331edc.274599","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1140.8374328613281,"y":865.9324493408203,"z":"6c1fa692.a38a58","wires":[["cc616362.9090e8"]]},{"id":"6a7f51cd.da458","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1144.5874710083008,"y":836.2895542159677,"z":"6c1fa692.a38a58","wires":[["d1c749b9.48fe3"]]},{"id":"cc616362.9090e8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for brg-allotted-resource\" />\n","comments":"","x":1310.5874710083008,"y":866.6824731826782,"z":"6c1fa692.a38a58","wires":[]},{"id":"39c8028b.d1ebd6","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1055.8148460388184,"y":518.7672016620636,"z":"6c1fa692.a38a58","wires":[["38b40fc9.d62398","9b187214.4c99c"]]},{"id":"38b40fc9.d62398","type":"switchNode","name":"switch brg length","xml":"<switch test='`$mdsal-ar.brg-allotted-resource_length`'>\n","comments":"","outputs":1,"x":1301.6720924377441,"y":553.052964925766,"z":"6c1fa692.a38a58","wires":[["253116a2.13449a"]]},{"id":"253116a2.13449a","type":"other","name":"outcome 1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":1492.6720962524414,"y":553.0529625415802,"z":"6c1fa692.a38a58","wires":[["a60326b3.15b8b"]]},{"id":"9c10ae24.f65718","type":"set","name":"set brg-ar from get","xml":"<set>\n<parameter name='brg-ar.' value='$mdsal-ar.brg-allotted-resource[0].' />\n","comments":"","x":1892.5292320251465,"y":553.6243867874146,"z":"6c1fa692.a38a58","wires":[]},{"id":"a60326b3.15b8b","type":"block","name":"block: atomic","xml":"<block atomic='true'>\n","atomic":"false","comments":"","outputs":1,"x":1663.5290794372559,"y":553.6244316101074,"z":"6c1fa692.a38a58","wires":[["9c10ae24.f65718","fd36fe44.f9fcd8","d42701c6.15bc"]]},{"id":"fd36fe44.f9fcd8","type":"set","name":"set oper-status","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$brg-ar.allotted-resource-data.allotted-resource-operation-information.request-information.request-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$brg-ar.allotted-resource-status.rpc-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$brg-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.svc-request-id`' />\n\n","comments":"","x":1890.5294761657715,"y":621.0529508590698,"z":"6c1fa692.a38a58","wires":[]},{"id":"f1b9b26c.17f35","type":"comment","name":"GET brg-allotted-resource from mdsal","info":"","comments":"","x":642.8148155212402,"y":482.7671926021576,"z":"6c1fa692.a38a58","wires":[]},{"id":"d42701c6.15bc","type":"switchNode","name":"switch order-status","xml":"<switch test='`$brg-ar.allotted-resource-data.allotted-resource-oper-status.order-status`'>\n","comments":"","outputs":1,"x":1900.52925491333,"y":586.6243848800659,"z":"6c1fa692.a38a58","wires":[["f5a846c5.f6614","4162652a.0eb31c"]]},{"id":"f5a846c5.f6614","type":"outcome","name":"outcome Created","xml":"<outcome value='Created'>\n","comments":"","outputs":1,"x":2112.1292114257812,"y":547.6243848800659,"z":"6c1fa692.a38a58","wires":[["54f38743.c68978"]]},{"id":"4162652a.0eb31c","type":"outcome","name":"outcome Other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2137.8435859680176,"y":583.052975654602,"z":"6c1fa692.a38a58","wires":[["54f38743.c68978"]]},{"id":"69655148.a35838","type":"comment","name":"Set allotted-resource-identifiers","info":"","comments":"","x":598.3386383056641,"y":573.3386459350586,"z":"6c1fa692.a38a58","wires":[]},{"id":"9b187214.4c99c","type":"set","name":"save backup copy of mdsal-ar for rollback","xml":"<set>\n<parameter name='bk-brg-ar' value='$mdsal-ar.' />\n","comments":"","x":1381.3864250183105,"y":518.7672936916351,"z":"6c1fa692.a38a58","wires":[]},{"id":"d5a3d619.6f2c1","type":"comment","name":"Create urls for restapi","info":"","comments":"","x":551.9576606750488,"y":408.6243562698364,"z":"6c1fa692.a38a58","wires":[]},{"id":"d1c749b9.48fe3","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1286.2434387207031,"y":832.4817234054208,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"911da86f.77f9d","type":"comment","name":"TO DO: vnf/put parent","info":"","comments":"","x":556.2433776855469,"y":761.1481952667236,"z":"6c1fa692.a38a58","wires":[]},{"id":"a41547ad.552528","type":"execute","name":"execute getTime","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n","comments":"","outputs":1,"x":540.2433815002441,"y":690.4815549850464,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"5d6d055b.455bac","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":874.5766868591309,"y":554.4814250469208,"z":"6c1fa692.a38a58","wires":[["51999669.382ec"]]},{"id":"51999669.382ec","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1054.5766372680664,"y":555.1479756832123,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"6a1a8118.ef901","type":"set","name":"set id","xml":"<set>\n<parameter name='brg-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='brg-ar.allotted-resource-status.action' value=\"`$brg-topology-operation-input.request-information.request-action` \" />\n<parameter name='brg-ar.allotted-resource-status.rpc-name' value=\"brg-topology-operation\" />\n<parameter name='brg-ar.allotted-resource-status.rpc-action' value=\"`$brg-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$brg-topology-operation-input.request-information.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$brg-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$brg-topology-operation-input.service-information.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$brg-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.brg-request-input.' value=\"`$brg-topology-operation-input.brg-request-input.` \" />","comments":"","x":523.2434234619141,"y":610.1481666564941,"z":"6c1fa692.a38a58","wires":[]},{"id":"54f38743.c68978","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2326.5997276306152,"y":549.0000190734863,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"761cfa6d.4a86bc","type":"update","name":"update AAI allotted-resource","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $brg-topology-operation-input.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $brg-topology-operation-input.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $brg-topology-operation-input.allotted-resource-information.parent-service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n\t<parameter name=\"operational-status\" value=\"in-service-path\" />\n","comments":"","outputs":1,"x":583.8571624755859,"y":794.2380628585815,"z":"6c1fa692.a38a58","wires":[["c14221c9.4904f8","c8137cf1.86be"]]},{"id":"c14221c9.4904f8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":839.6190567016602,"y":777.1905598640442,"z":"6c1fa692.a38a58","wires":[["a1949e47.9f4ee"]]},{"id":"a1949e47.9f4ee","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n","comments":"","x":1006.142936706543,"y":788.8096308708191,"z":"6c1fa692.a38a58","wires":[]},{"id":"c8137cf1.86be","type":"failure","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":846.7143440246582,"y":809.9525275230408,"z":"6c1fa692.a38a58","wires":[["a1949e47.9f4ee"]]},{"id":"26582af.1a68ed6","type":"execute","name":"execute RestApiCallNode - setup BRG to vgMux vxlan tunnel port","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.vpp.vxlan-tunnel.templatefile`\" />\n    <parameter name='restapiUrl' value='`$tmp.honeycomb.url + $tmp.vpp-honeycomb-url`' />\n    <parameter name='restapiUser' value='`$prop.honeycomb.user`' />\n    <parameter name='restapiPassword' value='`$prop.honeycomb.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"honeycomb-vnf\" />\n\n","comments":"","outputs":1,"x":696.0000610351562,"y":1363.6668300628662,"z":"6c1fa692.a38a58","wires":[["c35188aa.9d267","6b7f71c4.2210e","15e48478.12fb44"]]},{"id":"c35188aa.9d267","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1029.9748497009277,"y":1422.9984420761466,"z":"6c1fa692.a38a58","wires":[["cc0c8074.979a3"]]},{"id":"6b7f71c4.2210e","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1020.9748992919922,"y":1391.4984678253531,"z":"6c1fa692.a38a58","wires":[["cc0c8074.979a3"]]},{"id":"15e48478.12fb44","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1024.7249374389648,"y":1361.8555727005005,"z":"6c1fa692.a38a58","wires":[["f47ec3c3.abb0f"]]},{"id":"cc0c8074.979a3","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error setting up vxlan tunnel\" />\n","comments":"","x":1190.7249374389648,"y":1392.248491667211,"z":"6c1fa692.a38a58","wires":[]},{"id":"f47ec3c3.abb0f","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1166.3809051513672,"y":1358.0477418899536,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"e30e637f.d69ce8","type":"execute","name":"execute RestApiCallNode - setup BRG vxlan bridge domain","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.vpp.bridge-domain.templatefile`\" />\n    <parameter name='restapiUrl' value=\"`$tmp.honeycomb.url + $tmp.vpp-honeycomb-url + '/v3po:l2' `\" />\n    <parameter name='restapiUser' value='`$prop.honeycomb.user`' />\n    <parameter name='restapiPassword' value='`$prop.honeycomb.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"honeycomb-vnf\" />\n\n","comments":"","outputs":1,"x":677.6668243408203,"y":1510.3336246013641,"z":"6c1fa692.a38a58","wires":[["121ea1b0.ea0a96","71341c4e.7c87ac","27bd0ccf.487614"]]},{"id":"121ea1b0.ea0a96","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1098.9747314453125,"y":1565.9985536560416,"z":"6c1fa692.a38a58","wires":[["cdacc825.c32108"]]},{"id":"71341c4e.7c87ac","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1089.974781036377,"y":1534.4985794052482,"z":"6c1fa692.a38a58","wires":[["cdacc825.c32108"]]},{"id":"27bd0ccf.487614","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1093.7248191833496,"y":1504.8556842803955,"z":"6c1fa692.a38a58","wires":[["dd14f52.3d66b08"]]},{"id":"cdacc825.c32108","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error setting up bridge domain\" />\n","comments":"","x":1259.7248191833496,"y":1535.248603247106,"z":"6c1fa692.a38a58","wires":[]},{"id":"dd14f52.3d66b08","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1235.380786895752,"y":1501.0478534698486,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"4cafc9eb.8872b","type":"set","name":"set BRG to vgMUX VXLAN Tunnel Port Props","xml":"<set>\n<parameter name='tmp.tunnel-name' value=\"`'vxlanTun' + $brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-lan-ip` \" />\n<parameter name='tmp.tunnel-dest-ip' value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-lan-ip` \" />\n<parameter name='tmp.tunnel-src-ip' value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.vbrg-wan-ip` \" />\n<parameter name='tmp.tunnel-vni' value=\"`$brg-ar.allotted-resource-data.allotted-resource-operation-information.brg-request-input.vni` \" />","comments":"","x":632.1112060546875,"y":1228.6670894622803,"z":"6c1fa692.a38a58","wires":[]},{"id":"d5288677.a2085","type":"execute","name":"generate full brg-vpp-honeycomb url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.vpp-honeycomb`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.vpp-honeycomb-url\"/>\n    <parameter name=\"target\" value=\"{tunnel-name}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.tunnel-name`\"/>\n","comments":"","outputs":1,"x":603.7778472900391,"y":1283.6668682098389,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"536b348f.d4cf9c","type":"execute","name":"generate honeycomb-url to vBRG","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.honeycomb.url`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.honeycomb.url\"/>\n    <parameter name=\"target\" value=\"{honeycomb-instance-ip}\"/>\n    <parameter name=\"replacement\" value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.vbrg-wan-ip`\"/>\n","comments":"","outputs":1,"x":594.7778778076172,"y":1172.3333940505981,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"b8b17236.7bf06","type":"set","name":"set BRG Bridge Domain Props","xml":"<set>\n<parameter name='tmp.bridge-domain' value=\"bridge-domain-10\" />\n<parameter name='tmp.split-horizon-group' value=\"2\" />","comments":"","x":587.1111602783203,"y":1435.3334999084473,"z":"6c1fa692.a38a58","wires":[]},{"id":"ba483f5.d1e594","type":"comment","name":"save service data for BRG to md-sal for SO to do GET ","info":"http://c1.vm1.sdnc.simpledemo.openecomp.org:8282/restconf/config/GENERIC-RESOURCE-API:services/service/e565bb6b-de14-4a5c-a992-65a681771a7a/service-data/service-topology/\n\n\nservice-instance-id is of the vBRG (in VNF-API data)","comments":"","x":329.79503631591797,"y":2213.7715578079224,"z":"6c1fa692.a38a58","wires":[]},{"id":"2e22cf41.82e978","type":"execute","name":"execute RestApiCallNode - Get service-data by vnf-id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.vnf-api-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"service-data\" />\n\n","comments":"","outputs":1,"x":662.0015068054199,"y":2340.8350467681885,"z":"6c1fa692.a38a58","wires":[["27e1f386.d18d9c","98885b52.6aac4"]]},{"id":"27e1f386.d18d9c","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":950.8214263916016,"y":2338.2143902778625,"z":"6c1fa692.a38a58","wires":[["9811fdce.4362f"]]},{"id":"9811fdce.4362f","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1131.8213806152344,"y":2338.714339733124,"z":"6c1fa692.a38a58","wires":[["ae238cfd.99a978","ff84fda2.c98b9"]]},{"id":"ae238cfd.99a978","type":"switchNode","name":"switch brg length","xml":"<switch test='`$service-data.service-data_length`'>\n","comments":"","outputs":1,"x":1377.6786270141602,"y":2373.000102996826,"z":"6c1fa692.a38a58","wires":[["1239e54c.ee9663"]]},{"id":"1239e54c.ee9663","type":"other","name":"outcome 1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":1568.6786308288574,"y":2373.0001006126404,"z":"6c1fa692.a38a58","wires":[["ea02cbd2.3046e"]]},{"id":"df56b573.34663","type":"set","name":"set service-data from get","xml":"<set>\n<parameter name='tmp.service-data.' value='$service-data.service-data[0].' />\n","comments":"","x":1968.5357666015625,"y":2373.5715248584747,"z":"6c1fa692.a38a58","wires":[]},{"id":"ea02cbd2.3046e","type":"block","name":"block: atomic","xml":"<block atomic='true'>\n","atomic":"false","comments":"","outputs":1,"x":1739.5356140136719,"y":2373.5715696811676,"z":"6c1fa692.a38a58","wires":[["df56b573.34663","f04b4bc1.0daf68"]]},{"id":"3fbbcb04.80fcec","type":"comment","name":"GET vnf-api service info","info":"","comments":"","x":567.3927612304688,"y":2304.1427431106567,"z":"6c1fa692.a38a58","wires":[]},{"id":"f04b4bc1.0daf68","type":"switchNode","name":"switch order-status","xml":"<switch test='`$tmp.service-data.order-status`'>\n","comments":"","outputs":1,"x":1952.249984741211,"y":2425.1429500579834,"z":"6c1fa692.a38a58","wires":[["2ed09998.304e0e","5efce4f3.9488fc"]]},{"id":"2ed09998.304e0e","type":"outcome","name":"outcome Created","xml":"<outcome value='Created'>\n","comments":"","outputs":1,"x":2192.1355476379395,"y":2389.5714988708496,"z":"6c1fa692.a38a58","wires":[["d8bdded8.a9409"]]},{"id":"5efce4f3.9488fc","type":"outcome","name":"outcome Other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2217.849922180176,"y":2425.0000896453857,"z":"6c1fa692.a38a58","wires":[["d8bdded8.a9409"]]},{"id":"e60d88ff.eaefb","type":"comment","name":"Set service-data","info":"","comments":"","x":543.4880065917969,"y":2439.0004692077637,"z":"6c1fa692.a38a58","wires":[]},{"id":"ff84fda2.c98b9","type":"set","name":"save backup copy of mdsal-ar for rollback","xml":"<set>\n<parameter name='bk-service-data' value='$service-data.' />\n","comments":"","x":1457.3929595947266,"y":2338.7144317626953,"z":"6c1fa692.a38a58","wires":[]},{"id":"98885b52.6aac4","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":950.5832214355469,"y":2374.428563117981,"z":"6c1fa692.a38a58","wires":[["4824800d.76fea"]]},{"id":"4824800d.76fea","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1130.5831718444824,"y":2375.0951137542725,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"d8bdded8.a9409","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2406.6060638427734,"y":2390.94713306427,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"7946e793.89f08","type":"execute","name":"generate vnf service-info url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.vnf-api.service-information`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.vnf-api-url\"/>\n    <parameter name=\"target\" value=\"{vnf-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.brg-vnf-id`\"/>\n\n   <!-- \n   <parameter name=\"replacement\" value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.brg-vnf-id`\"/>\n -->\n    <!--\n    <parameter name=\"replacement\" value=\"`$brg-topology-operation-input.allotted-resource-data.brg-topology.brg-assignments.brg-vnf-id`\"/>\n-->\n<!--\nbrg-ar.allotted-resource-data.brg-topology.brg-assignments\n-->","comments":"","outputs":1,"x":583.8109130859375,"y":2259.263671875,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"25449935.bf4046","type":"execute","name":"execute RestApiCallNode - PUT service into service","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.services.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.services-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":662.0966911315918,"y":2517.502098083496,"z":"6c1fa692.a38a58","wires":[["75076c77.fcddbc","ab0e0ff6.dbacd8","f2aab5bd.10be8"]]},{"id":"75076c77.fcddbc","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1168.3095474243164,"y":2512.0241107940674,"z":"6c1fa692.a38a58","wires":[["3d728759.355018"]]},{"id":"ab0e0ff6.dbacd8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1159.3095970153809,"y":2480.524136543274,"z":"6c1fa692.a38a58","wires":[["3d728759.355018"]]},{"id":"f2aab5bd.10be8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1163.0596351623535,"y":2450.8812414184213,"z":"6c1fa692.a38a58","wires":[["6c725f42.e545c"]]},{"id":"3d728759.355018","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for brg-allotted-resource\" />\n","comments":"","x":1329.0596351623535,"y":2481.274160385132,"z":"6c1fa692.a38a58","wires":[]},{"id":"6c725f42.e545c","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1304.7156028747559,"y":2447.0734106078744,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"a173f61c.f54af","type":"execute","name":"generate services url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.services`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.services-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.service-data.service-information.service-instance-id`\"/>\n<!--  tmp.service-data.service-information.service-instance-id\nbrg-topology-operation-input.allotted-resource-information.parent-service-instance-id\nbrg-topology-operation-input.service-information.service-instance-id\n\n-->","comments":"","outputs":1,"x":561.4300231933594,"y":2469.02618598938,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"534527cb.5330b","type":"get-resource","name":"get-resource IPADDR from dmaap DHCP_MAP ","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='IPADDR' key=\"SELECT min(ip_addr) ip from DHCP_MAP where mac_addr = $brg-ar.allotted-resource-data.allotted-resource-operation-information.brg-request-input.brg-wan-mac-address\" pfx=\"tmp.brg-wan-ip\" >\n","comments":"","outputs":1,"x":640.8571624755859,"y":920.7501087188721,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"fbbea4d5.1f17","type":"set","name":"set brg-ar.allotted-resource-data.brg-topology.brg-assignments.vbrg-wan-ip","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.brg-assignments.vbrg-wan-ip' value='`$tmp.brg-wan-ip.ip`' />\n","comments":"","x":727.0000305175781,"y":970.0000267028809,"z":"6c1fa692.a38a58","wires":[]},{"id":"bcd27cb7.187a6","type":"set","name":"set tmp.ar.consuming-service-instance-id to find vgmux-lan-ip","xml":"<set>\n<parameter name='tmp.ar.consuming-service-instance-id' value='`$brg-ar.allotted-resource-data.brg-topology.allotted-resource-identifiers.consuming-service-instance-id`' />\n","comments":"","x":687.9999694824219,"y":1017.9998550415039,"z":"6c1fa692.a38a58","wires":[]},{"id":"574f0bbd.60c3ec","type":"call","name":"call GENERIC-RESOURCE-API:get-tunnelxconn-ar","xml":"<call module='GENERIC-RESOURCE-API' rpc='get-tunnelxconn-ar' mode='sync' >\n","comments":"","outputs":1,"x":648.0000152587891,"y":1066.333191871643,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"3451b716.87d158","type":"set","name":"set brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-lan-ip","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-lan-ip' value='`$tmp.tunnelxconn-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-assignments.vgmux-lan-ip`' />\n","comments":"","x":726.3332672119141,"y":1119.6665697097778,"z":"6c1fa692.a38a58","wires":[]},{"id":"b7fc9e2e.d326a8","type":"comment","name":"Change to POST and just update service?","info":"","comments":"","x":841.357177734375,"y":2544.9287109375,"z":"6c1fa692.a38a58","wires":[]},{"id":"77c9e988.0d476","type":"execute","name":"execute RestApiCallNode - setup vG to vgMux vxlan tunnel port","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.vpp.vxlan-tunnel.templatefile`\" />\n    <parameter name='restapiUrl' value='`$tmp.honeycomb.url + $tmp.vpp-honeycomb-url`' />\n    <parameter name='restapiUser' value='`$prop.honeycomb.user`' />\n    <parameter name='restapiPassword' value='`$prop.honeycomb.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"honeycomb-vnf\" />\n\n","comments":"","outputs":1,"x":842.166748046875,"y":2035.166748046875,"z":"6c1fa692.a38a58","wires":[["98e1d7c2.e9e0a","5ccf5413.99e35c","a81a84bb.2cc498"]]},{"id":"98e1d7c2.e9e0a","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1181.141513824463,"y":2074.49837436527,"z":"6c1fa692.a38a58","wires":[["2fbb5268.c289be"]]},{"id":"5ccf5413.99e35c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1172.1415634155273,"y":2042.9984001144767,"z":"6c1fa692.a38a58","wires":[["2fbb5268.c289be"]]},{"id":"a81a84bb.2cc498","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1175.8916015625,"y":2013.355504989624,"z":"6c1fa692.a38a58","wires":[["28394b93.ce2d9c"]]},{"id":"2fbb5268.c289be","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error setting up vxlan tunnel\" />\n","comments":"","x":1341.8916015625,"y":2043.7484239563346,"z":"6c1fa692.a38a58","wires":[]},{"id":"28394b93.ce2d9c","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1317.5475692749023,"y":2009.5476741790771,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"33cc3b7e.7713e4","type":"execute","name":"execute RestApiCallNode - setup BRG vxlan bridge domain","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.vpp.bridge-domain.templatefile`\" />\n    <parameter name='restapiUrl' value=\"`$tmp.honeycomb.url + $tmp.vpp-honeycomb-url + '/v3po:l2' `\" />\n    <parameter name='restapiUser' value='`$prop.honeycomb.user`' />\n    <parameter name='restapiPassword' value='`$prop.honeycomb.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"honeycomb-vnf\" />\n\n","comments":"","outputs":1,"x":827.1668548583984,"y":2121.8336877822876,"z":"6c1fa692.a38a58","wires":[["c3b25db3.17a52","4db3ba34.59a5fc","2dc69fdd.e1aed8"]]},{"id":"c3b25db3.17a52","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1171.808193206787,"y":2202.4984325394034,"z":"6c1fa692.a38a58","wires":[["277d259.8e3b45a"]]},{"id":"4db3ba34.59a5fc","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1162.8082427978516,"y":2170.99845828861,"z":"6c1fa692.a38a58","wires":[["277d259.8e3b45a"]]},{"id":"2dc69fdd.e1aed8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1166.5582809448242,"y":2141.3555631637573,"z":"6c1fa692.a38a58","wires":[["e418255e.942ff8"]]},{"id":"277d259.8e3b45a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error setting up bridge domain\" />\n","comments":"","x":1332.5582809448242,"y":2171.748482130468,"z":"6c1fa692.a38a58","wires":[]},{"id":"e418255e.942ff8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1308.2142486572266,"y":2137.5477323532104,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"fcd41611.21ace","type":"set","name":"set vG to vgMUX VXLAN Tunnel Port Props","xml":"<set>\n<parameter name='tmp.tunnel-name' value=\"`'vxlanTun' + $brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-bearer-ip` \" />\n<parameter name='tmp.tunnel-dest-ip' value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-bearer-ip` \" />\n<parameter name='tmp.tunnel-src-ip' value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.vg-ip` \" />\n<parameter name='tmp.tunnel-vni' value=\"`$brg-ar.allotted-resource-data.allotted-resource-operation-information.brg-request-input.vni` \" />","comments":"","x":631.9445724487305,"y":1917.1669521331787,"z":"6c1fa692.a38a58","wires":[]},{"id":"66b07f90.f3cf2","type":"execute","name":"generate full vg-vpp-honeycomb url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.vpp-honeycomb`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.vpp-honeycomb-url\"/>\n    <parameter name=\"target\" value=\"{tunnel-name}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.tunnel-name`\"/>\n","comments":"","outputs":1,"x":611.611213684082,"y":1972.1667308807373,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"803aa305.29b728","type":"execute","name":"generate honeycomb-url to vG","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.honeycomb.url`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.honeycomb.url\"/>\n    <parameter name=\"target\" value=\"{honeycomb-instance-ip}\"/>\n    <parameter name=\"replacement\" value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.vg-mgmt-ip`\"/>\n","comments":"","outputs":1,"x":590.9446029663086,"y":1857.4999265670776,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"52a794a3.717be4","type":"set","name":"set brg-ar.allotted-resource-data.brg-topology.brg-assignments.vg-ip","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.brg-assignments.vg-ip' value='`$tmp.tunnelxconn-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-assignments.vg-ip`' />\n","comments":"","x":703.0000457763672,"y":1569.666633605957,"z":"6c1fa692.a38a58","wires":[]},{"id":"4fe4fbe1.fdb434","type":"set","name":"set brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-bearer-ip","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-bearer-ip' value='`$tmp.tunnelxconn-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-assignments.vgmux-bearer-ip`' />\n","comments":"","x":741.3333435058594,"y":1619.6665630340576,"z":"6c1fa692.a38a58","wires":[]},{"id":"4d6b8902.f37ba8","type":"comment","name":"Setup VXLAN Tunnel - vG to vgMUX","info":"","comments":"","x":288,"y":1572.999852180481,"z":"6c1fa692.a38a58","wires":[]},{"id":"2f2d9dc0.026be2","type":"comment","name":"Setup VXLAN Tunnel - vBRG to vgMUX","info":"","comments":"","x":290.1666717529297,"y":923.0001373291016,"z":"6c1fa692.a38a58","wires":[]},{"id":"613dc927.a7cb98","type":"comment","name":"Get vg-mgmt-ip","info":"brg tunnelxconnn consuming-service-instance-id\nfound in services as service-instance-id","comments":"","x":286.00001525878906,"y":1767.333607673645,"z":"6c1fa692.a38a58","wires":[]},{"id":"fe0cd6c.e5be028","type":"set","name":"set tmp.search.consuming-service-instance-id to find vg-mgmt-ip","xml":"<set>\n<parameter name='tmp.search.consuming-service-instance-id' value='`$brg-ar.allotted-resource-data.brg-topology.allotted-resource-identifiers.consuming-service-instance-id`' />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t","comments":"","x":689.1666030883789,"y":1691.3329668045044,"z":"6c1fa692.a38a58","wires":[]},{"id":"5bee91fe.fa9cd8","type":"for","name":"for tmp.preloadvnfdata","xml":"<for index='vnfidx' start='0' end='`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list_length`' >\n                               \n\n\n","comments":"","outputs":1,"x":1548.333251953125,"y":1685.9998779296875,"z":"6c1fa692.a38a58","wires":[["e8013be2.d085f"]]},{"id":"5cb532.32ef0ad","type":"get-resource","name":"get-resource generic-resource-api:services ","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='GENERIC-RESOURCE-API' key='services' pfx='tmp.servicedata' >\n","comments":"","outputs":1,"x":625.6667175292969,"y":1753.6663818359375,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"a465b112.0d40a8","type":"switchNode","name":"switch parent-service-instance-id matches","xml":"<switch test='`$tmp.preloadvnfdata.vnfs.vnf[$vnfidx].service-instance-id == $tmp.search.consuming-service-instance-id`'>\n\n\n","comments":"","outputs":1,"x":1777,"y":2033.6666259765625,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"4088be7a.cae2","type":"success","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2003.9999923706055,"y":1744.3332052230835,"z":"6c1fa692.a38a58","wires":[["8594640f.24b708"]]},{"id":"1045f43d.d6afdc","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1223.3332977294922,"y":1670.6664695739746,"z":"6c1fa692.a38a58","wires":[["209d4769.e6146"]]},{"id":"9090d90e.a8f0a","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1201.6666564941406,"y":1737.3331623077393,"z":"6c1fa692.a38a58","wires":[["87fe04e9.24d5f8"]]},{"id":"a0e306ed.820868","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1192.666706085205,"y":1705.8331880569458,"z":"6c1fa692.a38a58","wires":[["87fe04e9.24d5f8"]]},{"id":"87fe04e9.24d5f8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error getting GENERIC-RESOURCE-API:services\" />\n","comments":"","x":1362.4167442321777,"y":1706.5832118988037,"z":"6c1fa692.a38a58","wires":[]},{"id":"5f63ed00.e4509c","type":"switchNode","name":"switch vnf-parameter-name matches vgw_private_ip","xml":"<switch test=\"`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list[$vnfidx].preload-data.vnf-topology-information.vnf-parameters[$paramidx].vnf-parameter-name == 'vgw_private_ip_1'`\" >\n\n\n","comments":"","outputs":1,"x":2492.3331451416016,"y":1637.3332786560059,"z":"6c1fa692.a38a58","wires":[["659ac035.31b17"]]},{"id":"659ac035.31b17","type":"success","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2771.333251953125,"y":1649,"z":"6c1fa692.a38a58","wires":[["faad5ed5.79e448"]]},{"id":"8594640f.24b708","type":"for","name":"for service vnfs vf-modules parameters","xml":"<for index='paramidx' start='0' end='`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list[$vnfidx].preload-data.vnf-topology-information.vnf-parameters_length`' >\n\n\n","comments":"","outputs":1,"x":2268.333251953125,"y":1727.66650390625,"z":"6c1fa692.a38a58","wires":[["5f63ed00.e4509c"]]},{"id":"faad5ed5.79e448","type":"set","name":"set vg-mgmt-ip","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.brg-assignments.vg-mgmt-ip'\n value=\"`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list[$vnfidx].preload-data.vnf-topology-information.vnf-parameters[$paramidx].vnf-parameter-value`\" />\n\n","comments":"","x":2920.999755859375,"y":1687.6666259765625,"z":"6c1fa692.a38a58","wires":[]},{"id":"6e158dbc.a9be7c","type":"execute","name":"execute print context","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/brg-topo-op-activate.log' />\n","comments":"","outputs":1,"x":568,"y":2576,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"e8013be2.d085f","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1561,"y":1799,"z":"6c1fa692.a38a58","wires":[["f34f3c76.64d458"]]},{"id":"591802ea.8c09bc","type":"set","name":"set debug","xml":"<set>\n<parameter name='tmp.debug.service-instance-id' value='`$tmp.servicedata.services.service[$serviceidx].service-instance-id`' />\n<parameter name='tmp.debug.consuming-service-instance-id' value='`$tmp.search.consuming-service-instance-id`' />\n\n\n\n","comments":"","x":1712,"y":1874,"z":"6c1fa692.a38a58","wires":[]},{"id":"60caa157.4e6378","type":"execute","name":"execute print context","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/brg-topo-op-activate.log' />\n","comments":"","outputs":1,"x":1541,"y":1618,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"543f9252.6eb754","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":1544,"y":1511,"z":"6c1fa692.a38a58","wires":[]},{"id":"209d4769.e6146","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1339,"y":1623,"z":"6c1fa692.a38a58","wires":[["5bee91fe.fa9cd8","6ba037e8.63ddd8"]]},{"id":"e51d221e.ee2ab8","type":"get-resource","name":"get-resource vnf-api:vnfs","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='VNF-API' key='preload-vnfs' pfx='tmp.preloadvnfdata' >\n<!--\ntmp.preloadvnfdata.preload-vnfs.vnf-preload-list[1].preload-data[0].vnf-topology-information.vnf-parameters[16].vnf-parameter-value = 10.0.101.30\n-->","comments":"","outputs":1,"x":661,"y":1801,"z":"6c1fa692.a38a58","wires":[["9090d90e.a8f0a","a0e306ed.820868","1045f43d.d6afdc"]]},{"id":"c7a11d7f.fb8c38","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":399,"y":1802,"z":"6c1fa692.a38a58","wires":[]},{"id":"f34f3c76.64d458","type":"switchNode","name":"switch parent-service-instance-id matches","xml":"<switch test='`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list[$vnfidx].vnf-name == $tmp.brg-match-vnf-name`'>\n\n\n","comments":"","outputs":1,"x":1776,"y":1949,"z":"6c1fa692.a38a58","wires":[["4088be7a.cae2"]]},{"id":"6ba037e8.63ddd8","type":"set","name":"set tmp.brgmatch-vnf-name","xml":"<set>\n<parameter name='tmp.brg-match-vnf-name' value=\"`'VGW2BRG-'+ $brg-ar.allotted-resource-data.allotted-resource-operation-information.brg-request-input.brg-wan-mac-address`\" />\n\n","comments":"","x":1562,"y":1574,"z":"6c1fa692.a38a58","wires":[]},{"id":"b292149a.348d68","type":"comment","name":"Disable updates to vGW becuase of race condition","info":"vGW has to reboot to apply its config and sdnc tries to connect soon. \nBeijing will have the sleep utilities to handle this. Use heat.env parameters with vni to resolve","comments":"","x":826,"y":2076,"z":"6c1fa692.a38a58","wires":[]},{"id":"3be7e02c.f2a31","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":526,"y":2043,"z":"6c1fa692.a38a58","wires":[]},{"id":"35706264.5e767e","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":520,"y":2125,"z":"6c1fa692.a38a58","wires":[]},{"id":"6c257595.e9d49c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":746,"y":2246,"z":"6c1fa692.a38a58","wires":[]},{"id":"65a5973d.076518","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":340,"y":312,"z":"6c1fa692.a38a58","wires":[]},{"id":"dce18120.0cf858","type":"for","name":"for tmp.vnfs","xml":"<for index='vnfidx' start='0' end='`$tmp.vnfdata.vnfs.vnf-list_length`' >\n\n\n","comments":"","outputs":1,"x":883,"y":339,"z":"6c1fa692.a38a58","wires":[["988fd8fd.e7e43"]]},{"id":"1879320e.a502ce","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":530.1429443359375,"y":299.1904296875,"z":"6c1fa692.a38a58","wires":[["a9df8e17.d4273","dce18120.0cf858"]]},{"id":"a9df8e17.d4273","type":"get-resource","name":"get-resource vnf-api vnfs","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='VNF-API' key='vnfs' pfx='tmp.vnfdata' >\n","comments":"","outputs":1,"x":962,"y":281.6666259765625,"z":"6c1fa692.a38a58","wires":[[]]},{"id":"988fd8fd.e7e43","type":"switchNode","name":"switch parent-service-instance-id matches","xml":"<switch test='`$tmp.vnfdata.vnfs.vnf-list[$vnfidx].service-data.service-information.service-instance-id == $tmp.ar.parent-service-instance-id`'>\n\n\n","comments":"","outputs":1,"x":1151,"y":362.33331298828125,"z":"6c1fa692.a38a58","wires":[["e2df1feb.345a88"]]},{"id":"e2df1feb.345a88","type":"success","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1449.0001220703125,"y":372.33331298828125,"z":"6c1fa692.a38a58","wires":[["c6e47000.d7b71"]]},{"id":"c6e47000.d7b71","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1664.0001220703125,"y":382.3333435058594,"z":"6c1fa692.a38a58","wires":[["e1ea2cb0.bcfd08"]]},{"id":"e1ea2cb0.bcfd08","type":"set","name":"set  tmp.ar.brg-vnf-id","xml":"<set>\n<parameter name='tmp.ar.brg-vnf-id' \n   value='`$tmp.vnfdata.vnfs.vnf-list[$vnfidx].vnf-id`' />\n\n\n\n","comments":"","x":1892,"y":399,"z":"6c1fa692.a38a58","wires":[]},{"id":"1934ef1e.f9add1","type":"comment","name":"Need to use parent service instance id","info":"service-instance id : {\n  \"service-status\": {\n    \"rpc-action\": \"activate\",\n    \"response-code\": \"200\",\n    \"action\": \"CreateVfModuleInstance\",\n    \"request-status\": \"synccomplete\",\n    \"rpc-name\": \"vf-module-topology-operation\",\n    \"response-timestamp\": \"2017-11-16T21:31:31.697Z\",\n    \"final-indicator\": \"Y\",\n    \"response-message\": \"\"\n  }\n}","comments":"","x":290,"y":2606,"z":"6c1fa692.a38a58","wires":[]},{"id":"2e1dc18a.e0a76e","type":"set","name":"set  service-instance-id ","xml":"<set>\n<parameter name='tmp.service-data.service-information.service-instance-id' value='`$brg-topology-operation-input.service-information.service-instance-id`' />\n","comments":"","x":568.5,"y":2391,"z":"6c1fa692.a38a58","wires":[]}]
