[{"id":"1c2e4ec2.265511","type":"dgstart","name":"DGSTART","outputs":1,"x":168.57142639160156,"y":82.85714387893677,"z":"f2a32f4b.a395c","wires":[["327d7a0d.239446"]]},{"id":"327d7a0d.239446","type":"service-logic","name":"VNF-API ${project.version}","module":"VNF-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='VNF-API' version='${project.version}'>","outputs":1,"x":390.4047393798828,"y":83.02382278442383,"z":"f2a32f4b.a395c","wires":[["b2fa78f1.5e9c28"]]},{"id":"a17bcae8.28c348","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":246.0714340209961,"y":185.85714387893677,"z":"f2a32f4b.a395c","wires":[["96ebfd33.34f83","fb382397.3c3d6","14bb58a1.af0e67","f9810dfb.b06c3","62e2a3ed.47ecac","3ae2afd7.ca527","ab86fb03.c39478","63823512.60608c","bd5aae62.fb397","2b097b37.aa27e4","4a603bf8.396a34"]]},{"id":"96ebfd33.34f83","type":"set","name":"set: order-status = PendingUpdate","xml":"<set>\n\t<parameter name=\"service-data.oper-status.order-status\" value=\"PendingUpdate\"/>","comments":"","x":543.182975769043,"y":961.9848866462708,"z":"f2a32f4b.a395c","wires":[[]]},{"id":"fb382397.3c3d6","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n\t<parameter name=\"error-code\" value=\"200\" />","comments":"","x":481.4527893066406,"y":1096.7847657203674,"z":"f2a32f4b.a395c","wires":[]},{"id":"14bb58a1.af0e67","type":"switchNode","name":"switch: service-data order-status = Active","xml":"<switch test=\"`$service-data.oper-status.order-status == Active`\">\n<!--\nleaf order-status {\n\ttype enumeration {\n\t\tenum \"Active\";\n\t\tenum \"PendingAssignment\";\n\t\tenum \"PendingCreate\";\n\t\tenum \"PendingUpdate\";\n\t\tenum \"Deleted\";\n\t}\n}\n-->","comments":"","outputs":1,"x":564.5714263916016,"y":229.85714387893677,"z":"f2a32f4b.a395c","wires":[["b9cd1561.1ea538"]]},{"id":"7f09bcc9.27e9a4","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='400'/>\n\t<parameter name='error-message' value='Invalid service-data order status'/>","comments":"","x":969.3212432861328,"y":229.69051790237427,"z":"f2a32f4b.a395c","wires":[]},{"id":"b9cd1561.1ea538","type":"other","name":"false","xml":"<outcome value='false'>","comments":"","outputs":1,"x":810.7380523681641,"y":229.44039583206177,"z":"f2a32f4b.a395c","wires":[["7f09bcc9.27e9a4"]]},{"id":"b2fa78f1.5e9c28","type":"method","name":"method vnf-topology-changeassign","xml":"<method rpc='vnf-topology-changeassign' mode='sync'>\n","comments":"","outputs":1,"x":268.57142639160156,"y":133.85714387893677,"z":"f2a32f4b.a395c","wires":[["a17bcae8.28c348"]]},{"id":"f9810dfb.b06c3","type":"set","name":"set: last-action ","xml":"<set>\n\t<parameter name=\"service-data.oper-status.last-action\" value=\"`$service-data.request-information.request-action`\"/>","comments":"","x":481.1905288696289,"y":1007.9999012947083,"z":"f2a32f4b.a395c","wires":[[]]},{"id":"62e2a3ed.47ecac","type":"set","name":"set: last-order-status = order-status","xml":"<set>\n\t<parameter name=\"service-data.oper-status.last-order-status\" value=\"`$service-data.oper-status.order-status`\"/>","comments":"","x":543.8572082519531,"y":912.6665992736816,"z":"f2a32f4b.a395c","wires":[[]]},{"id":"3ae2afd7.ca527","type":"call","name":"call: vnf-topology-assign-vfmodule","xml":"<call module='VNF-API' rpc='vnf-topology-assign-vfmodule' mode='sync' >","comments":"","outputs":1,"x":542.5714263916016,"y":274.85714387893677,"z":"f2a32f4b.a395c","wires":[[]]},{"id":"63823512.60608c","type":"save","name":"delete relationship: vf-module","xml":"<delete plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id \n\t\t\tAND related-to = l3-network\" \n\tforce=\"true\" \n\tlocal-only=\"false\">","comments":"","outputs":1,"x":526.7143096923828,"y":419.42879915237427,"z":"f2a32f4b.a395c","wires":[["c841e1cb.40476"]]},{"id":"8ad6d1c9.a9a0c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'An error occurred while deleting existing vf-module l3-network relationship in AnAI with with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id + ' vf-module update FAILED.'`\"/>","comments":"","x":928.5713043212891,"y":419.71416902542114,"z":"f2a32f4b.a395c","wires":[]},{"id":"ab86fb03.c39478","type":"save","name":"get AnAI - vf-module","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"vf-module\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tand generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\t\tlocal-only=\"false\" \n\t\tpfx=\"tmp.AnAI.vfmodule\">","comments":"","outputs":1,"x":500.57142639160156,"y":320.85714387893677,"z":"f2a32f4b.a395c","wires":[["1a5ea207.1792ee","34bdca57.146506"]]},{"id":"fdbb1fb1.edc49","type":"save","name":"save vf-module relationship: l3-network","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\tforce=\"true\" \n\tlocal-only=\"false\">\n\t\n\t<parameter name=\"relationship-list.relationship[0].related-to\" value=\"l3-network\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"l3-network.network-id\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks[$i].network-id`\" />","comments":"","outputs":1,"x":865.5435943603516,"y":545.4240374565125,"z":"f2a32f4b.a395c","wires":[["e5957add.e0e3b8"]]},{"id":"e5957add.e0e3b8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1108.6878356933594,"y":545.4710698127747,"z":"f2a32f4b.a395c","wires":[["f3e1a4c1.9cbf48"]]},{"id":"bd5aae62.fb397","type":"for","name":"for i : SERVICE_DATA vnf-networks","xml":"<for index=\"i\" start=\"0\" end=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks_length`\">","comments":"","outputs":1,"x":543.1903991699219,"y":545.3925185203552,"z":"f2a32f4b.a395c","wires":[["fdbb1fb1.edc49"]]},{"id":"d43666a.f2b7098","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'Failed to update vf-module l3-network relationship in AnAI. ' + $error-message`\"/>","comments":"","x":1435.6306610107422,"y":825.6659226417542,"z":"f2a32f4b.a395c","wires":[]},{"id":"f3e1a4c1.9cbf48","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1254.6665878295898,"y":545.7018132209778,"z":"f2a32f4b.a395c","wires":[["d43666a.f2b7098","9738bd98.25ecc","50861927.da6ba8","a7599cc5.49cd9"]]},{"id":"50861927.da6ba8","type":"save","name":"delete relationship: vf-module","xml":"<delete plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id \n\t\t\tAND related-to = l3-network\" \n\tforce=\"true\" \n\tlocal-only=\"false\">","comments":"","outputs":1,"x":1495.595199584961,"y":593.6305890083313,"z":"f2a32f4b.a395c","wires":[[]]},{"id":"fef44b3b.61d0e8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'An error occurred while querying vf-module from AnAI with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\"/>","comments":"","x":881.8570098876953,"y":321.5712857246399,"z":"f2a32f4b.a395c","wires":[]},{"id":"c841e1cb.40476","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":742.5714263916016,"y":419.85714387893677,"z":"f2a32f4b.a395c","wires":[["8ad6d1c9.a9a0c"]]},{"id":"2b097b37.aa27e4","type":"set","name":"Set final indicator to Y","xml":"<set>\n<parameter name=\"ack-final\" value=\"Y\"/>","comments":"","x":502.80956268310547,"y":1053.9524006843567,"z":"f2a32f4b.a395c","wires":[[]]},{"id":"a7599cc5.49cd9","type":"for","name":"for i : tmp.AnAI.vfmodule.relationship","xml":"<for index=\"i\" start=\"0\" end=\"`$tmp.AnAI.vfmodule.relationship-list.relationship_length`\">","comments":"","outputs":1,"x":1515.131004333496,"y":643.095263004303,"z":"f2a32f4b.a395c","wires":[["2c37487d.d71f68"]]},{"id":"2c37487d.d71f68","type":"switchNode","name":"switch: relationship.related-to","xml":"<switch test=\"`$tmp.AnAI.vfmodule.relationship-list.relationship[$i].related-to`\">","comments":"","outputs":1,"x":1824.130973815918,"y":643.8095831871033,"z":"f2a32f4b.a395c","wires":[["adcc0a50.763648"]]},{"id":"adcc0a50.763648","type":"other","name":"l3-network","xml":"<outcome value='l3-network'>","comments":"","outputs":1,"x":2047.130973815918,"y":643.8095831871033,"z":"f2a32f4b.a395c","wires":[["fd90feeb.bd151"]]},{"id":"fd90feeb.bd151","type":"for","name":"for j : tmp.AnAI.vfmodule.relationship-data","xml":"<for index=\"j\" start=\"0\" end=\"`$tmp.AnAI.vfmodule.relationship-list.relationship[$i].relationship-data_length`\">","comments":"","outputs":1,"x":1642.1309661865234,"y":726.4524254798889,"z":"f2a32f4b.a395c","wires":[["b995870e.83a938"]]},{"id":"b995870e.83a938","type":"save","name":"save vf-module relationship: l3-network","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\tforce=\"true\" \n\tlocal-only=\"false\">\n\t\n\t<parameter name=\"relationship-list.relationship[0].related-to\" value=\"l3-network\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"l3-network.network-id\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$tmp.AnAI.vfmodule.relationship-list.relationship[$i].relationship-data[$j].relationship-value`\" />","comments":"","outputs":1,"x":1999.7024230957031,"y":726.5953087806702,"z":"f2a32f4b.a395c","wires":[["cfb16deb.85c16","3cd815da.19e77a"]]},{"id":"cfb16deb.85c16","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2257.702423095703,"y":726.5953087806702,"z":"f2a32f4b.a395c","wires":[["a65d95ce.02bfa8"]]},{"id":"1a5ea207.1792ee","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":690.4286003112793,"y":321.00001192092896,"z":"f2a32f4b.a395c","wires":[["fef44b3b.61d0e8"]]},{"id":"9738bd98.25ecc","type":"set","name":"set error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\" />\n\t<parameter name=\"error-message\" value=\"`' | An error occurred while saving l3-network relationship with network-id = ' + $service-data.vnf-topology-information.vnf-assignments.vnf-networks[$i].network-id + ' for vf-module with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\" />\n","comments":"","x":1459.1667251586914,"y":545.6309809684753,"z":"f2a32f4b.a395c","wires":[[]]},{"id":"a65d95ce.02bfa8","type":"set","name":"set error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\" />\n\t<parameter name=\"error-message\" value=\"`$error-message + ' | An error occurred while during rollback of l3-network relationship for vf-module with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\" />\n","comments":"","x":2455.6667404174805,"y":726.1309533119202,"z":"f2a32f4b.a395c","wires":[[]]},{"id":"34bdca57.146506","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":697.3214263916016,"y":363.440456867218,"z":"f2a32f4b.a395c","wires":[["fef44b3b.61d0e8"]]},{"id":"3cd815da.19e77a","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2267.9881286621094,"y":767.773805141449,"z":"f2a32f4b.a395c","wires":[["a65d95ce.02bfa8"]]},{"id":"4a603bf8.396a34","type":"switchNode","name":"switch ...service-data vnf-networks[]","xml":"<switch test=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks_length`\">","comments":"","outputs":1,"x":543.8095855712891,"y":483.8095455169678,"z":"f2a32f4b.a395c","wires":[["b6182977.6d3518"]]},{"id":"b6182977.6d3518","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":771.2540588378906,"y":483.3372554779053,"z":"f2a32f4b.a395c","wires":[["8329b2ad.be702"]]},{"id":"8329b2ad.be702","type":"set","name":"set service-data vnf-networks[] = 0","xml":"<set>\n<parameter name = \"service-data.vnf-topology-information.vnf-assignments.vnf-networks_length\" value=\"0\" />\n","comments":"","x":992.809667799208,"y":483.33727614084864,"z":"f2a32f4b.a395c","wires":[]}]
