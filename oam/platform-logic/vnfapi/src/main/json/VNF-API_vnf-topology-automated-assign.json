[{"id":"16c70efe.7a8801","type":"dgstart","name":"DGSTART","outputs":1,"x":120,"y":81.25,"z":"1a1ddf2c.df1b41","wires":[["355a50a5.566cd"]]},{"id":"355a50a5.566cd","type":"service-logic","name":"VNF-API ${project.version}","module":"VNF-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='VNF-API' version='${project.version}'>","outputs":1,"x":234,"y":141.25,"z":"1a1ddf2c.df1b41","wires":[["3cac45ed.2af29a"]]},{"id":"3cac45ed.2af29a","type":"method","name":"method vnf-topology-automated-assign","xml":"<method rpc='vnf-topology-automated-assign' mode='sync'>\n","comments":"","outputs":1,"x":236.5,"y":201.25,"z":"1a1ddf2c.df1b41","wires":[["7f45592b.5aa228"]]},{"id":"7f45592b.5aa228","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":274,"y":261.25,"z":"1a1ddf2c.df1b41","wires":[["242b6039.a4933","5304daf6.f2f644","7994db7a.864d54","16f2f46d.f9323c","134b41a5.40812e","d578e5a.1ca0318","7e51ab70.dd7844","113a63d2.c73f9c","a83a3395.50d63"]]},{"id":"242b6039.a4933","type":"set","name":"set: order-status = PendingCreate","xml":"<set>\n\t<parameter name=\"service-data.oper-status.order-status\" value=\"PendingCreate\"/>","comments":"","x":579.3571395874023,"y":844.821439743042,"z":"1a1ddf2c.df1b41","wires":[]},{"id":"82792209.9734a","type":"comment","name":"request-action = VNFActivateRequest","info":"","comments":"","x":204,"y":41.25,"z":"1a1ddf2c.df1b41","wires":[]},{"id":"fb53bdbf.46f42","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":874.8571395874023,"y":785.821439743042,"z":"1a1ddf2c.df1b41","wires":[["58e46612.49adb8"]]},{"id":"ddf10b49.e08dc8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"Encountered error while updating vf-module orchestration-status in AnAI\"/>","comments":"","x":1229.071388244629,"y":786.2499771118164,"z":"1a1ddf2c.df1b41","wires":[]},{"id":"3f3242c8.1b61ee","type":"save","name":"save relationship: l3-network","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tand generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\tforce=\"true\" \n\tlocal-only=\"false\">\n\t\n\t<parameter name=\"relationship-list.relationship[0].related-to\" value=\"l3-network\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"l3-network.network-id\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks[$i].network-id`\" />","comments":"","outputs":1,"x":902.8571395874023,"y":659.821439743042,"z":"1a1ddf2c.df1b41","wires":[["10b1439d.aea9cc"]]},{"id":"10b1439d.aea9cc","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1121.9999656677246,"y":659.1071357727051,"z":"1a1ddf2c.df1b41","wires":[["520b73a3.1208cc"]]},{"id":"5304daf6.f2f644","type":"for","name":"for i : SERVICE_DATA vnf-networks","xml":"<for index=\"i\" start=\"0\" end=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks_length`\">","comments":"","outputs":1,"x":584.8571395874023,"y":659.821439743042,"z":"1a1ddf2c.df1b41","wires":[["3f3242c8.1b61ee"]]},{"id":"d2e43a22.4b50c8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'Encountered error while saving vf-module l3-network relationship in AnAI with network-id = ' + $service-data.vnf-topology-information.vnf-assignments.vnf-networks[$i].network-id`\"/>","comments":"","x":1483.357063293457,"y":657.964316368103,"z":"1a1ddf2c.df1b41","wires":[]},{"id":"520b73a3.1208cc","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1283.9999656677246,"y":659.1071357727051,"z":"1a1ddf2c.df1b41","wires":[["d2e43a22.4b50c8","6954002.67688"]]},{"id":"bc71a20.de7366","type":"save","name":"delete vf-module: l3-network relationship","xml":"<delete plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id \n\t\tAND related-to = l3-network\" \n\tforce=\"true\" \n\tlocal-only=\"false\">","comments":"","outputs":1,"x":1744.642921447754,"y":523.3928279876709,"z":"1a1ddf2c.df1b41","wires":[[]]},{"id":"7994db7a.864d54","type":"save","name":"update AnAI - vf-module.orchestration-status","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"vf-module\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tand generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\t\tlocal-only=\"false\" >\n\t<parameter name=\"orchestration-status\" value=\"pending-create\" />","comments":"","outputs":1,"x":613.3571395874023,"y":785.821439743042,"z":"1a1ddf2c.df1b41","wires":[["fb53bdbf.46f42"]]},{"id":"58e46612.49adb8","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1042.928581237793,"y":786.2500095367432,"z":"1a1ddf2c.df1b41","wires":[["ddf10b49.e08dc8","6954002.67688"]]},{"id":"16f2f46d.f9323c","type":"call","name":"call: vnf-topology-automated-assign-vfmodule","xml":"<call module='VNF-API' rpc='vnf-topology-automated-assign-vfmodule' mode='sync' >","comments":"","outputs":1,"x":615.3571395874023,"y":531.821439743042,"z":"1a1ddf2c.df1b41","wires":[[]]},{"id":"134b41a5.40812e","type":"set","name":"Set final indicator to Y","xml":"<set>\n<parameter name=\"ack-final\" value=\"Y\"/>","comments":"","x":543.3571395874023,"y":900.821439743042,"z":"1a1ddf2c.df1b41","wires":[]},{"id":"d578e5a.1ca0318","type":"switchNode","name":"switch ...SERVICE-DATA vnf-networks[]","xml":"<switch test=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks_length`\">","comments":"","outputs":1,"x":597.3571395874023,"y":591.821439743042,"z":"1a1ddf2c.df1b41","wires":[["ac55335c.b48bc"]]},{"id":"ac55335c.b48bc","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":834.8571395874023,"y":591.821439743042,"z":"1a1ddf2c.df1b41","wires":[["60a230cd.63643"]]},{"id":"60a230cd.63643","type":"set","name":"set SERVICE-DATA vnf-networks[] = 0","xml":"<set>\n<parameter name='service-data.vnf-topology-information.vnf-assignments.vnf-networks_length' value='0' />\n","comments":"","x":1072.8571395874023,"y":591.821439743042,"z":"1a1ddf2c.df1b41","wires":[]},{"id":"7e51ab70.dd7844","type":"save","name":"GET AnAI - vf-module","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"vf-module\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tand generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\t\tlocal-only=\"false\" \n\t\tpfx=\"tmp.AnAI.vfmodule\" >","comments":"","outputs":1,"x":546.6428604125977,"y":447.8214340209961,"z":"1a1ddf2c.df1b41","wires":[["d5f4c089.d7081","d330aef1.d0e27"]]},{"id":"d5f4c089.d7081","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":744.8571319580078,"y":419.25001335144043,"z":"1a1ddf2c.df1b41","wires":[["3b52247c.b50a5c"]]},{"id":"d330aef1.d0e27","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":750.4999923706055,"y":470.67858123779297,"z":"1a1ddf2c.df1b41","wires":[["a911107d.bce06"]]},{"id":"3b52247c.b50a5c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'Encountered error while querying vf-module from AnAI with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\"/>","comments":"","x":943.3571319580078,"y":419.25001335144043,"z":"1a1ddf2c.df1b41","wires":[]},{"id":"a911107d.bce06","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='404'/>\n\t<parameter name='error-message' value=\"`'vf-module not found in AnAI with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\"/>","comments":"","x":940.4999923706055,"y":470.67858123779297,"z":"1a1ddf2c.df1b41","wires":[]},{"id":"113a63d2.c73f9c","type":"switchNode","name":"switch:vnf-id | config == input","xml":"<switch test=\"`$vnf-topology-operation-input.vnf-request-information.vnf-id == $service-data.vnf-id`\">","comments":"","outputs":1,"x":561.8333129882812,"y":261.25001335144043,"z":"1a1ddf2c.df1b41","wires":[["7c6dbcf3.1a3954"]]},{"id":"fec3a55d.1a66c8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value='vnf-id is already present in config-tree'/>","comments":"","x":970.5,"y":261.25,"z":"1a1ddf2c.df1b41","wires":[]},{"id":"7c6dbcf3.1a3954","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":772,"y":261.25,"z":"1a1ddf2c.df1b41","wires":[["fec3a55d.1a66c8"]]},{"id":"a83a3395.50d63","type":"switchNode","name":"switch: INPUT model-customization-uuid","xml":"<switch test=\"`$vnf-topology-operation-input.vnf-request-information.model-customization-uuid`\">","comments":"","outputs":1,"x":598.5714111328125,"y":337.14282035827637,"z":"1a1ddf2c.df1b41","wires":[["2b051e5b.50a662","1811e1b.758e61e"]]},{"id":"1811e1b.758e61e","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":857.6427993774414,"y":358.39280700683594,"z":"1a1ddf2c.df1b41","wires":[["227c03f7.c6066c"]]},{"id":"2b051e5b.50a662","type":"outcome","name":"0","xml":"<outcome value='0'>","comments":"","outputs":1,"x":853.9285583496094,"y":312.2499761581421,"z":"1a1ddf2c.df1b41","wires":[["227c03f7.c6066c"]]},{"id":"227c03f7.c6066c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='400'/>\n\t<parameter name='error-message' value='model-customization-uuid cannot be NULL or 0'/>","comments":"","x":1027.6428756713867,"y":331.53565406799316,"z":"1a1ddf2c.df1b41","wires":[]},{"id":"5b308fe2.250b5","type":"call","name":"call: rollback-eipam-ip-assignment","xml":"<call module='VNF-API' rpc='rollback-eipam-ip-assignment' mode='sync' >","comments":"","outputs":1,"x":1729.0001258850098,"y":571.1428575515747,"z":"1a1ddf2c.df1b41","wires":[[]]},{"id":"6954002.67688","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1471.4286041259766,"y":548.5714340209961,"z":"1a1ddf2c.df1b41","wires":[["bc71a20.de7366","5b308fe2.250b5"]]}]
