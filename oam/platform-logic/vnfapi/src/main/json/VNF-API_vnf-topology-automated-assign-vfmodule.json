[{"id":"a3f3d39b.f78d9","type":"dgstart","name":"DGSTART","outputs":1,"x":221.66665649414062,"y":78.59521961212158,"z":"c6a6763c.4a8938","wires":[["7618c6cb.6da728"]]},{"id":"7618c6cb.6da728","type":"service-logic","name":"VNF-API ${project.version}","module":"VNF-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='VNF-API' version='${project.version}'>","outputs":1,"x":427.4523696899414,"y":78.33333206176758,"z":"c6a6763c.4a8938","wires":[["745c4044.c7543"]]},{"id":"745c4044.c7543","type":"method","name":"method vnf-topology-automated-assign-vfmodule","xml":"<method rpc='vnf-topology-automated-assign-vfmodule' mode='sync'>\n","comments":"","outputs":1,"x":343.95240020751953,"y":137.34521961212158,"z":"c6a6763c.4a8938","wires":[["d060a59c.64f7d8"]]},{"id":"658e22f0.e8f0ac","type":"comment","name":"vf-module-topology-operation-assign","info":"","comments":"","x":941.9877777099609,"y":114.07091808319092,"z":"c6a6763c.4a8938","wires":[]},{"id":"89188f30.f0547","type":"switchNode","name":"switch request-action","xml":"<switch test='`$vnf-topology-operation-input.request-information.request-action`'>\n","comments":"","outputs":1,"x":705.1904525756836,"y":196.02378845214844,"z":"c6a6763c.4a8938","wires":[["d088b2f2.8739a","f45b77de.439698"]]},{"id":"d088b2f2.8739a","type":"outcome","name":"VNFActivateRequest","xml":"<outcome value='VNFActivateRequest'>\n","comments":"","outputs":1,"x":967.2380676269531,"y":173.16667461395264,"z":"c6a6763c.4a8938","wires":[["b8e0d10d.97964"]]},{"id":"f45b77de.439698","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":923.904712677002,"y":218.54766368865967,"z":"c6a6763c.4a8938","wires":[["5cacb441.fde0cc"]]},{"id":"b8e0d10d.97964","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1157.0952320098877,"y":173.16670608520508,"z":"c6a6763c.4a8938","wires":[[]]},{"id":"5cacb441.fde0cc","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"If svc-action is 'assign' then request-action must be 'VNFActivateRequest'\" />\n","comments":"","x":1175.9047203063965,"y":218.88097620010376,"z":"c6a6763c.4a8938","wires":[]},{"id":"8f60b4ac.2c4328","type":"get-resource","name":"get-resource VF_MODULE_MODEL","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_MODULE_MODEL WHERE customization_uuid = $vnf-topology-operation-input.vnf-request-information.model-customization-uuid'\n  pfx='db.vf-module-model'>\n\n","comments":"","outputs":1,"x":752.5237197875977,"y":287.16673851013184,"z":"c6a6763c.4a8938","wires":[["13d1cb9d.f21ef4","890a29b.28c78d8"]]},{"id":"d9dd7137.f2e6f","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"`'No model found for VF module customization UUID ' + $vnf-topology-operation-input.vnf-request-information.model-customization-uuid`\" />\n","comments":"","x":1193.9521408081055,"y":311.59521102905273,"z":"c6a6763c.4a8938","wires":[]},{"id":"13d1cb9d.f21ef4","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1018.3094100952148,"y":267.54756927490234,"z":"c6a6763c.4a8938","wires":[["88d4d30f.afb0f"]]},{"id":"890a29b.28c78d8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1026.8808403015137,"y":311.8332824707031,"z":"c6a6763c.4a8938","wires":[["d9dd7137.f2e6f"]]},{"id":"88d4d30f.afb0f","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_MODULE_MODEL table\" />\n","comments":"","x":1193.309341430664,"y":266.6904697418213,"z":"c6a6763c.4a8938","wires":[]},{"id":"d060a59c.64f7d8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":281.66663360595703,"y":2689.5951585769653,"z":"c6a6763c.4a8938","wires":[["89188f30.f0547","8f60b4ac.2c4328","311746e4.0a155a","60df562d.be7488","bc2c72de.8ea2e","af03ef4d.70e9e","b00f7262.1c094","74a8a4cc.6a37bc","50a525a1.ba695c","1c0d1734.2252b9","d4c6f015.e3386","b1e903e3.a9656","f95ebeb7.10204","946d1e34.4231","bf9d4319.1481e"]]},{"id":"92ef08a2.2df308","type":"set","name":"set aic-clli","xml":"<set>\n<parameter name='tmp.aic-clli' value='`$aai-uid-split[$aai-uid-split_length - 1]`' />\n","comments":"","x":1596.0950164794922,"y":572.0712900161743,"z":"c6a6763c.4a8938","wires":[]},{"id":"311746e4.0a155a","type":"get-resource","name":"get-resource cloud region","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"cloud-region\" \n\t\tkey=\"cloud-region.cloud-owner = 'CloudOwner' AND \n\t\t     cloud-region.cloud-region-id = $vnf-topology-operation-input.vnf-request-information.aic-cloud-region\"\n        pfx='aai.cloud-region' local-only='false' >\n\n","comments":"","outputs":1,"x":719.6428527832031,"y":389.52400493621826,"z":"c6a6763c.4a8938","wires":[["c986ee76.ee16","d962828a.b478c"]]},{"id":"d962828a.b478c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":933.889045715332,"y":407.67486095428467,"z":"c6a6763c.4a8938","wires":[["e920bb81.b40cb8"]]},{"id":"e920bb81.b40cb8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving cloud region from AAI\" />\n","comments":"","x":1108.8890190124512,"y":407.6748971939087,"z":"c6a6763c.4a8938","wires":[]},{"id":"c986ee76.ee16","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":942.8176422119141,"y":365.9605941772461,"z":"c6a6763c.4a8938","wires":[["3f933d3b.567172"]]},{"id":"3f933d3b.567172","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"`'aic-cloud-region,'+ $vnf-topology-operation-input.vnf-request-information.aic-cloud-region + ' not found in AAI'`\" />\n","comments":"","x":1109.166919708252,"y":365.2661714553833,"z":"c6a6763c.4a8938","wires":[]},{"id":"60df562d.be7488","type":"get-resource","name":"get-resource VF_MODULE_TO_VFC_MAPPING","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_MODULE_TO_VFC_MAPPING WHERE vf_module_customization_uuid = $vnf-topology-operation-input.vnf-request-information.model-customization-uuid'\n  pfx='db.vf-module-to-vfc-mapping[]'>\n\n","comments":"","outputs":1,"x":799.4524383544922,"y":844.142825126648,"z":"c6a6763c.4a8938","wires":[["d338b11f.a37bd","2618c557.dded6a"]]},{"id":"d338b11f.a37bd","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1083.8095703125,"y":826.2379236221313,"z":"c6a6763c.4a8938","wires":[["2f952fcf.2a5da"]]},{"id":"2618c557.dded6a","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1092.3810005187988,"y":870.5236368179321,"z":"c6a6763c.4a8938","wires":[["7b10c7c8.b3c7e8"]]},{"id":"2f952fcf.2a5da","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_MODULE_TO_VFC_MAPPING table\" />\n","comments":"","x":1258.8095016479492,"y":825.3808240890503,"z":"c6a6763c.4a8938","wires":[]},{"id":"bc2c72de.8ea2e","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$db.vf-module-to-vfc-mapping_length`' >\n","comments":"","outputs":1,"x":668.571418762207,"y":1739.1430168151855,"z":"c6a6763c.4a8938","wires":[["ccbb8f9.a6c077"]]},{"id":"ccbb8f9.a6c077","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":747.6190719604492,"y":1804.428677558899,"z":"c6a6763c.4a8938","wires":[["33dc2f21.83919","52d8daec.769304","fbab1088.c3bf6","d8725c39.89566","76c54fa9.38022","8c428202.a4584","96d35d.16f99ca","7f727408.3c054c","3112f18c.d7febe","317a074d.bd4138"]]},{"id":"af03ef4d.70e9e","type":"set","name":"set vnf-vms_length","xml":"<set>\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms_length'\n  value='`$db.vf-module-to-vfc-mapping_length`' />\n","comments":"","x":705.9999618530273,"y":910.0477952957153,"z":"c6a6763c.4a8938","wires":[]},{"id":"33dc2f21.83919","type":"for","name":"for each network-role","xml":"<for index='network-role-index' start='0' end='`$db.vfc-to-network-role-mapping_length`' >\n","comments":"","outputs":1,"x":1058.0478515625,"y":1587.4918432235718,"z":"c6a6763c.4a8938","wires":[["57fcf630.bf5d88"]]},{"id":"b00f7262.1c094","type":"for","name":"for each cloud-region relationship","xml":"<for index='idx' start='0' end='`$aai.cloud-region.relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":746.1823654174805,"y":571.6021165847778,"z":"c6a6763c.4a8938","wires":[["17ad304.585b5d"]]},{"id":"17ad304.585b5d","type":"switchNode","name":"switch related-to","xml":"<switch test='`$aai.cloud-region.relationship-list.relationship[$idx].related-to`'>\n","comments":"","outputs":1,"x":1012.8609085083008,"y":571.3520460128784,"z":"c6a6763c.4a8938","wires":[["aa25cb53.f74cc8"]]},{"id":"aa25cb53.f74cc8","type":"outcome","name":"complex","xml":"<outcome value='complex'>\n","comments":"","outputs":1,"x":1209.3252296447754,"y":571.7448682785034,"z":"c6a6763c.4a8938","wires":[["744bf544.60ac9c"]]},{"id":"3fb04830.758938","type":"execute","name":"split related-link","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split'>\n   <parameter name='ctx_memory_result_key' value='aai-uid-split' />\n   <parameter name='original_string' value='`$aai.cloud-region.relationship-list.relationship[$idx].related-link`' />\n   <parameter name='regex' value='/' />\n","comments":"","outputs":1,"x":1613.4917297363281,"y":524.244912147522,"z":"c6a6763c.4a8938","wires":[[]]},{"id":"744bf544.60ac9c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1400.0870895385742,"y":571.8402318954468,"z":"c6a6763c.4a8938","wires":[["3fb04830.758938","b8173b08.432cc8","92ef08a2.2df308"]]},{"id":"b8173b08.432cc8","type":"break","name":"break","xml":"<break>\n","comments":"","x":1590.0154724121094,"y":621.9592657089233,"z":"c6a6763c.4a8938","wires":[]},{"id":"52d8daec.769304","type":"set","name":"set vm-networks_length","xml":"<set>\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks_length' \n  value='`$db.vfc-to-network-role-mapping_length`' />\n","comments":"","x":1068.1903991699219,"y":1417.9677104949951,"z":"c6a6763c.4a8938","wires":[]},{"id":"74a8a4cc.6a37bc","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$tmp.vnf-topology.vnf-assignments.vnf-vms_length`' >\n","comments":"","outputs":1,"x":637.6190872192383,"y":2421.6335849761963,"z":"c6a6763c.4a8938","wires":[["1a33d1f3.8f6e4e"]]},{"id":"1a33d1f3.8f6e4e","type":"for","name":"for each network-role in vm-networks","xml":"<for index='network-role-index' start='0' end='`$tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks_length`' >\n","comments":"","outputs":1,"x":911.1903839111328,"y":2421.6572647094727,"z":"c6a6763c.4a8938","wires":[["ba72b14b.2156"]]},{"id":"ba72b14b.2156","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1171.059455871582,"y":2421.466869354248,"z":"c6a6763c.4a8938","wires":[["d09a49ef.7c1908","98a1c0da.3df17","3b82b435.6743cc","e76ba29b.dbd2f","bca0b7c7.7693f8"]]},{"id":"50a525a1.ba695c","type":"set","name":"copy vnf-topology data","xml":"<set>\n<parameter name='service-data.vnf-topology-information.' value='tmp.vnf-topology.' />\n","comments":"","x":636.6309814453125,"y":3725.919508934021,"z":"c6a6763c.4a8938","wires":[]},{"id":"1c0d1734.2252b9","type":"execute","name":"printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/bgb-vnfapi-vfmodule.log' />\n","comments":"","outputs":1,"x":603.2619247436523,"y":3789.8836212158203,"z":"c6a6763c.4a8938","wires":[[]]},{"id":"d4c6f015.e3386","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$tmp.vnf-topology.vnf-assignments.vnf-vms_length`' >\n","comments":"","outputs":1,"x":618.4761657714844,"y":3657.035722732544,"z":"c6a6763c.4a8938","wires":[["27442cf3.32c4a4"]]},{"id":"27442cf3.32c4a4","type":"for","name":"for each vm","xml":"<for index='vm-index' start='0' end='`$tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-count`' >\n","comments":"","outputs":1,"x":814.4761962890625,"y":3657.368730545044,"z":"c6a6763c.4a8938","wires":[["78a03f6e.8c578"]]},{"id":"537a79f4.c23ef8","type":"save","name":"save VIPR_CONFIGURATION","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource\" resource=\"SQL\"\n\tkey=\"INSERT INTO VIPR_CONFIGURATION (vnf_id, \n\t\tvnf_name, \n\t\tecomp_service_instance_id, \n\t\tvm_name, \n\t\tcloud_region_id, \n\t\tcloud_owner) \n\tVALUES ( $service-data.vnf-id , \n\t\t$vnf-topology-operation-input.vnf-request-information.vnf-name , \n\t\t$vnf-topology-operation-input.service-information.service-instance-id , \n\t\t$tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-names[$vm-index]-vm-name , \n\t\t$vnf-topology-operation.vnf-request-information.aic-cloud-region , \n\t\t'CloudOwner')\" >","comments":"","outputs":1,"x":1222.1428985595703,"y":3680.0363807678223,"z":"c6a6763c.4a8938","wires":[["8ceacfdf.89fec"]]},{"id":"f06def73.72458","type":"comment","name":"Not a failure","info":"","comments":"","x":1742.1427993774414,"y":3680.036385536194,"z":"c6a6763c.4a8938","wires":[]},{"id":"8ceacfdf.89fec","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1432.1428833007812,"y":3680.03653049469,"z":"c6a6763c.4a8938","wires":[["b7da4a1c.00f698"]]},{"id":"b7da4a1c.00f698","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"VNF-API.vnf-topology-automated-assign-vfmodule:REQID\"/>\n<parameter name=\"field3\" value=\"`$vnf-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"Failed to insert VIPR_CONFIGURATION record\"/>\n","comments":"","outputs":1,"x":1575.4763259887695,"y":3680.036368370056,"z":"c6a6763c.4a8938","wires":[[]]},{"id":"2d06b410.7028dc","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1605.476448059082,"y":3631.368082046509,"z":"c6a6763c.4a8938","wires":[["db145896.d33078"]]},{"id":"3036cc89.607c34","type":"comment","name":"Not a failure","info":"","comments":"","x":2032.8095016479492,"y":3629.701904296875,"z":"c6a6763c.4a8938","wires":[]},{"id":"db145896.d33078","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"VNF-API.vnf-topology-automated-assign-vfmodule:REQID\"/>\n<parameter name=\"field3\" value=\"`$vnf-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"Failed to insert VIPR_CONFIGURATION record\"/>\n","comments":"","outputs":1,"x":1855.4763832092285,"y":3631.368715286255,"z":"c6a6763c.4a8938","wires":[[]]},{"id":"78a03f6e.8c578","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":982.8095893859863,"y":3656.3685750961304,"z":"c6a6763c.4a8938","wires":[["1bd6f906.202927","537a79f4.c23ef8"]]},{"id":"1bd6f906.202927","type":"delete","name":"delete any pre-existing records in VIPR_CONFIGURATION","xml":"<delete plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='DELETE from VIPR_CONFIGURATION WHERE vnf_id = $service-data.vnf-id\n     AND ecomp_service_instance_id = $vnf-topology-operation-input.service-information.service-instance-id\n     AND vm_name = $tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-names[$vm-index].vm-name' >","comments":"","outputs":1,"x":1312.1429138183594,"y":3631.702714920044,"z":"c6a6763c.4a8938","wires":[["2d06b410.7028dc"]]},{"id":"7b10c7c8.b3c7e8","type":"set","name":"set vf-module-to-vfc-mapping length to 0","xml":"<set>\n<parameter name='db.vf-module-to-vfc-mapping_length' value='0' />\n","comments":"","x":1345.5952911376953,"y":870.1422996520996,"z":"c6a6763c.4a8938","wires":[]},{"id":"f95ebeb7.10204","type":"set","name":"set: service-data.vnf-id","xml":"<set>\n\t<parameter name=\"service-data.vnf-id\" value=\"`$vnf-topology-operation-input.vnf-request-information.vnf-id`\"/>\n\t<parameter name=\"service-data.service-information.service-instance-id\" value=\"`$vnf-topology-operation-input.service-information.service-instance-id`\"/>\n\t<parameter name=\"service-data.service-information.service-type\" value=\"`$vnf-topology-operation-input.service-information.service-type`\"/>\n","comments":"","x":711.4881820678711,"y":453.2098321914673,"z":"c6a6763c.4a8938","wires":[]},{"id":"57fcf630.bf5d88","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1266.1906051635742,"y":1586.7732563018799,"z":"c6a6763c.4a8938","wires":[["bc92bded.ca455","fe584b6c.0233d8","3f0ffec2.1a9d32","d46dd161.dffe2","3a46ead4.8020a6","6e76e719.77b5f8"]]},{"id":"3f0ffec2.1a9d32","type":"get-resource","name":"get-resource l3-network","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"l3-networks\" \n\t\tkey=\"l3-network.network-role = $db.vfc-to-network-role-mapping[$network-role-index].network-role\"\n        pfx='aai.l3-network' local-only='false'\n>\n<!--\n\tAND l3-network.orchestration-status = 'active'\n\tAND cloud-region.cloud-region-id = $vnf-topology-operation-input.vnf-request-input.aic-cloud-region\n\tAND depth = 'ALL'\"\n-->\n","comments":"","outputs":1,"x":1517.7618255615234,"y":1505.2498626708984,"z":"c6a6763c.4a8938","wires":[["c1d211cb.4fae5","8d13a3a8.b532e"]]},{"id":"8d13a3a8.b532e","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1723.8095397949219,"y":1527.3927021026611,"z":"c6a6763c.4a8938","wires":[["47da81c8.ba4d8"]]},{"id":"47da81c8.ba4d8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving l3-network from AAI\" />\n","comments":"","x":1898.809513092041,"y":1527.3927383422852,"z":"c6a6763c.4a8938","wires":[]},{"id":"c1d211cb.4fae5","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1732.738136291504,"y":1485.6784353256226,"z":"c6a6763c.4a8938","wires":[["8e067fe5.5fcdd"]]},{"id":"8e067fe5.5fcdd","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No active l3-network found in AAI with cloud_region_id '\n          + $vnf-topology-operation-input.vnf-request-information.aic-cloud-region + ' and network_role '\n          + $db.vf-network-role-mapping[$network-role-index].network-role`\" />\n","comments":"","x":1899.0874137878418,"y":1484.9840126037598,"z":"c6a6763c.4a8938","wires":[]},{"id":"bc92bded.ca455","type":"set","name":"set tmp vnf-networks data","xml":"<set>\n<parameter name=\"tmp.vnf-topology.vnf-assignments.vnf-networks[$network-index].network-name\" \n\tvalue=\"`$aai.l3-network.l3-network[$network-role-index].network-name`\" />\n<parameter name=\"tmp.vnf-topology.vnf-assignments.vnf-networks[$network-index].network-id\" \n\tvalue=\"`$aai.l3-network.l3-network[$network-role-index].network-id`\" />\n<parameter name=\"tmp.vnf-topology.vnf-assignments.vnf-networks[$network-index].neutron-id\" \n\tvalue=\"`$aai.l3-network.l3-network[$network-role-index].neutron-network-id`\" />\n<parameter name=\"tmp.vnf-topology.vnf-assignments.vnf-networks[$network-index].contrail-network-fqdn\" \n\tvalue=\"`$aai.l3-network.l3-network[$network-role-index].contrail-network-fqdn`\" />\n<parameter name=\"tmp.vnf-topology.vnf-assignments.vnf-networks[$network-index].network-role\" \n\tvalue=\"`$db.vfc-to-network-role-mapping[$network-role-index].network-role`\" />\n","comments":"","x":1515.4761657714844,"y":1934.3929119110107,"z":"c6a6763c.4a8938","wires":[]},{"id":"fe584b6c.0233d8","type":"set","name":"network-index++","xml":"<set>\n<parameter name='network-index' value='`$network-index + 1`' />\n","comments":"","x":1487.9166984558105,"y":1982.785807609558,"z":"c6a6763c.4a8938","wires":[]},{"id":"82c167e.cb8f898","type":"for","name":"for each l3-network","xml":"<for index='db-network-index' start='0' end='`$aai.l3-network.l3-network_length`' >\n","comments":"","outputs":1,"x":1666.500144958496,"y":1664.9640560150146,"z":"c6a6763c.4a8938","wires":[["52452f43.5046b"]]},{"id":"52452f43.5046b","type":"switchNode","name":"switch orchestration-status","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].orchestration-status`'>\n","comments":"","outputs":1,"x":1895.071346282959,"y":1664.5354833602905,"z":"c6a6763c.4a8938","wires":[["948e53a0.a1a4e","bb5bb136.9a8cb","67f6e44a.8c755c"]]},{"id":"948e53a0.a1a4e","type":"outcome","name":"Pending Delete","xml":"<outcome value='Pending Delete'>\n","comments":"","outputs":1,"x":2129.238311767578,"y":1663.952260017395,"z":"c6a6763c.4a8938","wires":[["6e1e86e4.fc0878"]]},{"id":"bb5bb136.9a8cb","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2102.9287872314453,"y":1706.868727684021,"z":"c6a6763c.4a8938","wires":[["3d98f5bc.ae345a"]]},{"id":"1b5cfc0a.780784","type":"switchNode","name":"switch related-to","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].related-to`'>\n","comments":"","outputs":1,"x":2468.643138885498,"y":1706.440068244934,"z":"c6a6763c.4a8938","wires":[["18608e13.047c82"]]},{"id":"3d98f5bc.ae345a","type":"for","name":"for each relationship","xml":"<for silentFailure='true' index='db-rel-index' start='0' end='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":2272.928699493408,"y":1706.440104484558,"z":"c6a6763c.4a8938","wires":[["1b5cfc0a.780784"]]},{"id":"18608e13.047c82","type":"outcome","name":"cloud-region","xml":"<outcome value='cloud-region'>\n","comments":"","outputs":1,"x":2642.928779602051,"y":1706.0115146636963,"z":"c6a6763c.4a8938","wires":[["1a0b207b.b43a1"]]},{"id":"1a0b207b.b43a1","type":"for","name":"for each relationship data","xml":"<for silentFailure='true' index='db-data-index' start='0' end='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data_length`' >\n","comments":"","outputs":1,"x":2840.0714797973633,"y":1706.4399824142456,"z":"c6a6763c.4a8938","wires":[["ad33c2ce.a476"]]},{"id":"ad33c2ce.a476","type":"switchNode","name":"switch relationship-key","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data[$db-data-index].relationship-key`'>\n","comments":"","outputs":1,"x":3071.5000801086426,"y":1706.011357307434,"z":"c6a6763c.4a8938","wires":[["99e02cfa.c00ff"]]},{"id":"99e02cfa.c00ff","type":"outcome","name":"cloud-region.cloud-region-id","xml":"<outcome value='cloud-region.cloud-region-id'>\n","comments":"","outputs":1,"x":3312.928611755371,"y":1706.011462211609,"z":"c6a6763c.4a8938","wires":[["72f776c7.f8acb8"]]},{"id":"72f776c7.f8acb8","type":"switchNode","name":"switch relationship-value == cloud-region-id","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data[$db-data-index].relationship-value == $vnf-topology-operation-input.vnf-request-information.aic-cloud-region`'>\n","comments":"","outputs":1,"x":3617.214530944824,"y":1705.8685178756714,"z":"c6a6763c.4a8938","wires":[["fb503bba.563f58"]]},{"id":"fb503bba.563f58","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":3857.2145614624023,"y":1706.0114631652832,"z":"c6a6763c.4a8938","wires":[["f34debda.3059a8"]]},{"id":"d46dd161.dffe2","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1464.7142944335938,"y":1733.8212022781372,"z":"c6a6763c.4a8938","wires":[["82c167e.cb8f898","7dc3e952.f9aa48"]]},{"id":"7dc3e952.f9aa48","type":"returnSuccess","name":"CATCH BREAK","xml":"<return status='success'>\n\n","comments":"","x":1656.047737121582,"y":1807.15438747406,"z":"c6a6763c.4a8938","wires":[]},{"id":"563020a1.8c4ca","type":"returnFailure","name":"BREAK","xml":"<return status='failure'>\n","comments":"","x":4166.0475425720215,"y":1723.8208665847778,"z":"c6a6763c.4a8938","wires":[]},{"id":"3a46ead4.8020a6","type":"set","name":"set l3-network-id = -1","xml":"<set>\n<parameter name='l3-network-id' value='-1' />\n","comments":"","x":1509.047592163086,"y":1567.1545162200928,"z":"c6a6763c.4a8938","wires":[]},{"id":"f34debda.3059a8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":4003.047538757324,"y":1705.4875717163086,"z":"c6a6763c.4a8938","wires":[["d88a343b.538ab8","563020a1.8c4ca"]]},{"id":"d88a343b.538ab8","type":"set","name":"set l3-network-id","xml":"<set>\n<parameter name='l3-network-id' value='`$aai.l3-network.l3-network[$db-network-index].network-id`' />","comments":"","x":4192.714241027832,"y":1682.1541051864624,"z":"c6a6763c.4a8938","wires":[]},{"id":"6e76e719.77b5f8","type":"switchNode","name":"switch l3-network-id","xml":"<switch test='`$l3-network-id`'>\n","comments":"","outputs":1,"x":1497.7142486572266,"y":1886.8216562271118,"z":"c6a6763c.4a8938","wires":[["cc4e6c44.94099"]]},{"id":"cc4e6c44.94099","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":1667.714199066162,"y":1886.8214120864868,"z":"c6a6763c.4a8938","wires":[["aaf27a6f.92dd38"]]},{"id":"aaf27a6f.92dd38","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find l3-network in AAI for network role ' + $db.vf-network-role-mapping[$role-index].network-role`\" />\n","comments":"","x":1816.0475616455078,"y":1886.8215494155884,"z":"c6a6763c.4a8938","wires":[]},{"id":"6e1e86e4.fc0878","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2282.452423095703,"y":1663.729115486145,"z":"c6a6763c.4a8938","wires":[[]]},{"id":"67f6e44a.8c755c","type":"outcome","name":"Pending Create","xml":"<outcome value='Pending Create'>\n","comments":"","outputs":1,"x":2131.6189918518066,"y":1622.645486831665,"z":"c6a6763c.4a8938","wires":[["1d748942.552097"]]},{"id":"1d748942.552097","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2284.8330841064453,"y":1622.4223642349243,"z":"c6a6763c.4a8938","wires":[[]]},{"id":"fbab1088.c3bf6","type":"set","name":"set network-index = 0","xml":"<set>\n<parameter name='network-index' value='0' />\n","comments":"","x":1060.7978820800781,"y":1473.381046295166,"z":"c6a6763c.4a8938","wires":[]},{"id":"47540555.ce149c","type":"comment","name":"NO SUPPORT for network-macs","info":"","comments":"","x":248.52376556396484,"y":1477.5233364105225,"z":"c6a6763c.4a8938","wires":[]},{"id":"dc87a0e1.830c7","type":"comment","name":"NO SUPPORT for floating-ip[] and floating-ip-v6[]","info":"","comments":"","x":298.5237045288086,"y":1507.523419380188,"z":"c6a6763c.4a8938","wires":[]},{"id":"866effdc.31e09","type":"comment","name":"NO SUPPORT for interface-route-prefixes[]","info":"","comments":"","x":280.52376556396484,"y":1538.1900882720947,"z":"c6a6763c.4a8938","wires":[]},{"id":"77294c8e.f5ef34","type":"comment","name":"VNF-ASSIGNMENTS.VNF-NETWORKS[ ]","info":"","comments":"","x":1153.5714416503906,"y":1685.2971000671387,"z":"c6a6763c.4a8938","wires":[]},{"id":"a717d2eb.33e0d","type":"comment","name":"No support of vnf-networks[].subnet-id and subnet-name in 1707","info":"","comments":"","x":1624.5241203308105,"y":2031.9880800247192,"z":"c6a6763c.4a8938","wires":[]},{"id":"6bc6c778.aeb9b8","type":"comment","name":"Find l3-network with matching aic-cloud-region","info":"","comments":"","x":2675.833526611328,"y":1665.0827531814575,"z":"c6a6763c.4a8938","wires":[]},{"id":"d09a49ef.7c1908","type":"switchNode","name":"switch ipv4-ip-version","xml":"<switch test='`$db.vfc-to-network-role-mapping[$network-role-index].ipv4-ip-version`'>\n","comments":"","outputs":1,"x":1421.7381134033203,"y":2356.749324798584,"z":"c6a6763c.4a8938","wires":[["672a7280.55091c","31643f78.a77a6"]]},{"id":"78ac8019.a7f14","type":"set","name":"set vm-networks-index to -1","xml":"<set>\n<parameter name='vm-networks-index' value='-1' />\n\n","comments":"","x":1831.2617378234863,"y":2314.749429702759,"z":"c6a6763c.4a8938","wires":[]},{"id":"672a7280.55091c","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1598.4046325683594,"y":2314.7494649887085,"z":"c6a6763c.4a8938","wires":[["78ac8019.a7f14"]]},{"id":"31643f78.a77a6","type":"other","name":"ipv4","xml":"<outcome value='ipv4'>\n","comments":"","outputs":1,"x":1603.1665840148926,"y":2409.7016077041626,"z":"c6a6763c.4a8938","wires":[["5853f915.b367d8"]]},{"id":"2cc28b35.b1b3d4","type":"set","name":"set vm-networks-index to 0","xml":"<set>\n<parameter name='vm-networks-index' value='0' />\n","comments":"","x":2001.7378463745117,"y":2362.225468635559,"z":"c6a6763c.4a8938","wires":[]},{"id":"5853f915.b367d8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1764.3570594787598,"y":2409.0350732803345,"z":"c6a6763c.4a8938","wires":[["2cc28b35.b1b3d4","a3fe56e9.bbd588","f65ee3e0.f68a8"]]},{"id":"a3fe56e9.bbd588","type":"set","name":"set vm-networkls[].use-dhcp, ip-count","xml":"<set>\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks[$network-role-index].use-dhcp'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].ipv4-use-dhcp`' />\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks[$network-role-index].ip-count'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].ipv4-count`' />","comments":"","x":2034.2142486572266,"y":2409.1304264068604,"z":"c6a6763c.4a8938","wires":[]},{"id":"98a1c0da.3df17","type":"switchNode","name":"switch ipv6-ip-version","xml":"<switch test='`$db.vfc-to-network-role-mapping[$network-role-index].ipv6-ip-version`'>\n","comments":"","outputs":1,"x":1418.880973815918,"y":2556.9874448776245,"z":"c6a6763c.4a8938","wires":[["3c446888.3e39b8","eb49d457.dd4f28"]]},{"id":"3c446888.3e39b8","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1597.6904678344727,"y":2527.225256919861,"z":"c6a6763c.4a8938","wires":[["e181069f.a9af18"]]},{"id":"eb49d457.dd4f28","type":"other","name":"ipv6","xml":"<outcome value='ipv6'>\n","comments":"","outputs":1,"x":1599.1190223693848,"y":2591.5108137130737,"z":"c6a6763c.4a8938","wires":[["5fb2c0ca.155f3"]]},{"id":"ea162272.2b02b","type":"set","name":"increment vm-networks-index","xml":"<set>\n<parameter name='vm-networks-index' value='`$network-information-index + 1`' />\n","comments":"","x":2004.8331146240234,"y":2543.034843444824,"z":"c6a6763c.4a8938","wires":[]},{"id":"5fb2c0ca.155f3","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1754.3571815490723,"y":2590.5585527420044,"z":"c6a6763c.4a8938","wires":[["ea162272.2b02b","aaf6159f.3f4398","e09776e2.09fce8"]]},{"id":"e181069f.a9af18","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1740.3570976257324,"y":2526.5588750839233,"z":"c6a6763c.4a8938","wires":[[]]},{"id":"db2dfaa0.2e4a18","type":"outcome","name":"-1","xml":"<outcome value='-1'>","comments":"","outputs":1,"x":1641.0713024139404,"y":2779.3679761886597,"z":"c6a6763c.4a8938","wires":[["a57ad8d4.649d58"]]},{"id":"9a4fb538.0f0488","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1640.8332653045654,"y":2825.3202905654907,"z":"c6a6763c.4a8938","wires":[["fc11d026.29d27"]]},{"id":"a57ad8d4.649d58","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1777.7380180358887,"y":2779.701636314392,"z":"c6a6763c.4a8938","wires":[[]]},{"id":"fc11d026.29d27","type":"set","name":"increment vm-networks-index","xml":"<set>\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks_length'\n   value='`$vm-networks-index + 1`' />\n","comments":"","x":1848.4046325683594,"y":2825.701428413391,"z":"c6a6763c.4a8938","wires":[]},{"id":"aaf6159f.3f4398","type":"set","name":"set vm-networks[].use-dhcp, ip-count","xml":"<set>\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks[$network-role-index].use-dhcp'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].ipv6-use-dhcp`' />\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks[$network-role-index].ip-count'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].ipv6-count`' />","comments":"","x":2029.8809967041016,"y":2590.233787536621,"z":"c6a6763c.4a8938","wires":[]},{"id":"4fd57938.fd6288","type":"switchNode","name":"switch use-dhcp","xml":"<switch test='`$tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks[$network-role-index].use-dhcp`'>\n","comments":"","outputs":1,"x":1145.7619895935059,"y":2980.401258468628,"z":"c6a6763c.4a8938","wires":[["f5b2b31d.2316a"]]},{"id":"f5b2b31d.2316a","type":"outcome","name":"N","xml":"<outcome value='N'>\n","comments":"","outputs":1,"x":1327.7619018554688,"y":2979.972861289978,"z":"c6a6763c.4a8938","wires":[["d199b2c.f491e5"]]},{"id":"e57a3f7a.8c001","type":"execute","name":"call EIPAM assignIPAddress","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"assignIPAddress\">","comments":"","outputs":1,"x":2089.4402961730957,"y":3168.976450443268,"z":"c6a6763c.4a8938","wires":[["55962543.83bbfc"]]},{"id":"55962543.83bbfc","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2304.8213539123535,"y":3168.7030835151672,"z":"c6a6763c.4a8938","wires":[["ce019ac0.7cad08"]]},{"id":"d05f74bb.e28858","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while obtaining new address blocks from EIPAM.\" />\n","comments":"","x":2639.9998893737793,"y":3213.3460116386414,"z":"c6a6763c.4a8938","wires":[]},{"id":"19d92b6.c89dcd5","type":"comment","name":"Need VF_MODULE_MODEL availability_zone_count and ecomp_generated_vm_assignments","info":"","comments":"","x":525.5951919555664,"y":237.46378231048584,"z":"c6a6763c.4a8938","wires":[]},{"id":"31be1c0b.e4a514","type":"for","name":"for each cloud-region availability zone","xml":"<for index='az-index' start='0' end='`$aai.cloud-region.availability-zones.availability-zone_length`' >\n","comments":"","outputs":1,"x":911.3571243286133,"y":736.2734155654907,"z":"c6a6763c.4a8938","wires":[["644e35b7.02498c"]]},{"id":"7d5d3a7e.13dfa4","type":"set","name":"set availability-zone","xml":"<set>\n<parameter name='tmp.vnf-topology.vnf-assignments.availability-zones[$az-index].availability-zone'\n  value='`$aai.cloud-region.availability-zones.availability-zone[$az-index].availability-zone-name`' />\n","comments":"","x":1369.0238571166992,"y":737.0353193283081,"z":"c6a6763c.4a8938","wires":[]},{"id":"644e35b7.02498c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1165.023567199707,"y":736.3689994812012,"z":"c6a6763c.4a8938","wires":[["7d5d3a7e.13dfa4"]]},{"id":"811225ec.4649e8","type":"switchNode","name":"switch AAI availability-zone_length","xml":"<switch test='`$aai.cloud-region.availability-zones.availability-zone_length`'>\n","comments":"","outputs":1,"x":901.4521408081055,"y":690.1785621643066,"z":"c6a6763c.4a8938","wires":[["fbe8d942.a860d8"]]},{"id":"fbe8d942.a860d8","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1120.0235595703125,"y":689.7499713897705,"z":"c6a6763c.4a8938","wires":[["c01d6a9b.970a38"]]},{"id":"c01d6a9b.970a38","type":"set","name":"set availability-zone_length to 0","xml":"<set>\n<parameter name='aai.cloud-region.availability-zones.availability-zone_length' value='0' />\n","comments":"","x":1357.1665267944336,"y":689.1784152984619,"z":"c6a6763c.4a8938","wires":[]},{"id":"68aa1809.492868","type":"comment","name":"VNF-ASSIGNMENTS.AVAILABILITY-ZONES[ ]","info":"","comments":"","x":315.59522247314453,"y":593.1780614852905,"z":"c6a6763c.4a8938","wires":[]},{"id":"8300a18c.5a56","type":"comment","name":"VNF-ASSIGNMENTS.VNF-NETWORKS[ ]","info":"","comments":"","x":291.3095474243164,"y":761.3210287094116,"z":"c6a6763c.4a8938","wires":[]},{"id":"3a48a7be.8af1b8","type":"comment","name":"VNF-ASSIGNMENTS.VNF-VMS[ ].VM-NETWORKS[ ]","info":"","comments":"","x":1026.881004333496,"y":2339.368064880371,"z":"c6a6763c.4a8938","wires":[]},{"id":"3b82b435.6743cc","type":"set","name":"set vm-networks-index to -1","xml":"<set>\n<parameter name='vm-networks-index' value='-1' />\n\n","comments":"","x":1440.2141647338867,"y":2265.082242012024,"z":"c6a6763c.4a8938","wires":[]},{"id":"e76ba29b.dbd2f","type":"switchNode","name":"switch vm-networks-index","xml":"<switch test='`$vm-networks-index`'>\n","comments":"","outputs":1,"x":1422.7379455566406,"y":2802.7012300491333,"z":"c6a6763c.4a8938","wires":[["db2dfaa0.2e4a18","9a4fb538.0f0488"]]},{"id":"39f5f08d.dbc63","type":"switchNode","name":"switch plans[].address-family","xml":"<switch test='`$eipam-ip-block.plans[$plans-index].address-family`'>\n","comments":"","outputs":1,"x":2818.7937927246094,"y":3474.15486907959,"z":"c6a6763c.4a8938","wires":[["51a03202.e47d3c","70d3e88f.a07718"]]},{"id":"51a03202.e47d3c","type":"other","name":"ipv4","xml":"<outcome value='ipv4'>\n","comments":"","outputs":1,"x":3029.924644470215,"y":3448.4643754959106,"z":"c6a6763c.4a8938","wires":[["34d01025.7d17"]]},{"id":"70d3e88f.a07718","type":"other","name":"ipv6","xml":"<outcome value='ipv6'>\n","comments":"","outputs":1,"x":3030.459800720215,"y":3499.2737035751343,"z":"c6a6763c.4a8938","wires":[["c5666e02.07c39"]]},{"id":"34d01025.7d17","type":"set","name":"set vm-networks[].network-ips[].ip-address","xml":"<set>\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks[$network-role-index].network-ips[$ip-count-index].ip-address'\n   value='`$eipam-ip-block.plans[$plans-index].requests[$rqst-index].ip-prefix`' />","comments":"","x":3286.6750144958496,"y":3447.964214324951,"z":"c6a6763c.4a8938","wires":[]},{"id":"c5666e02.07c39","type":"set","name":"set vm-networks[].network-ips-v6[].ip-address-ipv6","xml":"<set>\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks[$network-role-index].network-ips-v6[$ip-count-index].ip-address-ipv6'\n   value='`$eipam-ip-block.plans[$plans-index].requests[$rqst-index].ip-prefix`' />","comments":"","x":3311.2576599121094,"y":3498.964376449585,"z":"c6a6763c.4a8938","wires":[]},{"id":"840dab74.e88378","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1811.4284591674805,"y":2979.1546588540077,"z":"c6a6763c.4a8938","wires":[["8a748fef.e9c92","464cbd36.e681d4","ec3340b.4bdcfc","e57a3f7a.8c001","1bbc0c5c.b5a494","817518c2.6f35c8","a8d8485a.c01bd8"]]},{"id":"8a748fef.e9c92","type":"set","name":"set eipam aic-cloud-region, client-key, subnetpool-id","xml":"<set>\n<parameter name='tmp.aic-cloud-region'\n   value='`$vnf-topology-operation-input.vnf-request-information.aic-cloud-region`' />\n<parameter name='tmp.client-key'\n   value='`$generate-unique-name-output.generated-name`' />\n<parameter name='tmp.subnetpool-id'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].extcp-subnetpool-id`' />\n<parameter name='network-topology-operation-input.network-information.network-id' \n\tvalue = 'NOT_APPLICABLE' />\n<parameter name='service-data.service-information.service-type' \n\tvalue = 'NOT_APPLICABLE' />\n","comments":"","x":2163.190719604492,"y":3073.869504928589,"z":"c6a6763c.4a8938","wires":[]},{"id":"ec3340b.4bdcfc","type":"call","name":"call GENERIC-RESOURCE-API:generate-unique-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-unique-name' mode='sync' >\n","comments":"","outputs":1,"x":2174.404983520508,"y":3026.591185569763,"z":"c6a6763c.4a8938","wires":[["503f07b6.8177c8"]]},{"id":"503f07b6.8177c8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2465.357437133789,"y":3026.4487466812134,"z":"c6a6763c.4a8938","wires":[["a1d0b29.32de85"]]},{"id":"464cbd36.e681d4","type":"set","name":"set variables for generating unique name","xml":"<set>\n<parameter name='generate-unique-name-input.index-table-name' value='EIPAM_CLIENT_KEY_INDEX' />\n<parameter name='generate-unique-name-input.index-table-prefix-column' value='vnf_name_prefix' />\n<parameter name='generate-unique-name-input.name-table-type' value='VNFAPI_CLIENT_KEY' />\n<parameter name='generate-unique-name-input.prefix'\n\tvalue=\"`$vnf-topology-operation-input.vnf-request-information.vnf-name + ':' +\n\t\t$tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-type + ':' +\n\t\t$tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks[$network-role-index].network-role + ':'`\" />\n<parameter name='generate-unique-name-input.index-length' value='2' />\n\n<!-- zrdm3mmex57_vlc:vlc:sctp_a:01 -->","comments":"","x":2130.023910522461,"y":2979.019688606262,"z":"c6a6763c.4a8938","wires":[]},{"id":"a1d0b29.32de85","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`$generate-unique-name-output.error-message`\" />\n","comments":"","x":2621.7858657836914,"y":3026.305785179138,"z":"c6a6763c.4a8938","wires":[]},{"id":"d8725c39.89566","type":"get-resource","name":"get-resource VFC_MODEL","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VFC_MODEL WHERE customization_uuid = $db.vf-module-to-vfc-mapping[$vm-type-index].vfc-customization-uuid'\n  pfx='db.vfc-model'>\n\n","comments":"","outputs":1,"x":1079.9999771118164,"y":1000.7376537322998,"z":"c6a6763c.4a8938","wires":[["783971a3.9819a","282c150e.65d37a"]]},{"id":"b3b0020d.74ce7","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No entries found in VFC_MODEL table for customization UUID ' + $db.vf-module-to-vfc-mapping[$db-vm-index].vfc-customization-uuid`\" />\n","comments":"","x":1476.4283256530762,"y":1025.1660461425781,"z":"c6a6763c.4a8938","wires":[]},{"id":"783971a3.9819a","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1302.7855949401855,"y":980.1184043884277,"z":"c6a6763c.4a8938","wires":[["b7066615.e7f238"]]},{"id":"282c150e.65d37a","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1310.3570251464844,"y":1025.4041175842285,"z":"c6a6763c.4a8938","wires":[["b3b0020d.74ce7"]]},{"id":"b7066615.e7f238","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VFC_MODEL table\" />\n","comments":"","x":1476.7855262756348,"y":980.2613048553467,"z":"c6a6763c.4a8938","wires":[]},{"id":"8c428202.a4584","type":"set","name":"set vnf-vms[] data","xml":"<set>\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-type'\n   value='`$db.vf-module-to-vfc-mapping[$vm-type-index].vm-type`' />\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-count'\n   value='`$db.vf-module-to-vfc-mapping[$vm-type-index].vm-count`' />\n\n","comments":"","x":1049.2976531982422,"y":1148.356819152832,"z":"c6a6763c.4a8938","wires":[]},{"id":"96d35d.16f99ca","type":"for","name":"for each vm-count","xml":"<for index='vm-index' start='0' end='`$db.vf-module-to-vfc-mapping[$vm-type-index].vm-count`' >\n","comments":"","outputs":1,"x":1051.6307220458984,"y":1212.6098346710205,"z":"c6a6763c.4a8938","wires":[["ce61047d.6b6798"]]},{"id":"9b33cb2.cd1cb38","type":"call","name":"call GENERIC-RESOURCE-API:generate-unique-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-unique-name' mode='sync' >\n","comments":"","outputs":1,"x":1584.0593452453613,"y":1240.2289810180664,"z":"c6a6763c.4a8938","wires":[["e1a23a4b.e7ad28","645ecf24.2a316"]]},{"id":"e1a23a4b.e7ad28","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1879.7736333211265,"y":1213.0862436294556,"z":"c6a6763c.4a8938","wires":[["64093666.6d3df8"]]},{"id":"645ecf24.2a316","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1883.1069831848145,"y":1264.7528867721558,"z":"c6a6763c.4a8938","wires":[["d1a2193e.7c37a8"]]},{"id":"9a519830.138b58","type":"set","name":"set variables for generating unique name","xml":"<set>\n<parameter name='generate-unique-name-input.index-table-name' value='VM_NAME_INDEX' />\n<parameter name='generate-unique-name-input.index-table-prefix-column' value='vm_name_prefix' />\n<parameter name='generate-unique-name-input.name-table-type' value='VNFAPI_VM_INSTANCE' />\n<parameter name='x' value=\"`$vnf-topology-operation-input.vnf-request-information.generic-vnf-name`\" />\n<parameter name='y' value=\"`$db.vfc-model.nfc-naming-code`\" />\n<parameter name='generate-unique-name-input.prefix' value=\"`$vnf-topology-operation-input.vnf-request-information.generic-vnf-name + $db.vfc-model.nfc-naming-code`\" />\n<parameter name='generate-unique-name-input.index-length' value='3' />\n","comments":"","x":1540.726058959961,"y":1188.562307357788,"z":"c6a6763c.4a8938","wires":[]},{"id":"d1a2193e.7c37a8","type":"set","name":"set generated name","xml":"<set>\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-names[$vm-index].vm-name' value='`$generate-unique-name-output.generated-name`' />\n","comments":"","x":2067.630699157715,"y":1264.228904724121,"z":"c6a6763c.4a8938","wires":[]},{"id":"64093666.6d3df8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`$generate-unique-name-output.error-message`\" />\n","comments":"","x":2047.630746205648,"y":1212.5147552490234,"z":"c6a6763c.4a8938","wires":[]},{"id":"ce61047d.6b6798","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1258.0356636047363,"y":1212.2527389526367,"z":"c6a6763c.4a8938","wires":[["9a519830.138b58","9b33cb2.cd1cb38"]]},{"id":"76c54fa9.38022","type":"switchNode","name":"switch ecomp-generated-naming == 'Y'","xml":"<switch test=\"$db.vfc-model.ecomp-generated-naming == 'Y'\">\n","comments":"","outputs":1,"x":1115.9403839111328,"y":1080.4993133544922,"z":"c6a6763c.4a8938","wires":[["53ce2381.2090fc"]]},{"id":"53ce2381.2090fc","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":1347.6069946289062,"y":1080.4989442825317,"z":"c6a6763c.4a8938","wires":[["63254101.50f2a"]]},{"id":"63254101.50f2a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'ECOMP generated naming is not Y for VFC customization UUID ' + $db.vf-module-to-vfc-mapping[$db-vm-index].vfc-customization-uuid`\" />\n","comments":"","x":1494.2737350463867,"y":1079.8323993682861,"z":"c6a6763c.4a8938","wires":[]},{"id":"46a48b56.e456d4","type":"comment","name":"1707 assumes same ipv4-ip-count and ipv6-ip-count the same","info":"","comments":"","x":1197.7381286621094,"y":2927.035418510437,"z":"c6a6763c.4a8938","wires":[]},{"id":"9226d6f7.945608","type":"for","name":"for each network-role in vm-networks","xml":"<for index='network-role-index' start='0' end='`$tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks_length`' >\n","comments":"","outputs":1,"x":884.8809127807617,"y":2980.5825901031494,"z":"c6a6763c.4a8938","wires":[["4fd57938.fd6288"]]},{"id":"ec67f8aa.5a4cc8","type":"comment","name":"Set vnf-vms[]","info":"","comments":"","x":842.0832824707031,"y":1064.487636566162,"z":"c6a6763c.4a8938","wires":[]},{"id":"3112f18c.d7febe","type":"set","name":"set vm-names_length","xml":"<set>\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-names_length'\n  value='`$db.vf-module-to-vfc-mapping[$vm-type-index].vm-count`' />\n","comments":"","x":1062.547519683838,"y":1289.1103086471558,"z":"c6a6763c.4a8938","wires":[]},{"id":"b1e903e3.a9656","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$tmp.vnf-topology.vnf-assignments.vnf-vms_length`' >\n","comments":"","outputs":1,"x":620.3094863891602,"y":2980.130418777466,"z":"c6a6763c.4a8938","wires":[["9226d6f7.945608"]]},{"id":"a8d8485a.c01bd8","type":"for","name":"for plans in eipam-ip-block.plans","xml":"<for index='plans-index' start='0' end='`$eipam-ip-block.plans_length`' >\n","comments":"","outputs":1,"x":2100.142868041992,"y":3394.5238189697266,"z":"c6a6763c.4a8938","wires":[["d21eb1a7.a1a34"]]},{"id":"1bbc0c5c.b5a494","type":"switchNode","name":"switch eipam-ip-block.plans_length","xml":"<switch test='`$eipam-ip-block.plans_length`'>\n","comments":"","outputs":1,"x":2109.190517425537,"y":3305.904595851898,"z":"c6a6763c.4a8938","wires":[["c1c303a7.b62b9","69212587.efd27c"]]},{"id":"c1c303a7.b62b9","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":2376.404853820801,"y":3281.725981235504,"z":"c6a6763c.4a8938","wires":[["66ca4c22.7c8a04"]]},{"id":"e1bf439.0dee4c","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"eipam-ip-block.plans[] is null.\" />\n","comments":"","x":2781.1190605163574,"y":3303.2259278297424,"z":"c6a6763c.4a8938","wires":[]},{"id":"76c321b0.d733e","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"`'eipam-ip-block.plans['+ $plans-index +'].requests[] is null.'`\" />\n","comments":"","x":3081.06339263916,"y":3397.162829399109,"z":"c6a6763c.4a8938","wires":[]},{"id":"304e678e.946e88","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":2739.7777404785156,"y":3375.2341175079346,"z":"c6a6763c.4a8938","wires":[["71155dea.d5c054"]]},{"id":"1c8f57b8.7e9de8","type":"switchNode","name":"switch requests_length","xml":"<switch test='`$eipam-ip-block.plans[$plans-index].requests_length`'>\n","comments":"","outputs":1,"x":2559.2063217163086,"y":3394.912588119507,"z":"c6a6763c.4a8938","wires":[["304e678e.946e88","ad0e3173.986be"]]},{"id":"ce019ac0.7cad08","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2466.5833473205566,"y":3168.6545939445496,"z":"c6a6763c.4a8938","wires":[["d05f74bb.e28858","2e3396bb.a9dc1a"]]},{"id":"69212587.efd27c","type":"outcome","name":"0","xml":"<outcome value='0'>","comments":"","outputs":1,"x":2377.476261138916,"y":3328.154568195343,"z":"c6a6763c.4a8938","wires":[["66ca4c22.7c8a04"]]},{"id":"66ca4c22.7c8a04","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2572.0833702087402,"y":3303.4046387672424,"z":"c6a6763c.4a8938","wires":[["e1bf439.0dee4c","2e3396bb.a9dc1a"]]},{"id":"71155dea.d5c054","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2892.5278244018555,"y":3397.6270179748535,"z":"c6a6763c.4a8938","wires":[["76c321b0.d733e","2e3396bb.a9dc1a"]]},{"id":"ad0e3173.986be","type":"outcome","name":"0","xml":"<outcome value='0'>","comments":"","outputs":1,"x":2740.277820587158,"y":3419.1270141601562,"z":"c6a6763c.4a8938","wires":[["71155dea.d5c054"]]},{"id":"53449ad4.088df4","type":"for","name":"for each rqst in requests","xml":"<for index='rqst-index' start='0' end='`$eipam-ip-block.plans[$plans-index].requests_length`' >\n","comments":"","outputs":1,"x":2563.722213745117,"y":3473.987840652466,"z":"c6a6763c.4a8938","wires":[["39f5f08d.dbc63"]]},{"id":"d21eb1a7.a1a34","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2347.611099243164,"y":3394.87654876709,"z":"c6a6763c.4a8938","wires":[["1c8f57b8.7e9de8","53449ad4.088df4"]]},{"id":"7f727408.3c054c","type":"set","name":"set vnf-networks_length","xml":"<set>\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-networks_length'\n  value='`$network-index`' />\n","comments":"","x":1062.5597381591797,"y":2092.975839614868,"z":"c6a6763c.4a8938","wires":[]},{"id":"946d1e34.4231","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":672.1666793823242,"y":712.3209276199341,"z":"c6a6763c.4a8938","wires":[["811225ec.4649e8","31be1c0b.e4a514"]]},{"id":"2e3396bb.a9dc1a","type":"call","name":"call: rollback-eipam-ip-assignment","xml":"<call module='VNF-API' rpc='rollback-eipam-ip-assignment' mode='sync' >","comments":"","outputs":1,"x":3079.9761543273926,"y":3168.3689274787903,"z":"c6a6763c.4a8938","wires":[[]]},{"id":"817518c2.6f35c8","type":"call","name":"call: eipam-mobility-ip-assignment","xml":"<call module='VNF-API' rpc='eipam-mobility-ip-assignment' mode='sync' >","comments":"","outputs":1,"x":2107.4361000061035,"y":3120.408854007721,"z":"c6a6763c.4a8938","wires":[[]]},{"id":"bf9d4319.1481e","type":"set","name":"copy input data","xml":"<set>\n\t<parameter name=\"service-data.\" value=\"vnf-topology-operation-input.\" />","comments":"","x":688.7737045288086,"y":513.5952196121216,"z":"c6a6763c.4a8938","wires":[]},{"id":"317a074d.bd4138","type":"get-resource","name":"get-resource VFC_TO_NETWORK_ROLE_MAPPING","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VFC_TO_NETWORK_ROLE_MAPPING WHERE vfc_customization_uuid = $db.vf-module-to-vfc-mapping[$vm-type-index].vfc-customization-uuid'\n  pfx='db.vfc-to-network-role-mapping[]'>\n\n","comments":"","outputs":1,"x":1161.6666259765625,"y":1354.999912261963,"z":"c6a6763c.4a8938","wires":[["5622a9a8.299278","400145c8.a5820c"]]},{"id":"5622a9a8.299278","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1448.8808288574219,"y":1335.3807592391968,"z":"c6a6763c.4a8938","wires":[["caac1149.1f034"]]},{"id":"400145c8.a5820c","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1457.4522590637207,"y":1379.6664724349976,"z":"c6a6763c.4a8938","wires":[["d6f31097.71144"]]},{"id":"caac1149.1f034","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VFC_TO_NETWORK_ROLE_MAPPING table\" />\n","comments":"","x":1623.880760192871,"y":1334.5236597061157,"z":"c6a6763c.4a8938","wires":[]},{"id":"d6f31097.71144","type":"set","name":"set vfc-to-network-role-mapping length to 0","xml":"<set>\n<parameter name='db.vfc-to-network-role-mapping_length' value='0' />\n","comments":"","x":1720.857078552246,"y":1379.6748628616333,"z":"c6a6763c.4a8938","wires":[]},{"id":"e09776e2.09fce8","type":"set","name":"set local ip-version","xml":"<set>\n<parameter name='tmp.local.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks[$network-role-index].ip-version'\n   value='ipv6' />\n","comments":"","x":1974.5473403930664,"y":2637.082179069519,"z":"c6a6763c.4a8938","wires":[]},{"id":"f65ee3e0.f68a8","type":"set","name":"set local.ip-version","xml":"<set>\n<parameter name='tmp.local.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks[$network-role-index].ip-version'\n   value='ipv4' />   ","comments":"","x":1979.547462463379,"y":2455.749161720276,"z":"c6a6763c.4a8938","wires":[]},{"id":"bca0b7c7.7693f8","type":"set","name":"set vm-networks[].network-role","xml":"<set>\n<parameter name='tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks[$network-role-index].network-role'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].network-role`' />","comments":"","x":1447.142837524414,"y":2689.9998846054077,"z":"c6a6763c.4a8938","wires":[]},{"id":"d199b2c.f491e5","type":"for","name":"for ip-count-index in ip-count","xml":"<for index='ip-count-index' start='0' end='`$tmp.vnf-topology.vnf-assignments.vnf-vms[$vm-type-index].vm-networks[$network-role-index].ip-count`'>","comments":"","outputs":1,"x":1555.333152770996,"y":2979.66695022583,"z":"c6a6763c.4a8938","wires":[["840dab74.e88378"]]}]
